!function(s,o,e){function n(e,t,i){return e.call.apply(e.bind,arguments)}function a(t,i,e){if(!t)throw Error();if(2<arguments.length){var o=Array.prototype.slice.call(arguments,2);return function(){var e=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(e,o),t.apply(i,e)}}return function(){return t.apply(i,arguments)}}function d(e,t,i){return(d=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?n:a).apply(null,arguments)}var r=Date.now||function(){return+new Date};function l(e,t){this.J=e,this.w=t||e,this.F=this.w.document}function c(e,t,i){(e=e.F.getElementsByTagName(t)[0])||(e=o.documentElement),e&&e.lastChild&&e.insertBefore(i,e.lastChild)}function h(e,t,i){t=t||[],i=i||[];for(var o=e.className.split(/\s+/),n=0;n<t.length;n+=1){for(var a=!1,r=0;r<o.length;r+=1)if(t[n]===o[r]){a=!0;break}a||o.push(t[n])}for(t=[],n=0;n<o.length;n+=1){for(a=!1,r=0;r<i.length;r+=1)if(o[n]===i[r]){a=!0;break}a||t.push(o[n])}e.className=t.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function u(e,t){for(var i=e.className.split(/\s+/),o=0,n=i.length;o<n;o++)if(i[o]==t)return!0;return!1}function g(e){if("string"==typeof e.na)return e.na;var t=e.w.location.protocol;return"about:"==t&&(t=e.J.location.protocol),"https:"==t?"https:":"http:"}function p(e,t){var i=e.createElement("link",{rel:"stylesheet",href:t,media:"all"}),o=!1;i.onload=function(){o||(o=!0)},i.onerror=function(){o||(o=!0)},c(e,"head",i)}function m(e,t,i,o){var n=e.F.getElementsByTagName("head")[0];if(n){var a=e.createElement("script",{src:t}),r=!1;return a.onload=a.onreadystatechange=function(){r||this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(r=!0,i&&i(null),a.onload=a.onreadystatechange=null,"HEAD"==a.parentNode.tagName&&n.removeChild(a))},n.appendChild(a),s.setTimeout(function(){r||(r=!0,i&&i(Error("Script load timeout")))},o||5e3),a}return null}function f(e,t){this.N=e,this.ga=t}function v(e,t,i,o){this.d=null!=e?e:null,this.g=null!=t?t:null,this.B=null!=i?i:null,this.f=null!=o?o:null}l.prototype.createElement=function(e,t,i){if(e=this.F.createElement(e),t)for(var o in t)t.hasOwnProperty(o)&&("style"==o?e.style.cssText=t[o]:e.setAttribute(o,t[o]));return i&&e.appendChild(this.F.createTextNode(i)),e};var b=/^([0-9]+)(?:[\._-]([0-9]+))?(?:[\._-]([0-9]+))?(?:[\._+-]?(.*))?$/;function y(e){var t=null,i=null,o=null,n=null;return(e=b.exec(e))&&(null!==e[1]&&e[1]&&(t=parseInt(e[1],10)),null!==e[2]&&e[2]&&(i=parseInt(e[2],10)),null!==e[3]&&e[3]&&(o=parseInt(e[3],10)),null!==e[4]&&e[4]&&(n=/^[0-9]+$/.test(e[4])?parseInt(e[4],10):e[4])),new v(t,i,o,n)}function w(e,t,i,o,n,a,r,s){this.L=e,this.m=s}function i(e){this.a=e}v.prototype.compare=function(e){return this.d>e.d||this.d===e.d&&this.g>e.g||this.d===e.d&&this.g===e.g&&this.B>e.B?1:this.d<e.d||this.d===e.d&&this.g<e.g||this.d===e.d&&this.g===e.g&&this.B<e.B?-1:0},v.prototype.toString=function(){return[this.d,this.g||"",this.B||"",this.f||""].join("")},w.prototype.getName=function(){return this.L};var _=new w("Unknown",0,0,0,0,0,0,new f(!1,!1));function C(e){var t=x(e.a,/(iPod|iPad|iPhone|Android|Windows Phone|BB\d{2}|BlackBerry)/,1);return""!=t?(/BB\d{2}/.test(t)&&(t="BlackBerry"),t):""!=(e=x(e.a,/(Linux|Mac_PowerPC|Macintosh|Windows|CrOS|PlayStation|CrKey)/,1))?("Mac_PowerPC"==e?e="Macintosh":"PlayStation"==e&&(e="Linux"),e):"Unknown"}function S(e){if((t=x(e.a,/(OS X|Windows NT|Android) ([^;)]+)/,2))||(t=x(e.a,/Windows Phone( OS)? ([^;)]+)/,2))||(t=x(e.a,/(iPhone )?OS ([\d_]+)/,2)))return t;if(t=x(e.a,/(?:Linux|CrOS|CrKey) ([^;)]+)/,1))for(var t=t.split(/\s/),i=0;i<t.length;i+=1)if(/^[\d\._]+$/.test(t[i]))return t[i];return(e=x(e.a,/(BB\d{2}|BlackBerry).*?Version\/([^\s]*)/,2))?e:"Unknown"}function k(e){var t=C(e),i=y(S(e)),o=y(x(e.a,/AppleWeb(?:K|k)it\/([\d\.\+]+)/,1)),n="Unknown",a=new v;a="Unknown";return/OPR\/[\d.]+/.test(e.a)?n="Opera":-1!=e.a.indexOf("Chrome")||-1!=e.a.indexOf("CrMo")||-1!=e.a.indexOf("CriOS")?n="Chrome":/Silk\/\d/.test(e.a)?n="Silk":"BlackBerry"==t||"Android"==t?n="BuiltinBrowser":-1!=e.a.indexOf("PhantomJS")?n="PhantomJS":-1!=e.a.indexOf("Safari")?n="Safari":-1!=e.a.indexOf("AdobeAIR")?n="AdobeAIR":-1!=e.a.indexOf("PlayStation")&&(n="BuiltinBrowser"),"BuiltinBrowser"==n?a="Unknown":"Silk"==n?a=x(e.a,/Silk\/([\d\._]+)/,1):"Chrome"==n?a=x(e.a,/(Chrome|CrMo|CriOS)\/([\d\.]+)/,2):-1!=e.a.indexOf("Version/")?a=x(e.a,/Version\/([\d\.\w]+)/,1):"AdobeAIR"==n?a=x(e.a,/AdobeAIR\/([\d\.]+)/,1):"Opera"==n?a=x(e.a,/OPR\/([\d.]+)/,1):"PhantomJS"==n&&(a=x(e.a,/PhantomJS\/([\d.]+)/,1)),a=y(a),new w(n,0,0,0,0,0,0,new f("AdobeAIR"==n?2<a.d||2==a.d&&5<=a.g:"BlackBerry"==t?10<=i.d:"Android"==t?2<i.d||2==i.d&&1<i.g:526<=o.d||525<=o.d&&13<=o.g,o.d<536||536==o.d&&o.g<11))}function x(e,t,i){return(e=e.match(t))&&e[i]?e[i]:""}function E(e){this.ma=e||"-"}function I(e,t){this.L=e,this.X=4,this.M="n";var i=(t||"n4").match(/^([nio])([1-9])$/i);i&&(this.M=i[1],this.X=parseInt(i[2],10))}function T(e){return e.M+e.X}function A(e,t){this.c=e,this.q=e.w.document.documentElement,this.P=t,this.j="wf",this.h=new E("-"),this.ha=!1!==t.events,this.C=!1!==t.classes}function M(e){if(e.C){var t=u(e.q,e.h.f(e.j,"active")),i=[],o=[e.h.f(e.j,"loading")];t||i.push(e.h.f(e.j,"inactive")),h(e.q,i,o)}P(e,"inactive")}function P(e,t,i){e.ha&&e.P[t]&&(i?e.P[t](i.getName(),T(i)):e.P[t]())}function t(){this.ca={}}function O(e,t){this.c=e,this.H=t,this.k=this.c.createElement("span",{"aria-hidden":"true"},this.H)}function L(e){c(e.c,"body",e.k)}function D(e){var t;t=[];for(var i=e.L.split(/,\s*/),o=0;o<i.length;o++){var n=i[o].replace(/['"]/g,"");-1==n.indexOf(" ")?t.push(n):t.push("'"+n+"'")}return t=t.join(","),i="normal","o"===e.M?i="oblique":"i"===e.M&&(i="italic"),"display:block;position:absolute;top:-9999px;left:-9999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+t+";font-style:"+i+";font-weight:"+e.X+"00;"}function N(e,t,i,o,n,a,r,s){this.Y=e,this.ka=t,this.c=i,this.o=o,this.m=n,this.H=s||"BESbswy",this.v={},this.W=a||3e3,this.ba=r||null,this.G=this.u=this.t=null,this.t=new O(this.c,this.H),this.u=new O(this.c,this.H),this.G=new O(this.c,this.H),e=D(e=new I("serif",T(this.o))),this.t.k.style.cssText=e,e=D(e=new I("sans-serif",T(this.o))),this.u.k.style.cssText=e,e=D(e=new I("monospace",T(this.o))),this.G.k.style.cssText=e,L(this.t),L(this.u),L(this.G),this.v.serif=this.t.k.offsetWidth,this.v["sans-serif"]=this.u.k.offsetWidth,this.v.monospace=this.G.k.offsetWidth}i.prototype.parse=function(){var e;if(-1!=this.a.indexOf("MSIE")||-1!=this.a.indexOf("Trident/")){e=C(this);var t=y(S(this)),i=null,o=x(this.a,/Trident\/([\d\w\.]+)/,1);i=-1!=this.a.indexOf("MSIE")?y(x(this.a,/MSIE ([\d\w\.]+)/,1)):y(x(this.a,/rv:([\d\w\.]+)/,1));""!=o&&y(o),e=new w("MSIE",0,0,0,0,0,0,new f("Windows"==e&&6<=i.d||"Windows Phone"==e&&8<=t.d,!1))}else if(-1!=this.a.indexOf("Opera"))e:if(e=y(x(this.a,/Presto\/([\d\w\.]+)/,1)),y(S(this)),null!==e.d||y(x(this.a,/rv:([^\)]+)/,1)),-1!=this.a.indexOf("Opera Mini/"))e=y(x(this.a,/Opera Mini\/([\d\.]+)/,1)),e=new w("OperaMini",0,0,0,C(this),0,0,new f(!1,!1));else{if(-1!=this.a.indexOf("Version/")&&null!==(e=y(x(this.a,/Version\/([\d\.]+)/,1))).d){e=new w("Opera",0,0,0,C(this),0,0,new f(10<=e.d,!1));break e}e=null!==(e=y(x(this.a,/Opera[\/ ]([\d\.]+)/,1))).d?new w("Opera",0,0,0,C(this),0,0,new f(10<=e.d,!1)):new w("Opera",0,0,0,C(this),0,0,new f(!1,!1))}else e=/OPR\/[\d.]+/.test(this.a)?k(this):/AppleWeb(K|k)it/.test(this.a)?k(this):-1!=this.a.indexOf("Gecko")?(e="Unknown",t=new v,y(S(this)),t=!1,-1!=this.a.indexOf("Firefox")?(e="Firefox",t=3<=(t=y(x(this.a,/Firefox\/([\d\w\.]+)/,1))).d&&5<=t.g):-1!=this.a.indexOf("Mozilla")&&(e="Mozilla"),i=y(x(this.a,/rv:([^\)]+)/,1)),t||(t=1<i.d||1==i.d&&9<i.g||1==i.d&&9==i.g&&2<=i.B),new w(e,0,0,0,C(this),0,0,new f(t,!1))):_;return e},E.prototype.f=function(e){for(var t=[],i=0;i<arguments.length;i++)t.push(arguments[i].replace(/[\W_]+/g,"").toLowerCase());return t.join(this.ma)},I.prototype.getName=function(){return this.L},O.prototype.remove=function(){var e=this.k;e.parentNode&&e.parentNode.removeChild(e)};var $={sa:"serif",ra:"sans-serif",qa:"monospace"};function V(e,t,i){for(var o in $)if($.hasOwnProperty(o)&&t===e.v[$[o]]&&i===e.v[$[o]])return!0;return!1}function H(e){var t=e.t.k.offsetWidth,i=e.u.k.offsetWidth;t===e.v.serif&&i===e.v["sans-serif"]||e.m.ga&&V(e,t,i)?r()-e.oa>=e.W?e.m.ga&&V(e,t,i)&&(null===e.ba||e.ba.hasOwnProperty(e.o.getName()))?R(e,e.Y):R(e,e.ka):setTimeout(d(function(){H(this)},e),50):R(e,e.Y)}function R(e,t){e.t.remove(),e.u.remove(),e.G.remove(),t(e.o)}function G(e,t,i,o){this.c=t,this.A=i,this.R=0,this.ea=this.aa=!1,this.W=o,this.m=e.m}function F(e,t,i,o,n){if(i=i||{},0===t.length&&n)M(e.A);else for(e.R+=t.length,n&&(e.aa=n),n=0;n<t.length;n++){var a=t[n],r=i[a.getName()],s=e.A,l=a;s.C&&h(s.q,[s.h.f(s.j,l.getName(),T(l).toString(),"loading")]),P(s,"fontloading",l),s=null,(s=new N(d(e.ia,e),d(e.ja,e),e.c,a,e.m,e.W,o,r)).start()}}function B(e){0==--e.R&&e.aa&&(e.ea?((e=e.A).C&&h(e.q,[e.h.f(e.j,"active")],[e.h.f(e.j,"loading"),e.h.f(e.j,"inactive")]),P(e,"active")):M(e.A))}function z(e){this.J=e,this.Z=new t,this.pa=new i(e.navigator.userAgent),this.a=this.pa.parse(),this.T=this.U=0,this.Q=this.S=!0}function q(e,t){ae.Z.ca[e]=t}function W(e,t,i){this.O=e||t+j,this.s=[],this.V=[],this.fa=i||""}N.prototype.start=function(){this.oa=r();var e=D(e=new I(this.o.getName()+",serif",T(this.o)));this.t.k.style.cssText=e,e=D(e=new I(this.o.getName()+",sans-serif",T(this.o))),this.u.k.style.cssText=e,H(this)},G.prototype.ia=function(e){var t=this.A;t.C&&h(t.q,[t.h.f(t.j,e.getName(),T(e).toString(),"active")],[t.h.f(t.j,e.getName(),T(e).toString(),"loading"),t.h.f(t.j,e.getName(),T(e).toString(),"inactive")]),P(t,"fontactive",e),this.ea=!0,B(this)},G.prototype.ja=function(e){var t=this.A;if(t.C){var i=u(t.q,t.h.f(t.j,e.getName(),T(e).toString(),"active")),o=[],n=[t.h.f(t.j,e.getName(),T(e).toString(),"loading")];i||o.push(t.h.f(t.j,e.getName(),T(e).toString(),"inactive")),h(t.q,o,n)}P(t,"fontinactive",e),B(this)},z.prototype.load=function(e){this.c=new l(this.J,e.context||this.J),this.S=!1!==e.events,this.Q=!1!==e.classes;var t=new A(this.c,e),i=[],o=e.timeout;t.C&&h(t.q,[t.h.f(t.j,"loading")]),P(t,"loading");i=this.Z;var n,a=this.c,r=[];for(n in e)if(e.hasOwnProperty(n)){var s=i.ca[n];s&&r.push(s(e[n],a))}for(i=r,this.T=this.U=i.length,e=new G(this.a,this.c,t,o),o=0,n=i.length;o<n;o++)(a=i[o]).D(this.a,d(this.la,this,a,t,e))},z.prototype.la=function(e,t,d,i){var c=this;i?e.load(function(e,t,i){var o,n,a,r,s,l;n=d,a=e,r=t,s=i,l=0==--(o=c).U,(o.Q||o.S)&&setTimeout(function(){F(n,a,r||null,s||null,l)},0)}):(e=0==--this.U,this.T--,e&&0==this.T?M(t):(this.Q||this.S)&&F(d,[],{},null,e))};var j="//fonts.googleapis.com/css";function U(e){this.s=e,this.da=[],this.K={}}W.prototype.f=function(){if(0==this.s.length)throw Error("No fonts to load!");if(-1!=this.O.indexOf("kit="))return this.O;for(var e=this.s.length,t=[],i=0;i<e;i++)t.push(this.s[i].replace(/ /g,"+"));return e=this.O+"?family="+t.join("%7C"),0<this.V.length&&(e+="&subset="+this.V.join(",")),0<this.fa.length&&(e+="&text="+encodeURIComponent(this.fa)),e};var K={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"},Z={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},X={i:"i",italic:"i",n:"n",normal:"n"},Y=/^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$/;function J(e,t){this.a=new i(navigator.userAgent).parse(),this.c=e,this.e=t}U.prototype.parse=function(){for(var e=this.s.length,t=0;t<e;t++){var i=this.s[t].split(":"),o=i[0].replace(/\+/g," "),n=["n4"];if(2<=i.length){var a;if(a=[],r=i[1])for(var r,s=(r=r.split(",")).length,l=0;l<s;l++){var d;if((d=r[l]).match(/^[\w-]+$/)){var c=void 0;if(null==(d=Y.exec(d.toLowerCase())))c="";else{if(c=void 0,null==(c=d[1])||""==c)c="4";else{var h=Z[c];c=h||(isNaN(c)?"4":c.substr(0,1))}c=[null==(d=d[2])||""==d?"n":X[d],c].join("")}d=c}else d="";d&&a.push(d)}0<a.length&&(n=a),3==i.length&&(a=[],0<(i=(i=i[2])?i.split(","):a).length&&(i=K[i[0]])&&(this.K[o]=i))}for(this.K[o]||(i=K[o])&&(this.K[o]=i),i=0;i<n.length;i+=1)this.da.push(new I(o,n[i]))}};var Q={Arimo:!0,Cousine:!0,Tinos:!0};function ee(e,t){this.c=e,this.e=t,this.p=[]}function te(e,t){this.c=e,this.e=t,this.p=[]}function ie(e,t){this.c=e,this.e=t,this.p=[]}function oe(e,t){this.c=e,this.e=t}function ne(e,t){this.c=e,this.e=t}J.prototype.D=function(e,t){t(e.m.N)},J.prototype.load=function(e){var t,i,o=this.c;"MSIE"==this.a.getName()&&1!=this.e.blocking?(t=o,i=d(this.$,this,e),function e(){t.F.body?i():setTimeout(e,0)}()):this.$(e)},J.prototype.$=function(e){for(var t=this.c,i=new W(this.e.api,g(t),this.e.text),o=this.e.families,n=o.length,a=0;a<n;a++){var r=o[a].split(":");3==r.length&&i.V.push(r.pop());var s="";2==r.length&&""!=r[1]&&(s=":"),i.s.push(r.join(s))}(o=new U(o)).parse(),p(t,i.f()),e(o.da,o.K,Q)},ee.prototype.I=function(e){var t=this.c;return g(this.c)+(this.e.api||"//f.fontdeck.com/s/css/js/")+(t.w.location.hostname||t.J.location.hostname)+"/"+e+".js"},ee.prototype.D=function(e,d){var t=this.e.id,i=this.c.w,c=this;t?(i.__webfontfontdeckmodule__||(i.__webfontfontdeckmodule__={}),i.__webfontfontdeckmodule__[t]=function(e,t){for(var i=0,o=t.fonts.length;i<o;++i){var n=t.fonts[i];c.p.push(new I(n.name,(a="font-weight:"+n.weight+";font-style:"+n.style,l=s=r=void 0,r=4,s="n",l=null,a&&((l=a.match(/(normal|oblique|italic)/i))&&l[1]&&(s=l[1].substr(0,1).toLowerCase()),(l=a.match(/([1-9]00|normal|bold)/i))&&l[1]&&(/bold/i.test(l[1])?r=7:/[1-9]00/.test(l[1])&&(r=parseInt(l[1].substr(0,1),10)))),s+r)))}var a,r,s,l;d(e)},m(this.c,this.I(t),function(e){e&&d(!1)})):d(!1)},ee.prototype.load=function(e){e(this.p)},te.prototype.I=function(e){var t=g(this.c);return(this.e.api||t+"//use.typekit.net")+"/"+e+".js"},te.prototype.D=function(e,a){var t=this.e.id,r=this.c.w,s=this;t?m(this.c,this.I(t),function(e){if(e)a(!1);else{if(r.Typekit&&r.Typekit.config&&r.Typekit.config.fn){e=r.Typekit.config.fn;for(var t=0;t<e.length;t+=2)for(var i=e[t],o=e[t+1],n=0;n<o.length;n++)s.p.push(new I(i,o[n]));try{r.Typekit.load({events:!1,classes:!1})}catch(e){}}a(!0)}},2e3):a(!1)},te.prototype.load=function(e){e(this.p)},ie.prototype.D=function(i,o){var n=this,a=n.e.projectId,e=n.e.version;if(a){var r=n.c.w;m(this.c,n.I(a,e),function(e){if(e)o(!1);else{if(r["__mti_fntLst"+a]&&(e=r["__mti_fntLst"+a]()))for(var t=0;t<e.length;t++)n.p.push(new I(e[t].fontfamily));o(i.m.N)}}).id="__MonotypeAPIScript__"+a}else o(!1)},ie.prototype.I=function(e,t){return g(this.c)+"//"+(this.e.api||"fast.fonts.net/jsapi").replace(/^.*http(s?):(\/\/)?/,"")+"/"+e+".js"+(t?"?v="+t:"")},ie.prototype.load=function(e){e(this.p)},oe.prototype.load=function(e){var t,i,o=this.e.urls||[],n=this.e.families||[],a=this.e.testStrings||{};for(t=0,i=o.length;t<i;t++)p(this.c,o[t]);for(o=[],t=0,i=n.length;t<i;t++){var r=n[t].split(":");if(r[1])for(var s=r[1].split(","),l=0;l<s.length;l+=1)o.push(new I(r[0],s[l]));else o.push(new I(r[0]))}e(o,a)},oe.prototype.D=function(e,t){return t(e.m.N)},ne.prototype.load=function(e){var t,i,o=this.e.families||[];0<o.length&&(""!==(t=o.join("|"))&&(t=t.replace(/ /g,""),p(this.c,"/type/css?family="+t)));var n=[];for(t=0,i=o.length;t<i;t++){var a=o[t].split(":");if(a[1])for(var r=a[1].split(","),s=0;s<r.length;s+=1)n.push(new I(a[0],r[s]));else n.push(new I(a[0]))}e(n)},ne.prototype.D=function(e,t){return t(e.m.N)};var ae=new z(this);q("custom",function(e,t){return new oe(t,e)}),q("Persona",function(e,t){return new ne(t,e)}),q("fontdeck",function(e,t){return new ee(t,e)}),q("monotype",function(e,t){return new ie(t,e)}),q("typekit",function(e,t){return new te(t,e)}),q("google",function(e,t){return new J(t,e)}),this.WebFont||(this.WebFont={},this.WebFont.load=d(ae.load,ae),this.WebFontConfig&&ae.load(this.WebFontConfig))}(this,document);var Cargo={o:{}};Cargo.o.model={},Cargo.o.collection={},Cargo.o.view={},Cargo.Router={},Cargo.Template={},Cargo.Helper={},Cargo.API={},Cargo.Event={},Cargo.Collection={},Cargo.Model={},Cargo.View={};var Action=window.Action||{};function in_array(e,t,i){var o="";if(!!i){for(o in t)if(t[o]===e)return!0}else for(o in t)if(t[o]==e)return!0;return!1}function strip_tags(e,i){i=(((i||"")+"").toLowerCase().match(/<[a-z][a-z0-9]*>/g)||[]).join("");return e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(e,t){return-1<i.indexOf("<"+t.toLowerCase()+">")?e:""})}function closest(e,t){var i=e&&(t(e)?e:closest(e.parentNode,t));return i||null}function ucFirst(e){return e?e.charAt(0).toUpperCase()+e.slice(1):e}function lerp(e,t,i){var o=Math.max(Math.min(i,1),0);return(1-o)*e+o*t}Cargo.Core={log:function(e){"undefined"!=typeof console&&window.console&&console.log(e)},KeyboardShortcut:{Add:function(e,t,i){var o={type:"keydown",disable_in_input:!0,propagate:!0,keycode:t};shortcut.add(e,i,o)},Remove:function(e){shortcut.remove(e)},InitDefaults:function(){Cargo.Helper.IsAdminPath()||(this.Add("X",88,function(){lightbox.isActive||Action.Page.Home()}),this.Add("I",73,function(){lightbox.isActive||Action.Page.Home()}),this.Add("J",74,function(){lightbox.isActive||Action.Page.Next()}),this.Add("K",75,function(){lightbox.isActive||Action.Page.Prev()}),this.Add("Right",39,function(){lightbox.isActive||Action.Page.Next()}),this.Add("Left",37,function(){lightbox.isActive||Action.Page.Prev()}),this.Add("R",82,function(){lightbox.isActive||Action.Page.Random()}),this.Add("Shift+G",71,function(){lightbox.isActive||Cargo.Helper.GoToUrl("img")}),this.Add("Meta+/",191,function(e){e.preventDefault(),Action.yepThisIsACargoSite()})),this.Add("Shift+A",65,function(){Cargo.Helper.GoToUrl("admin")});var d=0;mouseY=0,Cargo.Model.DisplayOptions.get("layout_options").is_feed&&window.addEventListener("mousemove",function(e){d=e.clientX,mouseY=e.clientY}),Cargo.Core.loadAdminForActivePage=function(){if(parent.location==window.location)if(Cargo.Model.Site.GetIsEditor()){var t,i,o,e,n,a,r=Cargo.View.Content.el.querySelectorAll(".page.container[data-id]"),s=window.innerHeight/2,l=9e9;_.each(r,function(e){e.style.minHeight="1px"}),_.each(r,function(e){(n=e.getBoundingClientRect()).top<mouseY&&n.bottom>mouseY&&n.left<d&&n.right>d&&(i=e),n.top<s&&n.bottom>s?(t=e,l=0):0<l&&(n.top>s?o=Math.abs(s-n.top):n.bottom<s&&(o=Math.abs(s-n.bottom)),o<l&&(t=e,l=o))}),_.each(r,function(e){e.style.minHeight=""}),(t||i)&&(i?a=parseInt(i.getAttribute("data-id")):t&&(a=parseInt(t.getAttribute("data-id"))),e=Cargo.Collection.Scaffolding.getModel({id:a})),!e&&Cargo.View.Content.currentSet&&(e=Cargo.View.Content.currentSet.model),e&&!e.get("pin")?((e.get("stack")||e.get("is_set"))&&e.get("pages")&&0<e.get("pages").length&&(e=e.get("pages").models[0]),Cargo.Helper.GoToUrl("admin/"+e.id)):Cargo.Helper.GoToUrl("admin")}else Cargo.Helper.GoToUrl("admin")},this.Add("Shift+E",69,Cargo.Core.loadAdminForActivePage),this.Add("Shift+H",72,function(){Cargo.Helper.GoToUrl("admin/design/html")}),this.Add("Shift+C",67,function(){Cargo.Helper.GoToUrl("admin/design/css")}),this.Add("Shift+I",73,function(){Cargo.Helper.GoToUrl("admin/design/css")}),this.Add("Shift+D",68,function(){Cargo.Helper.GoToUrl("admin/design")}),this.Add("Shift+X",88,function(){Cargo.Helper.GoToUrl("")}),this.Add("Esc",27,function(){Cargo.Helper.IsAdminPath()||(Cargo.View.Following.isActive()&&!Cargo.Modal.isActive()?Cargo.View.Following.Toggle():Cargo.View.SiteMenu.isActive()?Cargo.View.SiteMenu.hide():lightbox.isActive||Action.Page.Home())})}},InitKeycodeListener:function(){var e=_.bind(function(e){e.shiftKey||(83==e.keyCode&&(navigator.platform.match("Mac")?e.metaKey:e.ctrlKey)&&(e.preventDefault(),Cargo.Event.trigger("save_shortcut_triggered",e),Cargo.contentWindow||window.top.Cargo.Event.trigger("save_shortcut_triggered",e)),13==e.keyCode&&Cargo.Event.trigger("enter_keycode_triggered",e),27==e.keyCode&&Cargo.Event.trigger("esc_keycode_triggered",e))},this);document.addEventListener("keydown",e,!1)},InitMessageListener:function(){window.addEventListener("message",function(a){"object"==typeof a.data&&"retrieve-newsletter-html"===a.data.type&&a.data.pid&&Cargo.View.Content.retrieveActivePageViewForPID(a.data.pid,_.bind(function(n){n&&setTimeout(function(){var t="https://weekly.cargo.site/w/",e=n.el.querySelector(".page_content");_.each(e.querySelectorAll("a[href]"),function(e){e.setAttribute("href",t+a.data.newsLetterID+"/[email-id]/click?l="+e.href)}),_.each(e.querySelectorAll("img"),function(e){var t=e.getAttribute("src"),i=e.offsetWidth,o=e.offsetHeight;for(e.hasAttribute("data-lazy-src")&&(t=e.getAttribute("data-lazy-src"));0<e.attributes.length;)e.removeAttribute(e.attributes[0].name);e.setAttribute("src",t),e.setAttribute("width",i),e.setAttribute("height",o)});var i=document.createElement("a"),o=document.createElement("img");i.href=t+a.data.newsLetterID+"/[email-id]/unsubscribe",i.className="unsubscribe-link",i.innerHTML="Unsubscribe",o.src=t+a.data.newsLetterID+"/[email-id]/open.gif",o.width=1,o.height=1,o.style.visibility="hidden",o.className="tracking_pixel",e.appendChild(i),e.insertBefore(o,e.firstChild),parent.postMessage({type:"retrieve-newsletter-html-response",html:e.outerHTML,css:n.getLocalCSSElement().innerHTML.trim()},"*")},1e3)},this))},!1)},ReseedThumbnailCollection:function(){Cargo.Event.trigger("thumbnails:clear_cache"),Cargo.Collection.GlobalThumbnails.fetch({params:Cargo.Collection.GlobalThumbnails.currentParams,from_thumbnail_reseed:!0,reset:!0,merge:!0,success:function(){Cargo.View.Thumbnail.checkAndLoadThumbnails(Cargo.Helper.GetCurrentProjectId()),Cargo.Event.trigger("reseed_thumbnails_complete")}})}},Cargo.o.analytics=Backbone.View.extend({Config:{id:"UA-1837333-7",name:"__cargo_analytics"},initialize:function(){var e,t,i,o,n;this.enabled=!0!==Cargo.Model.DisplayOptions.get("analytics_disabled"),this.enabled&&(Cargo.API.Config.is_domain&&(this.Config.custom_url="/"+document.location.host),e=window,t=document,i="ga",e.GoogleAnalyticsObject=i,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,o=t.createElement("script"),n=t.getElementsByTagName("script")[0],o.async=1,o.src="https://www.google-analytics.com/analytics.js",n.parentNode.insertBefore(o,n),ga("create",this.Config.id,"auto",{name:this.Config.name,cookieName:this.Config.name}),this.pageview(!1))},setDimension:function(e,t){this.enabled&&ga(this.Config.name+".set",e,t)},pageview:function(e,t){var i=this.Config.name,o=document.location.pathname.replace(/\/$/,"");if(this.enabled){if(void 0!==t&&!e)return void ga(this.Config.name+".send","pageview",{page:t,dimension3:"Cargo 2"});void 0!==this.Config.custom_url?ga(this.Config.name+".send","pageview",{page:this.Config.custom_url+o,dimension3:"Cargo 2"}):ga(this.Config.name+".send","pageview",{dimension3:"Cargo 2"})}"function"==typeof ga&&e&&(ga(function(){ga.getAll().map(function(e){var t=e.get("name");t!=i&&ga(t+".send","pageview",{page:o})})}),"undefined"!=typeof _gaq&&_gaq.push(["_trackPageview",o]))}}),Cargo.o.api=Backbone.View.extend({Config:{Version:"v0",api_path:"/_api",cargo_id:"",cargo_url:"",filter:"",search_term:"",route_name:"",current_offset:0,current_page:1,is_filter:!1,is_search:!1,is_editor:!1,is_template:!1,is_solo:!1,is_direct_link:!1,is_custom_route:!1,admin_edit_project:!1,first_load_finished:!1,tags:null},initialize:function(){_.extend(this.Config,$.parseJSON($("script[data-set='defaults']").html()))},fetch:function(e,t){$.getJSON(e,t)},GetBasePath:function(){var e=this.Config;return e.api_path+"/"+e.Version},GetSitePath:function(){var e=this.Config;return e.api_path+"/"+e.Version+"/site/"+e.cargo_url},GetDesignPath:function(){var e=this.Config;return e.api_path+"/"+e.Version+"/design/"+e.cargo_url},GetTemplatesPath:function(){var e=this.Config;return e.api_path+"/"+e.Version+"/templates"},GetDesignFile:function(e){return this.GetDesignPath()+"?file="+e},GetTemplatePath:function(){var e=this.Config,t=e.route_name?e.route_name+"/":"";return this.GetDesignFile(t)},GetFilesPath:function(){var e=this.Config;return e.api_path+"/"+e.Version+"/files"},GetDesignAndFile:function(e,t){var i=this.GetTemplatePath()+e;return t&&(i+="&to_var=true"),i},GetDisplayOptionsPath:function(){var e=this.Config;return e.api_path+"/"+e.Version+"/displayoptions/"+e.cargo_url},GetImagesPath:function(e,t,i){e=e||"newest",t=t||"true",i=i||"false";var o=this.GetSitePath()+"/images";return o+="?sort="+e+"&unique="+t+"&projectsonly="+i},GetPluginsPath:function(){var e=this.Config;return e.api_path+"/"+e.Version+"/backdrops"},GetPagesPath:function(e,t,i){var o=this.GetSitePath()+"/pages";if(void 0!==e||void 0!==t||void 0!==i){"string"==typeof e&&(e=e.replace(/\ /g,"-")),o+="?";var n=new Array;void 0!==e&&n.push("tags="+e),void 0!==t&&n.push("offset="+t),void 0!==i&&n.push("limit="+i),o+=n.join("&")}return o},GetContentCollectionPath:function(e){var t=this.GetSitePath()+"/content";return e&&(t+="?tags="+e),t},GetAdminListPath:function(e,t){return e=e||this.Config.current_offset,t=t||Cargo.Helper.GetPageLimit(),this.GetSitePath()+"/admincollection"},GetSinglePagePath:function(e){var t=this.Config,i=t.api_path+"/"+t.Version+"/page";return e&&void 0!==e&&(i+="/"+e),i},GetSingleContentPath:function(e){var t=this.GetContentCollectionPath();return e?t+"/"+e:t},GetSingleStackPath:function(e){return this.GetSitePath()+"/stack/"+e},GetSiteFilesPutPath:function(){return"/dispatch/files/putFile"},GetDataPackage:function(e,t){var i={site:Cargo.Model.Site.toJSON(),display_options:Cargo.Model.DisplayOptions.toJSON(),config:this.Config};return i[e]=t,i},GetThumbnailsPath:function(e,t,i,o,n,a,r){var s=this.Config,l=s.api_path+"/"+s.Version+"/thumbnails/"+s.cargo_url;if(void 0!==e||void 0!==i||void 0!==o||void 0!==n||void 0!==a||void 0!==r||void 0!==t){"string"==typeof i&&(i=i.replace(/\ /g,"-")),l+="?";var d=new Array;void 0!==e&&d.push("page_id="+e),void 0!==t&&d.push("all=true"),void 0!==i&&d.push("tags="+i),void 0!==o&&d.push("set_id="+o),void 0!==n&&d.push("offset="+n),void 0!==r?(d.push("random_limit="+r),d.push("random=true")):void 0!==a&&d.push("limit="+a),l+=d.join("&")}return l},GetThumbnailModesPath:function(){var e=this.Config;return e.api_path+"/"+e.Version+"/thumbnailsettings/modes"},GetAllThumbnailSettingsPath:function(e,t,i){var o=this.Config,n=o.api_path+"/"+o.Version+"/thumbnailsettings/"+o.cargo_url+"/all";if(e||i||t){n+="?";var a=new Array;e&&a.push("page_id="+e),i&&a.push("iterator="+i),t&&a.push("mode_id="+t),n+=a.join("&")}return n},GetActiveThumbnailSettingsPath:function(e,t,i,o){var n=this.Config,a=n.api_path+"/"+n.Version+"/thumbnailsettings/"+n.cargo_url+"/single";if(o&&(a+="/"+o),e||i||t){a+="?";var r=new Array;e&&r.push("page_id="+e),i&&r.push("iterator="+i),t&&r.push("mode_id="+t),a+=r.join("&")}return a},PutSiteFile:function(e,t,i){$.ajax({type:"POST",url:this.GetSiteFilesPutPath(),context:this,data:{file:e,data:t,uid:Cargo.Model.Site.GetId()},dataType:"json",success:function(e){"function"==typeof i&&i.call(this,e)},error:function(e){}})}}),Action={Page:{Home:function(e){Cargo.View.Main.ShowHome(void 0,e)},Next:function(){Cargo.View.Main.NextPage()},Prev:function(){Cargo.View.Main.PrevPage()},Random:function(){Cargo.View.Main.RandomPage()}},yepThisIsACargoSite:function(){var e=new Image;e.onload=function(){var e=document.createElement("div");e.style.top="20%",e.style.width="100%",e.style.height="60%",e.style.zIndex="999",e.style.position="fixed",e.style.background='url("/assets/bolt.gif") center center / contain no-repeat',setTimeout(function(){e.style.transition="opacity 500ms",setTimeout(function(){e.parentNode.removeChild(e),e=null},700),setTimeout(function(){e.style.opacity="0"})},1e3),document.body.appendChild(e)},e.src="/assets/bolt.gif"},Start:function(i){$("[data-example-start]").html('<div class="loading_animation pulsing white inline right"><div></div></div>'),Cargo.API.Config.cookie_link&&0<Cargo.API.Config.cookie_site_count?Cargo.Modal.Alert({message:"<em>Youâ€™re already logged in; you can create new Sites in your Settings panel.</em>",confirm:function(){top.document.location.href=Cargo.API.Config.cookie_link+"/admin"}}):require(["/_jsapps/admin/_models/adminsite.js"],function(e){var t=new e;t.bind("sync",function(e,t){document.location.href=t.redirect}),t.bind("error",function(e,t){var i=JSON.parse(t.responseText);i&&i.message?Cargo.Modal.Alert({message:i.message,confirm:function(){i.data.redirect&&(document.location.href=i.data.redirect)}}):Cargo.Modal.Alert({message:"There was a problem submitting. Refresh and try again."}),$("[data-example-start]").html("Choose Style")}),i=i||Cargo.Model.Site.GetId(),t.set({template_id:i}),t.save()})}},Cargo.Event=Cargo.Event||{},_.extend(Cargo.Event,Backbone.Events),Cargo.Event.on("add_history",function(e,t){Cargo.Router.is_first_route=!1,(e=Cargo.Helper.NormalizeRouteLink(e))!==Cargo.Helper.GetCurrentProjectUrl()?(Cargo.Helper.IsCurrentRoute(e)?Cargo.Model.DisplayOptions.GetDisableProjectScroll()||Cargo.Helper.ScrollToTop():(t=t||Cargo.Helper.GetPidFromPurl(e),"admin"==e||/^following/.test(e)||/^cart/.test(e)||Cargo.Helper.ShowLoadingAnimation(t,e)),(!/^following/.test(Cargo.Router.previousRoute)&&!/^following/.test(Backbone.history.getFragment())&&/^following/.test(e)||!/^contact-form/.test(Cargo.Router.previousRoute)&&!/^contact-form/.test(Backbone.history.getFragment())&&/^contact-form/.test(e)||!/^cart/.test(Cargo.Router.previousRoute)&&!/^cart/.test(Backbone.history.getFragment())&&/^cart/.test(e))&&(Cargo.Router.previousSiteRoute=Backbone.history.getFragment()),Cargo.Router.previousRoute=Backbone.history.getFragment(),Cargo.Router.navigate(e,{trigger:!0})):Cargo.Model.DisplayOptions.GetDisableProjectScroll()||Cargo.Helper.ScrollToTop()}),Cargo.Event.on("add_history_passive",function(e){e=Cargo.Helper.NormalizeRouteLink(e),Cargo.Router.navigate(e,{trigger:!1,replace:!0})}),Cargo.Event.on("admin_page_update",function(e,t){}),Cargo.Event.on("BaseUnit:set",function(e){var t=Cargo.Helper.IsMobileWindowSize(e.cache.window.w);Cargo.Event.trigger("mobile_size",t)}),Cargo.Event.on("custom_route_loaded",function(e){}),Cargo.Event.on("content_view_closed",function(){}),Cargo.Event.on("first_page_collection_reset",function(){Cargo.API.Config.first_load_finished=!0}),Cargo.Event.on("hide_loading_anim",function(){"object"==typeof Cargo.Helper&&Cargo.Helper.HideLoadingAnimation&&Cargo.Helper.HideLoadingAnimation()}),Cargo.Event.on("homepage_loaded",function(){Cargo.Model.DisplayOptions.GetDisableProjectScroll()||Cargo.Helper.ScrollToTop(),Cargo.View.Main&&(Cargo.View.Main.SetHomepageClass(),Cargo.View.Main.SetFeedClass())}),Cargo.Event.on("loading_anims_replaced",function(){}),Cargo.Event.on("mobile_size",function(e){}),Cargo.Event.on("mobile_padding_set",function(){}),Cargo.Event.on("plugin_render",function(e){e.el.style.opacity=0,e.el.style.transition="opacity .5s ease-in-out",e.el.style.webkitTransition="opacity .5s ease-in-out",void 0===e.deferredLoadEventName?setTimeout(function(){e.el.style.opacity=1},33):Cargo.Event.once(e.deferredLoadEventName,function(){e.el.style.opacity=1})}),Cargo.Event.on("page_change",function(){}),Cargo.Event.on("page_collection_reset",function(){}),Cargo.Event.on("page_load_complete",function(e){Cargo.Event.PageTransition=new $.Deferred,Cargo.View.Main&&!Cargo.Helper.IsOnHomepage()?(Cargo.View.Main.RemoveHomepageClass(),Cargo.View.Main.RemoveFeedClass()):null!==Cargo.View.Content.activeContentModel&&Cargo.View.Content.activeContentModel.get("id")!==Cargo.Helper.GetHomepageId()&&(Cargo.View.Main.RemoveHomepageClass(),Cargo.View.Main.RemoveFeedClass()),Cargo.Helper.HideLoadingAnimation(),Cargo.View.Main.SetWindowTitle(),Cargo.Event.trigger("project_load_complete",e)}),Cargo.Event.on("content_load_complete",function(e){Cargo.View.Main&&!Cargo.Helper.IsOnHomepage()?Cargo.View.Main.RemoveHomepageClass():null!==Cargo.View.Content.activeContentModel&&Cargo.View.Content.activeContentModel.get("id")!==Cargo.Helper.GetHomepageId()&&Cargo.View.Main.RemoveHomepageClass(),Cargo.Model.DisplayOptions.GetDisableProjectScroll()||Cargo.Helper.ScrollToTop(),Cargo.View.Main.SetPageId(e),Cargo.API.Config.is_direct_link||Cargo.Helper.IsOnHomepage()||Cargo.Analytics.pageview(!0),Cargo.Helper.HideLoadingAnimation()}),Cargo.Event.on("set_render_complete",function(e){}),Cargo.Event.on("image_gallery_init_complete",function(e){}),Cargo.Event.on("image_gallery_render_complete",function(e){}),Cargo.Event.on("image_upload_complete",function(e){}),Cargo.Event.on("image_delete_complete",function(e){}),Cargo.Event.on("pagination_complete",function(e,t,i){i&&i.render_changes&&($(window).trigger("resize"),Cargo.Plugins.elementResizer.update())}),Cargo.Event.on("page_load_start",function(e){Cargo.Event.trigger("page_change")}),Cargo.Event.on("project_load_start",function(e){Cargo.Event.trigger("page_load_start",e)}),Cargo.Event.on("reseed_pages_complete",function(e){}),Cargo.Event.on("show_index_complete",function(e){Cargo.View.Main.SetWindowTitle(!0),Cargo.Event.IndexTransition=new $.Deferred}),Cargo.Event.on("show_index_start",function(e){Cargo.Event.trigger("page_change")}),Cargo.Event.on("show_loading_anim",function(){Cargo.Helper.ShowLoadingAnimation(null,"page")}),Cargo.Event.on("solo_link_loaded",function(e){}),Cargo.Event.on("template_loaded",function(e){}),Cargo.Event.PageTransition=new $.Deferred,Cargo.Event.IndexTransition=new $.Deferred,Cargo.Event.ShowPageTransition=function(e,t,i){return Cargo.Event.PageTransition.resolve(),Cargo.Event.PageTransition.promise()},Cargo.Event.ShowIndexTransition=function(e,t){return Cargo.Event.IndexTransition.resolve(),Cargo.Event.IndexTransition.promise()},window.addEventListener("popstate",function(){"object"==typeof lightbox&&void 0!==lightbox.activeGallery&&lightbox.activeGallery.close()}),Cargo.o.helpers=Backbone.View.extend({Data:{is_loading:!1,loading_timout:1e3,projectlist_volatile:!1},initialize:function(){Cargo.Event.on("adminlist_volatile",function(){this.Data.projectlist_volatile=!0},this),Cargo.Event.on("adminlist_stable",function(){this.Data.projectlist_volatile=!1},this)},FindCollectionByProjectUrl:function(i){var o=!1;return _.each(Cargo.Collection.Page,function(e){if(!o){var t=new Backbone.Collection;t.reset(e),t.where({project_url:i})[0]&&(o=e)}}),o},GetBackboneCaseInsensitive:function(e,t){var i={};for(var o in e)!e.hasOwnProperty(o)||"function"!=typeof e[o]&&"object"!=typeof e[o]||(i[o.toLowerCase()]=o);return t?i[t.toLowerCase()]:""},GetBaseUrl:function(e,t){if(Cargo.API.Config.is_domain)return t?"/":"";var i=e?Cargo.API.Config.cargo_url:"";return t?"/"+i:i},IsAdminProjectListSorting:function(){return this.Data.projectlist_volatile},GetBaseCargoDomain:function(){var e=Cargo.Model.Site.get("home_url");return e?e.replace(/(http(s)?:\/\/)/,""):document.location.host},GetAuthDomain:function(){var e=Cargo.Model.Site.get("auth_url");return e||"//"+document.location.host},GetBaseDomain:function(){return Cargo.Model.Site.get("home_url").replace(/(http(s)?:\/\/)/,"")},IsIndexableModel:function(e){return!(!e||"set"!==e.attributes.type)||!!e&&!(!1===e.attributes.display||e.attributes.pin||e.attributes.is_homepage&&!e.attributes.is_set)},GetCurrentProjectUrl:function(){var e=Cargo.View.Content.getActiveContentModel();return e?e.get("project_url"):null},GetCurrentProjectId:function(){if(void 0===Cargo.View.Content)return null;var e=Cargo.View.Content.getActiveContentModel();return e?e.get("id"):null},GetCurrentRoute:function(){return Backbone.history.fragment},GetDomainOrUrl:function(){return Cargo.API.Config.is_domain?this.GetUrl():location.pathname.split("/")[1]},GetHomeUrl:function(e,t){var i=t?"/":"";return Cargo.API.Config.set&&Cargo.API.Config.filter?Cargo.API.Config.is_domain?i+Cargo.API.Config.set+"/filter/"+encodeURIComponent(Cargo.API.Config.filter):this.GetBaseUrl(e,t)+"/"+Cargo.API.Config.set+"/filter/"+encodeURIComponent(Cargo.API.Config.filter):Cargo.API.Config.route&&Cargo.API.Config.filter?Cargo.API.Config.is_domain?Cargo.Helper.GetRouteUrl()+"/filter/"+encodeURIComponent(Cargo.API.Config.filter):this.GetBaseUrl(e,!1)+Cargo.Helper.GetRouteUrl()+"/filter/"+encodeURIComponent(Cargo.API.Config.filter):Cargo.API.Config.filter?Cargo.API.Config.is_domain?i+"filter/"+encodeURIComponent(Cargo.API.Config.filter):this.GetBaseUrl(e,t)+"/filter/"+encodeURIComponent(Cargo.API.Config.filter):Cargo.API.Config.set?Cargo.API.Config.is_domain?i+Cargo.API.Config.set:this.GetBaseUrl(e,t)+"/"+Cargo.API.Config.set:Cargo.API.Config.route&&Cargo.API.Config.is_domain?Cargo.Helper.GetRouteUrl():this.GetBaseUrl(e,t)},GetOffsetFromPage:function(e){return--e*this.GetPageLimit()},GetPageLimit:function(){var e=Cargo.Model.DisplayOptions.GetPaginationCount();return e&&Cargo.Model.DisplayOptions.GetIndexRouteName()&&Cargo.Model.DisplayOptions.GetIndexRouteName().toUpperCase()==Cargo.Helper.GetRouteName().toUpperCase()&&Cargo.Model.DisplayOptions.get("index_pagination_count")?e=Cargo.Model.DisplayOptions.get("index_pagination_count"):Cargo.Model.DisplayOptions.get("mobile_pagination_count")&&this.isMobile()&&(e=Cargo.Model.DisplayOptions.get("mobile_pagination_count")),e||10},IsMobileWindowSize:function(e){return e<this.GetMobileWindowBreakPoint()},GetMobileWindowBreakPoint:function(e){return 770},GetPageViewById:function(e){var t;return void 0===t&&Cargo.View.Content&&(t=Cargo.View.Content.getPageViewById(e)),void 0===t&&Cargo.View.PinnedTop&&(t=Cargo.View.PinnedTop.getPageViewById(e)),void 0===t&&Cargo.View.PinnedBottom&&(t=Cargo.View.PinnedBottom.getPageViewById(e)),t},GetPidFromPurl:function(e){var t=Cargo.Collection.Scaffolding.getModel({project_url:e});return t?t.get("id"):0},GetRouteName:function(){var e=Cargo.API.Config.route_name;return/display_options/.test(Cargo.API.Config.route)&&(e=Cargo.Model.DisplayOptions.GetIndexRouteName()),e},GetRouteUrl:function(){var e=Cargo.API.Config.route_name;return(/display_options/.test(Cargo.API.Config.route)||"feed"==e||"index"==e)&&(e=Cargo.Model.DisplayOptions.GetIndexRouteUrl()),e},GetHomepageId:function(){return Math.floor(Cargo.Model.Site.GetHomepageId())},GetUrl:function(){return Cargo.API.Config.cargo_url},GoToUrl:function(e){top.document.location.href=document.location.origin+"/"+e},HideLoadingAnimation:function(e){this.ClearLoadingAnimationTimeout(),this.Data.is_loading=!1,$("[data-loading]").hide()},IsAdminEdit:function(){var e=/\/adminedit/.test(document.location.pathname)||/\/admin/.test(document.location.pathname);try{var t=parent!=window&&"object"==typeof parent.Cargo,i=null!=Cargo.Editor;return e||t||i}catch(e){return!1}},IsAdminBackdrop:function(){return/\/adminbackdrop/.test(document.location.pathname)},IsStandaloneAdmin:function(){return!!(Cargo&&Cargo.Editor&&Cargo.Editor.hasOwnProperty("Standalone"))},IsCurrentRoute:function(e){return e=this.NormalizeRouteLink(e),Cargo.Helper.GetCurrentRoute()==e},isFeed:function(){return Cargo.Model.DisplayOptions.get("layout_options").is_feed},isFirefox:function(){return/Firefox\/\d+\.\d+/.test(navigator.userAgent)},isSafari:function(){return-1!=navigator.userAgent.indexOf("Safari")&&-1==navigator.userAgent.indexOf("Chrome")},isIE:function(){return/MSIE (\d+\.\d+);/.test(navigator.userAgent)},isEdge:function(){return/Edge/.test(navigator.userAgent)},isIE8:function(){var e=-1;this.isIE()&&(null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)&&(e=parseFloat(RegExp.$1)));return e<9&&0<e},isIOS:function(){return!!navigator.userAgent.match(/i(Phone|Pod|Pad)/i)},isMobile:function(){if(this.isIOS())return!0;var e,t=!1,i=navigator.userAgent||navigator.vendor||window.opera;return(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(e=i)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4)))&&(t=!0),t=t||!t&&/(android)/i.test(i.substr(0,40))},isIOSWebView:function(){var e=window.navigator.standalone,t=window.navigator.userAgent.toLowerCase(),i=/safari/.test(t);if(/iphone|ipod|ipad/.test(t)){if(!e&&i)return!1;if(e&&!i)return!1;if(!e&&!i)return!0}return!1},IsOnHomepage:function(){return(""==Cargo.Helper.GetCurrentRoute()||"adminedit"==Cargo.Helper.GetCurrentRoute())&&null!=Cargo.Helper.GetHomepageId()},isOldIE:function(){var e=-1;this.isIE()&&(null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)&&(e=parseFloat(RegExp.$1)));return e<=9&&0<e},IsAdminPath:function(){return/\/admin(\/|$)/.test(document.location.pathname)},IsPresetPreview:function(){return/\/presetpreview(\/|$)/.test(document.location.pathname)},IsCurrentRoute:function(e){return e=e.replace("/",""),this.GetCurrentRoute()&&e&&this.GetCurrentRoute().toLowerCase()==e.toLowerCase()},isTablet:function(){return"string"==typeof new MobileDetect(window.navigator.userAgent).tablet()},NormalizeRouteLink:function(e){if(!e)return e;-1!==e.indexOf(Cargo.Helper.GetBaseDomain())&&(e=e.split(Cargo.Helper.GetBaseDomain())[1]),"/"==e.charAt(0)&&(e=e.replace("/","")),!/following/.test(e)&&this.GetHomeUrl(!0)&&0==e.search(this.GetHomeUrl(!0))&&(e=e.replace(this.GetHomeUrl(!0)+"/","")),"/"==e.charAt(e.length-1)&&(e=e.substr(0,e.length-1));var t=Cargo.Collection.Scaffolding.getModel({project_url:e});return void 0!==t&&t.get("id")==Cargo.Helper.GetHomepageId()&&(e=""),e},ScrollToTop:function(){var e=Cargo.Router.scrollPositions[Backbone.history.getFragment()];requestAnimationFrame(function(){window.scrollTo(0,e)})},ShowLoadingAnimation:function(e,t){this.Data.is_loading=!0,e?this.Data.loadingAnimationTimeoutID=_.delay(function(){Cargo.Helper.ShowLoadingAnimationById(e)},Cargo.Helper.Data.loading_timout):t&&(this.Data.loadingAnimationTimeoutID=_.delay(function(){Cargo.Helper.ShowLoadingAnimationById("page")},Cargo.Helper.Data.loading_timout)),$("*[data-loading=global], *[data-loading=global] .retinaSpinner").show()},ClearLoadingAnimationTimeout:function(){window.clearTimeout(this.Data.loadingAnimationTimeoutID)},ShowLoadingAnimationById:function(e){this.Data.is_loading&&$("*[data-loading="+e+"], *[data-loading="+e+"] .retinaSpinner").show()},TestUrlCaseAndRedirect:function(){if(!Cargo.API.Config.is_domain){var e=document.location.pathname.split("/")[1],t=Cargo.API.Config.cargo_url;e!=t&&e.toUpperCase()==t.toUpperCase()&&history.replaceState(document.location.pathname.replace(e,t),Cargo.Model.Site.GetWebsiteTitle())}},UpdatePinPages:function(e){"top"==e?Cargo.View.PinnedTop.formatOverlayPages():("bottom"==e||Cargo.View.PinnedTop.formatOverlayPages(),Cargo.View.PinnedBottom.formatOverlayPages())},htmlDecode:function(e){var t=document.createElement("div");return t.innerHTML=e,0===t.childNodes.length?"":t.childNodes[0].nodeValue}}),Cargo.o.router=Backbone.Router.extend({routes:{"":"Home",adminedit:"Home",cart:"Cart","contact-form":"Contact","preview/:which":"Home","search/:query":"Search",":purl/adminedit":"AdminEdit",":purl":"slashProxy",":purl1/:purl2":"slashProxy",":purl1/:purl2/:purl3":"slashProxy","*actions":"defaultAction"},is_first_route:!0,defaultAction:function(e){this.route(e)},preventQueryStringRemoval:!1,initialize:function(){document.location.search&&"?example=true"!=document.location.search&&(this.handleQueryString(document.location.search),this.preventQueryStringRemoval||window.history.replaceState({},document.title,document.location.href.replace(document.location.search,""))),this._lastFrag=null,this.scrollPositions={}},handleQueryString:function(e){if("string"==typeof e){var t=["fontsinuse","wetransfer","wepresent","sightunseen","carbon","NYABF2018"],i=t.indexOf(e.substring(1));-1!==i&&setTimeout(function(){Cargo.Analytics.setDimension("dimension5",t[i])}),this.queryString=e}},execute:function(e,t,i){null!==this._lastFrag&&document.scrollingElement&&(this.scrollPositions[this._lastFrag]=document.scrollingElement.scrollTop),this._lastFrag=Backbone.history.getFragment(),Backbone.Router.prototype.execute.apply(this,arguments)},navigate:function(e){this.scrollPositions.hasOwnProperty(e)&&delete this.scrollPositions[e],Backbone.Router.prototype.navigate.apply(this,arguments)},slashProxy:function(e,t,i){if(this.RouteIsHome(e))this.Home(e);else if(/\,|\~|\+/.test(e)&&!/\?/.test(e))Cargo.Event.trigger("thumbnails:load_tag",e),t?this.Page(t):Cargo.View.Content.hideActiveView();else if(/\,|\~\+/.test(t)){Cargo.Event.trigger("thumbnails:load_tag",t,e);var o=i||e;this.Page(o)}else if(e&&t&&!i){var n=Cargo.Collection.Tags.findTagByUrl(e),a=Cargo.Collection.Tags.findTagByUrl(t);n?(Cargo.Event.trigger("thumbnails:load_tag",n.get("url")),this.Page(t)):a&&(Cargo.Event.trigger("thumbnails:load_tag",a.get("url"),e),Cargo.View.Content.hideActiveView())}else this.Page(e)},Home:function(e){this.CheckToggleFollowing(),e||(e=""),Cargo.Event.trigger("before_purl_render",e),0!==Cargo.Helper.GetHomepageId()||Cargo.Helper.isFeed()?(Cargo.View.Content.RenderHomepage(),Cargo.View.Main&&(Cargo.View.Main.SetHomepageClass(),Cargo.View.Main.SetFeedClass())):Cargo.API.Config.offline?(Cargo.Event.trigger("page_load_complete"),Cargo.Event.trigger("content_load_complete")):(Cargo.View.Content.hideActiveView(),Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId()))},Following:function(){},FollowedBy:function(){},Contact:function(){Cargo.View.Following.loadSection("contact")},Cart:function(){Cargo.View.Following.loadSection("cart",!0)},Page:function(e){Cargo.Event.trigger("before_purl_render",e),this.CheckToggleFollowing(),e=(e+="").replace(/\//g,""),Cargo.View.Content.RenderPidOrPurl(e)},Search:function(e){this.Home()},AdminEdit:function(e){return this.CheckToggleFollowing(),Cargo.API.Config.admin_edit_project=!0,this.Page(e)},CheckToggleFollowing:function(){!0===Cargo.View.Following.isActive()&&Cargo.View.Following.disable()},_routeToRegExp:function(e){return e=e.replace(/[-{}[\]+?.,\\^$|#\s]/g,"\\$&").replace(/\((.*?)\)/g,"(?:$1)?").replace(/:\w+/g,"([^/]+/?)").replace(/\*\w+/g,"(.*?)"),new RegExp("^"+e+"$","i")},addroute:function(e,t,i){for(var o=["","/","?*querystring","/?*querystring"],n=0;n<o.length;n++){var a=o[n];this.route(e+a,t,i)}},RouteIsHome:function(e){var t=!1;return Cargo.API.Config.is_domain||e.toLowerCase()!=Cargo.Helper.GetDomainOrUrl().toLowerCase()||document.location.pathname.replace("/").split("/").length<=1&&(t=!0),t}}),Cargo.o.templates=Backbone.View.extend({Data:{},Get:function(e,t){var i=Cargo.Helper.GetBackboneCaseInsensitive(this.Data,e);if(i=i||e,this.Data[i]&&this.Data[i].template)return this.Data[i].template;this.Load(i,t)},Add:function(e,t,i){Cargo.Template.Data[e]={dataset:t,setname:i}},FindAndAddViewStubs:function(){$("[data-view]").each(function(){var e=$(this).data("view"),t=$(this).data("set"),i=new Backbone.Collection;if(t){var o=Cargo.Helper.GetBackboneCaseInsensitive(Cargo.Collection,t),n=Cargo.Helper.GetBackboneCaseInsensitive(Cargo.Model,t);o?i=Cargo.Collection[o]:n&&(i=Cargo.Model[n])}Cargo.Template.Add(e,i,t)})},Load:function(which,file_path){if(!file_path){var file_name=which;file_path=Cargo.API.GetDesignAndFile(file_name,!1)}Cargo.Template.Data[which]&&Cargo.Template.Data[which].loading||(Cargo.Template.Data[which]||(Cargo.Template.Data[which]={}),Cargo.Template.Data[which].loading=!0,Cargo.Event.trigger("template_preload",which),$.loadFiles(file_path).done(function(template){if(template){try{var template=eval(template)}catch(e){}Cargo.Template.Data[which].template=template}else{var template_var="templatesdesign"+file_name.replace(/(\/|\.)/g,"");Cargo.Template.Data[which].template=window[template_var]}return Cargo.Event.trigger("template_loaded",which),Cargo.Template.Data[which].template}))},LoadAll:function(){for(key in this.Data)void 0===this.Data[key].template&&this.Load(key)},LoadFoundViews:function(){for(key in this.Data){var e=0==key.indexOf("pinned")?"Pin":key,t=Cargo.Helper.GetBackboneCaseInsensitive(Cargo.o.view,e);if("function"==typeof Cargo.o.view[t]&&void 0===Cargo.View[t]){var i=0==key.indexOf("pinned")?key.toCamel(!0):t.toCamel(!0);if(void 0===Cargo.View[i]){var o=this;$("[data-view='"+key+"']").each(function(e){i=0<e?t+"_"+e:i,Cargo.View[i]=new Cargo.o.view[t]({el:this,collection:o.Data[key].dataset,template:o.Data[key].template,className:i}),null==o.Data[key].template&&Cargo.View[i].template&&(o.Data[key].template=Cargo.View[i].template)})}}else null==this.Data[key].template&&Cargo.View[t]&&void 0!==Cargo.View[t].template&&(this.Data[key].template=Cargo.View[t].template)}}}),Cargo.o.model.StripeProductModel=Backbone.Model.extend({initialize:function(){},parse:function(t,e){return t.is_file=!1,t&&t.attributes&&-1!==t.attributes.indexOf("link_to_file")&&(t.is_file=!0,t.attributes=[],1<t.skus.total_count&&t.attributes.push("description")),t&&t.skus&&t.skus.data&&_.each(t.skus.data,function(e){t.is_file&&1<t.skus.total_count&&"object"==typeof e.attributes&&0===_.keys(e.attributes).length&&(e.attributes.description=t.name+" - "+Cargo.o.view.ProductWidget.prototype.formatPriceForCurrency(e.price,e.currency)),e.is_file=t.is_file}),t},getSku:function(e){if(null!=this.attributes.skus)return _.findWhere(this.attributes.skus.data,{id:e})},getAvailableItemsForSKU:function(e){if(e){if(!1===e.active)return 0;if("finite"===e.inventory.type&&0<e.inventory.quantity)return e.inventory.quantity;if("infinite"===e.inventory.type)return 9e9;if("bucket"===e.inventory.type&&("in_stock"===e.inventory.value||"limited"===e.inventory.value))return 9e9}return 0}}),Cargo.o.collection.StripeProductCollection=Backbone.Collection.extend({model:Cargo.o.model.StripeProductModel,productSyncOccurred:!1,initialize:function(){this.cart_count=0,Cargo.Event.on("cart-size-changed",function(e){this.cart_count=e,Cargo.Core.Ecommerce.updateCartText(),Cargo.Core.Ecommerce.updateInlineCartCounters()},this),this.on("sync",function(){var e=[],t=localStorage.getItem("cargo_ecommerce_cart");if(null!==t&&0<t.length)try{e=JSON.parse(t)}catch(e){console.error(e)}_.each(e,function(e){e.available=!1;var t,i=this.findWhere({id:e.productID});i&&(t=i.getSku(e.skuID))&&(this.cart_count+=Math.min(e.amount,i.getAvailableItemsForSKU(t)))},this),Cargo.Core.Ecommerce.updateCartText(),Cargo.Core.Ecommerce.updateInlineCartCounters()}),Cargo.Event.on("stripe_account_connected stripe_account_disconnected",this.fetch,this)},parse:function(e){return _.filter(e,function(e){return e.active})},url:function(){return"/_api/v0/ecommerce/products/"+Cargo.Model.Site.get("id")},updateCartText:function(){return Cargo.Core.Ecommerce.updateCartText.apply(Cargo.Core.Ecommerce,arguments)}}),Cargo.Core.PageviewFactory={pageViewTypes:[],constructPageView:function(){var e,t=Cargo.o.view.Page;for(e=0;e<this.pageViewTypes.length;e++)if(!0===this.pageViewTypes[e].filter.apply(this,arguments)){t=this.pageViewTypes[e].constructor;break}return new(Function.prototype.bind.apply(t,[].concat.apply([null],arguments)))},addPageViewType:function(e,t){t.constructor=function(){this.__super__=Object.getPrototypeOf(Object.getPrototypeOf(this)),Backbone.View.prototype.constructor.apply(this,arguments)},this.pageViewTypes.push({filter:e,constructor:Cargo.o.view.Page.extend(t)})}},Cargo.Core.SetViewFactory={setViewTypes:[],constructSetView:function(){var e,t=Cargo.o.view.Set;for(e=0;e<this.setViewTypes.length;e++)if(!0===this.setViewTypes[e].filter.apply(this,arguments)){t=this.setViewTypes[e].constructor;break}return new(Function.prototype.bind.apply(t,[].concat.apply([null],arguments)))},addSetViewType:function(e,t){t.constructor=function(){this.__super__=Object.getPrototypeOf(Object.getPrototypeOf(this)),Backbone.View.prototype.constructor.apply(this,arguments)},this.setViewTypes.push({filter:e,constructor:Cargo.o.view.Set.extend(t)})}},Cargo.Core.ImageGallery={draggingOverGallery:!1,draggingInEditor:!1,idIndex:0,imageGalleryObjects:{},cachedScrollPosition:-1,imageGalleryModes:{},allModesLoaded:!1,galleryLoadInProgress:!1,currentEditableGallery:void 0,cachedPaddingSizes:{0:{fontSize:0,paddingMeasure:0}},setCachedPaddingSize:function(e,t,i){if(0!==i){var o=Math.floor(10*parseFloat(e))/10;t/=i,this.cachedPaddingSizes[o]={fontSize:e,paddingMeasure:t}}},getCachedPaddingSize:function(e,t){if(0<t){var i=Math.floor(10*parseFloat(e))/10;return this.cachedPaddingSizes.hasOwnProperty(i)?this.cachedPaddingSizes[i].paddingMeasure*parseFloat(t):null}return 0},loadGalleryModes:function(){var r=this;!Cargo.Helper.IsAdminEdit()||this.allModesLoaded||this.galleryLoadInProgress||void 0!==Cargo.Homepage&&parent===window||(this.galleryLoadInProgress=!0,require(["/_jsapps/imagegallery/columns/main.js?nocache=18-11-26","/_jsapps/imagegallery/freeform/main.js?nocache=18-11-26","/_jsapps/imagegallery/grid/main.js?nocache=18-11-26","/_jsapps/imagegallery/justify/main.js?nocache=18-11-26","/_jsapps/imagegallery/montessori/main.js?nocache=18-11-26","/_jsapps/imagegallery/slideshow/main.js?nocache=18-11-26"],function(e,t,i,o,n,a){r.imageGalleryModes={columns:e,freeform:t,grid:i,justify:o,montessori:n,slideshow:a},r.allModesLoaded=!0,r.galleryLoadInProgress=!1,r.InitImageGallery()}))},addEditorEvents:function(){"undefined"!=typeof CargoEditor&&CargoEditor.events&&_.each(this.editorEvents,function(e,t){this.boundEditorEvents.push(CargoEditor.events.on(t,_.bind(e,this)))},this)},initialize:function(){this.boundEditorEvents=[],this.addEditorEvents(),Cargo.Event.on("gallery-drag-end",function(e,t){var i=$('.image-gallery[gid="'+t+'"] [data-gallery-uid="'+e+'"]')[0];i&&Cargo.Core.ImageGallery.normalizeSelection(void 0,i)},this),this.InitImageGallery()},galleryDefaults:function(){return{name:"Columns",path:"columns",mode_id:2,gallery_instance_id:0,data:{column_size:10,columns:3,image_padding:2,responsive:!0,mobile_data:{columns:2,column_size:11,image_padding:1,separate_mobile_view:!1},meta_data:{}}}},init_options_defaults:{forceReCollectionOfItems:!1,targetElement:!1},parseGalleryOptions:function(e){for(var t=decodeURIComponent(e),i=0;"{"!==t[0]&&i<3;)t=decodeURIComponent(t),i++;return"{"!==t[0]?this.galleryDefaults():JSON.parse(t)},InitImageGallery:function(o){var r=this;if(!Cargo.Helper.IsAdminEdit()||this.allModesLoaded){if(o||(o={}),!(o=_.defaults(o,this.init_options_defaults)).targetElement||jQuery.contains(document.documentElement,o.targetElement)){var s=[],t=[];(o.targetElement?$(o.targetElement).find(".image-gallery[gid-clone]"):$(".image-gallery[gid-clone]")).remove();var e=o.targetElement?$(o.targetElement).find(".image-gallery[gid]"):$(".image-gallery[gid]"),l=o.targetElement?$(o.targetElement).find(".image-gallery").not(".initialized, .initialization-in-progress").length:$(".image-gallery").not(".initialized, .initialization-in-progress").length;e.each(function(){var e=this.getAttribute("gid");-1==t.indexOf(e)?t.push(e):(this.removeAttribute("gid"),this.setAttribute("gid-clone",e))}),(o.targetElement?$(o.targetElement).find(".image-gallery"):$(".image-gallery")).each(function(){if(0<$(this.parentNode).closest(".image-gallery").length)this.parentNode.removeChild(this);else if(Cargo.Helper.IsAdminEdit()&&this.setAttribute("contenteditable",!1),!1===$(this).hasClass("initialized")&&!1===$(this).hasClass("initialization-in-progress")){$(this).addClass("initialization-in-progress"),s.push(parseInt($(this).closest(".page").attr("data-id"))),this.hasAttribute("data-gallery")&&this.setAttribute("data-gallery",JSON.stringify(Cargo.Core.ImageGallery.parseGalleryOptions(this.getAttribute("data-gallery"))));var e,t=this.hasAttribute("gid")&&r.imageGalleryObjects.hasOwnProperty(this.getAttribute("gid"));this.hasAttribute("data-force-gid")&&this.hasAttribute("gid")?(e=this.getAttribute("gid"),this.removeAttribute("data-force-gid")):e=t?this.getAttribute("gid"):++r.idIndex,this.setAttribute("gid",e);var i={};if(t)r.imageGalleryObjects[e].el=this,(i=r.imageGalleryObjects[this.getAttribute("gid")]).subviewInited=!1,i.mobileSubviewInited=!1,i.subviewActive=!1,i.mobileSubviewActive=!1,o.forceReCollectionOfItems&&(i.images=null,i.removeViews(),i.checkMobileAndLoadSubview()),r.imageGalleryObjects[e].storeOptionsOnElement();else{if(i={options:Cargo.Core.ImageGallery.galleryDefaults(e),el:this,images:null,isEditing:!1,hasClick:!1,isEditable:!1,MobileSubview:null,mobileSubviewInitInProgress:!1,mobileSubviewInited:!1,mobileSubviewActive:!1,Subview:null,subviewInitInProgress:!1,subviewInited:!1,inited:!1,bindEvents:function(){var e=this;Cargo.Helper.IsAdminEdit()&&($(this.el).on("mousedown.gallery",function(){e.hasClick=!0}),$(this.el).on("mouseup.gallery mouseleave.gallery",function(){e.hasClick=!1}),this.enableEditable=_.bind(this.enableEditable,this),this.checkIfStillEditable=_.bind(this.checkIfStillEditable,this),$(this.el).on("mousedown.editable",this.enableEditable),$(this.el).on("mouseup.editable mouseleave.editable",this.checkIfStillEditable),CargoEditor.events.on("editor-drop",this.checkIfStillEditable),CargoEditor.events.on("cursor-activity",this.checkIfStillEditable),CargoEditor.events.on("editor-deactivated",this.checkIfStillEditable)),Cargo.Event.on("mobile_size",this.requestTick,this)},unbindEvents:function(){$(this.el).off("mousedown.gallery mouseup.gallery mouseleave.gallery mousedown.editable mouseup.editable mouseleave.editable"),Cargo.Event.off("mobile_size",this.requestTick),Cargo.Helper.IsAdminEdit()&&(CargoEditor.events.off("editor-drop",this.checkIfStillEditable),CargoEditor.events.off("cursor-activity",this.checkIfStillEditable),CargoEditor.events.off("editor-deactivated",this.checkIfStillEditable))},enableEditable:function(){!0!==this.isEditable&&(Cargo.Core.ImageGallery.currentEditableGallery&&Cargo.Core.ImageGallery.currentEditableGallery.disableEditable(),this.el.removeAttribute("contenteditable"),this.isEditable=!0,Cargo.Core.ImageGallery.currentEditableGallery=this,Cargo.Event.trigger("gallery_editing_enabled",this))},disableEditable:function(){!1!==this.isEditable&&(this.el.setAttribute("contenteditable",!1),this.isEditable=!1,Cargo.Event.trigger("gallery_editing_disabled",this),Cargo.Core.ImageGallery.currentEditableGallery&&Cargo.Core.ImageGallery.currentEditableGallery.options.gallery_instance_id==this.options.gallery_instance_id&&(Cargo.Core.ImageGallery.currentEditableGallery=void 0))},checkIfStillEditable:function(e){if(!1!==this.isEditable){var t=CargoEditor.getActiveRange(),i=!1;if(t){var o=t.commonAncestorContainer;o.nodeType!==Node.ELEMENT_NODE&&(o=o.parentNode),i=this.el.contains(o)}i||this.disableEditable()}},setEditMode:function(e){e&&!this.isEditing?$(window).on("scroll.imagegalleryEdit",function(){i.cachedRects.needsUpdate=!0}):!e&&this.isEditing&&$(window).off("scroll.imagegalleryEdit"),this.isEditing=e},setElement:function(e){this.el=e,this.Subview&&this.Subview.setElement(this.el),this.MobileSubview&&this.MobileSubview.setElement(this.el)},checkMobileAndLoadSubview:function(){var e=window.baseUnit.cache.window.w?window.baseUnit.cache.window.w:document.documentElement.clientWidth,t=Cargo.Helper.IsMobileWindowSize(e),i=this.options.data.mobile_data.separate_mobile_view,o=this.options.data.responsive,n=this.mobileSubviewActive,a=this.mobileSubviewInitInProgress,r=this.mobileSubviewInited,s=this.subviewInited,l=this.subviewInitInProgress;t&&i&&!n&&o?a||(r&&this.MobileSubview.galleryOptions.data.mobile_design_path==this.options.data.mobile_data.mobile_design_path?(this.MobileSubview.render(),this.cachedRects.needsUpdate=!0,this.mobileSubviewActive=!0):this.loadMobileSubview(),this.cachedRects.needsUpdate=!0):t&&i&&o||l||(!s||this.Subview&&this.Subview.galleryOptions.path!=this.options.path?this.loadSubview():n&&(this.Subview.render(),this.cachedRects.needsUpdate=!0,this.mobileSubviewActive=!1),this.cachedRects.needsUpdate=!0)},loadSubview:function(){var t=this;if(this.Subview&&this.subviewInited&&(this.Subview.destroy(),this.subviewInited=!1),this.subviewInitInProgress=!0,Cargo.Core.ImageGallery.imageGalleryModes.hasOwnProperty(this.options.path)){var e=Cargo.Core.ImageGallery.imageGalleryModes[this.options.path];_.defer(function(){t.finishSubviewSetup(e)})}else require(["/_jsapps/imagegallery/"+this.options.path+"/main.js?nocache="+__cargo_js_ver__],function(e){Cargo.Core.ImageGallery.imageGalleryModes[t.options.path]=e,t.finishSubviewSetup(e)})},finishSubviewSetup:function(e){var t=window.baseUnit.cache.window.w?window.baseUnit.cache.window.w:document.documentElement.clientWidth,i=Cargo.Helper.IsMobileWindowSize(t),o=new e({el:this.el,galleryOptions:Object.assign({},this.options),parentView:this,mobile_active:i}),n=!r.inited;if(this.Subview=o,this.images||(this.images=this.Subview.serialize()),(_.keys(this.images).length<2&&!Cargo.Core.ImageGallery.draggingInEditor||0==_.keys(this.images).length)&&this.destroy(),$(this.el).removeClass("initialization-in-progress"),this.mobileSubviewActive=!1,this.unbindEvents(),this.Subview.render(),this.cachedRects.needsUpdate=!0,this.subviewInited=!0,this.subviewInitInProgress=!1,this.inited=!0,this.lastSerializedState=this.Subview.serialize(),this.bindEvents(),this.isEditing||this.hasClick)if(-1==Cargo.Core.ImageGallery.cachedScrollPosition){var a=this.el.getBoundingClientRect();(a.top>window.innerHeight-30||a.bottom<30)&&window.scrollTo(0,a.top+$(window).scrollTop())}else window.scrollTo(0,Cargo.Core.ImageGallery.cachedScrollPosition);n&&(Cargo.Event.trigger("image_gallery_render_complete",this),0==--l&&Cargo.Event.trigger("image_gallery_init_complete",s))},loadMobileSubview:function(){var t=this;this.MobileSubview&&this.mobileSubviewInited&&(this.MobileSubview.destroy(),this.mobileSubviewInited=!1),this.options.data.mobile_data.separate_mobile_view&&(this.mobileSubviewInitInProgress=!0,Cargo.Core.ImageGallery.imageGalleryModes.hasOwnProperty(this.options.data.mobile_data.mobile_design_path)?this.finishMobileSubviewSetup(Cargo.Core.ImageGallery.imageGalleryModes[this.options.data.mobile_data.mobile_design_path]):require(["/_jsapps/imagegallery/"+this.options.data.mobile_data.mobile_design_path+"/main.js"],function(e){Cargo.Core.ImageGallery.imageGalleryModes[t.options.data.mobile_data.mobile_design_path]=e,t.finishMobileSubviewSetup(e)}))},finishMobileSubviewSetup:function(e){var t=$.extend(!0,{},this.options);t.data=Object.assign(t.data,t.data.mobile_data),t.data.responsive=!1;var i=!this.inited,o=new e({el:this.el,galleryOptions:t,parentView:this,mobile_active:!0});if(this.MobileSubview=o,this.images=this.MobileSubview.serialize(),(_.keys(this.images).length<2&&!Cargo.Core.ImageGallery.draggingInEditor||0==_.keys(this.images).length)&&this.destroy(),$(this.el).removeClass("initialization-in-progress"),this.mobileSubviewActive=!0,this.unbindEvents(),this.MobileSubview.render(),this.cachedRects.needsUpdate=!0,this.mobileSubviewInited=!0,this.mobileSubviewInitInProgress=!1,this.inited=!0,this.bindEvents(),this.lastSerializedState=this.MobileSubview.serialize(),this.isEditing||this.hasClick)if(-1==Cargo.Core.ImageGallery.cachedScrollPosition){var n=this.el.getBoundingClientRect();(n.top>window.innerHeight-30||n.bottom<30)&&window.scrollTo(0,n.top+$(window).scrollTop())}else window.scrollTo(0,Cargo.Core.ImageGallery.cachedScrollPosition);i&&(Cargo.Event.trigger("image_gallery_render_complete",this),0==--l&&Cargo.Event.trigger("image_gallery_init_complete",s))},handleUpdates:function(e){"responsive"==e.changing&&this.options.data.mobile_data.separate_mobile_view?this.checkMobileAndLoadSubview():this.routeUpdatesToActiveSubview(e)},checkForChanges:function(){var o=this.lastSerializedState,i=this.mobileSubviewActive?this.MobileSubview.serialize():this.Subview.serialize();if(o){var e=_.filter(o,function(e,t){return!i.hasOwnProperty(t)}),t=_.filter(i,function(e,t){return!o.hasOwnProperty(t)}),n={};_.each(i,function(e,i){if(null!=o[i]){var t=_.omit(e,function(e,t){return"data"==t||"itemSrc"==t||("object"==typeof o[i][t]&&"object"==typeof e?_.isEqual(o[i][t],e):o[i][t]==e)},this);0<_.keys(t).length&&(n[i]=t)}},this),(0<t.length||0<e.length||0<_.keys(n).length)&&(this.images=i,this.applyChanges({added:t,removed:e,updated:n}))}this.lastSerializedState=i},applyChanges:function(e){var t=[];for(var i in e.removed)t.push(e.removed[i].index);var o,n,a=CargoEditor.getActiveRange();if(a){var r=Cargo.Core.ImageGallery.getselectedGalleryId(a);r&&(o=n=r),_.each(e.removed,function(e){e.index<=n&&o--}),_.each(e.added,function(e){e.index<=n&&o++})}if(this.removeViews(),this.checkMobileAndLoadSubview(),this.routeUpdatesToActiveSubview({changing:"gallery_changed"}),void 0!==o&&!isNaN(o)&&!Cargo.Core.ImageGallery.draggingInEditor){var s=this.Subview.$el.find('[data-gallery-item-id="'+o+'"]')[0];s&&Cargo.Core.ImageGallery.normalizeSelection(void 0,s)}try{window.top.hasOwnProperty("Cargo")&&window.top.Cargo.hasOwnProperty("Editor")&&window.top.Cargo.Editor.View.ContentView.SaveButton.trigger("save_enable")}catch(e){console.warn("Cargo Editor not found, Image Gallery settings will not be saved")}},routeUpdatesToActiveSubview:function(e){var t=Cargo.Core.ImageGallery.getselectedGalleryId();if(this.mobileSubviewActive){var i=$.extend(!0,{},this.options);i.data=_.extend(i.data,i.data.mobile_data),this.MobileSubview.handleUpdates(i,e)}else this.Subview.handleUpdates(this.options,e);if(void 0!==t&&!isNaN(t)&&!Cargo.Core.ImageGallery.draggingInEditor){var o=this.Subview.$el.find('[data-gallery-item-id="'+t+'"]')[0];o&&Cargo.Core.ImageGallery.normalizeSelection(void 0,o)}},indicateInsertion:function(e,t,i){this.draggingOverGallery=!0,this.updateCacheRects(),this.mobileSubviewActive?"function"==typeof this.MobileSubview.indicateInsertion&&this.MobileSubview.indicateInsertion(e,t,i):"function"==typeof this.Subview.indicateInsertion&&this.Subview.indicateInsertion(e,t,i)},resetIndication:function(){this.draggingOverGallery&&(this.draggingOverGallery=!1,this.mobileSubviewActive?"function"==typeof this.MobileSubview.resetIndication&&this.MobileSubview.resetIndication():"function"==typeof this.Subview.resetIndication&&this.Subview.resetIndication())},removeViews:function(e){!this.isEditing&&!this.hasClick||e?Cargo.Core.ImageGallery.cachedScrollPosition=-1:Cargo.Core.ImageGallery.cachedScrollPosition=$(window).scrollTop(),this.mobileSubviewInited&&"function"==typeof this.MobileSubview.destroy&&this.MobileSubview.destroy(),this.subviewInited&&"function"==typeof this.Subview.destroy&&this.Subview.destroy(),this.inited=!1,this.subviewInited=!1,this.mobileSubviewInited=!1,this.mobileSubviewActive=!1},destroy:function(){this.unbindEvents(),this.setEditMode(!1),this.disableEditable();for(var e=_.sortBy(this.images,"index"),t=0;t<e.length;t++){var i=this.mobileSubviewActive?this.MobileSubview.createItem(e[t],!0):this.Subview.createItem(e[t],!0);this.el.parentNode.insertBefore(i,this.el)}this.removeViews(),this.el&&this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.images=void 0,Cargo.Plugins.elementResizer.requestRefreshTick(),delete Cargo.Core.ImageGallery.imageGalleryObjects[this.el.getAttribute("gid")]},cachedRects:{rects:{default:{top:-9e9,left:-9e9,bottom:-9e9,width:0,height:0,positions:{distance:9e9}}},needsUpdate:!0},updateCacheRects:function(){if(this.cachedRects.needsUpdate){var e=window.innerHeight,t=_.clone(this.cachedRects.rects.default);this.cachedRects.rects={default:t};for(var i=this.el.querySelectorAll("[data-gallery-item-id]"),o=0;o<i.length;o++){var n=i[o].getAttribute("data-gallery-item-id"),a=i[o].getBoundingClientRect();0<=a.bottom&&a.top<=e&&(this.cachedRects.rects[n]=a,this.cachedRects.rects[n].midPoint={x:a.left+.5*a.width,y:a.top+.5*a.height})}this.cachedRects.needsUpdate=!1}},requestTick:function(){var e=this;this.ticking||(window.requestAnimationFrame(function(){e.checkMobileAndLoadSubview(),e.ticking=!1}),this.ticking=!0),this.cachedRects.needsUpdate=!0},updateOptions:function(e,t){var i=this.options.path,o=e.path;this.options=e,t&&this.storeOptionsOnElement(),i!=o&&(this.removeViews(!0),this.checkMobileAndLoadSubview())},storeOptionsOnElement:function(){try{this.el.setAttribute("data-gallery",JSON.stringify(this.options))}catch(e){console.warn("unable to store image gallery settings",e)}},addItem:function(e){var t=this,i=parseInt(this.insertionPoint)||0;if($(e).is(".ce-in-progress")){if(!e.hasAttribute("width")||!e.hasAttribute("height")||0==e.getAttribute("width")||0==e.getAttribute("height"))return void(e.onload=function(){e.setAttribute("width",e.naturalWidth),e.setAttribute("height",e.naturalHeight),e.onload=null,t.addItem(e)});parent.Cargo.Event.once("image_upload_complete",function(e){t.checkForChanges()})}e.setAttribute("data-gallery-item-index",i),$(e).find("[data-gallery-item-index]").attr("data-gallery-item-index",i),this.meta_data_cache&&(e.setAttribute("data-meta",this.meta_data_cache),$(e).find("[data-meta]").attr("data-meta",this.meta_data_cache),this.meta_data_cache=""),$(this.el).find("[data-gallery-item-index]").each(function(){var e=parseInt(this.getAttribute("data-gallery-item-index"));i<=e&&this.setAttribute("data-gallery-item-index",e+1)}),e.removeAttribute("data-exclude-item"),$(e).find("[data-exclude-item]").removeAttr("data-exclude-item"),this.el.insertBefore(e,null),this.checkForChanges()}},!this)return;if(this.hasAttribute("data-gallery"))i.options=Cargo.Core.ImageGallery.parseGalleryOptions(this.getAttribute("data-gallery"));else if(this.hasAttribute("gid-clone")){if(!r.imageGalleryObjects.hasOwnProperty(this.getAttribute("gid-clone")))return void this.parentNode.removeChild(this);i.options=r.imageGalleryObjects[this.getAttribute("gid-clone")].options,this.removeAttribute("gid-clone")}i.options.gallery_instance_id=e,i.storeOptionsOnElement()}i.el=this,Cargo.Helper.IsAdminEdit()&&this.setAttribute("contenteditable",!1),i.checkMobileAndLoadSubview(),i.finishSubviewSetup=_.bind(i.finishSubviewSetup,i),i.finishMobileSubviewSetup=_.bind(i.finishMobileSubviewSetup,i),r.imageGalleryObjects[e]=i}}),0==l&&Cargo.Event.trigger("image_gallery_init_complete",s)}}else this.loadGalleryModes()},doDelete:function(){CargoEditor.execCommand("delete")},removeMID:function(t){var i=this,e=0,o=$(".image-gallery img[data-mid="+t+"]");if(0<o.length){var n=o.first();parseInt(n.closest("[data-gallery-item-id]").attr("data-gallery-item-id")),e=n.closest(".image-gallery").attr("gid"),1<o.length&&Cargo.Event.once("image_gallery_render_complete",function(e){i.removeMID(t)}),null!==n.get(0).parentNode&&n.get(0).parentNode.removeChild(n.get(0)),this.imageGalleryObjects[e].checkForChanges()}},normalizeSelection:function(e,t){var i=CargoEditor.getActiveRange();if(i){void 0===t&&(t=e?e.target:i.endContainer);var o=$(t).closest(".gallery_card").get(0);if(o){var n=o.querySelectorAll("img, iframe, video")[0];if(n){var a=CargoEditor.rangy.createRange();a.selectNode(n),CargoEditor.helpers.setActiveRange(a)}else i.setStartBefore(o.firstChild),i.setEndAfter(o.lastChild),CargoEditor.helpers.setActiveRange(i);if(o.hasAttribute("data-gallery-item-index"))parseInt(o.getAttribute("data-gallery-item-index"));else{var r=o.querySelector("[data-gallery-item-index]");r&&parseInt(r.getAttribute("data-gallery-item-index"))}}}},getselectedGalleryId:function(e){if(e||(e=CargoEditor.getActiveRange())){var t=void 0,i=e.getNodes([Node.ELEMENT_NODE],function(e){return e.hasAttribute("data-gallery-item-id")});return 0==i.length&&(i=$(e.commonAncestorContainer).closest("[data-gallery-item-id]")),i[0]&&(t=parseInt(i[0].getAttribute("data-gallery-item-id"))),t}},editorEvents:{"editor-keydown":function(e,t){if(Cargo.Core.ImageGallery.currentEditableGallery)if(8===t.keyCode)this.doDelete(),t.preventDefault(),t.stopImmediatePropagation();else if(37===t.keyCode||39===t.keyCode){t.preventDefault(),t.stopImmediatePropagation();var i=CargoEditor.getActiveRange(),o=0,n=_.keys(Cargo.Core.ImageGallery.currentEditableGallery.images).length-1;if(i){var a=i.commonAncestorContainer.querySelector("[data-gallery-item-index]");a&&(o=parseInt(a.getAttribute("data-gallery-item-index")))}else o=37===t.keyCode?0:9e9;if(37===t.keyCode?o--:o++,n<o||o<0){var r=CargoEditor.rangy.createRange();o<0?(r.setStartBefore(Cargo.Core.ImageGallery.currentEditableGallery.el),r.setEndBefore(Cargo.Core.ImageGallery.currentEditableGallery.el)):(r.setStartAfter(Cargo.Core.ImageGallery.currentEditableGallery.el),r.setEndAfter(Cargo.Core.ImageGallery.currentEditableGallery.el)),r.collapse(),CargoEditor.plugins.forcerange.makeRangeForced(r)}else{var s=Cargo.Core.ImageGallery.currentEditableGallery.el.querySelector('[data-gallery-item-index="'+o+'"]');s&&this.normalizeSelection(null,s),!Cargo.Core.ImageGallery.currentEditableGallery.mobileSubviewActive&&Cargo.Core.ImageGallery.currentEditableGallery.Subview.el.hasOwnProperty("slick")&&Cargo.Core.ImageGallery.currentEditableGallery.Subview.$el.slick("slickGoTo",o,!0)}}else if(13===t.keyCode){t.preventDefault(),(r=CargoEditor.rangy.createRange()).setStartAfter(Cargo.Core.ImageGallery.currentEditableGallery.el),r.setEndAfter(Cargo.Core.ImageGallery.currentEditableGallery.el),r.collapse(),CargoEditor.plugins.forcerange.makeRangeForced(r)}else!1===t.metaKey&&(t.preventDefault(),t.stopImmediatePropagation())},"editor-mousedown":function(e,t){if(Cargo.Core.ImageGallery.currentEditableGallery&&Cargo.Core.ImageGallery.currentEditableGallery.el.contains(t.target)){(t&&"IMG"!==t.target.nodeName||0<$(t.target).closest('[draggable="true"]').length)&&t.preventDefault();var i=Cargo.Core.ImageGallery.currentEditableGallery.el.getBoundingClientRect(),o=!1;if(o=t.clientY<i.top+.5*i.height?"left":"right","IMG"!==t.target.nodeName&&"VIDEO"!==t.target.nodeName&&"IFRAME"!==t.target.nodeName||(o=!1),"left"==o)(n=CargoEditor.rangy.createRange()).setStartBefore(Cargo.Core.ImageGallery.currentEditableGallery.el),n.setEndBefore(Cargo.Core.ImageGallery.currentEditableGallery.el),n.collapse(!1),CargoEditor.plugins.forcerange.makeRangeForced(n);else if("right"==o){var n;(n=CargoEditor.rangy.createRange()).setStartAfter(Cargo.Core.ImageGallery.currentEditableGallery.el),n.setEndAfter(Cargo.Core.ImageGallery.currentEditableGallery.el),n.collapse(!0),CargoEditor.plugins.forcerange.makeRangeForced(n)}else this.normalizeSelection(t)}},"cursor-activity":function(e,t){Cargo.Core.ImageGallery.currentEditableGallery},"editor-paste":function(e,t){Cargo.Core.ImageGallery.currentEditableGallery&&(t.preventDefault(),t.stopImmediatePropagation())},"editor-cut":function(e,t){Cargo.Core.ImageGallery.currentEditableGallery&&(t.preventDefault(),t.stopImmediatePropagation())},"editor-copy":function(e,t){Cargo.Core.ImageGallery.currentEditableGallery&&(t.preventDefault(),t.stopImmediatePropagation())},"editor-before-summary-report":function(e){Cargo.Core.ImageGallery.currentEditableGallery&&0!==e.generateUnreportedMutationSummaries().length&&Cargo.Core.ImageGallery.currentEditableGallery.checkForChanges()},"history-add":function(e,t){t.modifiedGalleryIDs=[],t.removedNodes.forEach(function(e){e&&e.__galleryInstanceUID__&&t.modifiedGalleryIDs.indexOf(e.__galleryInstanceUID__)&&t.modifiedGalleryIDs.push(e.__galleryInstanceUID__)})},"history-before-undo":function(e,i){_.each(Cargo.Core.ImageGallery.imageGalleryObjects,function(e,t){-1!==i.modifiedGalleryIDs.indexOf(parseInt(t))&&(e.el.innerHTML="")})},"history-undo":function(e,i){var n={},t=!1;for(var o in _.each(i.removedNodes,function(e){$(e).hasClass("image-gallery")&&(e.className="image-gallery",e.setAttribute("data-force-gid",e.getAttribute("gid")),t=!0)}),_.each(i.attributeChanges,function(e){if("data-gallery"==e.attribute&&$(e.element).hasClass("image-gallery")){var t=e.element.getAttribute("gid"),i=Cargo.Core.ImageGallery.imageGalleryObjects[t];if(i){var o=JSON.parse(e.oldValue);i.updateOptions(o,!0),n[o.gallery_instance_id]=i}}}),_.each(Cargo.Core.ImageGallery.imageGalleryObjects,function(e,t){-1!==i.modifiedGalleryIDs.indexOf(parseInt(t))&&(n[t]=e)}),n)n[o].mobileSubviewActive?n[o].images=n[o].MobileSubview.serialize():n[o].images=n[o].Subview.serialize(),n[o].removeViews(!0),n[o].checkMobileAndLoadSubview();t&&_.defer(function(){Cargo.Core.ImageGallery.InitImageGallery({forceReCollectionOfItems:!0,targetElement:e.getElement()})})},"history-before-redo":function(e,i){_.each(Cargo.Core.ImageGallery.imageGalleryObjects,function(e,t){-1!==i.modifiedGalleryIDs.indexOf(parseInt(t))&&(e.el.innerHTML="")})},"history-redo":function(e,i){var n={},t=!1;for(var o in _.each(i.addedNodes,function(e){$(e).hasClass("image-gallery")&&(e.className="image-gallery",e.setAttribute("data-force-gid",e.getAttribute("gid")),t=!0)}),_.each(i.attributeChanges,function(e){if("data-gallery"==e.attribute&&$(e.element).hasClass("image-gallery")){var t=e.element.getAttribute("gid"),i=Cargo.Core.ImageGallery.imageGalleryObjects[t];if(i){var o=JSON.parse(e.newValue);i.updateOptions(o,!0),n[o.gallery_instance_id]=i}}}),_.each(Cargo.Core.ImageGallery.imageGalleryObjects,function(e,t){-1!==i.modifiedGalleryIDs.indexOf(parseInt(t))&&(n[t]=e)}),n)n[o].mobileSubviewActive?n[o].images=n[o].MobileSubview.serialize():n[o].images=n[o].Subview.serialize(),n[o].removeViews(!0),n[o].checkMobileAndLoadSubview();t&&_.defer(function(){Cargo.Core.ImageGallery.InitImageGallery({forceReCollectionOfItems:!0,targetElement:e.getElement()})})}}},Cargo.Core.Embeds={embeds:[],songKickWidgets:{},instagramInitialized:!1,initializeInstagram:function(e){requirejs(["https://platform.instagram.com/en_US/embeds.js"],e)},initializeTwitter:function(e){requirejs(["//platform.twitter.com/widgets.js"],e)},initializeBandsInTown:function(e){requirejs(["https://widget.bandsintown.com/main.min.js"],function(){BIT.widgetInitializer?e():BIT.onReady=e})},findEmbedsIn:function(e){_.each(e.querySelectorAll("cargo-embed, persona-embed"),this.add,this)},add:function(e){if(e&&e.nodeType===Node.ELEMENT_NODE){var t=e.getAttribute("data-type");if(t&&e&&e.nodeType===Node.ELEMENT_NODE&&-1===this.embeds.indexOf(e))switch(t){case"tweet":this.handleTwitterEmbed(e);break;case"twitter-timeline":this.handleTwitterTimelineEmbed(e);break;case"bandsintown":this.handleBandsIntownEmbed(e);break;case"songkick":this.handleSongkickEmbed(e);break;case"instagram":this.handleInstagramEmbed(e)}}},handleBandsIntownEmbed:function(e){this.initializeBandsInTown(_.bind(function(){var i={};_.each(e.attributes,function(e){if(/^data-/.test(e.name)&&"data-type"!==e.name){var t=e.name.substr(5).replace(/-/g,"_");i[t]=e.value}});var o=document.createElement("div");if(o.setAttribute("id","bit-widget-"+_.uniqueId()),o.setAttribute("class","bit-widget-initializer"),_.each(i,function(e,t){o.setAttribute("data-"+t.replace(/_/g,"-"),e)}),e.appendChild(o),Cargo.Helper.IsAdminEdit()){var t=new MutationObserver(function(e){_.each(e,function(e){"childList"==e.type&&e.addedNodes.forEach(function(e){e.setAttribute("contenteditable",!1),e&&e.classList.contains("bit-widget-container")&&(e.style.pointerEvents="none",t.disconnect())})})});t.observe(e,{childList:!0})}BIT.widgetInitializer.append(o,{})},this))},handleSongkickEmbed:function(e){var i={};_.each(e.attributes,function(e){if(/^data-/.test(e.name)&&"data-type"!==e.name){var t=e.name.substr(5).replace(/-/g,"_");i[t]=e.value}});var o=document.createElement("a");o.setAttribute("class","songkick-widget"),o.setAttribute("href","https://www.songkick.com/artists/"+i.id),o.setAttribute("contenteditable","false"),_.each(i,function(e,t){o.setAttribute("data-"+t.replace(/_/g,"-"),e)}),e.appendChild(o),this.embeds.push(e);var t="https://widget.songkick.com/"+i.id+"/widget.js";void 0===this.songKickWidgets[i.id]?this.songKickWidgets[i.id]=0:t=t+"?"+ ++this.songKickWidgets[i.id],require([t])},handleTwitterEmbed:function(e){var t=e.getAttribute("data-id");t&&""!==t&&this.initializeTwitter(_.bind(function(){twttr.widgets.createTweet(t,e).then(function(e){e.setAttribute("contenteditable","false")}),this.embeds.push(e)},this))},handleTwitterTimelineEmbed:function(e){try{var t=JSON.parse(e.getAttribute("data-source"))}catch(e){return}var i;if("number"==typeof t&&(t=e.getAttribute("data-source")),e.hasAttribute("data-options"))try{i=JSON.parse(e.getAttribute("data-options"))}catch(e){}this.initializeTwitter(_.bind(function(){twttr.widgets.createTimeline(t,e,i).then(function(e){e&&e.setAttribute("contenteditable","false")}),this.embeds.push(e)},this))},handleInstagramEmbed:function(t){var e=t.getAttribute("data-url");e&&(0<e.indexOf("?")&&(e=e.substring(0,e.indexOf("?"))),$.get("/dispatch/services/getInstagramByUrl?url="+e,_.bind(function(e){"object"==typeof e&&this.initializeInstagram(_.bind(function(){t.innerHTML=e.html,instgrm.Embeds.process()},this))},this)))},remove:function(){}},Cargo.Core.Ecommerce={activeWidgets:[],settingsStorage:{},settingsStorageIndex:0,findWidgets:function(e){if(Cargo.Collection.StripeProducts.productSyncOccurred){var t=Array.prototype.slice.call(document.body.querySelectorAll("shop")),a=[],r=0;e&&e.querySelectorAll&&_.each(e.querySelectorAll("shop"),function(e){-1===t.indexOf(e)&&t.push(e)}),_.each(t,function(e){if(e&&e.nodeType===Node.ELEMENT_NODE){var t=e.getAttribute("product");if(t){var i=Cargo.Collection.StripeProducts.findWhere({id:t.trim()});if(!e.__ecommerce_view__||e.__ecommerce_view__.model!==i){var o=new Cargo.o.view.ProductWidget({model:i});if(e.hasAttribute("sid")){var n=e.getAttribute("sid");this.settingsStorage[n]&&o.updateOptions(this.settingsStorage[n]),e.removeAttribute("sid")}o.setElement(e),o.render(),e.__ecommerce_view__=o,a.push({el:e,view:o,id:r++})}}}},this),this.activeWidgets=a}},updateCartText:function(e,t){if(!0===t||void 0!==Cargo.Model.DisplayOptions.get("ecommerce_options")&&"text"==Cargo.Model.DisplayOptions.get("ecommerce_options").shop_icon){var i=document.getElementById("shop_button");e||(e=Cargo.Model.DisplayOptions.get("ecommerce_options").shop_icon_text),i&&e&&(void 0===Cargo.Collection.StripeProducts.cart_count||0===Cargo.Collection.StripeProducts.cart_count?i.innerHTML=e.replace(/&lt;(.*?)#(.*?)&gt;/gi,""):i.innerHTML="string"==typeof e&&""!==e?e.replace(/&lt;(.*?)#(.*?)&gt;/gi,"$1"+Cargo.Collection.StripeProducts.cart_count+"$2"):"")}},updateInlineCartCounters:function(){var e=document.querySelectorAll("cartcount");_.each(e,function(e){var t=e.getAttribute("data-template");void 0===Cargo.Collection.StripeProducts.cart_count||0===Cargo.Collection.StripeProducts.cart_count?e.innerText=t.replace(/<(.*?)#(.*?)>/gi,""):e.innerText="string"==typeof t&&""!==t?t.replace(/<(.*?)#(.*?)>/gi,"$1"+Cargo.Collection.StripeProducts.cart_count+"$2"):""},this)},storeSettingsAndSaveReferences:function(){_.each(this.activeWidgets,function(e){var t=this.settingsStorageIndex++;this.settingsStorage[t]=e.view.getOptions(),e.view.el.setAttribute("sid",t)},this)},initialize:function(){Cargo.Collection.StripeProducts.on("sync error",function(){this.findWidgets()},this),Cargo.Event.on("cargoEditor:before-html-to-projectcontent",function(){this.storeSettingsAndSaveReferences()},this),this.findWidgets()},countryMap:{AF:"Afghanistan",AX:"Ã…land Islands",AL:"Albania",DZ:"Algeria",AS:"American Samoa",AD:"Andorra",AO:"Angola",AI:"Anguilla",AQ:"Antarctica",AG:"Antigua and Barbuda",AR:"Argentina",AM:"Armenia",AW:"Aruba",AU:"Australia",AT:"Austria",AZ:"Azerbaijan",BS:"Bahamas",BH:"Bahrain",BD:"Bangladesh",BB:"Barbados",BY:"Belarus",BE:"Belgium",BZ:"Belize",BJ:"Benin",BM:"Bermuda",BT:"Bhutan",BO:"Bolivia, Plurinational State of",BQ:"Bonaire, Sint Eustatius and Saba",BA:"Bosnia and Herzegovina",BW:"Botswana",BV:"Bouvet Island",BR:"Brazil",IO:"British Indian Ocean Territory",BN:"Brunei Darussalam",BG:"Bulgaria",BF:"Burkina Faso",BI:"Burundi",KH:"Cambodia",CM:"Cameroon",CA:"Canada",CV:"Cape Verde",KY:"Cayman Islands",CF:"Central African Republic",TD:"Chad",CL:"Chile",CN:"China",CX:"Christmas Island",CC:"Cocos (Keeling) Islands",CO:"Colombia",KM:"Comoros",CG:"Congo",CD:"Congo, the Democratic Republic of the",CK:"Cook Islands",CR:"Costa Rica",CI:"CÃ´te d'Ivoire",HR:"Croatia",CU:"Cuba",CW:"CuraÃ§ao",CY:"Cyprus",CZ:"Czech Republic",DK:"Denmark",DJ:"Djibouti",DM:"Dominica",DO:"Dominican Republic",EC:"Ecuador",EG:"Egypt",SV:"El Salvador",GQ:"Equatorial Guinea",ER:"Eritrea",EE:"Estonia",ET:"Ethiopia",FK:"Falkland Islands (Malvinas)",FO:"Faroe Islands",FJ:"Fiji",FI:"Finland",FR:"France",GF:"French Guiana",PF:"French Polynesia",TF:"French Southern Territories",GA:"Gabon",GM:"Gambia",GE:"Georgia",DE:"Germany",GH:"Ghana",GI:"Gibraltar",GR:"Greece",GL:"Greenland",GD:"Grenada",GP:"Guadeloupe",GU:"Guam",GT:"Guatemala",GG:"Guernsey",GN:"Guinea",GW:"Guinea-Bissau",GY:"Guyana",HT:"Haiti",HM:"Heard Island and McDonald Islands",VA:"Holy See (Vatican City State)",HN:"Honduras",HK:"Hong Kong",HU:"Hungary",IS:"Iceland",IN:"India",ID:"Indonesia",IR:"Iran, Islamic Republic of",IQ:"Iraq",IE:"Ireland",IM:"Isle of Man",IL:"Israel",IT:"Italy",JM:"Jamaica",JP:"Japan",JE:"Jersey",JO:"Jordan",KZ:"Kazakhstan",KE:"Kenya",KI:"Kiribati",KP:"Korea, Democratic People's Republic of",KR:"Korea, Republic of",KW:"Kuwait",KG:"Kyrgyzstan",LA:"Lao People's Democratic Republic",LV:"Latvia",LB:"Lebanon",LS:"Lesotho",LR:"Liberia",LY:"Libya",LI:"Liechtenstein",LT:"Lithuania",LU:"Luxembourg",MO:"Macao",MK:"Macedonia, the former Yugoslav Republic of",MG:"Madagascar",MW:"Malawi",MY:"Malaysia",MV:"Maldives",ML:"Mali",MT:"Malta",MH:"Marshall Islands",MQ:"Martinique",MR:"Mauritania",MU:"Mauritius",YT:"Mayotte",MX:"Mexico",FM:"Micronesia, Federated States of",MD:"Moldova, Republic of",MC:"Monaco",MN:"Mongolia",ME:"Montenegro",MS:"Montserrat",MA:"Morocco",MZ:"Mozambique",MM:"Myanmar",NA:"Namibia",NR:"Nauru",NP:"Nepal",NL:"Netherlands",NC:"New Caledonia",NZ:"New Zealand",NI:"Nicaragua",NE:"Niger",NG:"Nigeria",NU:"Niue",NF:"Norfolk Island",MP:"Northern Mariana Islands",NO:"Norway",OM:"Oman",PK:"Pakistan",PW:"Palau",PS:"Palestinian Territory, Occupied",PA:"Panama",PG:"Papua New Guinea",PY:"Paraguay",PE:"Peru",PH:"Philippines",PN:"Pitcairn",PL:"Poland",PT:"Portugal",PR:"Puerto Rico",QA:"Qatar",RE:"RÃ©union",RO:"Romania",RU:"Russian Federation",RW:"Rwanda",BL:"Saint BarthÃ©lemy",SH:"Saint Helena, Ascension and Tristan da Cunha",KN:"Saint Kitts and Nevis",LC:"Saint Lucia",MF:"Saint Martin (French part)",PM:"Saint Pierre and Miquelon",VC:"Saint Vincent and the Grenadines",WS:"Samoa",SM:"San Marino",ST:"Sao Tome and Principe",SA:"Saudi Arabia",SN:"Senegal",RS:"Serbia",SC:"Seychelles",SL:"Sierra Leone",SG:"Singapore",SX:"Sint Maarten (Dutch part)",SK:"Slovakia",SI:"Slovenia",SB:"Solomon Islands",SO:"Somalia",ZA:"South Africa",GS:"South Georgia and the South Sandwich Islands",SS:"South Sudan",ES:"Spain",LK:"Sri Lanka",SD:"Sudan",SR:"Suriname",SJ:"Svalbard and Jan Mayen",SZ:"Swaziland",SE:"Sweden",CH:"Switzerland",SY:"Syrian Arab Republic",TW:"Taiwan, Province of China",TJ:"Tajikistan",TZ:"Tanzania, United Republic of",TH:"Thailand",TL:"Timor-Leste",TG:"Togo",TK:"Tokelau",TO:"Tonga",TT:"Trinidad and Tobago",TN:"Tunisia",TR:"Turkey",TM:"Turkmenistan",TC:"Turks and Caicos Islands",TV:"Tuvalu",UG:"Uganda",UA:"Ukraine",AE:"United Arab Emirates",GB:"United Kingdom",US:"United States",UM:"United States Minor Outlying Islands",UY:"Uruguay",UZ:"Uzbekistan",VU:"Vanuatu",VE:"Venezuela, Bolivarian Republic of",VN:"Viet Nam",VG:"Virgin Islands, British",VI:"Virgin Islands, U.S.",WF:"Wallis and Futuna",EH:"Western Sahara",YE:"Yemen",ZM:"Zambia",ZW:"Zimbabwe"}},function(){var n=function(e){e?(e.setAttribute("contenteditable","false"),e.innerHTML='<div class="button"><svg class="play icon" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve"><polygon points="4,2 4,14 15.3,8 "/></svg><svg class="pause icon" x="0px" y="0px" viewBox="0 0 16 16" enable-background="new 0 0 16 16" xml:space="preserve"><polygon points="3,2 3,14 4,14 7,14 7,2 4,2"/><polygon points="12,2 9,2 9,14 12,14 13,14 13,2"/></svg>\t</div>\t<div class="separator">Â </div></div><div class="bar">\t<div class="buffer"> </div>\t<div class="progress"><div class="progress-indicator"></div></div><svg class="note-icon" x="0px" y="0px" viewBox="0 0 42 49.9" style="enable-background:new 0 0 42 49.9;" xml:space="preserve">\t<g>\t\t<g>\t\t\t<path d="M41.5,34.9c0,5.5-3.1,8.2-9.2,8.2c-2.2,0-3.9-0.4-5.2-1.6c-1.3-1-1.9-2.4-1.9-4s0.7-3.1,2.4-4.3c1.6-1.2,3.6-1.8,5.8-1.8 c1.8,0,3.4,0.4,5.2,1.2V9.2L16.8,16v25.1c0,5.5-3.1,8.3-9.3,8.3c-2.2,0-3.9-0.4-5.2-1.5c-1.2-1-1.9-2.4-1.9-4s0.7-3.1,2.2-4.3 s3.4-1.8,5.6-1.8c1.8,0,3.7,0.4,5.6,1V9.2l27.7-8.7L41.5,34.9L41.5,34.9z"/>\t\t</g>\t</g></svg>\t<div class="current-time">0:00</div>\t<div data-title class="title">Play</div>\t<div class="total-time">0:00</div></div><audio preload="metadata"></audio>',this.elements={container:e,play_pause:e.querySelector(".button"),play:e.querySelector(".play"),pause:e.querySelector(".pause"),current_time:e.querySelector(".current-time"),note:e.querySelector(".note-icon"),track_buffer:e.querySelector(".buffer"),progress:e.querySelector(".progress"),progress_ind:e.querySelector(".progress-indicator"),bar:e.querySelector(".bar"),track_length:e.querySelector(".total-time"),play_text:e.querySelector(".title")},this.audio_track=e.querySelector("audio"),this.onMouseInteraction=this.onMouseInteraction.bind(this),this.updatePlayerTime=this.updatePlayerTime.bind(this),this.onError=this.onError.bind(this),this.clearError=this.clearError.bind(this),this.togglePlay=this.togglePlay.bind(this),this.onProgress=this.onProgress.bind(this),this.onTrackEnd=this.onTrackEnd.bind(this),this.onSeekStart=this.onSeekStart.bind(this),this.onSeekEnd=this.onSeekEnd.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.destroy=this.destroy.bind(this),this.removeEl=this.removeEl.bind(this),this.bindEvents(),this.mouseFlow,this.paused,this.started,this.dragging,this.hasError=!1,this.mouseInteractionDisabled=!1,this.isAdminEdit=Cargo.Helper.IsAdminEdit(),(this.elements.container.__cargo_audio_player_=this).setSrc(e.getAttribute("data-src")),this.setTitle(e.getAttribute("data-title"))):console.error("no element passed.")};n.prototype.setSrc=function(e){this.audio_track.getAttribute("src")!==e&&(this.setInitialState(),this.audio_track.src=e,this.elements.container.setAttribute("data-src",e))},n.prototype.setTitle=function(e){this.setInitialState(),e&&""!==e||(e="Play"),this.elements.play_text.innerText=e,this.elements.container.setAttribute("data-title",e)},n.prototype.bindEvents=function(){this.audio_track.addEventListener("progress",this.onProgress),this.audio_track.addEventListener("loadedmetadata",this.onProgress),this.audio_track.addEventListener("timeupdate",this.updatePlayerTime),this.audio_track.addEventListener("seeking",this.onSeekStart),this.audio_track.addEventListener("seeked",this.onSeekEnd),this.audio_track.addEventListener("ended",this.onTrackEnd),this.audio_track.addEventListener("error",this.onError),this.audio_track.addEventListener("canplay",this.clearError),this.elements.play_pause.addEventListener("click",this.togglePlay),this.elements.bar.addEventListener("mousedown",this.onMouseDown),this.elements.bar.addEventListener("touchstart",this.onMouseDown),this.elements.bar.addEventListener("touchend",this.onMouseUp),Cargo.Event.on("css_inspector_activated",this.disableMouseInteraction,this),Cargo.Event.on("css_inspector_deactivated",this.enableMouseInteraction,this),window.addEventListener("mouseup",this.onMouseUp)},n.prototype.destroy=function(){this.audio_track.removeEventListener("progress",this.onProgress),this.audio_track.removeEventListener("loadedmetadata",this.onProgress),this.audio_track.removeEventListener("timeupdate",this.updatePlayerTime),this.audio_track.removeEventListener("seeking",this.onSeekStart),this.audio_track.removeEventListener("seeked",this.onSeekEnd),this.audio_track.removeEventListener("ended",this.onTrackEnd),this.audio_track.removeEventListener("error",this.onError),this.audio_track.removeEventListener("canplay",this.clearError),this.elements.play_pause.removeEventListener("click",this.togglePlay),this.elements.bar.removeEventListener("mousedown",this.onMouseDown),this.elements.bar.removeEventListener("touchstart",this.onMouseDown),this.elements.bar.removeEventListener("touchend",this.onMouseUp),Cargo.Event.off("css_inspector_activated",this.disableMouseInteraction),Cargo.Event.off("css_inspector_deactivated",this.enableMouseInteraction),window.removeEventListener("mouseup",this.onMouseUp),this.audio_track.pause(),this.audio_track.src="",delete this.elements.container.__cargo_audio_player_},n.prototype.disableMouseInteraction=function(){this.mouseInteractionDisabled=!0},n.prototype.enableMouseInteraction=function(){this.mouseInteractionDisabled=!1},n.prototype.removeEl=function(){this.elements.container&&this.elements.container&&this.elements.container.parentNode.removeChild(this.elements.container)},n.prototype.setPlayState=function(){this.elements.play.style.display="none",this.elements.pause.style.display="",this.elements.play_text.style.display="none",this.elements.current_time.style.display="",this.elements.note.style.display="none",this.elements.progress.style.display="",this.elements.track_length.style.display="",this.elements.track_buffer.style.display="",this.paused=!1,this.started=!0,this.dragging=!0},n.prototype.setInitialState=function(){this.elements.play.style.display="",this.elements.play_text.style.display="",this.elements.pause.style.display="none",this.elements.note.style.display="",this.elements.progress.style.display="none",this.elements.current_time.style.display="none",this.elements.track_length.style.display="none",this.elements.track_buffer.style.display="none",this.elements.progress.style.width="0%",this.elements.track_buffer.style.left="0",this.elements.track_buffer.style.width="0",this.paused=!0,this.dragging=!1,this.started=!1,this.currentPlayerTimestamp=0},n.prototype.setPauseState=function(){this.paused=!0,this.elements.play.style.display="",this.elements.pause.style.display="none"},n.prototype.togglePlay=function(){if(!this.mouseInteractionDisabled)if(this.audio_track.paused){var e=this.audio_track.play();e?(this.elements.container.classList.add("seeking"),e.then(function(){this.setPlayState()}.bind(this)).catch(this.onError).finally(function(){requestAnimationFrame(function(){this.elements.container.classList.remove("seeking")}.bind(this))}.bind(this))):this.setPlayState()}else this.audio_track.pause(),this.setPauseState()},n.prototype.onError=function(e){if(this.isAdminEdit&&""===this.audio_track.getAttribute("src"))return!0;this.hasError=!0,this.setInitialState(),this.elements.play_text.innerText="Unable to load file",e instanceof DOMException&&console.error(e)},n.prototype.clearError=function(e){this.hasError&&(this.setTitle(this.elements.container.getAttribute("data-title")),this.hasError=!1)},n.prototype.onTrackEnd=function(){!0!==this.dragging&&(this.started=!1,this.setPauseState())},n.prototype.onProgress=function(e){e&&"loadedmetadata"===e.type&&(this.elements.track_length.innerText=this.timestampToHumanReadable(this.audio_track.duration)),this.updateBufferSize()},n.prototype.updatePlayerTime=function(){if(this.started&&this.audio_track.readyState!==this.audio_track.HAVE_NOTHING){this.currentPlayerTimestamp=this.audio_track.currentTime,this.elements.current_time.textContent=this.timestampToHumanReadable(this.currentPlayerTimestamp);var e=this.currentPlayerTimestamp/this.audio_track.duration*100,t=this.elements.bar.clientWidth,i=parseInt(window.getComputedStyle(this.elements.progress_ind).width);this.elements.track_buffer.style.transition=t*(e/100)<i?(e=i/t*(100-e),this.elements.progress.style.transition="none"):this.elements.progress.style.transition="",this.elements.progress.style.width=e+"%",this.elements.track_buffer.style.left=e+"%",this.updateBufferSize()}},n.prototype.updateBufferSize=function(){for(var e=0,t=0;t<this.audio_track.buffered.length;t++)if(this.currentPlayerTimestamp>=this.audio_track.buffered.start(t)&&this.currentPlayerTimestamp<=this.audio_track.buffered.end(t)){e=Math.max(this.audio_track.buffered.end(t)-this.currentPlayerTimestamp,0)/this.audio_track.duration*100;break}e+=1,this.elements.track_buffer.style.width=e+"%"},n.prototype.timestampToHumanReadable=function(e){if(isNaN(e))return"0:00";var t=Math.floor(e%60),i=Math.floor(e/60),o=Math.floor(i/60);return t<10&&(t="0"+t),0<o?((i-=60*o)<10&&(i="0"+i),o+":"+i+":"+t):i+":"+t},n.prototype.onMouseInteraction=function(e){if(!this.mouseInteractionDisabled&&this.started&&this.audio_track.readyState!==this.audio_track.HAVE_NOTHING&&this.dragging){var t=this.elements.bar.getBoundingClientRect(),i=e.clientX||e.touches[0].clientX;i<t.left?this.audio_track.currentTime=0:i>t.right?this.audio_track.currentTime=this.audio_track.duration:this.audio_track.currentTime=this.audio_track.duration*((i-t.left)/this.elements.bar.clientWidth)}},n.prototype.onMouseDown=function(e){e.preventDefault(),this.mouseInteractionDisabled||2===e.button||(!1===this.paused&&this.audio_track.pause(),document.body.classList.add("audio-player-dragging"),this.elements.bar.addEventListener("mousemove",this.onMouseInteraction),window.addEventListener("mousemove",this.onMouseInteraction),this.elements.bar.addEventListener("touchmove",this.onMouseInteraction),this.elements.container.classList.add("seeking"),this.dragging=!0,this.onMouseInteraction(e))},n.prototype.onMouseUp=function(e){1==this.dragging&&(document.body.classList.remove("audio-player-dragging"),this.elements.bar.removeEventListener("mousemove",this.onMouseInteraction),this.elements.bar.removeEventListener("touchmove",this.onMouseInteraction),window.removeEventListener("mousemove",this.onMouseInteraction),(this.dragging=!1)===this.paused&&!0===this.started&&(this.audio_track.currentTime>=this.audio_track.duration-.001?this.setPauseState():this.audio_track.play())),this.onSeekEnd()},n.prototype.onSeekStart=function(){this.elements.container.classList.add("seeking"),requestAnimationFrame(function(){this.updatePlayerTime()}.bind(this))},n.prototype.onSeekEnd=function(){this.updatePlayerTime(),this.dragging||requestAnimationFrame(function(){this.elements.container.classList.remove("seeking")}.bind(this))},Cargo.Core.AudioPlayer={instances:[],findPlayers:function(i){if(i){var e,o=[];return e=$(i).is("div.audio-player")?[i]:i.querySelectorAll("div.audio-player"),_.each(e,function(e){if(void 0===_.findWhere(this.instances,{el:e})){var t=new n(e);this.instances.push({parent:i,el:e,player:t}),o.push(t)}},this),o}},destroyPlayers:function(t){t&&_.each(this.instances,function(e){e.parent===t&&e.player.destroy()})}}}(),function(){function h(e,t){var i=e&&(t(e)?e:h(e.parentNode,t));return i||null}function P(e,t,i,o,n,a,r){var s=Math.acos,l=Math.atan,d=Math.sqrt,c=Math.PI,h={x:n,y:a},u=0,g={x:1,y:1},p={x:0,y:0},m=e*o-t*i;if(r)e?(p={x:l(i/e),y:l(t/e)},g={x:e,y:m/e}):p.x=t?(u=.5*c,g={x:t,y:m/t},l(o/t)):(g={x:i,y:o},.25*c);else if(e||t){var f=d(e*e+t*t);u=0<t?s(e/f):-s(e/f),g={x:f,y:m/f},p.x=l((e*i+t*o)/(f*f))}else if(i||o){var v=d(i*i+o*o);u=.5*c-(0<o?s(-i/v):-s(i/v)),g={x:m/v,y:v},p.y=l((e*i+t*o)/(v*v))}else g={x:0,y:0};return{scale:g,translate:h,rotation:u,skew:p}}Cargo.Core.Draggables={},Cargo.Core.Draggables.masterList={},Cargo.Core.Draggables.findShowLinks=function(){0<document.querySelectorAll('[rel*="show_draggable"]').length?Cargo.Core.Draggables.showLinkIsPresent=!0:Cargo.Core.Draggables.showLinkIsPresent=!1},Cargo.Core.Draggables.cleanup=function(e){e.model&&Cargo.Core.Draggables.masterList.hasOwnProperty(e.model.id)&&delete Cargo.Core.Draggables.masterList[e.model.id]},Cargo.Core.Draggables.DraggablesInstance=Backbone.View.extend({initialize:function(e){if(!Cargo.Helper.IsAdminEdit()&&e.pageView&&(this.pageView=e.pageView,this.insideGallery=this.pageView.el.classList.contains("image-gallery"),!this.insideGallery||!this.pageView.el.classList.contains("slick"))){if(this.pid=0,this.insideGallery){var t=h(this.pageView.el,function(e){if(e&&e.nodeType===Node.ELEMENT_NODE&&"DIV"===e.nodeName)return e.hasAttribute("data-id")});if(!t)return;this.pid=parseInt(t.getAttribute("data-id"))}else this.pid=this.pageView.model.id;this.draggables=[],this.findDraggables(),this.bindShowHideLinks()}},findDraggables:function(){var e=this.pageView.el.querySelectorAll("[data-draggable]");if(0<e.length){var t=this.pageView.el.querySelectorAll("[grid-col], [image-gallery-col]");_.each(t,function(e){0<e.querySelectorAll("[data-draggable]").length&&(""!==e.style.position&&"static"!==e.style.position||(e.style.position="relative"))})}for(var i=0;i<e.length;i++){var o=e[i],n=o.classList.contains("gallery_card"),a=null;n||(a=h(o,function(e){if(e&&e.nodeType===Node.ELEMENT_NODE&&"DIV"===e.nodeName)return e.classList.contains("marquee")}));var r=h(o.parentNode,function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.hasAttribute("data-draggable")});if(!(a||!o.parentNode||o.parentNode.classList.contains("image-gallery")&&!n||r||!this.insideGallery&&n)){var s={initial_state_set:!1};o.style.zIndex?s.zIndex=o.style.zIndex:s.zIndex=1;var l=_.uniqueId("draggable_");o.hasAttribute("data-draggable-id")&&(l=o.getAttribute("data-draggable-id")),s.id=l,s.el=o;var d=s.el.querySelector(".draggable_handle");if(s.handle=d,this.insideGallery&&n)s.interiorItem=s.el.querySelector("[data-gallery-item]");else if(this.insideGallery)continue;this.draggables.push(s),Cargo.Core.Draggables.masterList.hasOwnProperty(this.pid)||(Cargo.Core.Draggables.masterList[this.pid]={draggables:[]}),Cargo.Core.Draggables.masterList[this.pid].draggables.push(s)}}if(0<this.draggables.length&&!this.insideGallery){var c=this.pageView.el.querySelector("bodycopy");c&&c.classList.add("preserve-3d")}for(i=0;i<this.draggables.length;i++)this.bindDraggable(this.draggables[i])},bindShowHideLinks:function(){for(var e=this.pageView.el.querySelectorAll('[rel*="toggle_draggable"]'),t=0;t<e.length;t++){e[t].addEventListener("click",this.toggleDraggables)}var i=this.pageView.el.querySelectorAll('[rel*="hide_draggable"]');for(t=0;t<i.length;t++){i[t].addEventListener("click",this.hideDraggables)}var o=this.pageView.el.querySelectorAll('[rel*="show_draggable"]');for(t=0;t<o.length;t++){o[t].addEventListener("click",this.showDraggables)}Cargo.Core.Draggables.masterList[this.pid]||(Cargo.Core.Draggables.masterList[this.pid]={draggables:[]}),Cargo.Core.Draggables.showLinkIsPresent?_.each(Cargo.Core.Draggables.masterList,function(e){_.each(e.draggables,function(e){e.initial_state_set||(e.el.classList.add("draggable_hidden"),e.initial_state_set=!0)})}):_.each(Cargo.Core.Draggables.masterList,function(e){_.each(e.draggables,function(e){e.initial_state_set||e.el.classList.remove("draggable_hidden"),e.initial_state_set=!0})})},hideDraggables:function(e){if(e.preventDefault(),this.hasAttribute("data-draggable-id")){var i=this.getAttribute("data-draggable-id");_.each(Cargo.Core.Draggables.masterList,function(e){var t=_.filter(e.draggables,{id:i});_.each(t,function(e){e.el.classList.add("draggable_hidden")})})}else _.each(Cargo.Core.Draggables.masterList,function(e){_.each(e.draggables,function(e){e.el.classList.add("draggable_hidden")})})},showDraggables:function(e){if(e.preventDefault(),this.hasAttribute("data-draggable-id")){var i=this.getAttribute("data-draggable-id");_.each(Cargo.Core.Draggables.masterList,function(e){var t=_.filter(e.draggables,{id:i});_.each(t,function(e){e.el.classList.remove("draggable_hidden")})})}else _.each(Cargo.Core.Draggables.masterList,function(e){_.each(e.draggables,function(e){e.el.classList.remove("draggable_hidden")})})},toggleDraggables:function(e){if(e.preventDefault(),this.hasAttribute("data-draggable-id")){var i=this.getAttribute("data-draggable-id");_.each(Cargo.Core.Draggables.masterList,function(e){var t=_.filter(e.draggables,{id:i});_.each(t,function(e){e.el.classList.contains("draggable_hidden")?e.el.classList.remove("draggable_hidden"):e.el.classList.add("draggable_hidden")})})}else _.each(Cargo.Core.Draggables.masterList,function(e){_.each(e.draggables,function(e){e.el.classList.contains("draggable_hidden")?e.el.classList.remove("draggable_hidden"):e.el.classList.add("draggable_hidden")})})},bindDraggable:function(g){var p,m=0,f=0,v=0,b=0,y=0,w=0,C=0,S=0,k=0,x=!1,E=!1,I=null;if(g.interiorItem&&(g.interiorItem.style.cursor="move"),g.handle?g.handle.style.cursor="move":g.el.style.cursor="move",g.el.setAttribute("data-draggable-id",g.id),0<g.el.children.length){var e=g.el.querySelectorAll('[rel*="show_draggable"]'),t=g.el.querySelectorAll('[rel*="hide_draggable"]'),i=g.el.querySelectorAll('[rel*="toggle_draggable"]');_.each(e,function(e){e.setAttribute("data-draggable-id",g.id)}),_.each(t,function(e){e.setAttribute("data-draggable-id",g.id)}),_.each(i,function(e){e.setAttribute("data-draggable-id",g.id)})}var T=function(e){E=!x||(e.preventDefault(),e.stopPropagation(),!1),window.removeEventListener("click",T,!0)},o=_.bind(function(e){if(2!=e.button){"INPUT"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&"LABEL"!==e.target.tagName&&"CANVAS"!==e.target.tagName&&(e.preventDefault(),E=!1),I=g.el,x=!1;var t=e.clientX||e.touches&&e.touches[0].clientX,i=e.clientY||e.touches&&e.touches[0].clientY;this.pageView.el.classList.add("dragging-active");var o=g.el.style.transform;g.el.style.transform="",g.el.style.transitionDuration="initial",p=g.el.getBoundingClientRect(),g.el.style.transform=o,g.initial_state_set=!0;var n=window.getComputedStyle(g.el);if(!this.insideGallery){var a=n.getPropertyValue("background-color"),r=!0;if(0<a.indexOf("rgb("))r=!1;else for(var s=a.replace("rgba(","").replace(")","").split(","),l=0;l<s.length;l++){0<parseFloat(s[l])&&(r=!1)}r&&(g.el.style.backgroundColor="rgba(0,0,0,0.004)")}var d=n.getPropertyValue("transform"),c=-1<d.indexOf("matrix("),h=-1<d.indexOf("matrix3d(");if(c){d=d.replace(")","").replace("matrix(","").split(",");for(l=0;l<d.length;l++)d[l]=parseFloat(d[l]);k=P(d[0],d[1],d[2],d[3],d[4],d[5],!1).rotation,b=d[d.length-1],v=d[d.length-2]}else if(h){d=d.replace(")","").replace("matrix3d(","").split(",");for(l=0;l<d.length;l++)d[l]=parseFloat(d[l]);k=P(d[0],d[1],d[4],d[5],d[12],d[13],!1).rotation,b=d[d.length-3],v=d[d.length-4]}else d=[1,0,0,1,0,0],b=v=k=0;v=Math.floor(100*v)/100,b=Math.floor(100*b)/100,180<(k=(Math.round(k*(180/Math.PI))+360)%360)&&(k-=360),m=t-v,f=i-b,C=p.left,S=p.top,y=t,w=i,window.addEventListener("click",T,!0);var u=0;for(l=0;l<this.draggables.length;l++)u=Math.max(this.draggables[l].zIndex,u);g.zIndex=u+1,g.el.style.zIndex=99,_.defer(function(){g.el.style.zIndex=u+1}),e.touches?(window.addEventListener("touchmove",A),window.addEventListener("touchend",M)):(window.addEventListener("mousemove",A),window.addEventListener("mouseup",M))}},this),A=function(e){var t=e.clientX||e.touches&&e.touches[0].clientX,i=e.clientY||e.touches&&e.touches[0].clientY;v=t-m,b=i-f,(2<Math.abs(y-t)||2<Math.abs(w-i))&&(x=!0),C+v>=baseUnit.cache.window.w-50?v=baseUnit.cache.window.w+-C+-50:C+v+p.width<=50&&(v=-C-p.width+50);S+b>=baseUnit.cache.window.h-50?b=baseUnit.cache.window.h+-S+-50:S+b+p.height<=50&&(b=-S-p.height+50),n()},M=_.bind(function(e){if(_.defer(function(){g.el.style.transitionDuration=""}),g.el.hasAttribute("data-draggable")&&(g.el.setAttribute("data-transform-z",g.zIndex),g.el.setAttribute("data-transform-x",100*v/p.width),g.el.setAttribute("data-transform-y",100*b/p.height)),this.pageView.el.classList.remove("dragging-active"),0<g.el.children.length&&!this.insideGallery){var t=g.el.querySelectorAll("img, video, iframe");_.each(t,function(e){e._scrollWatcher&&(e._scrollWatcher.recalculateLocation(),e._scrollWatcher.update(),e._scrollWatcher.triggerCallbacks()),e._scrollWatchEnterThreshold&&(e._scrollWatchEnterThreshold.recalculateLocation(),e._scrollWatchEnterThreshold.update(),e._scrollWatchEnterThreshold.triggerCallbacks()),e._referenceScrollWatch&&(e._referenceScrollWatch.recalculateLocation(),e._referenceScrollWatch.update(),e._referenceScrollWatch.triggerCallbacks())})}else this.insideGallery&&g.interiorItem?(g.interiorItem._scrollWatcher&&(g.interiorItem._scrollWatcher.recalculateLocation(),g.interiorItem._scrollWatcher.update(),g.interiorItem._scrollWatcher.triggerCallbacks()),g.interiorItem._scrollWatchEnterThreshold&&(g.interiorItem._scrollWatchEnterThreshold.recalculateLocation(),g.interiorItem._scrollWatchEnterThreshold.update(),g.interiorItem._scrollWatchEnterThreshold.triggerCallbacks()),g.interiorItem._referenceScrollWatch&&(g.interiorItem._referenceScrollWatch.recalculateLocation(),g.interiorItem._referenceScrollWatch.update(),g.interiorItem._referenceScrollWatch.triggerCallbacks())):(g.el._scrollWatcher&&(g.el._scrollWatcher.recalculateLocation(),g.el._scrollWatcher.update(),g.el._scrollWatcher.triggerCallbacks()),g.el._scrollWatchEnterThreshold&&(g.el._scrollWatchEnterThreshold.recalculateLocation(),g.el._scrollWatchEnterThreshold.update(),g.el._scrollWatchEnterThreshold.triggerCallbacks()),g.el._referenceScrollWatch&&(g.el._referenceScrollWatch.recalculateLocation(),g.el._referenceScrollWatch.update(),g.el._referenceScrollWatch.triggerCallbacks()));x||_.defer(function(){if(!E&&I){var e=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0});I.dispatchEvent(e)}}),window.removeEventListener("touchmove",A),window.removeEventListener("touchend",M),window.removeEventListener("mousemove",A),window.removeEventListener("mouseup",M)},this),n=function(){g.el.style.transform="translate("+100*v/p.width+"%,"+100*b/p.height+"%) rotate("+k+"deg) translateZ("+g.zIndex+"px)"};g.handle?(g.handle.addEventListener("touchstart",o),g.handle.addEventListener("mousedown",o)):(g.el.addEventListener("touchstart",o),g.el.addEventListener("mousedown",o))},remove:function(){if(this.pageView){for(var e=this.pageView.el.querySelectorAll('[rel*="toggle_draggable"]'),t=0;t<e.length;t++){e[t].removeEventListener("click",this.toggleDraggables)}var i=this.pageView.el.querySelectorAll('[rel*="hide_draggable"]');for(t=0;t<i.length;t++){i[t].removeEventListener("click",this.hideDraggables)}var o=this.pageView.el.querySelectorAll('[rel*="show_draggable"]');for(t=0;t<o.length;t++){o[t].removeEventListener("click",this.showDraggables)}Cargo.Core.Draggables.cleanup(this.pageView)}Backbone.View.prototype.remove.apply(this,arguments)}}),Cargo.Event.on("image_gallery_rendered",function(e){e.draggableView?Cargo.Helper.IsAdminEdit()||(e.draggableView.draggables=[],e.draggableView.findDraggables(),e.draggableView.bindShowHideLinks()):e.draggableView=new Cargo.Core.Draggables.DraggablesInstance({pageView:e})})}(),function(){var a=Backbone.View.extend({defaults:{speed:-20,behavior:"scroll",direction:"horizontal",offset:0},initialize:function(e){if(e.parentView){this.parentView=e.parentView,Cargo.Event.trigger("marquee:before-init",this),this.model.attributes=_.defaults(this.model.attributes,this.defaults);if(this.getAttributes(),this.setAttributes(),this.contentNodes=[],this.waitingForDragEnd=!1,this.built=!1,this.editing=!1,this.marqueeContentRect=null,this.mRect=null,this.wrapper=null,this.inner=null,this.position=0,this.hasPadding=null,this.translateX=0,this.translateY=0,this.paused=!1,this.onlyContainsScalableItems=!1,this.updateContent(),this.buildOut(!0),this.updateSize(),this.dragEnter=_.bind(this.dragEnter,this),this.handleUndoRedoChanges=_.bind(this.handleUndoRedoChanges,this),Cargo.Helper.IsAdminEdit()&&(this.el.addEventListener("dragenter",this.dragEnter),"undefined"!=typeof CargoEditor&&CargoEditor.events)){var t={childList:!0,subtree:!0},i=new MutationObserver(this.handleUndoRedoChanges);CargoEditor.events.on("history-before-redo history-before-undo",function(){i.observe(this.el,t)},this),CargoEditor.events.on("history-redo history-undo",function(){this.handleUndoRedoChanges(i.takeRecords()),i.disconnect()},this),CargoEditor.events.on("editor-drop",function(){var e=this;_.defer(function(){e.built||!e.waitingForDragEnd||e.editing||(e.updateContent(),e.buildOut())})},this),CargoEditor.events.on("editor-dragend",function(){this.built||!this.waitingForDragEnd||this.editing||(this.updateContent(),this.buildOut())},this)}Cargo.Event.trigger("marquee:after-init",this)}},events:{mouseenter:"onMouseEnter",mouseleave:"onMouseLeave"},onMouseEnter:function(e){this.built&&this.el.setAttribute("contenteditable",!1)},onMouseLeave:function(e){this.el.blur(),this.el.removeAttribute("contenteditable")},handleUndoRedoChanges:function(e){var t=!1;if(_.each(e,function(e){e.target.classList.contains("marquee")&&e.target.classList.contains("torn-down")&&(t=!0)}),0<e.length){var i=!1,o=this.el.querySelector(".marquee_contents");if(o){var n=o.querySelector(".marquee_inner");if(n){for(i=!0;0<n.childNodes.length;)this.el.appendChild(n.childNodes[0]);o.parentNode.removeChild(o)}}this.contentNodes=this.el.childNodes,i&&t?(this.built=!1,this.buildOut()):(this.built=!0,this.tearDown(),Cargo.Event.trigger("marquee:requires-modal",this))}},pause:function(){this.paused=!0},resume:function(){this.paused=!1},setAttributes:function(){this.el.setAttribute("direction",this.model.get("direction")),this.el.setAttribute("speed",this.model.get("speed")),this.el.setAttribute("behavior",this.model.get("behavior")),this.el.setAttribute("behavior",this.model.get("behavior")),this.el.setAttribute("offset",Math.floor(100*this.model.get("offset"))+"%")},dragEnter:function(e){this.waitingForDragEnd=!0,this.tearDown()},getAttributes:function(){this.el.hasAttribute("speed")&&this.model.set("speed",parseFloat(this.el.getAttribute("speed"))),this.el.hasAttribute("direction")&&this.model.set("direction",this.el.getAttribute("direction")),this.el.hasAttribute("behavior")&&this.model.set("behavior",this.el.getAttribute("behavior")),this.el.hasAttribute("offset")&&this.model.set("offset",.01*parseInt(this.el.getAttribute("offset")))},handleUpdate:function(e,t){"offset"===e&&(t*=.01);var i=this.model.get(e);this.model.set(e,t),this.setAttributes(),"behavior"===e&&i!==t?(this.setAttributes(),this.built&&this.tearDown(),this.buildOut()):i===t||this.built||this.buildOut()},removeMarqueeContent:function(){if(this.updateContent(),this.el.parentNode)for(;0<this.contentNodes.length;)this.el.parentNode.insertBefore(this.contentNodes[0],this.el);this.destroy()},updateSize:function(){if(this.el||this.destroy(),this.built){var e=this.wrapper.getBoundingClientRect(),t=this.el.getBoundingClientRect(),i=0,o=0,n=0,a=0;if(null===this.hasPadding||this.hasPadding){var r=window.getComputedStyle(this.el,null);n=parseFloat(r.paddingLeft),o=parseFloat(r.paddingTop),a=parseFloat(r.paddingBottom),i=parseFloat(r.paddingRight),null===this.hasPadding&&(this.hasPadding=n||o||a||i)}var s=t.left+-(e.left+-this.translateX);this.marqueeContentRect={width:e.width,height:e.height},this.mRect={overHangX:s,padTop:o,padLeft:n,padRight:i,padBottom:a,width:t.width,height:t.height}}},draw:function(){if(this.el&&this.el.parentNode||this.destroy(),this.built&&this.mRect&&this.marqueeContentRect){var e=this.paused?0:.001*this.model.get("speed")*60,t=1;if(this.onlyContainsScalableItems)t=baseUnit.cache.window.w/1e3;else{var i=((f=Math.min(1e3,Math.max(320,baseUnit.cache.window.w)))-320)/680;t=1*i+.72*(1-i)}e*=t;var o=this.model.get("offset"),n="vertical"===this.model.get("direction"),a="horizontal"===this.model.get("direction");if(e*=1.5,this.position=e+this.position,"bounce"===this.model.get("behavior")){var r=Math.abs(this.position),s=this.mRect.width-(this.mRect.padLeft+this.mRect.padRight),l=this.mRect.height-(this.mRect.padTop+this.mRect.padBottom),d=s-(f=this.marqueeContentRect.width),c=l-(v=.5*this.marqueeContentRect.height),h=0,u=0;s<=f&&(h=-(d=f-s)),l<=v&&(u=-(c=v-l));var g=a?d+o*d:o*d,p=n?c+o*c:o*c,m=c-Math.abs((r+p)%(2*c)-c)||0;b=((b=d-Math.abs((r+g)%(2*d)-d)||0)+d)%d+h,m=(m+c)%c+u,a?(this.wrapper.style.transform="translateX("+b+"px)",this.translateX=b,this.translateY=0):this.translateX=n?(this.wrapper.style.transform="translateY("+m+"px)",this.translateY=m,0):(this.wrapper.style.transform="translate("+b+"px, "+m+"px)",this.translateY=m,b),this.inner.style.transform=""}else{var f=Math.max(this.marqueeContentRect.width,this.mRect.width),v=Math.max(this.marqueeContentRect.height,this.mRect.height),b=(this.position+o*this.marqueeContentRect.width)%f||this.translateX;m=(this.position+o*this.marqueeContentRect.height)%v||this.translateX;0<b&&(b+=-f),b+=this.mRect.overHangX,0<m&&(m-=f),a?(this.translateY=0,this.translateX=b,this.inner.style.transform="translateX("+f+"px)",this.wrapper.style.transform="translateX("+b+"px)"):n&&(this.translateY=m,this.translateX=0,this.inner.style.transform="translateY("+v+"px)",this.wrapper.style.transform="translateX("+m+"px)")}}},startEditing:function(){this.editing||(this.el.classList.add("editing"),this.editing=!0,CargoEditor&&CargoEditor.hasOwnProperty("rangy")&&setTimeout(_.bind(function(){var e=CargoEditor.rangy.createRange();e.selectNodeContents(this.el),e.collapse(!0),CargoEditor.helpers.setActiveRange(e)},this),50)),this.tearDown()},stopEditing:function(){this.editing&&(this.el.classList.remove("editing"),this.editing=!1,Cargo.Event.trigger("handleAdminUIChange")),this.buildOut()},updateContent:function(){this.built?this.contentNodes=this.inner.childNodes:this.contentNodes=this.el.childNodes,this.onlyContainsScalableItems=!0;for(var e=0;e<this.contentNodes.length;){var t=this.contentNodes[e];if(t.nodeType===Node.ELEMENT_NODE)if("IMG"===t.nodeName&&"VIDEO"===t.nodeName&&"IFRAME"===t.nodeName||(this.onlyContainsScalableItems=!1),t.classList.contains("marquee")||t.classList.contains("image-gallery")){if(t.hasAttribute("data-marquee-id"))this.parentView.marquee[t.getAttribute("data-marquee-id")].removeMarqueeContent();else for(;0<t.childNodes.length;)t.parentNode.insertBefore(t.childNodes[0],t);t.parentNode.removeChild(t)}else e++;else e++}},buildOut:function(e){if(!this.built)if(this.el.classList.remove("torn-down"),0!=this.contentNodes.length){var t=document.createElement("div");t.className="marquee_contents";var i=document.createElement("div");for(i.className="marquee_inner";0<this.contentNodes.length;)i.appendChild(this.contentNodes[0]);t.appendChild(i);var o=(this.inner=i).cloneNode(!0);o.classList.add("cloned_marquee_inner"),this.innerClone=o,"scroll"!==this.model.get("behavior")&&"up"!==this.model.get("direction")&&"down"!==this.model.get("direction")&&"diagonal"!==this.model.get("direction")||t.appendChild(o);var n=i.querySelectorAll("img"),a=o.querySelectorAll("img");_.each(n,function(e,t){e.classList.contains("image-zoom")&&(a[t].classList.add("image-zoom"),$(a[t]).on("click.lightbox",function(){$(e).click()}))});var r=i.querySelectorAll("video"),s=o.querySelectorAll("video");_.each(r,function(e,t){!function(e,t,i){var o;t.addEventListener("play",function(){e.currentTime=t.currentTime,e.play()}),t.addEventListener("pause",function(){e.currentTime=t.currentTime,e.pause()}),e.addEventListener("play",function(){t.currentTime=e.currentTime,t.play(),o=setTimeout(n,500)}),e.addEventListener("pause",function(){t.currentTime=e.currentTime,t.pause(),clearTimeout(o)});var n=function(){t.currentTime=e.currentTime,o=setTimeout(n,500)}}(r[t],s[t])}),this.el.innerHTML="",this.el.setAttribute("data-marquee-id",this.id),this.el.appendChild(t),this.wrapper=t,Cargo.Event.trigger("handleAdminUIChange"),e||this.parentView.refresh(),this.built=!0,this.updateContent()}else this.destroy()},destroy:function(){this.parentView.removeView(this.id)},tearDown:function(){if(this.built){if(this.el.classList.add("torn-down"),0<this.contentNodes.length&&this.contentNodes[0].parentNode!==this.el)for(;0<this.contentNodes.length;)this.el.appendChild(this.contentNodes[0]);this.wrapper&&this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper),this.el.removeAttribute("contenteditable");var e=this.el.querySelector(".marquee_contents");e&&e.parentNode.removeChild(e),this.wrapper=null,this.innerClone=null,this.inner=null,this.built=!1,this.updateContent(),this.parentView.refresh()}},remove:function(){Cargo.Event.trigger("marquee:before-remove",this),this.stopListening(),this.undelegateEvents(),Cargo.Helper.IsAdminEdit()&&this.el.removeEventListener("dragenter",this.dragEnter),this.built=!1,this.contentNodes=[],Backbone.View.prototype.remove.apply(this,arguments),Cargo.Event.trigger("marquee:after-remove",this)}});Cargo.Core.MarqueeInstance=Backbone.View.extend({initialize:function(e){e&&e.parentView&&(this.parentView=e.parentView,this.isAdmin=Cargo.Helper.IsAdminEdit(),this.marquees={},this.ticking=!1,this.idleWaiting=!1,this.hasRequestIdle="requestIdleCallback"in window,this.draw=_.bind(this.draw,this),this.requestTick=_.bind(this.requestTick,this),this.findMarquees=_.bind(this.findMarquees,this),this.listenTo(Cargo.Event,"elementresizer_update_complete",this.requestTick),"undefined"!=typeof CargoEditor&&CargoEditor.events&&this.listenTo(CargoEditor.events,"editor-content-change",this.requestTick))},findMarquees:function(){var e=this.parentView.el.querySelectorAll(".marquee");_.each(e,function(e){4<e.classList.length||this.addView(e)},this),cancelAnimationFrame(this.drawFrame),_.isEmpty(this.marquees)||this.draw()},draw:function(){this.ticking&&(this.hasRequestIdle&&!this.idleWaiting?(this.idleWaiting=!0,requestIdleCallback(_.bind(function(){this.updateSizes(),this.idleWaiting=!1},this),{timeout:500})):this.hasRequestIdle||this.updateSizes(),this.ticking=!1),_.each(this.marquees,function(e){e.draw()}),this.drawFrame=requestAnimationFrame(this.draw)},addView:function(e,t){if(!(4<e.classList.length)){var i=_.uniqueId("marquee_");if(e.hasAttribute("data-marquee-id")&&(i=e.getAttribute("data-marquee-id")),e.setAttribute("data-marquee-id",i),this.marquees[i])return this.marquees[i];var o=_.extend({},t),n=new a({el:e,id:i,parentView:this,model:new Backbone.Model(o)});return this.marquees[i]=n,cancelAnimationFrame(this.drawFrame),this.draw(),n}},requestTick:function(){this.ticking||(this.ticking=!0)},updateSizes:function(){_.each(this.marquees,function(e){e.updateSize()})},removeView:function(e){this.marquees[e]&&(this.marquees[e].remove(),delete this.marquees[e])},removeViews:function(){var i=this;_.each(this.marquees,function(e,t){e.remove(),delete i.marquees[t]})},refresh:_.debounce(function(){Cargo&&Cargo.Plugins&&Cargo.Plugins.elementResizer.requestRefreshTick()}.bind(this),100),remove:function(){cancelAnimationFrame(this.drawFrame),this.stopListening(),Backbone.View.prototype.remove.apply(this,arguments)}})}(),Cargo.Core=window.Cargo.Core||{},Cargo.Core.Handlebars={Render:function(e,t){var i=Handlebars.compile(e);return Handlebars.registerPartial("loading_animation",$("#loading_animation").html()),Handlebars.registerPartial("images",$('[type="text/x-handlebars-template"]#images').html()),Handlebars.registerPartial("page_master",this.ParseScriptTags($("#page_master").html())),Handlebars.registerPartial("page",this.ParseScriptTags($("#page").html())),Handlebars.registerPartial("pin",this.ParseScriptTags($("#pin").html())),Handlebars.registerPartial("content",this.ParseScriptTags($("#content").html())),Handlebars.registerPartial("sitemenu_item",this.ParseScriptTags($("#sitemenu_item").html())),this.RegisterHelper_Print(),this.RegisterHelper_IfAny(),this.RegisterHelper_IfAll(),this.RegisterHelper_IfEqual(),this.RegisterHelper_UnlessAny(),this.RegisterHelper_UnlessAll(),this.RegisterHelper_IfOption(),this.RegisterHelper_UnlessOption(),this.RegisterHelper_DisplayOptions(),this.RegisterHelper_Truncate(),this.RegisterHelper_Image(),this.RegisterHelper_Var(),this.RegisterHelper_Stringify(),this.RegisterHelper_IsAdmin(),this.RegisterHelper_FillDefaultThumbnailCrop(),i(t)},ParseScriptTags:function(e){if(e)return e.replace(/\[script/g,"<script").replace(/\[\/script/g,"</script")},RegisterHelper_Print:function(){Handlebars.registerHelper("print",function(e,t){var i=wrapper_tail="";"project.content"!=e&&"content"!=e||(i="<projectcontent>",wrapper_tail="</projectcontent>"),e=e.replace("project.","");var o="object"==typeof this.project?this.project:this;return new Handlebars.SafeString(i+o[e]+wrapper_tail)})},RegisterHelper_IfAny:function(){Handlebars.registerHelper("if_any",function(){for(var e=!1,t=arguments[arguments.length-1],i=arguments.length-2;0<=i;i--)if(arguments[i]){e=!0;break}return e?t.fn(this):t.inverse(this)})},RegisterHelper_IfAll:function(){Handlebars.registerHelper("if_all",function(){for(var e=!0,t=arguments[arguments.length-1],i=arguments.length-2;0<=i;i--)if(!arguments[i]){e=!1;break}return e?t.fn(this):t.inverse(this)})},RegisterHelper_IfEqual:function(){Handlebars.registerHelper("if_equal",function(e,t,i){return 3!=arguments.length?"":e==t?i.fn(this):i.inverse(this)})},RegisterHelper_UnlessAny:function(){Handlebars.registerHelper("unless_any",function(){for(var e=!1,t=arguments[arguments.length-1],i=arguments.length-2;0<=i;i--)if(!arguments[i]){e=!0;break}return e?t.fn(this):t.inverse(this)})},RegisterHelper_UnlessAll:function(){Handlebars.registerHelper("unless_all",function(){for(var e=!0,t=arguments[arguments.length-1],i=arguments.length-2;0<=i;i--)if(arguments[i]){e=!1;break}return e?t.fn(this):t.inverse(this)})},RegisterHelper_DisplayOptions:function(){Handlebars.registerHelper("displayoptions",function(e,t){var i=e.replace("display_options.","").split("."),o=i.length;return(1==o?Cargo.Model.DisplayOptions.get(i[0]):2==o?Cargo.Model.DisplayOptions.get(i[0])[i[1]]:3==o?Cargo.Model.DisplayOptions.get(i[0])[i[1]][i[2]]:Cargo.Model.DisplayOptions.get(i[0]))?t.fn(this):t.inverse(this)})},RegisterHelper_IfOption:function(){Handlebars.registerHelper("if_option",function(e,t){var i=e.replace("display_options.","").split("."),o=i.length;return(1==o?Cargo.Model.DisplayOptions.get(i[0]):2==o?Cargo.Model.DisplayOptions.get(i[0])[i[1]]:3==o?Cargo.Model.DisplayOptions.get(i[0])[i[1]][i[2]]:Cargo.Model.DisplayOptions.get(i[0]))?t.fn(this):t.inverse(this)})},RegisterHelper_UnlessOption:function(){Handlebars.registerHelper("unless_option",function(e,t){var i=e.replace("display_options.","").split("."),o=i.length;return(1==o?Cargo.Model.DisplayOptions.get(i[0]):2==o?Cargo.Model.DisplayOptions.get(i[0])[i[1]]:3==o?Cargo.Model.DisplayOptions.get(i[0])[i[1]][i[2]]:Cargo.Model.DisplayOptions.get(i[0]))?t.inverse(this):t.fn(this)})},RegisterHelper_Truncate:function(){Handlebars.registerHelper("truncate",function(e,t){if(e.length>t&&0<e.length){var i=e+" ";return i=e.substr(0,t),i=0<(i=e.substr(0,i.lastIndexOf(" "))).length?i:e.substr(0,t),new Handlebars.SafeString(i+"...")}return e})},RegisterHelper_Image:function(){Handlebars.registerHelper("image",function(e,t){return new Cargo.o.model.image(e).getImageByWidth(t)})},RegisterHelper_Var:function(){Handlebars.registerHelper("var",function(e,t){this[e]=t})},RegisterHelper_Stringify:function(){Handlebars.registerHelper("stringify",function(e){return JSON.stringify(e)})},RegisterHelper_IsAdmin:function(){Handlebars.registerHelper("is_admin",function(e){var t=arguments[arguments.length-1];return Cargo.Helper.IsAdminEdit()?t.fn(this):t.inverse(this)})},RegisterHelper_FillDefaultThumbnailCrop:function(){Handlebars.registerHelper("fill_default_thumbnail_crop",function(e,t){var i,o,n,a=t.split(/x/),r=a[0]/a[1],s=e.imageModel.width/e.imageModel.height;return n=s<=r?(o=0,(1/s-1/r)/2*-(i=100)):(i=s/r*100,o=50*(1-s/r),0),"width: "+i+"%; margin-left: "+o+"%; margin-top: "+n+"%; height: auto;"})}},Cargo=Cargo||{},Cargo.utils=Cargo.utils||{},Cargo.utils.CargoXHR=function(e){var t=this;if($.extend(this.options={},this.defaultOptions,e),void 0===this.options.context&&(this.options.context=this),void 0===this.options.url)throw'no URL given, define "url" in the contructor\'s options object';this.retries=0,this.xhr=new XMLHttpRequest,this.xhr.addEventListener("abort",function(){t.options.abort.apply(t.options.context,arguments)},!1),this.xhr.addEventListener("error",function(){t.options.error.apply(t.options.context,arguments)},!1),this.xhr.addEventListener("load",function(){t.options.success.apply(t.options.context,arguments)},!1),this.xhr.addEventListener("loadend",function(){t.options.always.apply(t.options.context,arguments)},!1),this.xhr.upload.addEventListener("progress",function(e){t.options.progress.apply(t.options.context,arguments)},!1),this.send()},Cargo.utils.CargoXHR.prototype.send=function(){for(var e in this.xhr.open(this.options.type,this.options.url,this.options.async),this.options.headers)this.xhr.setRequestHeader(e,this.options.headers[e]);this.xhr.responseType=this.options.dataType,this.options.beforeSend.call(this,this.xhr),this.xhr.send(this.options.data)},Cargo.utils.CargoXHR.prototype.retry=function(){if(!(this.retries++<this.options.maxRetries))return this.abort(),!1;Cargo.utils.CargoXHR.prototype.send.apply(this,arguments)},Cargo.utils.CargoXHR.prototype.abort=function(){"object"==typeof this.xhr&&this.xhr.abort()},Cargo.utils.CargoXHR.prototype.defaultOptions={async:!0,beforeSend:function(e){},always:function(e){},success:function(e){},progress:function(e){},error:function(e){},abort:function(e){},type:"GET",url:void 0,dataType:"text",headers:{},data:null,context:void 0,maxRetries:5},function(){var a=null;Cargo.Core.MarkerInstance=function(e){this.resizedSVGOffsetX=0,this.resizedSVGOffsetY=0,this.pageView=e,this.addSVGElementHoverOutline=_.bind(this.addSVGElementHoverOutline,this),this.removeSVGElementHoverOutline=_.bind(this.removeSVGElementHoverOutline,this),e.listenTo(e,"initial-setup",_.bind(this.setupPage,this)),e.listenTo(Cargo.Event,"elementresizer_update_complete",_.bind(this.positionTetheredNodes,this)),this.loadSVGWebfonts()},Cargo.Core.MarkerInstance.prototype.hoverStatesEnabled=!1,Cargo.Core.MarkerInstance.prototype.setupPage=function(){this.findTetherTargets(),this.positionTetheredNodes(),this.pageView.listenTo(Cargo.Event,"image_gallery_rendered",_.bind(function(){this.findTetherTargets(),this.positionTetheredNodes()},this)),this.pageView.listenTo(Cargo.Event,"image_gallery_init_complete",_.bind(function(){this.positionTetheredNodes()},this))},Cargo.Core.MarkerInstance.prototype.enableSVGHoverStates=function(){if(null===a){var e=document.createElement("div");a=document.createElement("div"),e.className="marker-outline-layer",a.className="marker-outline-box",e.appendChild(a),document.body.appendChild(e)}this.svg_overlay&&(this.svg_overlay.addEventListener("mouseover",this.addSVGElementHoverOutline),this.svg_overlay.addEventListener("mouseout",this.removeSVGElementHoverOutline)),this.hoverStatesEnabled=!0},Cargo.Core.MarkerInstance.prototype.disableSVGHoverStates=function(e){this.svg_overlay&&(this.svg_overlay.removeEventListener("mouseover",this.addSVGElementHoverOutline),this.svg_overlay.removeEventListener("mouseout",this.removeSVGElementHoverOutline)),e||(null!==a&&this.removeSVGElementHoverOutline(),this.hoverStatesEnabled=!1)},Cargo.Core.MarkerInstance.prototype.addSVGElementHoverOutline=function(e){var t=e.target;"a"===t.parentNode.nodeName&&(t=t.parentNode);var i=t.getAttribute("stroke-width"),o=1;"none"===t.getAttribute("stroke")||isNaN(i)||(o+=i/2);var n=t.getBoundingClientRect();a.style.left=n.left-o+"px",a.style.top=n.top-o+document.scrollingElement.scrollTop+"px",a.style.width=n.width+2*o+"px",a.style.height=n.height+2*o+"px",a.style.display="block"},Cargo.Core.MarkerInstance.prototype.resizeSVGToFitContent=function(e){if(this.svg_overlay&&this.svg_content_layer&&1!==this.svg_content_layer.children.length){var t=this.pageView.isAdminEdit?200:0,i=offsetY=0;try{var o=this.svg_content_layer.getBBox()}catch(e){return void console.warn("unable to retrieve bbox")}i=-1*(o.x-t),offsetY=-1*(o.y-t),this.svg_overlay.style.transform="translate("+-1*i+"px, "+-1*offsetY+"px)",this.svg_overlay.style.webkitTransform="translate("+-1*i+"px, "+-1*offsetY+"px)",this.svg_content_layer.setAttribute("transform","translate("+i+", "+offsetY+")"),this.svg_selector_layer&&this.svg_selector_layer.setAttribute("transform","translate("+i+", "+offsetY+")"),this.resizedSVGOffsetX=i,this.resizedSVGOffsetY=offsetY,this.svg_overlay.style.width=o.width+2*t,this.svg_overlay.style.height=o.height+2*t}},Cargo.Core.MarkerInstance.prototype.removeSVGElementHoverOutline=function(){a.style.display="none"},Cargo.Core.MarkerInstance.prototype.loadSVGWebfonts=function(){var e=_.clone(this.pageView.model.getPageOption("svg_fonts"));e&&(e.fontactive=_.bind(function(){this.positionTetheredNodes()},this),WebFont.load(e))},Cargo.Core.MarkerInstance.prototype.findTetherTargets=function(e){if(!e&&this.pageView.el.querySelector("#svgroot")&&(e=this.pageView.el.querySelector("#svgroot")),e||(e=this.pageView.el.querySelector(".marker-overlay")))return this.svg_overlay!==e&&(this.disableSVGHoverStates(!0),this.svg_overlay=e,this.svg_position_layer=this.svg_overlay,this.svg_overlay.querySelector(".marker-overlay")&&(this.svg_position_layer=this.svg_overlay.querySelector(".marker-overlay")),this.svg_content_layer=this.svg_overlay.querySelector("g.layer"),this.svg_selector_layer=this.svg_overlay.parentNode.querySelector("#selectorParentGroup"),this.resizeSVGToFitContent(),this.pageView.isAdminEdit?this.svg_overlay.addEventListener("click",function(e){Cargo.Event.trigger("marker-overlay-click",e)}):this.svg_overlay.addEventListener("click",function(e){e.preventDefault();var t=e.target;if("a"===t.parentNode.nodeName&&(t=t.parentNode),"a"===t.nodeName&&t.hasAttribute("href")&&!t.hasAttribute("rel"))if(t.hasAttribute("target"))window.open(t.getAttribute("href"),t.getAttribute("target"));else document.location.href=t.getAttribute("href")}),this.hoverStatesEnabled&&this.enableSVGHoverStates()),this.tetherPairs={},this.tetherPairs[-1]={el:document.body,svgs:[]},this.tetherPairs[0]={el:this.pageView.el.querySelector(".page_content"),svgs:[]},_.each(this.pageView.el.querySelectorAll(".page_content [data-marker-id]"),function(e){var t=parseInt(e.getAttribute("data-marker-id"));if(!isNaN(t)&&e instanceof HTMLElement&&null==this.tetherPairs[t]){this.tetherPairs[t]={el:e,svgs:[]};var i=$(e).closest(".image-gallery")[0];i&&("slideshow"!==i.getAttribute("image-gallery")&&(this.tetherPairs[t].el=this.tetherPairs[t].el.parentNode),i.classList.contains("initialized")||(this.tetherPairs[t].galleryInitInProgress=!0))}},this),_.each(e.querySelectorAll("*"),function(e){if(!0===e.hasAttribute("data-marker-id")){var t=parseInt(e.getAttribute("data-marker-id"));!isNaN(t)&&e instanceof SVGElement&&this.tetherPairs.hasOwnProperty(t)&&(e.style.willChange="transform",this.tetherPairs[t].galleryInitInProgress?e.style.visibility="hidden":e.style.visibility="",this.tetherPairs[t].svgs.push({el:e,positionData:JSON.parse(e.getAttribute("data-position"))}))}},this),this.tetherPairs},Cargo.Core.MarkerInstance.prototype.positionTetheredNodes=function(){if(this.svg_overlay){var s,l,d,c,h,u,g,p,m,f,v,b,y,w,C,S,k,e=getComputedStyle(this.svg_overlay),t=this.svg_overlay.getBoundingClientRect(),x=t.left+this.resizedSVGOffsetX+parseFloat(e.paddingLeft),E=t.top+this.resizedSVGOffsetY+parseFloat(e.paddingTop);_.each(this.tetherPairs,function(e,t){if(0<e.svgs.length&&e.el){var i,o=e.el.getBoundingClientRect();for(i=0;i<e.svgs.length;i++){s=e.svgs[i];try{l=s.el.getBBox()}catch(e){return void console.warn("unable to retrieve bbox")}if(d=0,c=l.x,h=l.y,u=c+x+this.resizedSVGOffsetX,g=h+E+this.resizedSVGOffsetY,p=s.positionData.left*o.width,m=s.positionData.top*o.height,f=s.positionData.width*o.width,v=s.positionData.height*o.height,b=f/l.width,y=v/l.height,b<0&&(p-=f),y<0&&(m-=v),w=o.left+p,C=o.top+m,S=w-u,k=C-g,!isNaN(b)&&isFinite(b)&&0!==b||(b=1),!isNaN(y)&&isFinite(y)&&0!==y||(y=1),0!=t&&-1!=t||"text"!==s.el.nodeName&&(y=b),s.el.hasAttribute("data-rotation")&&(d=parseFloat(s.el.getAttribute("data-rotation")),isNaN(d)&&(d=0)),!isNaN(S)&&!isNaN(k)){s.el.setAttribute("transform","translate("+(c+S)+", "+(h+k)+") scale("+b+", "+y+") translate("+-1*c+", "+-1*h+")"),s.el.__marker_scale__=b;var n=s.el.getCTM(),a="";if(n&&(0!==d&&(a="rotate("+d+" "+(c+S+l.width*b/2+this.resizedSVGOffsetX)+" "+(h+k+l.height*y/2+this.resizedSVGOffsetY)+") "),a+="matrix("+n.a+", "+n.b+", "+n.c+", "+n.d+", "+n.e+", "+n.f+")",s.el.setAttribute("transform",a)),"object"==typeof svgedit){var r=svgedit.transformlist.getTransformList(s.el);r&&r.reload&&r.reload()}}}}},this),this.resizeSVGToFitContent(),this.pageView.trigger("marker-tether-position-update",this)}},Cargo.Event.on("pageview-initialized",function(e){e.markerInstance=new Cargo.Core.MarkerInstance(e)})}(),window.partial=function(e,t){return _.template(e)(t)},String.prototype.toCamel=function(e){var t=this.replace(/((\_|\-)[a-z])/g,function(e){return e.toUpperCase().replace(/(\_|\-)/g,"")});return e?t.substr(0,1).toUpperCase()+t.substr(1):t};var lastT=0,timer=null;function doscroll(e,t,i){var o=e-t;return i+=(i+o/36)/o,newY=1==i?t+o:t+o*(1-Math.pow(2,-20*i/1)),i&&window.scrollTo(0,newY),1<=i||lastT==i||!i?clearTimeout(timer):timer=setTimeout("doscroll("+e+","+t+","+i+")",1),lastT=i,!1}function number_format(e,t,i,o){e=(e+"").replace(/[^0-9+\-Ee.]/g,"");var n,a,r,s=isFinite(+e)?+e:0,l=isFinite(+t)?Math.abs(t):0,d=void 0===o?",":o,c=void 0===i?".":i,h="";return 3<(h=(l?(n=s,a=l,r=Math.pow(10,a),""+(Math.round(n*r)/r).toFixed(a)):""+Math.round(s)).split("."))[0].length&&(h[0]=h[0].replace(/\B(?=(?:\d{3})+(?!\d))/g,d)),(h[1]||"").length<l&&(h[1]=h[1]||"",h[1]+=new Array(l-h[1].length+1).join("0")),h.join(c)}function getQueryStringParam(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1].replace(/\+/g," "))}$.fn.toggleInputError=function(e){return this.parent().toggleClass("error",e),this},window.loading_animation=function(e){return _.template($("#loading_animation").html())({extra_class:e}).replace("{{ extra_class }}","")},Cargo.o.model.css=Backbone.Model.extend({initialize:function(){},url:function(){var e=Cargo.API.Config;return e.api_path+"/"+e.Version+"/css/"+e.cargo_url}}),Cargo.o.model.set=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},name:"Set",url:function(){return Cargo.API.GetSingleContentPath(this.id)},initialize:function(){if(this.type="set",this.attributes.pages){this.attributes.pages=new Cargo.o.collection.content(this.attributes.pages),this.attributes.pages.server_page_count=this.get("page_count"),this.attributes.pages.each(function e(t){t&&t.attributes.pages&&!t.attributes.pages instanceof Backbone.Collection&&(t.attributes.pages=new Cargo.o.collection.content(t.attributes.pages),t.attributes.pages.server_page_count=t.get("page_count"),t.attributes.pages.each(e))})}},getModelAtIndex:function(t){return _.filter(this.get("pages").filter(Cargo.Helper.IsIndexableModel),function(e){return e.get("index")==t})[0]},recursivelyFindMissingIndexesInSet:function(c,h){var u={};if(!c||isNaN(c))return u;return h||(h={}),function e(t,i){for(var o=t.get("pages"),n=o.getMissingIndexes().reverse(),a=[],r=0;r<o.models.length;r++)if("set"===o.models[r].type){if(h.limit&&h.limit.set===t.get("id")&&o.models[r].get("index")>h.limit.index)break;for(var s=o.models[r].get("index"),l=n.length-1;0<=l&&n[l]<s&&0<c;l--)a.push(n[l]),n.splice(l,1),c--;if(!1===e.call(this,o.models[r],i+1)){if(0<i)return!1;c=0;break}}if(0<c){var d=n.reverse().slice(0,c);h.limit&&h.limit.set===t.get("id")&&(d=d.filter(function(e){return e<=h.limit.index})),c-=d.length,a=a.concat(d)}if(0<a.length&&(u[t.get("id")]={indexes:a,model:t}),h.limit&&h.limit.set===t.get("id"))return!1}.call(this,this,0),u},paginate:function(e){if(e||(e={}),!this.paginating){if(_.extend(e,{render_changes:!0}),this.get("__tag__"))return this.paginating=!0,void Cargo.View.Content.activeContentModel.get("pages").fetch({render_changes:!0,remove:!1,from_pagination:!0,success:_.bind(function(e,t,i){this.paginating=!1,Cargo.Event.trigger("tag_pagination_complete",e,t,i),this.trigger("tag_pagination_complete",e,t,i)},this)});var t=this.recursivelyFindMissingIndexesInSet(!isNaN(parseInt(e.pagination_count))&&0<=e.pagination_count?parseInt(e.pagination_count):5);this.paginateWithMissingIndexObject(t,e)}},paginateWithMissingIndexObject:function(e,i){i||(i={}),_.extend(i,{from_pagination:!0});var o=0,n=[];this.paginating=!0,_.each(e,function(e){var t=e.model.loadIndexes(e.indexes,i);t&&(o++,t.always(_.bind(function(e){n=n.concat(e),0===--o&&(this.paginating=!1,i.done&&i.done(n),$('[data-loading="page"]').hide(),Cargo.Event.trigger("pagination_complete",this,n,i))},this)))},this),0===o?this.paginating=!1:($('[data-loading="page"]').show(),Cargo.Event.trigger("pagination_start"))},loadIndexes:function(e,t){if(t||(t={}),_.extend(t,{remove:!1,merge:!1}),0<e.length){var i=!1;if(Cargo.Helper.IsAdminProjectListSorting()&&top&&top.Cargo&&top.Cargo.Collection.AdminList){i=!0;var o,n=[];if(_.each(e,function(t){(o=top.Cargo.Collection.AdminList.filter(function(e){return Cargo.Helper.IsIndexableModel(e)&&e.get("index")===t&&e.get("set_id")===this.get("id")},this)[0])&&n.push(o.get("id"))},this),0<n.length){var a=$.ajax({method:"GET",url:Cargo.API.GetPagesPath()+"?pid_list="+n.join(","),dataType:"json"});return a.done(function(e){_.each(e,function(e){(o=top.Cargo.Collection.AdminList.findWhere({id:e.id}))&&(e.sort=o.get("sort"),e.index=o.get("index"),e.set_id=o.get("set_id"),e.display=o.get("display"),e.reverse_index=o.get("reverse_index")),Cargo.Collection.Scaffolding.insertModel(e,this,t)})}),a}}if(!i)return this.get("pages").url=Cargo.API.GetContentCollectionPath()+"?set_id="+this.get("id")+"&index="+e.join(","),this.get("pages").fetch(t)}},fetchModelAtIndex:function(e,t){if(!0===isNaN(e=parseInt(e)))return!1;if(t||(t={}),!0!==t.ignore_cache){var i=this.getModelAtIndex(e);if(i)return void(t.done&&t.done(i,t))}return _.extend(t,{remove:!1,merge:!1,success:_.bind(function(e,t,i){if(t&&t[0]&&t[0].id){var o=e.get(t[0].id);o&&(Cargo.Collection.Scaffolding.insertModel(o,e,i),i.done&&i.done(o,i))}else i.error&&i.error()},this)}),this.get("pages").url=Cargo.API.GetContentCollectionPath()+"?set_id="+this.get("id")+"&index="+e,this.get("pages").fetch(t)},toJSON:function(e){var t=_.clone(this.attributes);return function e(t){t.pages&&(void 0!==t.pages.models&&(t.pages=t.pages.toJSON()),_.each(t.pages,e))}(t),t}}),Cargo.o.model.page=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},initialize:function(){this.type="page",this.busySendingValues=!1,this.saveValueQueue=[],null!=this.get("page_options")&&"object"==typeof this.get("page_options")||(this.attributes.page_options={}),this.on("change:images",this.addImagesToGlobalCollection,this),this.addImagesToGlobalCollection(),this.on("change:title",function(){void 0!==Cargo.contentWindow&&Cargo.contentWindow.Cargo.Event.trigger("page_model_change:title",this.get("id"),this.get("title"))})},addImagesToGlobalCollection:function(){if(Cargo.Collection.Images&&this.get("images")){var e=Cargo.Collection.Images.add(this.get("images"));this.attributes.images=e}},toJSON:function(e){var t=_.clone(this.attributes);return function e(t){t.pages&&(void 0!==t.pages.models&&(t.pages=t.pages.toJSON()),_.each(t.pages,e))}(t),t},url:function(){return Cargo.API.GetSinglePagePath(this.id)},saveValue:function(e,t,i){if(!0!==i&&this.set(e),this.busySendingValues){console.info("saveValue, still handling previous request. Queuing.",e);var o=_.where(this.saveValueQueue,{keys:_.keys(e).join(",")})[0];return o?(o.data=e,o.callback=t,!1):(this.saveValueQueue.push({data:e,callback:t,keys:_.keys(e).join(",")}),!0)}return this.busySendingValues=!0,this.save(e,{patch:!0,success:_.bind(function(){t&&t.call(),this.busySendingValues=!1,0<this.saveValueQueue.length&&(this.saveValue(this.saveValueQueue[0].data,this.saveValueQueue[0].callback,!0),this.saveValueQueue.shift())},this)}),!0},GetThumbnailCropData:function(){var e=this.get("thumb_meta");return e?e.thumbnail_crop:null},SetThumbnailCropData:function(e){var t=this.get("thumb_meta")||{};t.thumbnail_crop=e,this.set("thumb_meta",t)},GetId:function(){return this.get("id")},GetProjectUrl:function(){return this.get("project_url")},GetType:function(){return!(!this.get("type")||0==this.get("id"))&&this.get("type")},GetBgColor:function(){return!!this.get("bgcolor")&&"#"+this.get("bgcolor")},setPageOption:function(e,t,i){return null!=this.get("page_options")&&"object"==typeof this.get("page_options")||(this.attributes.page_options={}),this.get("page_options")[e]=t,this.set("page_options",this.get("page_options"),i)},getPageOption:function(e){if(null!=this.get("page_options")&&"object"==typeof this.get("page_options"))return this.get("page_options")[e]},setPinOptions:function(e,t){var i;(i=this.getPageOption("pin_options"))||(i={}),i[e]=t,this.setPageOption("pin_options",i),(i=this.get("pin_options"))||(i={}),i[e]=t,this.set("pin_options",i),this.set("pin_changed",!0),this.trigger("pin_option_change",e,t)},getPinOption:function(e){if(null!=this.get("pin_options")&&"object"==typeof this.get("pin_options"))return this.get("pin_options")[e]},getLayoutOption:function(e){var t=this.getPageOption("local_layout_options");return t&&e in t?t[e]:t},setLayoutOption:function(e,t,i){var o=this.getPageOption("local_layout_options");return o||(o={}),o[e]=t,this.setPageOption("local_layout_options",o,i)},getThumbnailOption:function(e){var t=this.getPageOption("thumbnail_options");if(t&&e in t)return t[e]},setThumbnailOption:function(e,t){var i=this.getPageOption("thumbnail_options");if(i||(i={}),i[e]!==t){i[e]=t,this.setPageOption("thumbnail_options",i);var o={changing:e,value:t,mobile:!1};this.trigger("change",this,o)}},isFullyPopulated:function(){return this.attributes.hasOwnProperty("thumb")}}),Cargo.o.model.pin=Backbone.Model.extend({constructor:function(){Backbone.Model.prototype.constructor.apply(this,arguments)},initialize:function(){var e=this.get("pageView").model,t=this.getDepth(e),i=e.get("pin_options").fixed;this.set({pageModel:e,depth:i?0:t,sort:e.get("sort"),page_padding:0}),this.addEventListeners()},getPinOptions:function(){return this.get("pageModel").get("pin_options")},getDepth:function(e){var t=0;if(e&&e.get("set_id"))for(;e&&0!=e.get("set_id");)e=Cargo.Collection.Scaffolding.getModel({id:e.get("set_id")}),t++;return t},addEventListeners:function(){var r=this.get("pageView"),s=this.get("pageModel"),l=this.collection;r.listenTo(s,"change:pin",function(){!1===this.model.get("pin")&&this.remove()}),r.listenTo(s,"pin_option_change",_.bind(function(e,t,i){var o=s.getPageOption("pin_options");if(r.$el.removeClass("overlay accommodate fixed exclude_mobile"),o){o.overlay&&r.$el.addClass("overlay"),o.accommodate&&r.$el.addClass("accommodate"),o.exclude_mobile&&r.$el.addClass("exclude_mobile"),o.fixed&&r.$el.addClass("fixed");var n=this.getDepth(s),a=this.getPinOptions().fixed;this.set("depth",a?0:n)}l.trigger("update"),this.trigger("formatting_update_required")},this)),r.listenTo(r,"remove",function(){!0!==this.__prevent_model_removal__&&l.remove(this.model.get("id"),{from_pageview_removal:!0})}),this.on("remove",function(e,t,i){i&&!0!==i.from_pageview_removal&&(e.get("pageView").__prevent_model_removal__=!0,e.get("pageView").remove(),delete e.get("pageView").__prevent_model_removal__)}),r.listenTo(s,"change:set_id",_.bind(function(){var e=this.getDepth(s),t=this.getPinOptions().fixed;this.set("depth",t?0:e)},this)),r.listenTo(s,"change:sort",_.bind(function(e,t,i){this.set("sort",t)},this))}}),Cargo.o.model.display_options=Backbone.Model.extend({fetch:function(e){$("script[data-set='DisplayOptions']").html()?this.set($.parseJSON($("script[data-set='DisplayOptions']").html()),e):Backbone.Model.prototype.fetch.apply(this,arguments)},url:function(){return Cargo.API.GetDisplayOptionsPath()},GetPaginationCount:function(){return this.get("pagination_count")},GetDisableProjectScroll:function(){return this.get("disable_project_scroll")},GetImageWidth:function(){return this.get("image_width")},GetIndexRouteUrl:function(){return this.get("index_route_url")},GetIndexRouteName:function(){return this.get("index_route_name")}}),Cargo.o.model.site=Backbone.Model.extend({fetch:function(e){!0!==(e=e||{}).force_admin_fetch&&$("script[data-set='Site']").html()?this.set($.parseJSON($("script[data-set='Site']").html()),e):Backbone.Model.prototype.fetch.apply(this,arguments)},parse:function(e){return Cargo.Helper.IsAdminEdit()||(e.is_editor=Cargo.Helper.GetIsEditor()),e},url:function(){var e=Cargo.API.GetSitePath();return""!=Cargo.API.Config.filter&&(e+="?filter="+encodeURIComponent(Cargo.API.Config.filter)),e},GetId:function(){return this.get("id")},GetPresetPreviewLink:function(e){return"//"+this.get("site_url")+"."+Cargo.Helper.GetBaseCargoDomain()+"/presetpreview/"+e},GetWebsiteTitle:function(){return this.get("website_title")},GetHomepageId:function(){return this.get("homepage_id")},GetIsEditor:function(){return this.get("is_editor")},GetUseHiRes:function(){var e=this.get("use_hi_res");return null==e&&(e=1<window.devicePixelRatio),e}}),Cargo.o.model.image=Backbone.Model.extend({initialize:function(){_.bindAll(this,"getImageByWidth")},urlRoot:function(){return"/_api/v0/image"},getImageByWidth:function(e){var t={};return e>this.get("width")&&(e=this.get("width")),t.w=e,this.getImageWithOptions(t).url},getImageByWidth2x:function(e){return this.getImageByWidth(2*e)},getImageWithOptions:function(e){var t={retina:!!window.devicePixelRatio&&1.2<=window.devicePixelRatio,square:!1,url:"",webgl:e.hasOwnProperty("t")&&"webgl"==e.t};if(_.extend(t,e),"original"===t.t&&(t.retina=!1),!0!==t.retina||t.webgl||(null==t.q&&(t.q=67),t.hasOwnProperty("w")&&(t.w=Math.min(2*t.w,this.get("width"))),t.hasOwnProperty("h")&&(t.h=Math.min(2*t.h,this.get("height")))),t.w&&t.w>this.get("width")&&(t.webgl?t.w=this.getValidWebGLSize(t.w):t.w=this.get("width")),t.h&&t.h>this.get("height")&&(t.h=this.get("height")),!0===t.square){var i=this.getSquareCrop();t.c={x:i.x,y:i.y,w:i.w,h:i.h}}var o=["t","w","h","q","c"],n=[],a=!1,r=!1;_.each(t,function(e,t){-1!==o.indexOf(t)&&""!==e&&("c"===t?n.push("c/"+e.x+"/"+e.y+"/"+e.w+"/"+e.h):n.push(t+"/"+e),a="w"==t?e:"c"==t&&e.w?e.w:a,r="h"==t?e:"c"==t&&e.h?e.h:r)},this);var s=this.getScaleSize(a,r);return t.w=s.w,t.h=s.h,void 0!==this.get("hash")&&void 0!==this.get("name")?t.url="//freight.cargo.site/"+n.join("/")+"/i/"+this.get("hash")+"/"+this.get("name"):t.url="",t},getSquareCrop:function(){var e=y=w=h=diff=0;return this.get("height")>this.get("width")?(w=h=this.get("width"),diff=this.get("height")-this.get("width"),y=Math.floor(diff/2),e=0):this.get("width")>this.get("height")?(w=h=this.get("height"),diff=this.get("width")-this.get("height"),e=Math.floor(diff/2),y=0):(w=this.get("width"),h=this.get("height"),e=y=0),{w:w,h:h,x:e,y:y}},getOriginalImage:function(){return this.getImageWithOptions({t:"original",retina:!1})},urlBelongsToImage:function(e){return"string"==typeof e&&-1!==e.indexOf(this.get("hash")+"/"+this.get("name"))},getValidWebGLSize:function(t){return t>this.get("width")&&_.each([128,256,512,1024,2048,4096],function(e){e<1e3&&(t=e)}),t},getScaleSize:function(e,t){var i=e,o=t;if(og_w=parseInt(this.get("width")),og_h=parseInt(this.get("height")),e&&t);else if(og_w==og_h)o=i=e||(t||og_w);else if(e){var n=og_w/e;o=Math.floor(og_h/n),i=e}else if(t)n=og_h/t,i=Math.floor(og_w/n),o=t;return{w:i,h:o}},getFitSize:function(e,t,i,o){if((e=parseInt(e))<(t=parseInt(t)))var n=e/i,a=Math.floor(t/n),r=i;else if(t<e)n=t/o,r=Math.floor(e/n),a=o;else r=e,a=t;return[r,a]}}),Cargo.o.model.localImage=Cargo.o.model.image.extend({blob_references:{},canvas:null,initialize:function(){this.blob_references={},this.canvas=document.createElement("canvas"),_.bindAll(this,"getImageByWidth")},urlRoot:function(){return""},getImageWithOptions:function(e){var t=Cargo.o.model.image.prototype.getImageWithOptions.apply(this,arguments),i=["t","w","h","q","c"],o=[],n=!1,a=!1;_.each(t,function(e,t){-1!==i.indexOf(t)&&""!==e&&("c"===t?o.push("c_"+e.x+"_"+e.y+"_"+e.w+"_"+e.h):o.push(t+"_"+e),n="w"==t?e:"c"==t&&e.w?e.w:n,a="h"==t?e:"c"==t&&e.h?e.h:a)},this);var r=o.join("_");if(this.blob_references.hasOwnProperty(r))t.url=this.blob_references[r];else{if("original"==t.t)this.canvas.setAttribute("width",this.get("width")),this.canvas.setAttribute("height",this.get("height")),this.canvas.getContext("2d").drawImage(this.get("img"),0,0,this.get("width"),this.get("height"));else if(t.hasOwnProperty("c")){var s=Math.max(Math.min(t.c.w,this.get("width")-t.c.x),0),l=Math.max(Math.min(t.c.w,this.get("height")-t.c.y),0);this.canvas.setAttribute("width",s),this.canvas.setAttribute("height",l),this.canvas.getContext("2d").drawImage(this.get("img"),-t.c.x,-t.c.y,this.get("width"),this.get("height"))}else t.webgl&&(this.canvas.setAttribute("width",t.webgl),this.canvas.setAttribute("height",t.webgl),this.canvas.getContext("2d").drawImage(this.get("img"),0,0,t.webgl,t.webgl)),this.canvas.setAttribute("width",t.w),this.canvas.setAttribute("height",t.h),this.canvas.getContext("2d").drawImage(this.get("img"),0,0,t.w,t.h);this.canvas.toBlob(_.bind(function(e){this.blob_references[r]=URL.createObjectURL(e)},this)),t.url=this.canvas.toDataURL()}return t},urlBelongsToImage:function(i){if("string"!=typeof i)return!1;var o=!1;return _.each(this.blob_references,function(e,t){e!=i||(o=!0)},this),o}}),Cargo.o.model.tag=Backbone.Model.extend({initialize:function(){this.responseCache={},this.isAdmin=Cargo.Helper.IsAdminEdit()},tag_url:"",url:function(){return Cargo.API.GetSitePath()+"/tags/"+this.tag_url},fetch:function(n){n=n||{},_.defaults(n,{});var a=this.url();if(this.responseCache.hasOwnProperty(a))return this.set(this.responseCache[a]),this.trigger("sync"),void("function"==typeof n.success&&n.success.call(n.context,this,this.responseCache[a],n));n.success=_.wrap(n.success,_.bind(function(e,t,i){!0!==this.isAdmin&&(this.responseCache[a]=i);var o=Array.prototype.slice.call(arguments);o.shift(),e&&e.apply(n.context,o)},this)),Backbone.Model.prototype.fetch.apply(this,arguments)}}),Cargo.o.model.thumbnailsettings=Backbone.Model.extend({page_id:null,mode_id:null,iterator:null,initialize:function(e){this.page_id=e&&e.page_id?e.page_id:this.page_id,this.mode_id=e&&e.mode_id?e.mode_id:this.mode_id,this.iterator=e&&e.iterator?e.iterator:this.iterator},fetch:function(e){$("script[data-set='ThumbnailSettings']").html()?(this.set($.parseJSON($("script[data-set='ThumbnailSettings']").html()),e),$("script[data-set='ThumbnailSettings']").remove()):Backbone.Model.prototype.fetch.apply(this,arguments)},url:function(){return Cargo.API.GetActiveThumbnailSettingsPath(this.page_id,this.mode_id,this.iterator,this.id)},getTemplatePath:function(e){return"/_jsapps/thumbnails/"+(e=e||this.get("path"))+"/thumbnail.handlebars"},setThumbMeta:function(e,t){window.parent.Cargo.Event.trigger("thumbnail:add_meta_data",e,t)}}),Cargo.o.collection.content=Backbone.Collection.extend({name:"Content",constructor:function(){this.server_page_count=0,this.on("add",function(e,t,i){i.from_admin_sort&&Cargo.Helper.IsIndexableModel(e)&&this.server_page_count++},this),this.on("remove",function(e,t,i){i.from_admin_sort&&Cargo.Helper.IsIndexableModel(e)&&this.server_page_count--},this),Backbone.Collection.prototype.constructor.apply(this,arguments)},initialize:function(){},comparator:"sort",model:function(e,t){return new Cargo.o.model[e.pages?"set":"page"](e,t)},isGlobal:!0,CollectionData:{},url:function(){return Cargo.API.GetPagesPath()},LoadCollection:function(e){if(!1!==Cargo.Helper.isFeed()&&(!0!==this.isGlobal||"global"!=e))if(e&&this.CollectionData[e])this.set(this.CollectionData[e]),!1===this.isGlobal&&"global"!=e?(this.trigger("sync"),this.isGlobal=!0):!0===this.isGlobal&&"global"!=e&&(this.trigger("sync"),this.isGlobal=!1);else if(e)this.tags=e,this.fetch(),this.tags=null,this.isGlobal=!1;else{if(!0===this.isGlobal)return;this.set(this.CollectionData.global),this.trigger("sync"),this.isGlobal=!0}},getLoadedIndexes:function(){return _.without(this.map(function(e){if(Cargo.Helper.IsIndexableModel(e))return e.get("index")},this),void 0)},getMissingIndexes:function(e){for(var t=this.getLoadedIndexes(),i=[],o=0;o<this.server_page_count;){if(e&&e<o)return i;-1==t.indexOf(o)&&i.push(o),o++}return i},missingNumInSequence:function(e,t,i){if(void 0!==e&&void 0!==e.length){if(void 0===t&&(t=0),void 0===i&&(i=e.length),i<=t)return t;var o=Math.floor((t+i)/2);return e[o]===o?this.missingNumInSequence(e,o+1,i):this.missingNumInSequence(e,t,o)}},getFirstIndexGap:function(){var e=_.uniq(this.getLoadedIndexes(),!0);return this.missingNumInSequence(e)},each:function(o,n,e){if(!e)return Backbone.Collection.prototype.find.apply(this,arguments);(function e(t){t.each(o,n);for(var i=0;i<t.models.length;i++)"set"===t.models[i].type&&e(t.models[i].get("pages"))})(this)},getContentOrPageModelByPid:function(e,t){var i=this.getModel({id:e});return i&&t&&i.parent_model&&i.parent_model.get("stack")&&(i=i.parent_model),i},getContentOrPageModelByPurl:function(e,t){var i=this.getModel({project_url:e});if(!i){var o=this.getModel({project_url:e});o&&t&&o.parent_model&&o.parent_model.get("stack")&&(i=o.parent_model)}return i},getModel:function(e){return this.findWhere(e,!0)},getHomePageModel:function(){return this.getContentOrPageModelByPid(Cargo.Helper.GetHomepageId())},getAllContentPageIds:function(){var e=this.reject(function(e){if(e.get("pin")||0==e.get("pages").length)return e});return _.pluck(e,"id")},fetchPageModel:function(o){var n=this;return new Cargo.o.model.set({id:o}).fetch({error:function(t,e){try{if("no pid found"===$.parseJSON(e.responseText).message.toLowerCase()){var i=Cargo.Collection.Tags.findTagByUrl(o);i?(n.LoadCollection(i.get("url")),Cargo.Event.trigger("thumbnails:load_tag",i.get("url")),Cargo.View.Content.hideActiveView()):(Cargo.Modal.Alert({message:"Page Not Found",confirm:function(){window.history.back()}}),Cargo.Helper.HideLoadingAnimation())}}catch(e){console.error("unable to fetch",t)}},success:function(e,t,i){"set"===e.type&&void 0===e.get("pages")&&(e=new Cargo.o.model.page(e.toJSON())),n.insertModel(e,t,i)}})},insertModel:function(e,t,i){if(e.get("set_id")){var o=this.getModel({id:e.get("set_id")});if(o)return o.get("pages").add(e),o.get("pages").sort(),this.trigger("add",e,t,i),void this.trigger("offline_model_loaded",e)}this.add(e),this.trigger("offline_model_loaded",e)},removeNonVisiblePages:function(){var e=_.filter(this.getAllPages(),function(e){return!1===e.get("display")&&!1===e.get("pin")});_.each(_.pluck(e,"id"),_.bind(function(e){var t=this.findWhere({id:e});if(t&&!t.get("is_set"))this.remove(t,{silent:!0});else{var i=this.findWhere({id:e},!0);i&&(1==i.parent_model.get("pages").length?this.remove(i.parent_model,{silent:!0}):i.parent_model.get("pages").remove(i,{silent:!0}))}},this))},findWhere:function(e,t){return t=t||!1,this.where(e,!0,t)},where:function(e,t,i){return(i=i||!1)?this[t?"find":"filter"](e,i):Backbone.Collection.prototype.where.call(this,e,t)},find:function(o,e){if(e=e||!1){var n,a;return function e(t){if(n=t.findWhere(o))(a=n).parent_model=t;else for(var i=0;i<t.models.length;i++)if("set"===t.models[i].type){if(n=t.models[i].get("pages").findWhere(o)){(a=n).parent_model=t.models[i];break}"set"===t.models[i].type&&e(t.models[i].get("pages"))}}(this),a}return Backbone.Collection.prototype.find.call(this,o)},getAllPages:function(o){var n=[];return function e(t){for(var i=0;i<t.models.length;i++)"page"!==t.models[i].type?t.models[i].get("pages")&&t.models[i].get("pages").models&&(o&&"set"===t.models[i].type&&n.push(t.models[i]),e(t.models[i].get("pages"))):n.push(t.models[i])}(this),n},filter:function(o,e){if(e=e||!1){var n=[];return function e(t){n=_.union(n,t.filter(o));for(var i=0;i<t.models.length;i++)"set"===t.models[i].type&&e(t.models[i].get("pages"))}(this),n}return Backbone.Collection.prototype.filter.call(this,o)}}),Cargo.o.collection.scaffolding=Backbone.Collection.extend({name:"Scaffolding",constructor:function(){Backbone.Collection.prototype.constructor.apply(this,arguments)},comparator:"sort",model:function(e,t){return new Cargo.o.model[e.pages?"set":"page"](e,t)},url:function(){return Cargo.API.GetPagesPath()},initialize:function(){this.fetchPageModelCache={},this.isAdmin=Cargo.Helper.IsAdminEdit()},applyAdminlistChangeMap:function(t,e){var i,o={};this.each(function(e){void 0!==t[e.get("id")]&&(void 0!==(i=t[e.get("id")]).sort&&e.set("sort",i.sort,{from_admin_sort:!0}),void 0!==i.index&&e.set("index",i.index,{from_admin_sort:!0}),void 0!==i.reparented&&(o[e.get("id")]={new_set:i.reparented.to,model:e}),delete t[e.get("id")])},this,!0),_.each(o,function(e,t){var i=e.model,o=this.getModel({id:i.get("set_id")}),n=this.getModel({id:e.new_set});void 0!==o&&void 0!==n&&(o.get("pages").remove(i,{from_admin_sort:!0}),i.set("set_id",n.get("id")),this.insertModel(i,this,{from_admin_sort:!0,render_changes:!0}))},this),_.each(t,function(e){if(void 0!==e.reparented&&e.reparented.indexable){var t=this.getModel({id:e.reparented.from}),i=this.getModel({id:e.reparented.to});t&&t.get("pages").server_page_count--,i&&i.get("pages").server_page_count++}},this),Cargo.View.Content.currentSet&&(_.each(_.union([Cargo.View.Content.currentSet],Cargo.View.Content.currentSet.getAllSetViews()),function(e){e.sortPagesAndUpdateDOM()}),_.each(Cargo.View.Content.currentSet.getAllPageViews(),function(e){e.addBackdrop()}),"display_state"!==e&&Cargo.View.Content.fillGapsInCurrentSet()),Cargo.Event.trigger("refresh_pins")},fetch:function(e){if(0<$("[data-set='ScaffoldingData']").length){var t=JSON.parse($("[data-set='ScaffoldingData']").html());this.set(t),$("[data-set='ScaffoldingData']").remove()}else Backbone.Collection.prototype.fetch.apply(this,arguments)},parse:function(e,i){return _.each(e,function(e){var t=this._prepareModel(e,i);t&&this.insertModel(t,this,i)},this),[]},LoadTagCollection:function(e){var t=new Cargo.o.model.set({id:e.get("url"),pages:[],project_url:e.get("url"),__tag__:e.get("url"),title:e.get("tag")});!1===Cargo.Helper.isFeed()?(t.get("pages").url="",t.get("pages").fetch=function(){console.info("no paginate for non-feed tags")},Cargo.View.Content.render(t),Cargo.Event.trigger("thumbnails:load_tag",e.get("url")),Cargo.View.Main.SetWindowTitle()):(t.__offset=0,t.__increment=5,t.get("pages").url=function(){var e=Cargo.API.GetPagesPath(t.get("__tag__"),t.__offset,t.__increment);return t.__offset+=t.__increment,e},t.get("pages").on("add",function(e){this.insertModel(e,this,{render_changes:!1})},this),t.attributes.pages.fetch({success:function(e){Cargo.View.Content.render(t),Cargo.View.Main.SetWindowTitle()}}))},getSetOrPageModel:function(e,t){var i=this.getModel(e);return i&&t&&i.parent_model&&i.parent_model.get("stack")&&(i=i.parent_model),i},getContentOrPageModelByPid:function(e,t){var i=this.getModel({id:e});return i&&t&&i.parent_model&&i.parent_model.get("stack")&&(i=i.parent_model),i},getModelByPurl:function(t,e){if(void 0!==t){var i=this.filter(function(e){return"string"==typeof e.get("project_url")&&e.get("project_url").toLowerCase()===(t+"").toLowerCase()},!0)[0];return i&&e&&i.parent_model&&i.parent_model.get("stack")&&(i=i.parent_model),i}},getModel:function(e){return this.findWhere(e,!0)},getHomePageModel:function(){return this.getContentOrPageModelByPid(Cargo.Helper.GetHomepageId())},getAllContentPageIds:function(){var e=this.reject(function(e){if(e.get("pin")||0==e.get("pages").length)return e});return _.pluck(e,"id")},getPinsByPositionSetId:function(t,e){if(Number(e)){var i=[];if(!(o=this.getModel({id:e})))return;if("page"===o.type){if(0===o.get("set_id"))return;if(!(o=this.getModel({id:o.get("set_id")})))return}for(i=i.concat(o.get("pages").models);o&&0!=o.get("set_id")&&0!=o.get("id");)(o=this.getModel({id:o.get("set_id")}))&&o.get("pages")&&(i=i.concat(o.get("pages").models));return _.filter(i,function(e){return e.get("pin")&&e.get("pin_options")&&e.get("pin_options").position==t})}if(!1===e){var o;i=[];return(o=this.getModel({id:0})).get("pages").filter(function(e){return e.get("pin")&&e.get("pin_options")&&e.get("pin_options").position==t})}},fetchPageModel:function(n,e){console.info("loading async",n);var t=this.fetchPageModelCache[n];if(t)return console.info("located in cache",n),this.insertModel(t,this,e),void(e.done&&e.done(t,e));var i,a=this;return i=new Cargo.o.model.set({id:n}),e||(e={}),_.extend(e,{error:function(t,e){try{if(404==e.status){var i=Cargo.View.Content.getActiveContentModel();i&&i.get("is_set")&&i.get("id");var o=Cargo.Collection.Tags.findTagByUrl(n);o?a.LoadTagCollection(o):(Cargo.Modal.Alert({message:"Page Not Found",confirm:function(){window.event&&27===window.event.keyCode||window.history.back()}}),Cargo.Helper.HideLoadingAnimation())}else 401==e.status&&window.location.replace(window.location.href)}catch(e){console.error(e),console.warn("unable to fetch",t)}},success:function(e,t,i){if(Cargo.Helper.IsAdminProjectListSorting()&&top&&top.Cargo&&top.Cargo.Collection.AdminList){var o=top.Cargo.Collection.AdminList.findWhere({id:e.get("id")});o&&(e.attributes.sort=o.get("sort"),e.attributes.index=o.get("index"),e.attributes.set_id=o.get("set_id"),e.attributes.display=o.get("display"))}"set"===e.type&&void 0===e.get("pages")&&(e=new Cargo.o.model.page(e.toJSON()),a.isAdmin||(a.fetchPageModelCache[n]=e)),a.insertModel(e,a,i),i.done&&i.done(e,i)}}),i.fetch(e)},insertModel:function(e,t,i){var o=e;if("function"==typeof e.get&&(o=e.attributes),void 0!==o.set_id){var n=this.getModel({id:o.set_id});if(n){var a=n.get("pages");if(a.get(e))return;return a.add(e,i),a.sort(),e.collection=a,void this.trigger("add",e,a,i)}}this.add(e)},removeNonVisiblePages:function(){non_visible=_.filter(this.getAllPages(),function(e){return!1===e.get("display")&&!1===e.get("pin")&&!1===e.get("is_homepage")}),_.each(non_visible,function(e){this.getModel({id:e.get("set_id")}).get("pages").remove(e)},this)},changeDisplayStateForPID:function(e,t){var i=this.getModel({id:e});i?(i.set("display",t),!1===t&&this.getModel({id:i.get("set_id")}).get("pages").remove(i)):this.fetchPageModel(e,{render_changes:!0})},findWhere:function(e,t){return t=t||!1,this.where(e,!0,t)},where:function(e,t,i){return(i=i||!1)?this[t?"find":"filter"](e,i):Backbone.Collection.prototype.where.call(this,e,t)},logIndexStructure:function(){console.log("\n----\n\n"),function e(t,i){t.getMissingIndexes;for(var o=0;o<t.models.length;o++)Cargo.Helper.IsIndexableModel(t.models[o])&&(console.log("---".repeat(i)+"index:",t.models[o].get("index"),"sort:",t.models[o].get("sort"),"-",t.models[o].type+":",t.models[o].get("title").substring(0,70)),"set"===t.models[o].type&&e(t.models[o].get("pages"),i+1))}(this,0)},getSetStructure:function(o){var n={tree:void 0,_byId:{}},a=function(e,t){for(var i=0;i<e.length;i++)e[i].pages&&(o&&!0!==o(e[i])||(n._byId[e[i].id]=e[i]),e[i].depth=t,e[i].pages=_.where(e[i].pages,{is_set:!0}),a(e[i].pages,t+1))};return a(this.toJSON(),0),n.tree=n._byId[0],n},each:function(o,n,e){if(!e)return Backbone.Collection.prototype.find.apply(this,arguments);(function e(t){t.each(o,n);for(var i=0;i<t.models.length;i++)"set"===t.models[i].type&&e(t.models[i].get("pages"))})(this)},find:function(o,e){if(e=e||!1){var n,a;return function e(t){if(n=t.findWhere(o))(a=n).parent_model=t;else for(var i=0;i<t.models.length;i++)if("set"===t.models[i].type){if(n=t.models[i].get("pages").findWhere(o)){(a=n).parent_model=t.models[i];break}"set"===t.models[i].type&&e(t.models[i].get("pages"))}}(this),a}return Backbone.Collection.prototype.find.call(this,o)},getAllPages:function(o){var n=[];return function e(t){for(var i=0;i<t.models.length;i++)"page"!==t.models[i].type?t.models[i].get("pages")&&t.models[i].get("pages").models&&(o&&"set"===t.models[i].type&&n.push(t.models[i]),e(t.models[i].get("pages"))):n.push(t.models[i])}(this),n},filter:function(o,e){if(e=e||!1){var n=[];return function e(t){n=_.union(n,t.filter(o));for(var i=0;i<t.models.length;i++)"set"===t.models[i].type&&e(t.models[i].get("pages"))}(this),n}return Backbone.Collection.prototype.filter.call(this,o)}}),Cargo.o.collection.images=Backbone.Collection.extend({model:function(e,t){return e&&"local"===e.type?new Cargo.o.model.localImage(e,t):new Cargo.o.model.image(e,t)},responseCache:{},initialize:function(){},url:function(){var e=!!this.options&&this.options.sort;return Cargo.API.GetImagesPath(e,!0,!0)},fetchNextPage:function(o){var n=this.url+"-"+this.length;this.fetch({remove:!1,data:{offset:this.length},success:_.bind(function(e,t,i){this.responseCache[n]=t,"function"==typeof o&&o(e,t,i)},this)})},fetch:function(e){var t=e&&e.data&&e.data.offset?e.data.offset:0,i=this.url+"-"+t;return this.responseCache.hasOwnProperty(i)?(0==t?this.set(this.responseCache[i]):this.add(this.responseCache[i]),"function"==typeof e.success&&e.success.call(e.context,this,this.responseCache[i],e),void this.trigger("sync",this,this.responseCache[i])):Backbone.Collection.prototype.fetch.apply(this,arguments)},getImagesWithoutDuplications:function(){var t=[];return this.filter(function(e){return-1===t.indexOf(e.get("hash"))&&(t.push(e.get("hash")),!0)})},fetchImage:function(e,t){var i=this.findWhere({id:parseInt(e)});if(i)return i.getImageWithOptions({w:t})},fetchWebGLImage:function(e,t){var i=this.findWhere({id:parseInt(e)});if(i)return i.getImageWithOptions({t:"webgl",w:t})},fetchOriginalImage:function(e){var t=this.findWhere({id:parseInt(e)});if(t)return t.getOriginalImage()}}),Cargo.o.collection.pins=Backbone.Collection.extend({model:Cargo.o.model.pin,comparator:function(e,t){var i=e.getPinOptions(),o=t.getPinOptions(),n=e.get("pageModel").get("sort"),a=t.get("pageModel").get("sort");if(e.get("depth")!==t.get("depth"))if("bottom"===this.position){if(e.get("depth")>t.get("depth"))return-1;if(e.get("depth")<t.get("depth"))return 1}else{if(e.get("depth")>t.get("depth"))return 1;if(e.get("depth")<t.get("depth"))return-1}else if(n!==a){if(i.overlay&&(this.position===this.reversedSide?n+=9e5:n-=9e5),o.overlay&&(this.position===this.reversedSide?a+=9e5:a-=9e5),a<n)return 1;if(n<a)return-1}return 0},initialize:function(e,t){this.position=t.position,this.reversedSide="bottom",this.pid_list=[],this.debouncedSort=_.debounce(this.sort,0),this.on("reset",this.onReset),this.on("add",this.onAdd),this.on("remove",this.onRemove),this.on("update reset change:sort change:depth",this.onChange)},sort:function(){Backbone.Collection.prototype.sort.apply(this,arguments)},onReset:function(e,t){_.each(t.previousModels,function(e){e.trigger("remove")})},onChange:function(e,t){this.sort(),this.pid_list=this.pluck("id"),this.levels={},this.deepestLevel=0,this.each(function(e){void 0===this.levels[e.get("depth")]&&(this.levels[e.get("depth")]={models:[]}),e.get("depth")>this.deepestLevel&&(this.deepestLevel=e.get("depth")),this.levels[e.get("depth")].models.push(e)},this)},onAdd:function(e,t,i){e.get("pageView").listenTo(e.get("pageModel"),"change:sort",_.bind(this.debouncedSort,this))},onRemove:function(e,t,i){}}),Cargo.o.collection.tags=Backbone.Collection.extend({initialize:function(){},url:function(){return Cargo.API.GetSitePath()+"/tags"},findTagByUrl:function(e){if("string"!=typeof e||""==e||0===e.indexOf("search/"))return!1;if(/(\s|,|\+|\~)/.test(e))return Cargo.Model.Tag.set("url",e),Cargo.Model.Tag;var i=!1;return Cargo.Model.Tag.tag_url=e,Cargo.Model.Tag.fetch({async:!1,success:function(e,t){i=0!==_.keys(t).length&&e}}),i},fetch:function(){if(0<$("[data-set='TagsCollection']").length){var e=JSON.parse($("[data-set='TagsCollection']").html());this.set(e),$("[data-set='TagsCollection']").remove()}else Backbone.Collection.prototype.fetch.apply(this,arguments)}}),Cargo.o.collection.sitemenu=Backbone.Collection.extend({initialize:function(){Cargo.Event.on("page_model_change:title",_.bind(function(e,t){this.updatePageTitle(e,t)},this))},url:function(){var e=Cargo.Helper.IsAdminEdit()?"/inadmin":"";return Cargo.API.GetSitePath()+"/sitemenu"+e},fetch:function(e){if(!$("script[data-set='SiteMenu']").html())return Backbone.Collection.prototype.fetch.apply(this,arguments);this.set($.parseJSON($("script[data-set='SiteMenu']").html()),e),$("script[data-set='SiteMenu']").remove()},getAllPages:function(){var i=[];return void 0!==this.models[0]&&function t(e){_.each(e,function(e){e.hasOwnProperty("pages")?(i.push(e),t(e.pages)):i.push(e)})}(this.models[0].get("pages")),i},updatePageTitle:function(t,e){var i=_.filter(this.getAllPages(),function(e){return e.id==t});void 0!==i[0]&&(i[0].project_url=e,i[0].title=e)}}),Cargo.o.collection.thumbnailmodes=Backbone.Collection.extend({initialize:function(){},url:function(){return Cargo.API.GetThumbnailModesPath()},fetch:function(e){$("script[data-set='ThumbnailModes']").html()?this.set($.parseJSON($("script[data-set='ThumbnailModes']").html()),e):Backbone.Collection.prototype.fetch.apply(this,arguments)}}),Cargo.o.collection.thumbnails=Backbone.Collection.extend({initialize:function(e){this.paginating=!1,this.responseCache={},this.currentParams={},this.paginationIncrement=50,this.paginationComplete=!1,Cargo.Event.on("admin_page_update",_.bind(function(e,t){var i=this.findWhere({id:e});i&&i.set(JSON.parse(JSON.stringify(t)))},this)),Cargo.Event.on("thumbnails:clear_cache",function(){this.url=void 0,this.responseCache={}},this);var t=$("[data-set='FirstloadThumbnails']");if(0<t.length){var i=JSON.parse(t.html()),o={page_id:t.attr("data-page_id"),force_all:"all"===t.attr("data-filter_type")||void 0,tags:t.attr("data-tags"),set_id:t.attr("data-set_id"),random_limit:t.attr("data-random_limit"),offset:0,limit:this.paginationIncrement};void 0!==o.random_limit&&isNaN(parseInt(o.random_limit))&&(o.random_limit=10),i&&i.length?(this.url=Cargo.API.GetThumbnailsPath(o.page_id,o.force_all,o.tags,o.set_id,void 0,void 0,o.random_limit),this.responseCache[this.url]={data:i,offset:i.length,paginationComplete:i.length<this.paginationIncrement},this.currentParams=o):console.warn("Initial thumb data is invalid, not setting."),t.remove()}},paginate:function(){this.paginating||this.paginationComplete||void 0===this.currentParams.random_limit&&(this.paginating=!0,this.currentParams.offset+=this.paginationIncrement,$('[data-loading="page"]').show(),this.fetch({params:this.currentParams,remove:!1,from_pagination:!0,success:_.bind(function(e,t,i){$('[data-loading="page"]').hide(),this.paginating=!1,Cargo.Event.trigger("thumbnail_pagination_complete",e,t,i)},this),error:_.bind(function(){$('[data-loading="page"]').hide()},this)}))},applyAdminlistChangeMap:function(e,t,i){this.currentParams&&(this.currentParams&&void 0!==this.currentParams.random_limit||(void 0!==this.currentParams.set_id&&_.each(e,function(e,t){t=parseInt(t);var i=parseInt(this.currentParams.set_id);if(e.hasOwnProperty("reparented"))if(e.reparented.from==i)this.remove(t);else if(e.reparented.to==i&&top&&top.Cargo&&top.Cargo.Collection.AdminList){var o=top.Cargo.Collection.AdminList.findWhere({id:t});!0===o.get("display")&&!0===o.get("thumb_is_visible")&&this.add(o.toJSON())}},this),this.models.sort(function(e,t){return i.indexOf(e.id)-i.indexOf(t.id)}),Cargo.View.Thumbnail&&Cargo.View.Thumbnail.Subview&&Cargo.View.Thumbnail.Subview.render()))},fetch:function(n){n=n||{},_.defaults(n,{params:{}}),this.currentParams=n.params;var a,r=Cargo.API.GetThumbnailsPath(n.params.page_id,n.params.force_all,n.params.tags,n.params.set_id,void 0,void 0,n.params.random_limit);if(this.responseCache.hasOwnProperty(r)){if((a=this.responseCache[r]).paginationComplete||!0!==n.from_pagination)return this.paginationComplete=a.paginationComplete,this.set(this.responseCache[r].data),this.trigger("sync",this,this.responseCache[r].data,n),void("function"==typeof n.success&&n.success.call(n.context,this,this.responseCache[r].data,n));this.url=Cargo.API.GetThumbnailsPath(n.params.page_id,n.params.force_all,n.params.tags,n.params.set_id,a.offset,this.paginationIncrement)}if(this.url!==r)return a||(this.url=r),n.success=_.wrap(n.success,_.bind(function(e,t,i){void 0!==n.params.random_limit?this.paginationComplete=!0:this.paginationComplete=i.length<this.paginationIncrement,a?(a.data=_.union(a.data,i),a.paginationComplete=this.paginationComplete,a.offset+=i.length,this.set(a.data)):this.responseCache[r]={data:i,offset:0,paginationComplete:this.paginationComplete};var o=Array.prototype.slice.call(arguments);o.shift(),e&&e.apply(n.context,o)},this)),Backbone.Collection.prototype.fetch.apply(this,arguments)}}),Cargo.o.collection.thumbnailsettings=Backbone.Collection.extend({pid:null,model:Cargo.o.model.thumbnailsettings,initialize:function(e){e&&e.pid&&(this.pid=e.pid)},url:function(){return Cargo.API.GetAllThumbnailSettingsPath(this.pid)},fetch:function(e){$("script[data-set='AllThumbnailSettings']").html()?this.set($.parseJSON($("script[data-set='AllThumbnailSettings']").html()),e):Backbone.Collection.prototype.fetch.apply(this,arguments)}}),Cargo.o.view.Main=Backbone.View.extend({el:"body",initialize:function(){this.resolveFontTest=_.bind(this.resolveFontTest,this),this.drawTextCanvas=_.bind(this.drawTextCanvas,this),this.testIconFont(),this.loadingRandomPage=!1,this.collection.bind("change",this.render,this),"html"==Cargo.API.Config.preview?this.WriteCustomHtmlPreview():"css"==Cargo.API.Config.preview&&this.WriteCustomCSSPreview();var e=document.querySelector(".main_container");if(e&&e.addEventListener("scroll",function(){this.scrollTop=0},{passive:!0}),window.matchMedia){var t=Cargo.Helper.GetMobileWindowBreakPoint(),i=window.matchMedia("(min-width: "+t+"px)");i.addListener(function(e){setTimeout(function(){Cargo.Event.trigger("mobile_breakpoint_triggered",i.matches)})})}Cargo.Helper.IsAdminEdit()&&this.$el.attr("data-adminview","true")},events:{"click [rel='history']":"HistoryPush","click [rel='load_admin']":"loadAdmin","click [rel='home_page']":"ShowHome","click [rel='next_page']":"NextPage","click [rel='prev_page']":"PrevPage","click [rel='add_to_cart']":"AddToCart","click [rel='show_cart']":"ShowCart","click [rel='random_page']":"RandomPage","click [rel='site_menu']":"ShowSiteMenu","click a":"preventExtLinks"},render:function(){this.collection},loadAdmin:function(e){e.preventDefault(),Cargo.Helper.IsOnHomepage()?Cargo.Helper.GoToUrl("admin"):Cargo.Core.loadAdminForActivePage()},AddToCart:function(e){e.preventDefault(),Cargo.Helper.IsAdminEdit()&&"click"==e.type||Cargo.View.Following.triggerEventInFrame("add-sku-to-cart",{sku:e.currentTarget.getAttribute("data-sku"),product:e.currentTarget.getAttribute("data-product")})},ShowCart:function(e){e.preventDefault(),Cargo.Helper.IsAdminEdit()&&"click"==e.type&&!$(e.currentTarget).is("#shop_button")||Cargo.Event.trigger("add_history","cart")},isClickInEditor:function(e){if("undefined"==typeof CargoEditor||void 0===CargoEditor.events)return!1;if(void 0===e)return!1;if(e&&"dblclick"===e.type)try{if(!1===top.editor.editorInstance.inspectorOverlay.disabled)return!1}catch(e){}for(var t=e.target;null!==(t=t.parentNode);)if(t.nodeType===Node.ELEMENT_NODE){if("true"===t.contentEditable)return!0;if(t.hasAttribute("data-ce-model-id")&&t.getAttribute("data-ce-model-id")!=Backbone.history.fragment)return!0;if("svg"===t.nodeName&&"marker-overlay"===t.className.baseVal)return!0}return!1},preventExtLinks:function(e){this.isClickInEditor(e)&&e.preventDefault()},testIconFont:function(){this.el.classList.add("iconfont-loading");var e=document.createElement("canvas");e.width=150,e.height=150,this.textCtx=e.getContext("2d"),this.textCtx.font="150px Icons, Verdana",this.textCtx.textAlign="center",this.textCtx.fillStyle="black",this.drawTextCanvas(),this.fontTimer=setTimeout(this.resolveFontTest,3e3)},drawTextCanvas:function(){this.textCtx.fillStyle="white",this.textCtx.fillRect(0,0,150,150),this.textCtx.fillStyle="black",this.textCtx.fillText("î€¿ï¸Ž",75,120);for(var e=[[10,10],[120,10],[120,120],[10,120],[95,75],[55,75],[75,75]],t=this.textCtx.getImageData(0,0,150,150),i=!1,o=0;o<e.length;o++){var n=e[o],a=600*n[1]+4*n[0];if(i=255==t.data[a])break}if(t=null,i){this.drawFrameID=window.requestAnimationFrame(this.drawTextCanvas)}else this.resolveFontTest()},resolveFontTest:function(){window.cancelAnimationFrame(this.drawFrameID),clearTimeout(this.fontTimer),this.textCanvas=null,this.textCtx=null,this.el.classList.remove("iconfont-loading")},HistoryPush:function(e,t){if(!this.isClickInEditor(e)){e&&(e.preventDefault(),t=e.currentTarget);var i=$(t).attr("href")?$(t).attr("href"):$(t).data("href"),o=$(t).attr("data-id")?$(t).attr("data-id"):$(t).data("id"),n=!(!$(t).attr("target")||"_blank"!=$(t).attr("target"));e.metaKey||n?window.open(i):Cargo.Event.trigger("add_history",i,o)}},ShowHome:function(e,t){this.isClickInEditor(e)||(e&&e.preventDefault(),Cargo.Event.trigger("add_history",""))},NextPage:function(e){if(!this.isClickInEditor(e)){e&&e.preventDefault();var t=Cargo.View.Content.getActiveContentModel();if(t&&(!t.get("is_set")||t.get("stack")))if(!1!==t.get("display")){var i=Cargo.Collection.Scaffolding.getModel({id:t.get("set_id")});if(i&&void 0!==i.get("page_count")&&!(i.get("page_count")<=1)){var o,n,a=_.without(i.get("pages").map(function(e){return e.get("is_set")&&!e.get("stack")||0==e.get("page_count")?e.get("index"):void 0}),void 0),r=i.get("page_count"),s=t.get("index");for(n=0;n<r&&(r<=++s&&(s=0),-1!==a.indexOf(s));n++);(o=i.getModelAtIndex(s))?Cargo.Event.trigger("add_history",o.get("project_url"),o.get("id")):i.fetchModelAtIndex(s,{done:function(e){Cargo.Event.trigger("add_history",e.get("project_url"),e.get("id"))}})}}else $.get(Cargo.API.GetBasePath()+"/page/next/"+t.get("id"),function(e){if(e){var t=Cargo.Collection.Scaffolding.model(e);Cargo.Collection.Scaffolding.insertModel(t,Cargo.Collection.Scaffolding,{}),Cargo.Event.trigger("add_history",t.get("project_url"),t.get("id"))}},"json")}},PrevPage:function(e){if(!this.isClickInEditor(e)){e&&e.preventDefault();var t=Cargo.View.Content.getActiveContentModel();if(t&&(!t.get("is_set")||t.get("stack")))if(!1!==t.get("display")){var i=Cargo.Collection.Scaffolding.getModel({id:t.get("set_id")});if(i&&void 0!==i.get("page_count")&&!(i.get("page_count")<=1)){var o,n,a=_.without(i.get("pages").map(function(e){return e.get("is_set")&&!e.get("stack")||0==e.get("page_count")?e.get("index"):void 0}),void 0),r=i.get("page_count"),s=t.get("index");for(n=0;n<r&&(--s<0&&(s=r-1),-1!==a.indexOf(s));n++);(o=i.getModelAtIndex(s))?Cargo.Event.trigger("add_history",o.get("project_url"),o.get("id")):i.fetchModelAtIndex(s,{done:function(e){Cargo.Event.trigger("add_history",e.get("project_url"),e.get("id"))}})}}else $.get(Cargo.API.GetBasePath()+"/page/prev/"+t.get("id"),function(e){if(e){var t=Cargo.Collection.Scaffolding.model(e);Cargo.Collection.Scaffolding.insertModel(t,Cargo.Collection.Scaffolding,{}),Cargo.Event.trigger("add_history",t.get("project_url"),t.get("id"))}},"json")}},RandomPage:function(e){if(!this.isClickInEditor(e)&&(e&&e.preventDefault(),!0!==this.loadingRandomPage)){this.loadingRandomPage=!0;var t,i,o,n,a=[];if(Cargo.View.Content.activeContentModel&&(t=Cargo.View.Content.activeContentModel.get("id")),Cargo.Collection.Scaffolding.each(function(e){if("set"===e.type)if(e.get("stack"))0<e.get("page_count")&&t!==e.get("id")&&a.push([e.get("id")]);else if((i=e.get("page_count"))&&!isNaN(i))for(n=0;n<i;n++)(!(o=e.getModelAtIndex(n))||"set"!==o.type&&o.get("id")!==t)&&a.push([e.get("id"),n])},void 0,!0),0!==a.length){var r=a[Math.floor(Math.random()*a.length)],s=Cargo.Collection.Scaffolding.getModel({id:r[0]});2===r.length?s.fetchModelAtIndex(r[1],{done:_.bind(function(e){Cargo.Event.trigger("add_history",e.get("project_url"),e.get("id")),this.loadingRandomPage=!1},this),error:_.bind(function(){this.loadingRandomPage=!1},this)}):(1===r.length&&Cargo.Event.trigger("add_history",s.get("project_url"),s.get("id")),this.loadingRandomPage=!1)}else this.loadingRandomPage=!1}},ShowSiteMenu:function(e){Cargo.View.SiteMenu.show(e)},WriteCustomHtmlPreview:function(){if(void 0!==parent.editframe){var e=parent.editframe.document.getElementById("syntax_highlight").value;$("customhtml").html(e)}else if(void 0!==parent.Cargo&&parent.Cargo.hasOwnProperty("Editor")&&void 0!==parent.Cargo.Editor.previewCustomHTML){e=parent.Cargo.Editor.previewCustomHTML;$("customhtml").html(e)}},WriteCustomCSSPreview:function(){var e=parent.editframe.document.getElementById("syntax_highlight").value;$("body").append("<style>"+e+"</style>"),$("head link[rel='stylesheet']").remove()},SetWindowTitle:function(e){if(e||Cargo.Helper.IsOnHomepage())document.title=Cargo.Model.Site.GetWebsiteTitle();else{var t=Cargo.View.Content.getActiveContentModel(),i=t&&"all"!==t?t.get("title"):"";i?document.title=i+" - "+Cargo.Model.Site.GetWebsiteTitle():""===i&&(document.title=Cargo.Model.Site.GetWebsiteTitle())}},SetHomepageClass:function(){(Cargo.Model.Site.get("homepage_id")||0==Cargo.Model.Site.get("homepage_id"))&&this.$el.addClass("homepage")},SetFeedClass:function(){Cargo.Helper.isFeed()&&this.$el.addClass("feed")},RemoveHomepageClass:function(){this.$el.removeClass("homepage")},RemoveFeedClass:function(){this.$el.removeClass("feed")},SetPageId:function(e){this.$el.attr("data-page-id",e)}}),Cargo.o.view.Backdrop=Backbone.View.extend({template:"",has_webgl:null,pages:[],plugins:[],Subviews:{},ticking:!1,initialize:function(){return this.measuringStick=null,this.fullScreenHeight=null,this.addEventListeners(),this.requestTick(),this},addEventListeners:function(){this.requestTickCallback=this.requestTick.bind(this),this.updateScrollMonitorsCallback=this.updateScrollMonitors.bind(this),this.throttledRequestTick=_.throttle(this.requestTickCallback,150),this.resetIOSChromeCache=_.bind(this.resetIOSChromeCache,this),this.resetIOSChromeCache=_.debounce(this.resetIOSChromeCache,150),this.checkSplitResponsive=_.bind(this.checkSplitResponsive,this),this.checkSplitResponsive=_.debounce(this.checkSplitResponsive,30),this.listenTo(Cargo.Event,"design:ready backbone-route",this.setup),this.listenTo(Cargo.Event,"handleAdminUIChange",this.requestTickCallback),this.listenTo(Cargo.Event,"pin_format_complete",this.updateScrollMonitorsCallback),window.addEventListener("scroll",this.requestTickCallback,{passive:!0}),window.addEventListener("resize",this.requestTickCallback,{passive:!0}),window.addEventListener("gestureend",this.resetIOSChromeCache),window.addEventListener("pointerup",this.resetIOSChromeCache),window.addEventListener("onpointercancel",this.resetIOSChromeCache),window.addEventListener("onpointerout",this.resetIOSChromeCache),window.addEventListener("onpointerleave",this.resetIOSChromeCache),this.listenTo(Cargo.Event,"handleAdminUIChange",this.checkSplitResponsive),Cargo.Event.on("projectlist_sort",function(){_.each(this.Subviews,function(e){e._pageScrollMonitor&&(e._pageScrollMonitor.recalculateLocation(),e._pageScrollMonitor.update(),e._pageScrollMonitor.triggerCallbacks())})},this),CargoEditor&&CargoEditor.hasOwnProperty("events")&&CargoEditor.events.on("editor-content-change",this.requestTickCallback);try{parent.document,parent.hasOwnProperty("Cargo")&&parent.Cargo.hasOwnProperty("Event")&&(parent.Cargo.Event.on("applied-presets",this.requestTickCallback),parent.Cargo.Event.on("mobile-preview",_.debounce(_.bind(this.requestTickCallback,this),50)),parent.Cargo.Event.on("image_upload_complete",_.bind(this.addImage,this)),parent.Cargo.Event.on("image_delete_complete",_.bind(this.removeImage,this)))}catch(e){}return this},checkSplitResponsive:function(e,t){var a=!1;"split_layout"!==e&&"pagerender"!==e&&"split_responsive"!==e||(_.each(this.Subviews,function(e){var t=e.el;if(t){var i=closest(t,function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.classList.contains("page_container")});if(i){var o=i.hasAttribute("split-responsive");e._split_responsive!==o&&(a=!0),e._split_responsive=o;var n=i.hasAttribute("data-padding-top");e._has_accommodation!==n&&(a=!0),e._has_accommodation=n}}}),a&&this.updateBackdropScrollPosition(!0))},resetIOSChromeCache:function(){this.cacheChromeHeight=0,this.requestTick()},setup:function(){var e=$(".backdrop");if(!e.length&&_.isEmpty(this.pages))return this;var t=e.siblings(".page").map(function(){return $(this).data("id")});t=_.map(t,function(e){return parseInt(e,10)});var i=_.difference(this.pages,t),o=_.difference(t,this.pages);return _.each(o,function(e){this.add(e)},this),_.each(i,function(e){this.remove(e)},this),this},reset:function(){_.each(this.Subviews,function(e,t){this.remove(t,!0)},this),this.pages=[]},remove:function(e,t){if(!(e in this.Subviews))return this.pages=_.without(this.pages,e),this;var i=this.Subviews[e],o=_.clone(i.model);return i.prevent_removal?void 0:("function"==typeof i.destroy&&i.destroy(),"object"==typeof i._pageScrollMonitor&&i._pageScrollMonitor.destroy(),i.undelegateEvents(),i.$el.removeData().unbind(),!0===t&&void 0!==i.model.get("originalDataElement")&&null!==i.model.get("originalDataElement")&&null!==i.el.parentNode&&i.el.parentNode.appendChild(i.model.get("originalDataElement")),i.remove(),this.Subviews[e]=void 0,delete this.Subviews[e],this.pages=_.without(this.pages,e),this.markPluginInactive(o),this)},removeImage:function(e){if(e)for(var t in this.Subviews)this.Subviews.hasOwnProperty(t)&&"function"==typeof this.Subviews[t].Update&&this.Subviews[t].Update("image_delete",e)},addImage:function(e){if(e)for(var t in this.Subviews)this.Subviews.hasOwnProperty(t)&&"function"==typeof this.Subviews[t].Update&&this.Subviews[t].Update("image_upload",e)},add:function(e,t,i,o){var n=this.getRenderTargetForPID(e),a=null==n?null:n.parentNode.querySelector('[data-set="backdrop_data"]');if(void 0===o&&null!==a&&(o=a.innerHTML),this.pages.push(e),this.pages=_.uniq(this.pages),n||this.createBackdropEl(e),!o)return(r=new Backdrop.o.model.Settings({page_id:e,backdrop_id:t,backdrop_path:i})).fetch({success:$.proxy(this.loadBackdrop,this)}),this;var r=new Backdrop.o.model.Settings;return"string"==typeof o?r.set(JSON.parse(o)):r.set(o),r.set("originalDataElement",a),this.loadBackdrop(r),this},change:function(e,t,i){return this.remove(e).add(e,t,i)},get:function(e){if(void 0!==this.Subviews[e])return this.Subviews[e]},enableOrDisableBackdropForPID:function(e,t){if(e=parseInt(e),isNaN(e))console.warn("enableOrDisableBackdropForPID: no valid PID given.");else if(!1!==t&&(t=!0),t){var i=Cargo.Collection.Scaffolding.getModel({id:e});if(void 0!==i){var o=i.get("backdrop");o&&(o=o||{},o=_.defaults(o,{backdrop_id:void 0,backdrop_path:void 0}),this.add(e,o.backdrop_id,o.backdrop_path)),this.requestTick()}else console.warn("enableOrDisableBackdropForPID: Unable to enable backdrop. No page model found.")}else this.remove(e)},createBackdropEl:function(e){var t=$('.page[data-id="'+e+'"]').closest(".page_container");return $("<div />").addClass("backdrop").attr("data-view","Backdrop").appendTo(t),this},loadBackdrop:function(t){return t.get("requires_webgl")&&!this.testWebGl()?(this.makeFallback(t),this):Backdrop.Data.require_loaded?(require.config({baseUrl:"/_jsapps/backdrop",urlArgs:__cargo_js_ver__}),void 0!==this.getRenderTargetForPID(t.get("page_id"))?("undefined"!=typeof __cargo_context__&&"live"===__cargo_context__?require(["_dist/"+t.get("backdrop_path")],_.bind(function(e){require([t.get("backdrop_path")+"/main"],_.bind(function(e){this.markPluginActive(t),this.loadSubview(t,e),this.requestTick()},this))},this)):require([t.get("backdrop_path")+"/main"],_.bind(function(e){this.markPluginActive(t),this.loadSubview(t,e),this.requestTick()},this)),this):void console.error("no render target for backdrop")):(setTimeout($.proxy(function(){this.loadBackdrop(t)},this),150),this)},getRenderTargetForPID:function(e){return $('.page[data-id="'+e+'"]').siblings(".backdrop")[0]},loadSubview:function(e,t){var i=e.get("page_id");if(void 0!==this.Subviews[i])return this;var o=this.getRenderTargetForPID(i);if(o){var n=new t({model:e});n.deferredLoadEventName&&(n.deferredLoadEventName+="_"+_.uniqueId()),o.setAttribute("data-backdrop",e.get("backdrop_path")),o.innerHTML="",o.appendChild(n.el),n.render(),"function"==typeof n.Init&&n.Init();var a=$(o).closest(".page_container").get(0),r=$(o).closest('[data-view="pinned_bottom"] .fixed, [data-view="pinned_top"] .fixed');return a&&0==r.length?(a.hasAttribute("split-responsive")?(n._split_responsive=!0,a.hasAttribute("data-padding-top")?n._has_accommodation=!0:n._has_accommodation=!1):n._split_responsive=!1,n._scroll_tracking=!0,n._positionChangeTracker=scrollMonitor.create(a,screen.height),n._positionChangeTracker.enterViewport(function(){n._trackable=!0}),n._positionChangeTracker.exitViewport(function(){n._trackable=!1}),n._pageScrollMonitor=scrollMonitor.create(a),n._pageScrollMonitor.enterViewport(function(){n.in_viewport=!0,n.Resume&&n.paused&&n.Resume()}),n._pageScrollMonitor.exitViewport(function(){n.in_viewport=!1,n.Pause&&!n.paused&&n.Pause()}),void 0!==n._containerMonitor&&n._containerMonitor.update()):n.in_viewport=!0,n._cached_size={left:0,top:0,width:0,height:0},this.Subviews[i]=n,Cargo.Event.trigger("plugin_render",n),setTimeout(function(){n._pageScrollMonitor&&(n._pageScrollMonitor.recalculateLocation(),n._pageScrollMonitor.update(),n._pageScrollMonitor.triggerCallbacks())},100),this}console.error("no render target for backdrop")},markPluginActive:function(e){var t=e.get("backdrop_id"),i=e.get("backdrop_path"),o=_.findWhere(this.plugins,{path:i});return o||(o={count:0,id:t,path:i},this.plugins.push(o)),o.count++,this},markPluginInactive:function(e){e.get("backdrop_id");var t=e.get("backdrop_path"),i=_.findWhere(this.plugins,{path:t});return i&&i.count--,0===i.count&&(this.plugins=_.without(this.plugins,i)),this},is_ios:null,testIOS:function(){return null!==this.is_ios||(this.is_ios=Cargo.Helper.isIOS()),this.is_ios},cacheChromeHeight:0,cache_window_data:{height:0,width:0,scrollY:0,scrollX:0},updateScrollMonitors:function(){for(var e in this.Subviews)if(this.Subviews.hasOwnProperty(e)){var t=this.Subviews[e];t.hasOwnProperty("_pageScrollMonitor")&&(t._pageScrollMonitor.recalculateLocation(),t._pageScrollMonitor.update())}this.requestTick()},updateBackdropScrollPosition:function(e){var t=this.testIOS(),i=window.scrollY,o=window.innerHeight,n=document.documentElement.clientWidth,a=window.scrollX,r=!1;if(o!=this.cache_window_data.height||n!=this.cache_window_data.width||e||(r=!0),t&&(!this.fullScreenHeight||!r)){if(!this.measuringStick){var s=document.createElement("div");s.style.position="fixed",s.style.height="100vh",s.style.width="1px",s.style.zIndex="-10",s.style.pointerEvents="none",this.measuringStick=s,document.body.appendChild(this.measuringStick)}this.fullScreenHeight=this.measuringStick.offsetHeight}this.cache_window_data={width:n,height:o,scrollY:i,scrollX:a};var l=Cargo.Helper.IsMobileWindowSize(n);for(var d in this.Subviews)if(this.Subviews.hasOwnProperty(d)){var c=this.Subviews[d];if(c)if((c._trackable||c._scroll_tracking)&&c.hasOwnProperty("_positionChangeTracker")){x=c.el.parentElement.getBoundingClientRect();var h=c.el.parentElement.parentElement.getBoundingClientRect();if(x.left!=c._cached_size.left||x.top!=c._cached_size.top||x.width!=c._cached_size.width||x.height!=c._cached_size.height||!r){c._cached_size=x;var u=c._split_responsive&&l;if(h.height<=o||u){var g,p=0;c._scroll_tracking&&(c._has_accommodation?(p=Cargo.View.PinnedTop.pinCollection.findWhere({content_accommodate_page:!0}).get("page_height"),g=(S=u?"calc(50vh + "+p+"px)":"calc(100% + "+p+"px)","translate(0, "+-p+"px)"),c._scroll_tracking=!0):(g=S="",c._scroll_tracking=!1),c.el.style.transform=g,c.el.style.height=S,c.el.style.width="",c.el.style.position="",c.hasOwnProperty("auxiliary_container")&&(c.auxiliary_container._el.style.transform="",c.auxiliary_container._el.style.height=S,c.auxiliary_container._el.style.width="",c.auxiliary_container._el.style.position=""),c.el.style.willChange="initial"),c.hasOwnProperty("SetSizeFromMainView")&&(t&&u?c.SetSizeFromMainView(x.width,.5*this.fullScreenHeight+p):u?c.SetSizeFromMainView(x.width,.5*o+p):c.SetSizeFromMainView(x.width,x.height+p))}else{c._scroll_tracking&&!c._trackable?c._scroll_tracking=!1:c._scroll_tracking=!0;var m=0<=h.bottom&&h.top<0,f=h.top<=o&&h.bottom>o,v=h.top>o,b=h.bottom<0,y=h.top<=0&&h.bottom>=o,w=0,_=0,C="absolute",S="",k=Math.ceil(x.width);f&&!y||v?(S=o+"px",C="absolute",w=_=0):_=m&&!y||b?(S=o+"px",w=h.height+-o,C="absolute",0):(S=o+"px",w=0,C="fixed",Math.round(x.left)),c.el.style.position=C,c.el.style.willChange="transform, width, height, position",c.el.style.width=k+"px",c.el.style.height=S,_+=-h.left,c.el.style.transform=0==_&&0==w&&0==i?"":"translate("+_+"px, "+w+"px)",c.hasOwnProperty("auxiliary_container")&&(c.auxiliary_container._el.style.height=S,c.auxiliary_container._el.style.width=k+"px",c.auxiliary_container._el.style.position=C,c.auxiliary_container._el.style.transform=0==_&&0==w&&0==i?"":"translate("+_+"px, "+w+"px)"),c.hasOwnProperty("SetSizeFromMainView")&&(x.height,c.SetSizeFromMainView(x.width,o))}}}else if(c._scroll_tracking=!1,c.el.style.willChange="initial",c.hasOwnProperty("SetSizeFromMainView")){var x=c.el.parentElement.getBoundingClientRect();c.SetSizeFromMainView(x.width,x.height)}}},requestTick:function(e){if(!this.ticking){var t=this;requestAnimationFrame(function(){t.updateBackdropScrollPosition(),Cargo.Event.trigger("backdrop_position_update"),t.ticking=!1})}this.ticking=!0},makeFallback:function(e){var t=e.get("page_id"),i=$('[data-id="'+t+'"]').css("color"),o=i.split(","),n=[],a=125<(/rgb\(/.test(i)?(o[0]=o[0].replace("rgb(",""),n[0]=parseInt(o[0]),n[1]=parseInt(o[1]),n[2]=parseInt(o[2]),(299*n[0]+587*n[1]+114*n[2])/1e3):/rgba\(/.test(i)?(o[0]=o[0].replace("rgb(",""),n[0]=parseInt(o[0]),n[1]=parseInt(o[1]),n[2]=parseInt(o[2]),(299*n[0]+587*n[1]+114*n[2])/1e3):/#/.test(i)?(n[0]=parseInt(o[0],16),n[1]=parseInt(o[1],16),n[2]=parseInt(o[2],16),(299*n[0]+587*n[1]+114*n[2])/1e3):255)?"#333":"#fff";return $('.page[data-id="'+t+'"]').siblings(".backdrop").css("background-color",a),this},testWebGl:function(){if(null!==this.has_webgl)return this.has_webgl;var e,t,i;if(this.has_webgl=!1,window.WebGLRenderingContext){e=document.createElement("canvas"),i=!(t=["webgl","experimental-webgl","moz-webgl","webkit-3d"]);for(var o=0;o<4;o++)try{if((i=e.getContext(t[o]))&&"function"==typeof i.getParameter)return e=void 0,this.has_webgl=!0,this.has_webgl}catch(e){}return e=void 0,this.has_webgl=!1,this.has_webgl}return this.has_webgl=!1,this.has_webgl},initAndRenderPlugin:$.noop,initPlugin:$.noop,loadActivePlugin:$.noop,render:$.noop,unloadMainPlugin:$.noop}),Cargo.o.view.Content=Backbone.View.extend({template:$('[type="text/x-handlebars-template"]#content').html(),initialize:function(){this.currentSet=null,this.activeContentModel=null,$(_.bind(function(){var e=2*screen.height;Cargo.Helper.isMobile()&&(e=.75*screen.height);var n=scrollMonitor.create($("[data-autopaginate]")[0],e);n.enterViewport(_.bind(function(){this.requestPagination({prevent_pagination_recheck:!0,pagination_attempts:0})},this)),n.isInViewport&&this.requestPagination({prevent_pagination_recheck:!0,pagination_attempts:0}),Cargo.Event.on("set_render_complete",function(e,t){t.from_pagination||(scrollMonitor.update(),!0!==t.prevent_pagination_recheck&&n.isInViewport&&this.requestPagination({prevent_pagination_recheck:!0,pagination_attempts:0}))},this),Cargo.Event.on("set_load_complete",function(){scrollMonitor.update(),n.isInViewport&&this.requestPagination({prevent_pagination_recheck:!0,pagination_attempts:0})},this),Cargo.Event.on("pagination_complete",function(e,i,o){setTimeout(_.bind(function(){scrollMonitor.update();var e=o.pagination_attempts;if(isNaN(e)&&(e=!1),!(e&&3<e)&&0<i.length&&n.isInViewport){var t={};isNaN(e)||(t.pagination_attempts=++e),this.requestPagination(t)}},this),100)},this)},this)),this.activeLinks=[],Cargo.Event.on("content_load_complete",this.checkActiveLinks,this),Cargo.Event.once("init_complete",function(){this.initializePreRenderedSet()},this)},requestPagination:function(e){this.currentSet&&this.activeContentModel&&"set"===this.activeContentModel.type&&this.activeContentModel.paginate(e)},fillGapsInCurrentSet:function(){if(this.currentSet&&this.activeContentModel&&"set"===this.activeContentModel.type){var t,i,e=_.union([this.currentSet],this.currentSet.getAllSetViews()),o=[],n=[];if(e.sort(function(e,t){return e.model.get("sort")-t.model.get("sort")}),_.each(e,function(e){n.push(e),0<e.pageViews.length&&(i=(t=e).pageViews[e.pageViews.length-1],o=_.union(o,n),n=[])}),!t||!i)return;var a=0,r=this.activeContentModel.recursivelyFindMissingIndexesInSet(16,{limit:{set:t.model.get("id"),index:i.model.get("index")}});if(_.isEmpty(r))return;if(_.each(r,function(e){a+=e.indexes.length}),15<a){var s=this.activeContentModel.recursivelyFindMissingIndexesInSet(15,{limit:{set:t.model.get("id"),index:i.model.get("index")}});this.activeContentModel.paginateWithMissingIndexObject(s,{render_changes:!0,done:_.bind(function(e){var i=e[e.length-1];_.each(Cargo.Collection.Scaffolding.getAllPages(!0),function(e){if("set"===e.type){var t=[];e.get("pages").each(function(e){"page"===e.type&&Cargo.Helper.IsIndexableModel(e)&&e.get("sort")>i.sort&&t.push(e)}),e.get("pages").remove(t)}})},this)})}else this.activeContentModel.paginateWithMissingIndexObject(r,{render_changes:!0})}},checkActiveLinks:function(t){var i=Cargo.Helper.GetHomepageId(),e=Cargo.Collection.Scaffolding.getModel({id:t}),o="";e?o=e.get("project_url")+"":this.activeContentModel&&void 0!==this.activeContentModel.get("__tag__")&&(o=this.activeContentModel.get("__tag__"));var n,a=_.filter(document.querySelectorAll(".page_container a, #site_menu > a"),function(e){return t!=i&&("string"==typeof e.getAttribute("href")&&e.getAttribute("href").replace(/\//g,"").toLowerCase()==o.replace(/\//g,"").toLowerCase()||void(e.classList.contains("active")&&-1===this.activeLinks.indexOf(e)&&this.activeLinks.push(e)))},this),r=_.difference(this.activeLinks,a),s=_.difference(a,this.activeLinks);if(0!==s.length||0!==r.length){for(n=0;n<s.length;n++)s[n].classList.add("active"),this.activeLinks.push(s[n]);for(n=0;n<r.length;n++)r[n].classList.remove("active"),0===r[n].classList.length&&r[n].removeAttribute("class");this.activeLinks=_.difference(this.activeLinks,r),this.activeLinkPID=t}else this.activeLinkPID=t},retrieveActivePageViewForPID:function(n,a){var r=Cargo.Helper.GetPageViewById(n);if(r&&r.model.get("pin"));else if(Cargo.Helper.isFeed()||void 0===r)return void this.RenderPidOrPurl(n,!0,{complete:_.bind(function(){if(r=Cargo.Helper.GetPageViewById(n),unableToLoad=!1,void 0!==r)a&&a(r);else{unableToLoad=!0;var t=Cargo.Collection.Scaffolding.getModel({id:n});if(t){var e=Cargo.Collection.Scaffolding.getModel({id:t.get("set_id")});if(e&&e.get("stack")){var i=_.filter(e.get("pages").getMissingIndexes(),function(e){return e<=t.get("index")}),o=e.loadIndexes(i,{render_changes:!0});o&&(unableToLoad=!1,o.always(_.bind(function(){void 0!==(r=Cargo.Helper.GetPageViewById(n))?a&&a(r):Cargo.Modal.Alert({message:"Unable to load Page"})},this)))}}}unableToLoad&&Cargo.Modal.Alert({message:"Unable to load Page"})},this)});r&&a&&a(r)},render:function(e,t){if(t=t||{},_.defaults(t,{silent:!1,initial_render:!0,complete:function(){}}),this.removeCurrentView(),"set"===e.type)!0!==e.get("stack")||Cargo.Helper.IsAdminEdit()||this.collection.removeNonVisiblePages(),this.currentSet=Cargo.Core.SetViewFactory.constructSetView({model:e}),this.activeContentModel=e,this.currentSet.el.setAttribute("data-container","set"),this.currentSet.el.setAttribute("data-id",e.get("id")),this.el.appendChild(this.currentSet.el),this.currentSet.render(void 0,t),t.silent?this.checkActiveLinks(e.get("id")):(Cargo.Event.trigger("set_load_complete",e.get("id")),Cargo.Event.trigger("content_load_complete",e.get("id"))),e.get("__tag__")&&(Cargo.Event.trigger("tag_load_complete",e.get("__tag__")),Cargo.View.Main&&Cargo.View.Main.SetFeedClass()),Cargo.API.Config.is_direct_link&&(Cargo.API.Config.is_direct_link=!1),t.complete(e,t);else if("page"===e.type){var i=this.collection.getModel({id:e.get("set_id")}),o=e;this.activeContentModel=o,e=new Cargo.o.model.set({id:i.get("id"),pages:[o],stack:!1,is_set:!0,page_count:1}),this.currentSet=Cargo.Core.SetViewFactory.constructSetView({model:e}),this.currentSet.el.setAttribute("data-container","set"),this.currentSet.el.setAttribute("data-id",i.get("id")),this.el.appendChild(this.currentSet.el),this.currentSet.render(void 0,t),t.silent?this.checkActiveLinks(o.get("id")):(Cargo.Event.trigger("page_load_complete",o.get("id")),Cargo.Event.trigger("content_load_complete",o.get("id"))),Cargo.API.Config.is_direct_link&&(Cargo.API.Config.is_direct_link=!1),t.complete(o,t)}},RenderHomepage:function(e,i){if(i=i||{},_.defaults(i,{silent:!1,complete:function(){},force_single:!0}),this.activeContentModel&&this.activeContentModel.get("id")===Cargo.Helper.GetHomepageId()&&!0===Cargo.Router.is_first_route&&!e)return i.complete(this.activeContentModel,i),void Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId());Cargo.Helper.isFeed()?(!0!==Cargo.Router.is_first_route||e)&&(this.RenderFeed(!0,i),!0!==i.silent&&Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId())):(this.collection.removeNonVisiblePages(),0===Cargo.Helper.GetHomepageId()?(this.removeCurrentView(),this.activeContentModel=this.collection.getModel({id:0}),!0!==i.silent&&Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId()),i.complete(this.activeContentModel,i)):(i.complete=_.wrap(i.complete,_.bind(function(e){!0!==i.silent&&Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId());var t=Array.prototype.slice.call(arguments);t.shift(),e&&e.apply(i.context,t)},this)),this.RenderPidOrPurl(Cargo.Helper.GetHomepageId(),e,i)))},RenderFeed:function(e,t){t=t||{},_.defaults(t,{silent:!1}),this.collection.removeNonVisiblePages(),this.RenderPidOrPurl(0,e,t)},RenderPidOrPurl:function(t,i,o){if(o=o||{},_.defaults(o,{silent:!1,force_single:!1,force_set_render:!1,complete:function(){}}),!0!==Cargo.Router.is_first_route||i){var e;if(isNaN(Number(t))||"string"==typeof t&&0===Number(t)||(e=this.collection.getSetOrPageModel({id:Number(t)},Cargo.Helper.IsAdminEdit()&&!o.force_single)),e||(e=this.collection.getModelByPurl(t,Cargo.Helper.IsAdminEdit()&&!o.force_single)),e)return o.force_set_render||Cargo.Helper.isFeed()||!0!==e.get("is_set")||!1!==e.get("stack")?void this.render(e,o):(this.hideActiveView(o),this.activeContentModel=e,o.silent||(Cargo.Event.trigger("content_load_complete",e.get("id")),Cargo.Event.trigger("set_load_complete",e.get("id"))),void o.complete(e,o));o.from_async?(Cargo.Modal.Alert({message:"Page Not Found"}),Cargo.Helper.HideLoadingAnimation()):this.loadSinglePage(t,_.bind(function(e){o.from_async=!0,this.RenderPidOrPurl.call(this,t,i,o)},this))}else Cargo.Router.is_first_route=!1},loadSinglePage:function(t,i){this.collection.fetchPageModel(t,{done:_.bind(function(e){e.get("id")!=t&&(e.get("project_url")+"").toLowerCase()!=(t+"").toLowerCase()||i&&i(e)},this)})},ToggleFeed:function(e){e?this.RenderFeed(!0,{force_set_render:!0}):0===Cargo.Helper.GetHomepageId()?this.removeCurrentView():this.RenderPidOrPurl(Cargo.Helper.GetHomepageId(),!0)},removeCurrentView:function(){if(this.currentSet){this.activeContentModel=null;var e=this.currentSet;this.currentSet=null,e.remove(),this.checkActiveLinks(),Cargo.View.Main.SetWindowTitle(),Cargo.Event.trigger("content_view_removed")}this.el.innerHTML=""},hideActiveView:function(e){e=e||{},_.defaults(e,{silent:!1}),this.removeCurrentView(),Cargo.Helper.HideLoadingAnimation(),e.silent||Cargo.Event.trigger("content_view_closed")},initializePreRenderedSet:function(){var r=Cargo.Collection.Tags.findTagByUrl(Cargo.Helper.GetCurrentRoute().replace(window.location.search,""));if(_.each(this.el.children,function(e){var t=parseInt(e.getAttribute("data-id"),10),i=this.collection.getSetOrPageModel({id:Number(t)});if(!isNaN(t))if("set"===e.getAttribute("data-container")){var o=!!i&&i.get("stack");r&&!1===o?Cargo.Collection.Scaffolding.LoadTagCollection(r):i&&(this.activeContentModel=i,this.currentSet=Cargo.Core.SetViewFactory.constructSetView({el:e,model:i}),this.currentSet.render(!0),Cargo.Event.trigger("set_load_complete",i.get("id")),Cargo.Event.trigger("content_load_complete",i.get("id")),i.get("id")===Cargo.Helper.GetHomepageId()&&Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId()),Cargo.Helper.isFeed()&&r&&Cargo.Event.trigger("thumbnails:load_tag",r.get("url"))),Cargo.API.Config.is_direct_link&&(Cargo.API.Config.is_direct_link=!1)}else if("page"===e.getAttribute("data-container")){if(!i)return void this.loadSinglePage(t,_.bind(function(e){this.initializePreRenderedSet()},this));var n=this.collection.getModel({id:i.get("set_id")}),a=i;i=new Cargo.o.model.set({id:n.get("id"),pages:[a],stack:!1,is_set:!0,page_count:1}),this.activeContentModel=a,this.currentSet=Cargo.Core.SetViewFactory.constructSetView({model:i}),this.currentSet.el.setAttribute("data-container","set"),this.currentSet.el.setAttribute("data-id",n.get("id")),e.parentNode.insertBefore(this.currentSet.el,e),this.currentSet.el.appendChild(e),this.currentSet.findAndInitializePrerenderedContent(),Cargo.Event.trigger("page_load_complete",a.get("id")),Cargo.Event.trigger("content_load_complete",a.get("id")),a.get("id")===Cargo.Helper.GetHomepageId()&&Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId()),Cargo.API.Config.is_direct_link&&(Cargo.API.Config.is_direct_link=!1)}},this),null===this.activeContentModel)if(Cargo.API.Config.direct_link_pid){var e=this.collection.getModel({id:Cargo.API.Config.direct_link_pid});e&&"set"===e.type&&(this.activeContentModel=e,Cargo.Event.trigger("content_load_complete",e.get("id")),Cargo.Event.trigger("set_load_complete",e.get("id")))}else r?Cargo.Collection.Scaffolding.LoadTagCollection(r):Cargo.Event.trigger("homepage_loaded",Cargo.Helper.GetHomepageId());Cargo.API.Config.direct_link_pid=void 0},getPageViewById:function(t){if(this.currentSet)return _.filter(this.currentSet.getAllPageViews(),function(e){return e.model.get("id")==t})[0]},getFirstPageView:function(){if(this.currentSet)return _.filter(this.currentSet.getAllPageViews(),function(e){return!e.model.get("pin")})[0]},getLastPageView:function(){if(this.currentSet){var e=_.filter(this.currentSet.getAllPageViews(),function(e){return!e.model.get("pin")});return e[e.length-1]}},getActiveContentModel:function(){return this.activeContentModel},getActivePageViews:function(){return this.currentSet?this.currentSet.getAllPageViews():[]}}),Cargo.o.view.Page=Backbone.View.extend({parentView:null,template:$('[type="text/x-handlebars-template"]#page').html(),constructor:function(){Backbone.View.prototype.constructor.apply(this,arguments)},initialize:function(e){e&&e.parentView&&(this.parentView=e.parentView),e&&e.template&&(this.template=e.template),this.isAdminEdit=Cargo.Helper.IsAdminEdit(),this.finishGallerySetup=_.bind(this.finishGallerySetup,this),void 0!==this.model?(this.listenTo(this,"remove",function(){this.removeBackdrop(),Cargo.Event.trigger("pageview_removed",this),this.draggableView&&this.draggableView.remove()}),this.listenTo(this.model,"change:backdrop_enabled",function(){this.model.get("backdrop_enabled")?this.addBackdrop():this.removeBackdrop(!1)}),Cargo.Event.trigger("pageview-initialized",this),Cargo.Event.on("image_gallery_rendered",this.finishGallerySetup),this.initialSetup()):console.warn("no model for page")},events:{dragstart:"dragstart"},dragstart:function(e){if(Cargo.API.Config.cookie_url&&e.target.nodeType===Node.ELEMENT_NODE&&"IMG"===e.target.nodeName&&e.target.hasAttribute("data-mid")){var t=_.findWhere(this.model.get("images"),{id:parseInt(e.target.getAttribute("data-mid"))});if(t&&0==/(.*?)\.(svg)$/g.test(t.getOriginalImage().url)){var i={drag_image_src:e.target.getAttribute("src"),image_url:t.getOriginalImage().url,source_url:this.model.get("direct_link"),source_title:this.model.get("title")+" - "+Cargo.Model.Site.GetWebsiteTitle(),tags:""===this.model.get("tags")?[]:this.model.get("tags").split(", "),excerpt:this.model.get("excerpt")};e.dataTransfer.setData("cargo/imageselection",JSON.stringify(i))}}},removeBackdrop:function(e){!1!==e&&(e=!0),Backdrop.View.Backdrop.remove(this.model.get("id"),e)},addBackdrop:function(){this.model.get("backdrop")&&this.model.get("backdrop_enabled")&&Backdrop.View.Backdrop.add(this.model.get("id"),this.model.get("backdrop").backdrop_id,this.model.get("backdrop").backdrop_path)},initialSetup:function(){this.markNodesAsOriginal(),this.removeEmptyPagePadding(),Cargo.Core.Embeds.findEmbedsIn(this.el),Cargo.Core.Ecommerce.findWidgets(this.el),Cargo.Core.AudioPlayer.findPlayers(this.el),Cargo.Core.Ecommerce.updateInlineCartCounters(),Cargo.Core.Draggables.findShowLinks(),this.draggableView=new Cargo.Core.Draggables.DraggablesInstance({pageView:this}),Cargo.Core.ImageGallery.InitImageGallery({targetElement:this.el,forceReCollectionOfItems:!0}),Cargo.Model.DisplayOptions.get("layout_options")&&Cargo.Model.DisplayOptions.get("layout_options").image_zoom&&this.setupPageLightbox(),this.marqueeInstance||(this.marqueeInstance=new Cargo.Core.MarqueeInstance({parentView:this})),this.marqueeInstance.findMarquees(),this.trigger("initial-setup")},render:function(){if(this.preventRender)console.info("Prevented rendering of page",this.model.id);else{if(void 0!==this.model){var e=Cargo.Core.Handlebars.ParseScriptTags(this.template),t=Cargo.API.GetDataPackage();_.extend(t,this.model.toJSON());var i,o=Cargo.Core.Handlebars.Render(e,t),n=document.createRange(),a=[];for(n.selectNode(document.body),i=n.createContextualFragment(o),_.each(i.querySelectorAll("script"),function(e){a.push({node:e,parentNode:e.parentNode,nextSibling:e.nextSibling}),e.parentNode.removeChild(e)}),this.el.innerHTML="";0<i.childNodes.length;)this.el.appendChild(i.childNodes[0]);var r=!1,s=function(e){r=!0};if(window.addEventListener("error",s,!1),_.each(a,function(e){r=!1;var t=$;$(e.node).on("load",function(){if($!==t){Cargo.Modal.Alert({message:"<em>External versions of jQuery are not supported. Please use the built-in version of jQuery</em>"});var e=this.ownerDocument.createComment(this.outerHTML);e.setSaveable(!0),this.parentNode.insertBefore(e,this),this.parentNode.removeChild(this),jQuery.noConflict(!0)}}),e.nextSibling&&e.nextSibling.parentNode===e.parentNode?e.parentNode.insertBefore(e.node,e.nextSibling):e.parentNode.appendChild(e.node),r&&(r=!1,e.node.parentNode.insertBefore(document.createComment(e.node.outerHTML),e.node),e.node.parentNode.removeChild(e.node),this.isAdminEdit&&Cargo.Modal.Alert({message:"<em>One or more scripts on this page are broken and were disabled.</em>"}))}),window.removeEventListener("error",s),1===this.el.children.length)if(null!==this.el.parentNode){var l=this.el.children[0];this.el.parentNode.insertBefore(l,this.el),this.el.parentNode.removeChild(this.el),this.setElement(l)}else this.setElement(this.el.children[0]);return this.$el.closest("[local-style]").attr("local-style",this.model.get("id")),this.initialSetup(),this.addBackdrop(),Cargo.Event.trigger("page_render_complete",this),this}console.warn("no model for page")}},finishGallerySetup:function(e){var t=!1,i=!1,o=closest(e.el,function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.classList.contains("page")});o?(parseInt(o.getAttribute("data-id"))==this.model.get("id")&&(!this.isAdminEdit&&Cargo.Model.DisplayOptions.get("layout_options").image_zoom&&(t=!0),i=!0),t&&this.setupGalleryLightbox(e),i&&this.autoplayVideos()):Cargo.Event.off("image_gallery_rendered",this.finishGallerySetup)},setupGalleryLightbox:function(e){var t=e.el.querySelectorAll("img");if("montessori"!=e.galleryOptions.path||e.mobile_active)t=_.sortBy(t,function(e){return parseInt(e.getAttribute("data-gallery-item-index"))});else{var o=e.serialize();t=_.sortBy(t,function(e){var t=0;if(e.hasAttribute("data-gallery-item-id"))t=parseInt(e.getAttribute("data-gallery-item-id"));else{var i=closest(e,function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.hasAttribute("data-gallery-item-id")});i&&(t=parseInt(i.getAttribute("data-gallery-item-id")))}return _.findWhere(o,{index:t}).meta.montessori.y})}this.bindLightboxArray(t)},setupPageLightbox:function(e){var t=this;if(!this.isAdminEdit){for(var i=[],o=$("img",this.el),n=[],a=0;a<o.length;a++){var r=o[a].hasAttribute("data-gallery-item-index")||o[a].parentNode.classList.contains("image-gallery");r&&0<n.length?(i.push(n),n=[]):r||n.push(o[a])}0<n.length&&i.push(n),_.each(i,function(e){t.bindLightboxArray(e)})}},bindLightboxArray:function(e){var n=this.model.get("images"),a=[],r=/Mobi/i.test(navigator.userAgent),s=Cargo.Model.DisplayOptions.get("layout_options")&&!Cargo.Model.DisplayOptions.get("layout_options").image_full_zoom;_.each(e,function(i){if(i.hasAttribute("data-src")&&null===closest(i,function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.classList.contains("slick-cloned")||e.classList.contains("cloned_marquee_inner")||"A"===e.tagName})&&!i.hasAttribute("data-no-zoom")&&!i.hasAttribute("no-zoom")){if(r){var e,t=_.findWhere(n,{id:parseInt(i.getAttribute("data-mid"))});if(t){e=Math.floor(Math.min(250*Math.ceil(2*screen.width/250),t.get("width")));var o=t.getImageWithOptions({w:e,q:94});i._lightboxSrc=o.url,i._lightboxWidth=o.w,i._lightboxHeight=o.h}}a.push(i),i.classList.add("image-zoom"),i.addEventListener("click",function(e){var t=closest(i,function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.classList.contains("marquee_inner")});lightbox.openImageArray(a,i,{disableZoom:s,preventAnimation:null!==t})})}})},autoplayVideos:function(){var e=this.$el.find(".page_content").get(0);if(void 0!==e){var n=Cargo.Helper.isMobile();_.each(e.querySelectorAll("video[autoplay]"),function(t){if(!t._bound_by_pageView){t.hasAttribute("muted")&&(t.muted=!0),n&&!t.hasAttribute("playsinline")&&t.setAttribute("playsinline","");var e=t.hasAttribute("controls"),i=function(){e||t.removeAttribute("controls"),t.removeEventListener("play",i)};t.addEventListener("play",i);var o=t.play();void 0!==o&&o.then(function(){}).catch(function(e){t.setAttribute("controls","")}),t._bound_by_pageView=!0}})}},getModel:function(){return this.model},markNodesAsOriginal:function(){var e=this.$el.find("projectcontent")[0];if(void 0!==e){Node.prototype.hasOwnProperty("setSaveable")&&this.getAllDescendants(e,function(e){e.setSaveable(!0)});var t=e.parentNode;for(t.setAttribute("data-ce-host","true"),t.setAttribute("data-ce-model-id",this.model.get("id"));0<e.childNodes.length;)t.insertBefore(e.childNodes[0],e);t.removeChild(e),0==t.querySelectorAll(".image-gallery").length&&this.autoplayVideos()}},getAllDescendants:function(e,t){for(var i=0;i<e.childNodes.length;i++){var o=e.childNodes[i],n=t(o);if(!1===n)return!1;"continue"!==n&&this.getAllDescendants(o,t)}},removeEmptyPagePadding:function(){if((!Cargo.Helper.IsAdminEdit()||top.Backbone.history.fragment!=this.model.get("id"))&&0<$(".page_content",this.$el).length){var e=""==$(".page_content",this.$el).html().trim(),t=0<this.$el.find("[data-backdrop]").length;e&&!t&&$("bodycopy",this.$el).removeClass("content_padding")}},getLocalCSSElement:function(){return this.el.querySelector(".local-css")},remove:function(){if(!this.preventRemove){var e=$(".page_content",this.$el)[0];e&&Cargo.Helper.isMobile()&&_.each(e.querySelectorAll("video"),function(e){e.pause(),e.src="",e.innerHTML="",e.load()}),Cargo.Core.AudioPlayer.destroyPlayers(this.el),void 0!==Cargo.Helper.throttledScrollMonitorUpdate&&Cargo.Helper.throttledScrollMonitorUpdate(),Backbone.View.prototype.remove.apply(this,arguments)}}}),Cargo.o.view.Set=Backbone.View.extend({constructor:function(){Backbone.View.prototype.constructor.apply(this,arguments)},initialize:function(e){this.parentSetView=e.parentSetView?e.parentSetView:null,null!==this.parentSetView&&this.listenTo(this.parentSetView,"remove",this.remove),this.listenTo(this,"remove",this.removeAllPages),this.listenTo(Cargo.Event,"pageview_removed",function(e){-1!==this.pageViews.indexOf(e)&&(this.pageViews=_.without(this.pageViews,e))});var o=!1;this.listenTo(this.model.get("pages"),"add",function(e,t,i){1==i.from_pagination?o=!0:!1!==i.render_changes&&this.render(!0,i)}),this.listenTo(this.model.get("pages"),"remove",function(e,t,i){var o=_.union(this.pageViews,this.setViews),n=_.findWhere(o,{model:e});n&&(n.remove(),this.pageViews=_.without(this.pageViews,n),this.setViews=_.without(this.setViews,n)),!0===i.render_changes&&this.render(!0,i),Cargo.Helper.throttledScrollMonitorUpdate()}),this.listenTo(Cargo.Event,"pagination_complete",function(e,t,i){o&&this.render(!0,i),o=!1}),this.listenTo(this.model,"tag_pagination_complete",function(e,t,i){o&&this.render(!0,i),o=!1}),this.listenTo(this.model,"destroy",function(){this.remove()}),this.pageViews=[],this.setViews=[],this.findAndInitializePrerenderedContent()},sortPagesAndUpdateDOM:function(){if(!(this.model.get("pages").length<=1)){this.model.get("pages").sort();var e=_.union(this.pageViews,this.setViews);e.sort(function(e,t){return e.model.get("sort")-t.model.get("sort")}),_.each(e,function(e){this.el.appendChild(e.el)},this)}},sortSetViews:function(){this.setViews.sort(function(e,t){return e.model.get("sort")-t.model.get("sort")})},sortPageViews:function(){this.pageViews.sort(function(e,t){return e.model.get("sort")-t.model.get("sort")})},removeAllPages:function(){_.each(this.pageViews,function(e){e.remove()}),this.pageViews=[]},removeAllSets:function(){_.each(this.setViews,function(e){e.remove()}),this.setViews=[]},render:function(r,s){s=s||{},_.defaults(s,{}),!0!==r&&(r=!1,this.removeAllPages(),this.removeAllSets());var l=!1,d=this.model.get("pages").getFirstIndexGap();this.model.get("pages").each(function(e,t,i){if("page"!==e.type||e.get("pin")){if("set"===e.type){if(r&&(void 0!==_.findWhere(this.setViews,{model:e})||void 0!==this.$el.children('[data-container="set"][data-id="'+e.get("id")+'"]')[0]))return;var o=Cargo.Core.SetViewFactory.constructSetView({parentSetView:this,model:e});o.el.setAttribute("data-container","set"),o.el.setAttribute("data-id",e.get("id")),this.el.appendChild(o.el),o.render(void 0,s),this.setViews.push(o),l=!0}}else{if(1<this.model.get("page_count")&&e.get("index")>d)return void console.warn("Pageview not rendered because set has gap before it.",e);if(r&&(void 0!==_.findWhere(this.pageViews,{model:e})||void 0!==this.$el.children('[data-container="page"][data-id="'+e.get("id")+'"]')[0]))return;var n;if(n="undefined"!=typeof __pin_preview_pageview__&&__pin_preview_pageview__.model===e?__pin_preview_pageview__:Cargo.Core.PageviewFactory.constructPageView({parentView:this,model:e}),r)if(0<t){var a=this.$el.children('[data-container][data-id="'+i[t-1].get("id")+'"]')[0];a?a.parentNode.insertBefore(n.el,a.nextSibling):0===e.get("index")&&Cargo.Helper.IsIndexableModel(e)?this.el.insertBefore(n.el,this.el.firstChild):this.el.appendChild(n.el)}else this.el.insertBefore(n.el,this.el.firstChild);else this.el.appendChild(n.el);n.render(),this.pageViews.push(n),l=!0}},this),l&&(this.sortPageViews(),this.sortSetViews(),Cargo.Event.trigger("set_render_complete",this,s))},findAndInitializePrerenderedContent:function(r){_.each(this.el.children,function(e){var t=e.getAttribute("data-container"),i=parseInt(e.getAttribute("data-id"),10),o=this.model.get("pages").findWhere({id:i});if(isNaN(Number(r))||i===r)if(o){if("set"===t){if(void 0===_.findWhere(this.setViews,{model:o})){var n=Cargo.Core.SetViewFactory.constructSetView({parentSetView:this,model:o,el:e});this.setViews.push(n)}}else if("page"===t&&void 0===_.findWhere(this.pageViews,{model:o})){var a=Cargo.Core.PageviewFactory.constructPageView({parentView:this,model:o,el:e});this.pageViews.push(a)}this.sortPageViews(),this.sortSetViews()}else Cargo.Collection.Scaffolding.fetchPageModel(i,{done:_.bind(function(e){e.get("id")===i&&(console.info("fetching",i,"success"),void 0!==this.model.get("pages").findWhere({id:i})?this.findAndInitializePrerenderedContent(i):console.info("can't locate newly added model."))},this)})},this)},getAllPageViews:function(){var i=[];return function e(t){i=_.union(i,t.pageViews),_.each(t.setViews,e)}(this),i},getAllSetViews:function(){var i=[];return function e(t){i=_.union(i,t.setViews),_.each(t.setViews,e)}(this),i},remove:function(){this.preventRemove||(Cargo.Helper.throttledScrollMonitorUpdate(),Backbone.View.prototype.remove.apply(this,arguments))}}),Cargo.o.view.Pin=Backbone.View.extend({no_render:!1,Data:{tallest_height:null},initialize:function(e){this.count=0,this.debouncedSortElements=_.debounce(this.sortElements,10),this.position=this.$el.data("view").replace("pinned_",""),this.template=$('[type="text/x-handlebars-template"]#pinned_'+this.position).html(),this.reversedSide="bottom",this.pinCollection=new Cargo.o.collection.pins(null,{position:this.position}),this.pinCollection.on("sort",this.debouncedSortElements,this),this.pinCollection.on("formatting_update_required",function(e,t){this.pinCollection.sort(),this.formatOverlayPages()},this),this.initializePreRenderedPins(),this.formatOverlayPages=_.throttle(this.formatOverlayPages,1),this.listenTo(Cargo.Event,"BaseUnit:refresh thumbnails_render_complete thumbnails_hide thumbnails_show pagination_complete inline-editor-load-complete set_render_complete",this.formatOverlayPages,this),this.listenTo(Cargo.Event,"homepage_loaded content_load_complete refresh_pins mobile_breakpoint_triggered",function(){this.render(Cargo.Helper.GetCurrentProjectId(),!0)}),this.formatOverlayPages(),"bottom"===this.position&&(this.pinCollection.each(function(e){var t=0<e.get("pageView").$el.find(".image-gallery").length;e.set({has_image_gallery:t})}),Cargo.Event.on("image_gallery_init_complete",_.bind(function(e){_.each(e,_.bind(function(e,t){var i=_.findWhere(this.pinCollection.models,{id:e});i&&i.set({image_gallery_init_completed:!0})},this))},this)))},initializePreRenderedPins:function(e){var a=[];this.$el.find('[data-container="content"]').each(_.bind(function(e,t){var i=parseInt($(t).data("id")),o=Cargo.Collection.Scaffolding.getModel({id:i});if(o){var n=new Cargo.o.view.Page({template:$('[type="text/x-handlebars-template"]#pin').html(),parentView:this,model:o,el:t.parentNode});a.push({id:i,pageView:n})}},this)),this.pinCollection.add(a);var t=this.filterExcludedPins(this.pinCollection.models);this.pinCollection.remove(_.pluck(t,"id"))},render:function(e,t){t=!0===t;var i,o,n,a=_.union(this.collection.getPinsByPositionSetId(this.position,!1),this.collection.getPinsByPositionSetId(this.position,e)),r=this.pinCollection.pluck("pageModel");n=this.filterExcludedPins(a,!0),t||(this.pinCollection.reset(),n=this.filterExcludedPins(this.pinCollection.models)),a=_.filter(a,function(e){return-1==n.indexOf(e)}),i=_.difference(r,a),i=_.union(i,n),o=_.difference(a,r),_.difference(r,i,o);var s,l=[];_.each(o,function(e){"undefined"!=typeof __pin_preview_pageview__&&__pin_preview_pageview__.model===e?(s=__pin_preview_pageview__).stopListening(e):s=new Cargo.o.view.Page({template:$('[type="text/x-handlebars-template"]#pin').html(),parentView:this,model:e}),this.el.appendChild(s.el),s.render(),l.push({id:e.get("id"),pageView:s})},this),this.pinCollection.remove(_.pluck(i,"id")),this.pinCollection.add(l),(0<i.length||0<o.length)&&this.sortElements(),void 0!==Cargo.View.Content.activeLinkPID&&Cargo.View.Content.checkActiveLinks(Cargo.View.Content.activeLinkPID),(0<i.length||0<o.length)&&Cargo.Event.trigger("pin_load_complete")},filterExcludedPins:function(e,a){var t=document.documentElement.clientWidth,r=Cargo.Helper.IsMobileWindowSize(t),s=void 0!==Cargo.Helper.GetCurrentRoute()?Cargo.Helper.GetCurrentRoute():window.location.pathname.replace(/\//g,"");return _this=this,_.filter(e,function(e){if(Cargo.__admin_pid_required__===e.get("id"))return!1;var t=a?e:e.get("pageModel"),i=t.get("project_url"),o=t.getPinOption("exclude_mobile");if(s==i)var n=!0;return r&&o&&!n})},sortElements:function(){this.pinCollection.each(function(e){this.el.appendChild(e.get("pageView").el)},this),this.formatOverlayPages()},getPageViewById:function(e){var t=this.pinCollection.findWhere({id:e});if(void 0!==t)return t.get("pageView")},formatOverlayPages:function(){this.formatting||(this.formatting=!0,this.levelKeys=_.keys(this.pinCollection.levels),this.pinCollection.each(function(e){var t=window.getComputedStyle(e.get("pageView").el,null),i=parseFloat(t.height)-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom);e.set({page_height:i}),this.setPagePointerEvents(e.get("pageModel"),e.get("pageView").$el)},this),this.accommodatePages(),this.setHeightPerLevel(),this.positionPages(),this.setContainerHeight(),this.setContentContainerHeightforBottomPins(),Cargo.Event.trigger("pin_format_complete",this.position),this.formatting=!1,this.allowFixedSiteMenuToScroll(),"bottom"==this.position&&setTimeout(_.bind(function(){this.showAllBottomHiddenPins()},this),800))},allowFixedSiteMenuToScroll:function(){Cargo.View.SiteMenu&&Cargo.Helper.isMobile()&&Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth)&&(1==this.pinCollection.length&&1==Cargo.View.SiteMenu.collection.length&&this.pinCollection.models[0].get("id")==Cargo.View.SiteMenu.collection.models[0].get("id")&&Cargo.Router._lastFrag==Cargo.View.SiteMenu.collection.models[0].get("project_url")&&(this.pinCollection.models[0].get("pageView").$el.removeClass("overlay fixed"),this.$el.css("height","")))},setContainerHeight:function(){var i=0;_.each(this.pinCollection.levels,function(e,t){i+=parseFloat(e.overall_height)}),this.$el.css("height",i)},setContentContainerHeightforBottomPins:function(){var e=$(".content_container"),t=!1;Cargo.Helper.IsAdminEdit()&&void 0!==parent&&void 0!==parent.Cargo&&void 0!==parent.Cargo.Editor&&void 0!==parent.Cargo.Editor.View&&void 0!==parent.Cargo.Editor.View.ContentView&&"editproject"===parent.Cargo.Editor.View.ContentView.id&&void 0!==Cargo.View.Content?(_.each(Cargo.View.Content.getActivePageViews(),function(e){e.model.id==Cargo.Helper.GetHomepageId()&&(t=!0)}),void 0===_.findWhere(this.pinCollection.models,{id:parent.Cargo.Editor.View.ContentView.pid})||"bottom"!=this.pinCollection.position||t?e.removeClass("full_height"):e.addClass("full_height")):e.removeClass("full_height")},setHeightPerLevel:function(){var o=this;_.each(this.pinCollection.levels,function(n,t){t=parseInt(t,10);if(0!==n.models.length){var i=0;self_accommodating=void 0!==n.tallest&&n.tallest.get("accommodate_same_set"),height_pages=_.filter(n.models,function(e){var t=e.getPinOptions(),i=!t.overlay&&!t.fixed,o=self_accommodating&&e==n.tallest;return i||o}),_.each(height_pages,function(e){i+=e.get("page_height")});var e=_.filter(n.models,function(e){if(void 0!==e.get("accommodated_by_pid"))return o.getPageDepthByPid(e.get("accommodated_by_pid"))!==t})[0];void 0!==e&&(i+=e.get("page_padding")),n.overall_height=i}})},positionPages:function(){var p=this,m=this.position;opposite_position="bottom"==this.position?"top":"bottom",this.pinCollection.each(function(e){var t=0,i=e.getPinOptions(),o=(e.get("id"),!i.fixed&&!i.overlay),n=!1,a=e.get("depth"),r=(e.get("sort"),p.levelKeys[p.levelKeys.indexOf(a+"")+1]),s=p.levelKeys[p.levelKeys.indexOf(a+"")-1],l=(p.pinCollection.levels[r],p.pinCollection.levels[s]),d=p.pinCollection.levels[a];if("bottom"==m){for(var c=0;c<=a;c++){var h=p.pinCollection.levels[c-1];void 0!==h&&(void 0===h.tallest||h.tallest.get("accommodated_next_set")?null==h.tallest&&(t+=h.overall_height):t+=h.overall_height)}o?l&&null==l.tallest?t-=l.overall_height:l&&void 0!==l.tallest&&l.tallest.get("accommodate_same_set")?t-=l.overall_height:0==a&&d&&d.tallest&&d.tallest.get("accommodate_same_set")&&(t-=d.tallest.get("page_height")):n=!0}else{for(c=0;c<=a;c++)void 0!==p.pinCollection.levels[c-1]&&(t+=p.pinCollection.levels[c-1].overall_height);o?l&&null==l.tallest?t-=l.overall_height:l&&void 0!==l.tallest&&l.tallest.get("accommodate_same_set")?t-=l.overall_height:void 0!==d.tallest&&d.tallest.get("accommodate_same_set")&&void 0!==l&&void 0!==l.tallest&&l.tallest.get("id")!==e.get("accommodated_by_pid")&&(t+=l.tallest.get("page_height")):n=!0}n&&0<a&&void 0!==s&&void 0!==l&&void 0!==l.tallest&&l.tallest.get("id")!==e.get("accommodated_by_pid")&&1==d.accommodated_by_previous_set&&(t+=l.tallest.get("page_height"));var u=e.get("pageView").$el[0];if(u.style[m]=t+"px",u.style[opposite_position]="",i.overlay){var g=0;if(void 0!==d)g=d.models.slice().reverse().indexOf(e);u.style.zIndex=p.pinCollection.deepestLevel+-a+4+g}})},removeModelFlags:function(){_.each(this.pinCollection.models,function(e){e.unset("accommodated_by_pid")})},removeLevelFlags:function(){_.each(this.pinCollection.levels,function(e,t){void 0!==e.accommodated_by_previous_set&&(e.accommodated_by_previous_set=!1),void 0!==e.accommodated_by_same_set&&(e.accommodated_by_same_set=!1)})},accommodatePages:function(){this.removeAccommodatePadding(),this.removeModelFlags(),this.removeLevelFlags();var r=this.position,s=this;_.each(this.pinCollection.levels,function(i,e){if(0!==i.models.length&&(e=parseInt(e,10),next_depth=s.levelKeys[s.levelKeys.indexOf(e+"")+1],prev_depth=s.levelKeys[s.levelKeys.indexOf(e+"")-1],i.tallest&&(i.tallest.unset("accommodate_same_set"),i.tallest.unset("accommodated_next_set"),i.tallest.unset("accommodated_pin"),i.tallest.unset("accommodated_pid"),i.tallest.unset("content_accommodate_page")),i.tallest=void 0,_.each(i.models,function(e){var t=e.getPinOptions();t.overlay&&t.accommodate&&(!i.tallest||e.get("page_height")>i.tallest.get("page_height"))&&(i.tallest=e)}),_.each(i.models,_.bind(function(e){e!==i.tallest&&this.showBottomHiddenPin(e)},this)),null!=i.tallest)){var o=this.reversedSide,t=_.filter(i.models,function(e){var t=e.getPinOptions();return!t.overlay&&!t.fixed}).sort(function(e,t){return r==o?t.get("sort")-e.get("sort"):e.get("sort")-t.get("sort")})[0];if(t)return this.accommodateSinglePage(t,i.tallest),i.tallest.set({accommodate_same_set:!0,accommodated_pin:!0,accommodated_pid:t.get("id")}),void(i.accommodated_by_same_set=!0);var n=this.pinCollection.levels[next_depth];if(n){var a=_.filter(n.models,function(e){return e.getPinOptions().overlay}).sort(function(e,t){return r==o?t.get("sort")-e.get("sort"):e.get("sort")-t.get("sort")})[0];if(null==a&&(a=_.filter(n.models,function(e){return!e.getPinOptions().overlay}).sort(function(e,t){return r==o?t.get("sort")-e.get("sort"):e.get("sort")-t.get("sort")})[0]),a)return this.accommodateSinglePage(a,i.tallest),n.accommodated_by_previous_set=!0,void i.tallest.set({accommodated_pin:!0,accommodated_pid:a.get("id"),accommodated_next_set:!0})}e===this.pinCollection.deepestLevel&&(this.accommodateSinglePagebyElement($(this.getContentContainerElementToAccommodate()),i.tallest),i.tallest.set("content_accommodate_page",!0))}},this)},removeAccommodatePadding:function(){var t="padding-"+this.position;this.pinCollection.each(function(e){0<e.get("page_padding")&&(e.get("pageView").$el.css({"padding-top":"","padding-bottom":"",top:"",bottom:""}).removeAttr("data-"+t),e.set("page_padding",0))}),$("[data-"+t+"]").css(t,"").removeAttr("data-"+t),$("[data-content-accommodated]").css(t,"").removeAttr("data-content-accommodated")},accommodateSinglePage:function(e,t){var i=t.get("page_height"),o="padding-"+this.position;e.get("pageView").$el.css(o,i).attr("data-"+o,!0),e.set({page_padding:i,accommodated_by_pid:t.get("id")}),this.showBottomHiddenPin(t)},showAllBottomHiddenPins:function(){_.each(this.pinCollection.models,_.bind(function(e){e.get("pageView").$el.removeClass("bottom_pin_invisibility")},this))},showBottomHiddenPin:function(e){!0===e.get("has_image_gallery")?e.get("image_gallery_init_completed")&&e.get("pageView").$el.removeClass("bottom_pin_invisibility"):!1===e.get("has_image_gallery")&&e.get("pageView").$el.removeClass("bottom_pin_invisibility")},getContentContainerElementToAccommodate:function(){var e,t,i=$('.content_container [data-container="page"]');0<i.length&&(e=i.get(0),t=i.get(i.length-1));var o=!1,n=Cargo.View.Thumbnail;return n&&(o=Cargo.View.Thumbnail.show_thumbs),"top"==this.position?e||(o?n.el:void 0):"bottom"==this.position?o&&n?n.el:t||void 0:void 0},accommodateSinglePagebyElement:function(e,t){var i=t.get("page_height"),o="padding-"+this.position;if($(e).css(o,i).attr("data-"+o,!0).attr("data-content-accommodated",!0),void 0!==$(e).attr("data-id")){var n=_.findWhere(this.current_page_models,{id:$(e).attr("data-id")});void 0!==n&&n.set("page_padding",i)}this.showBottomHiddenPin(t)},setPagePointerEvents:function(e,t){if(e.get("pin_options").overlay){var i=t.find(".bodycopy")[0],o=this.hasNoBackgroundColor(t.find(".page_background")[0]),n=this.hasNoBackgroundColor(t.find(".page")[0]),a=void 0!==i&&parseFloat(window.getComputedStyle(t.find(".bodycopy")[0]).height)>window.innerHeight;if(!t.find(".page_background")[0])return;0==e.get("backdrop_enabled")&&(o?t.addClass("pointer-events-none"):t.removeClass("pointer-events-none"),n&&!a||!e.get("pin_options").fixed?t.find(".page").removeClass("pointer-events-auto"):t.find(".page").addClass("pointer-events-auto")),a&&e.get("pin_options").fixed?t.find(".page").addClass("allow-scroll"):t.find(".page").removeClass("allow-scroll")}},hasNoBackgroundColor:function(e){if(null==e)return!1;var t=window.getComputedStyle(e,null).getPropertyValue("background-color"),i=t.match("rgba")?alpha=t.replace(/^.*,(.+)\)/,"$1"):null;return null==t||"transparent"==t||"initial"==t||0==i},getPageDepthByPid:function(e){return this.pinCollection.findWhere({id:parseInt(e)}).get("depth")}}),Cargo.o.view.SiteMenu=Backbone.View.extend({template:$('[type="text/x-handlebars-template"]#sitemenu').html(),events:{'click [rel="history"]':"navigate",'click [rel="home_page"]':"navigateHome",click:"close",touchstart:"close","click .close":"hide"},enabled:null,initialize:function(e){Cargo.Event.on("content_load_complete",_.bind(this.hide,this)),Cargo.Event.on("homepage_loaded",_.bind(this.hide,this)),this.collection.fetch()},generateSiteMenuTree:function(){var e=Cargo.Collection.Scaffolding.getSetStructure(),t=this.collection.toJSON();for(_.each(e._byId,function(e){e.in_nav=void 0!==_.findWhere(t,{id:e.id}),e.has_children=!1}),i=0;i<t.length;i++)menuItem=t[i],"set"===menuItem.type?0<i&&(e._byId[menuItem.id].previous_type=t[i-1].is_set?"set":"page"):e._byId[menuItem.set_id]&&(e._byId[menuItem.set_id].has_children=!0,e._byId[menuItem.set_id].pages.push(menuItem));_.each(e._byId,function(e){e.pages.sort(function(e,t){return e.sort-t.sort})}),this.SiteMenuTree=e.tree,e=null},render:function(e){this.SiteMenuTree||this.generateSiteMenuTree(),this.site_menu_options=Cargo.Model.DisplayOptions.get("site_menu_options");var t=this.site_menu_options.display_type;if("page"!=t){var i=Cargo.API.GetDataPackage("site_menu_tree",this.SiteMenuTree);i=_.extend(i,{is_page:t});var o=Cargo.Core.Handlebars.Render(this.template,i);return $("#site_menu_panel_container",this.el).empty().show().html(o),$("html").addClass("no-scroll"),this.delegateEvents(),this.setActivePage(),this}},isActive:function(){return this.enabled},renderSinglePageView:function(t){var i=$("#site_menu_panel_container")[0];if(i){var e=Cargo.Core.PageviewFactory.constructPageView({model:t});i.innerHTML="",i.appendChild(e.el),i.style.display="",e.render(),e.$el.on("click",function(e){0==$(e.target).closest('[data-container="content"]').length&&0==t.get("backdrop_enabled")&&(i.style.display="none")})}},setActivePage:function(e){Cargo.Helper.IsOnHomepage()&&$('[rel="home_page"]',this.el).addClass("active");var t=Cargo.Helper.GetCurrentProjectUrl();$('[href="'+t+'"]',this.el).addClass("active")},show:function(e,t){var i;void 0!==e?(e.preventDefault(),i=$(e.currentTarget)):void 0!==t&&(i=t);var o=Cargo.Model.DisplayOptions.get("site_menu_options");if(void 0!==i&&i.is("#site_menu_button")&&i[0].hasAttribute("href"))"/"!==i.attr("href")?(Cargo.Event.trigger("add_history",i.attr("href")),this.enabled=!0):Cargo.Modal.Alert({message:"Page Not Found"});else{if("page"==o.display_type)return Cargo.Event.trigger("add_history",o.single_page_id),void(this.enabled=!0);$("#site_menu_button",this.el)[0].style.display="none",this.render(e),$("body")[0].style.overflow="hidden",this.enabled=!0}},hide:function(){var e=Cargo.Model.DisplayOptions.get("site_menu_options");$("#site_menu_panel_container",this.el)[0].style.display="none","page"===e.display_type&&e.single_page_id==parseInt(Cargo.Helper.GetCurrentProjectId())?setTimeout(_.bind(function(){this.enabled=!0,$("#site_menu_button",this.el)[0].style.display="none"},this),1):(this.enabled=!1,$("#site_menu_button",this.el)[0].style.display=""),$("body")[0].style.overflow=""},close:function(e){"site_menu_panel"==$(e.target).attr("id")&&this.hide()},navigate:function(e){Cargo.View.Main.HistoryPush(e),this.isActive()&&this.hide()},navigateHome:function(e){Cargo.View.Main.ShowHome(e),this.hide()},updateTitle:function(e,t){"page"==Cargo.Model.DisplayOptions.get("site_menu_options").display_type&&$("#site_menu_button",this.el).attr("href",t)},changeDisplayType:function(e,t,i){$("[data-type]",this.el).attr("data-type",e),this.$el.attr("data-type",e),"cargo_menu"==e?$("#site_menu_button",this.el).removeAttr("href"):this.UpdateSinglePageLink(t)},UpdateSinglePageLink:function(e){var t=Cargo.Collection.Scaffolding.getSetOrPageModel({id:Number(e)},!1);if(t)$("#site_menu_button",this.el).attr("href",t.get("project_url"));else{var i=this;Cargo.Collection.Scaffolding.fetchPageModel(e,{done:function(e,t){$("#site_menu_button",i.el).attr("href",e.get("project_url"))}})}}}),Cargo.o.view.Following=Backbone.View.extend({className:"persona-following-root",fauxFixedElements:[],animationDuration:600,animationInProgress:!1,followingWidth:"400px",enabled:!1,iframeLoadInitialized:!1,iframeLoaded:!1,section:!1,slideData:{delta:1,offset:0,lastOffset:0,closing:!0},initialize:function(){this.isInAdminOrPreviewMode=Cargo.Helper.IsAdminPath()||Cargo.Helper.IsAdminEdit()||Cargo.Helper.IsPresetPreview(),this.messageQueue=[],this.contentFrame=document.createElement("iframe"),this.contentFrame.id="following-frame",this.contentFrame.style.display="none",this.contentFrame.style.border="none",this.contentFrame.name="following-frame",this.followingOverlay=document.createElement("div"),this.followingOverlay.id="following-overlay",this.followingOverlay.style.display="none",this.followingOverlay.style.cursor="pointer",this.followingOverlay.style.position="fixed",this.followingOverlay.style.top=0,this.followingOverlay.style.left=0,this.followingOverlay.style.right=0,this.followingOverlay.style.bottom=0,this.followingOverlay.style.zIndex=2147483637,this.followingOverlay.addEventListener("click",_.bind(this.close,this)),document.body.appendChild(this.followingOverlay),document.documentElement.appendChild(this.render().el);var e=document.createElement("div");e.id="following-container",this.el.parentNode.insertBefore(e,this.el),e.appendChild(this.el),this.container=$(e),this.contentFrame=$(this.contentFrame),/^\/?follow/.test(document.location.pathname)||/^\/?contact-form/.test(document.location.pathname)||/^\/?cart/.test(document.location.pathname)||!1===Cargo.Helper.isMobile()&&$(window).load(_.bind(function(){setTimeout(_.bind(function(){this.iframeLoadInitialized||this.loadFrameSection()},this),5e3)},this))},render:function(){return this.setElement(this.contentFrame),this},triggerEventInFrame:function(e,t){if(this.messageQueue)return this.iframeLoaded&&this.el.contentWindow&&this.el.contentWindow.Following?void this.el.contentWindow.Following.Events.trigger(e,t):(this.iframeLoadInitialized||this.loadFrameSection(),void this.messageQueue.push(arguments))},Toggle:function(){if(!0!==this.animationInProgress)if(this.enabled)(null==Cargo.Router.previousSiteRoute||Cargo.Router.previousSiteRoute.match(/following/g)||Cargo.Router.previousSiteRoute.match(/followers/g)||Cargo.Router.previousSiteRoute.match(/contact-form/g)||Cargo.Router.previousSiteRoute.match(/cart/g))&&(Cargo.Router.previousSiteRoute="/"),Cargo.Router.navigate(Cargo.Router.previousSiteRoute,{trigger:!1}),this.disable();else{Cargo.Event.trigger("add_history","following");var e=parent.document.getElementById("login_frame");null!==e&&e.parentNode.removeChild(e)}},loadSection:function(e,t){this.enabled||this.enable(t),this.loadFrameSection(e,t)},loadFrameSection:function(e,t){this.isInAdminOrPreviewMode&&!0!==t||(!0!==this.iframeLoadInitialized?($(this.contentFrame).on("load",_.bind(function(){this.iframeLoaded=!0,0<this.messageQueue.length&&this.el.contentWindow.Following.Events.on("init-complete",function(){_.each(this.messageQueue,function(e){this.triggerEventInFrame.apply(this,e)},this),this.messageQueue=[]},this)},this)),this.contentFrame.attr("src","/followingframe/"+Cargo.Helper.GetUrl()+("string"==typeof e?"/"+e:"")+"?"+__cargo_js_ver__),this.iframeLoadInitialized=!0):this.el.contentWindow&&void 0!==this.el.contentWindow.Following&&void 0!==this.el.contentWindow.Following.View&&void 0!==this.el.contentWindow.Following.View.Main?(null==e&&void 0!==this.el.contentWindow.Following.View.Main.start_route&&(e=this.el.contentWindow.Following.View.Main.start_route),this.el.contentWindow.Following.Router.navigate(e,{trigger:!0,replace:!0})):this.contentFrame.attr("src","/followingframe/"+Cargo.Helper.GetUrl()+("string"==typeof e?"/"+e:"")+"?"+__cargo_js_ver__))},updateCookieData:function(){this.el.contentWindow&&void 0!==this.el.contentWindow.Following&&this.el.contentWindow.Following.Model.Default.fetch()},resizeListener:function(e){var t=document.getElementsByTagName("html")[0],i=window.innerWidth+"px",o=window.innerHeight+"px";!0===e&&(o=i=""),t.style.width=i,t.style.height=o,document.body.style.width=i,document.body.style.height=o,500<$(window).width()?this.followingWidth="400px":this.followingWidth=$(window).width()-40+"px",this.enabled&&(document.body.style.setProperty("transform","translateX(-"+this.followingWidth+")"),document.body.style.setProperty("-webkit-transform","translateX(-"+this.followingWidth+")")),$("#following-container").css({width:this.followingWidth,height:o})},enable:function(e){if((!this.isInAdminOrPreviewMode||!0===e)&&!0!==this.animationInProgress){document.body,document.getElementsByTagName("html")[0];if(this.fixedElements=this.getFixedElements(),$('<div id="following-container-overlap" />').insertAfter(this.$el.parent()),this.animationInProgress=!0,this.scrollAnchor=document.createElement("div"),this.scrollPos=window.scrollY,this.inlineStyles=document.createElement("style"),this.tempInlineStyles=document.createElement("style"),this.scrollAnchor.style.position="absolute",this.scrollAnchor.style.width="0px",this.scrollAnchor.style.height="0px",this.scrollAnchor.style.top=this.scrollPos+"px",document.body.appendChild(this.scrollAnchor),document.body.appendChild(this.tempInlineStyles),document.body.appendChild(this.inlineStyles),Cargo.Router.is_first_route)return this.direct_route=!0,this.prepareElementsForAnimation(),void this.realEnable();window.requestAnimationFrame(_.bind(function(){this.prepareElementsForAnimation(),window.setTimeout(_.bind(function(){window.requestAnimationFrame(_.bind(this.realEnable,this))},this),150)},this))}},prepareElementsForAnimation:function(){var e=document.body,t=document.getElementsByTagName("html")[0];this.tempInlineStyles.sheet.insertRule(".backdrop > div > * { \t-webkit-transform: translateZ(0);\t\t\ttransform: translateZ(0);}",0),e.style.setProperty("z-index","1"),e.style.setProperty("transform","translateZ(0)"),e.style.setProperty("-webkit-transform","rotateZ(0)"),e.style.setProperty("min-height",window.innerHeight+"px"),t.style.setProperty("transform","translateZ(0)"),t.style.setProperty("-webkit-transform","rotateZ(0)"),t.style.setProperty("min-height",window.innerHeight+"px"),this.container.css({transform:"translateX("+this.followingWidth+")","-webkit-transform":"translateX("+this.followingWidth+")"}),this.contentFrame.css({transform:"translateX(-"+this.followingWidth+")","-webkit-transform":"translateX(-"+this.followingWidth+")"}),this.resizeListener(),this.fixFixedElements(this.fixedElements),this.fixedElements=void 0,e.style.setProperty("position","fixed"),e.style.setProperty("overflow","hidden"),t.style.setProperty("position","fixed"),t.style.setProperty("overflow","hidden"),setTimeout(_.bind(function(){this.resizeListener()},this),150),this.scrollAnchor.scrollIntoView()},realEnable:function(){this.triggerEventInFrame("frame-animation-starting",{});var a=this;this.inlineStyles.sheet.insertRule("#following-container { \twidth: "+this.followingWidth+";\theight: 100%;\tposition: absolute;\ttop: 0;\tbottom: 0;\tright: 0;}",0),this.scrollAnchor.scrollIntoView(),this.resizeListener=_.bind(this.resizeListener,this),window.addEventListener("resize",this.resizeListener,!1),this.scrollAnchor.parentNode.removeChild(this.scrollAnchor),this.scrollAnchor=void 0;var e=this.direct_route?0:a.animationDuration;try{null!==this.contentFrame[0].contentWindow.document.body&&(this.contentFrame[0].contentWindow.document.body.style.display="none",setTimeout(function(){a.contentFrame[0].contentWindow.document.body.style.display="block"}))}catch(e){console.info(e)}$("body, #following-container-overlap").velocity({translateX:"-"+a.followingWidth,translateZ:0},{duration:e,easing:[29,9],complete:function(){a.enabled=!0,a.animationInProgress=!1,a.enableClickToClose(),a.tempInlineStyles.sheet.disabled=!0,a.direct_route=!1,_.each(Cargo.Plugins.elementResizer.targets(),function(e){_.each(e.children,function(e){e&&e.element&&e.element[0]._scrollWatcher&&!e.element[0].hasAttribute("src")&&e.element[0]._scrollWatcher.recalculateLocation()})}),scrollMonitor.update(),$("#following-container-overlap").remove()}}),this.container.velocity({translateX:[0,parseInt(this.followingWidth)],tween:[0,1]},{duration:e,easing:[29,9],progress:function(e,t,i,o,n){n<0&&a.container.css({transform:"translateX(0px)","-webkit-transform":"translateX(0px)"})}}),this.contentFrame.velocity({translateX:[0,-parseInt(this.followingWidth)],tween:[0,1]},{duration:e,easing:[29,9],progress:function(e,t,i,o,n){n<0&&a.contentFrame.css({transform:"translateX(0px)","-webkit-transform":"translateX(0px)"})}}),this.el.style.display=""},enableClickToClose:function(){this.followingOverlay.style.display="block"},disableClickToClose:function(){this.followingOverlay.style.display="none"},slideStart:function(e){$(window).on("mousemove touchmove",{slideData:this.slideData,slideEnd:_.bind(this.slideEnd,this),offset:e.clientX,width:this.followingWidth},this.slideMove)},slideMove:function(e){e.preventDefault();var t=e.data.slideData,i=0,o=parseInt(e.data.width),n=o-(i=event.touches?event.touches[0].clientX-e.data.offset:e.clientX-e.data.offset);t.delta=1-Math.abs(i-t.offsetLast)/30*1,t.delta<.3?t.delta=.3:1<t.delta&&(t.delta=1),i<0?n=o:n<0&&(n=0,e.data.slideEnd()),$("body, #following-container-overlap").velocity("stop").velocity({translateX:-1*n},1),t.closing=i>=t.offsetLast,t.offsetLast=i},slideEnd:function(e){this.slideData.closing?this.close():$("body, #following-container-overlap").velocity("stop").velocity({translateX:"-"+this.followingWidth,translateZ:0},{duration:this.animationDuration*this.slideData.delta,easing:[29,9]}),$(window).off("mousemove touchstart",this.slideMove),this.slideData.closing=!0,this.slideData.offsetLast=0,this.slideData.delta=1},close:function(){this.Toggle()},disable:function(){window.requestAnimationFrame(_.bind(this.realDisable,this))},realDisable:function(){if(!0!==this.animationInProgress){this.animationInProgress=!0,window.focus(),void 0!==this.el.contentWindow.Following&&this.el.contentWindow.Following.Events.trigger("disable");var i=this;this.tempInlineStyles&&this.tempInlineStyles.sheet&&(this.tempInlineStyles.sheet.disabled=!1),$("body, #following-container-overlap").velocity({translateX:0,translateZ:0},{begin:function(){$(this).css("cursor","auto")},duration:this.animationDuration*this.slideData.delta,easing:[25,8.5],complete:function(){i.enabled=!1,i.animationInProgress=!1,$(this).css({transform:"","-webkit-transform":""}),i.unfixFixedElements(),void 0!==i.inlineStyles&&(i.inlineStyles.sheet.disabled=!0,i.inlineStyles.parentNode.removeChild(i.inlineStyles)),void 0!==i.tempInlineStyles&&(i.tempInlineStyles.sheet.disabled=!0,i.tempInlineStyles.parentNode.removeChild(i.tempInlineStyles));var e=document.body,t=document.getElementsByTagName("html")[0];e.style.setProperty("z-index",""),e.style.setProperty("transform",""),e.style.setProperty("-webkit-transform",""),e.style.setProperty("min-height",""),t.style.setProperty("transform",""),t.style.setProperty("-webkit-transform",""),t.style.setProperty("min-height",""),e.style.setProperty("position",""),e.style.setProperty("overflow",""),t.style.setProperty("position",""),t.style.setProperty("overflow",""),i.resizeListener(!0),window.scrollTo(0,i.scrollPos),window.removeEventListener("resize",i.resizeListener,!1),i.disableClickToClose(),i.el.style.display="none"}}),this.container.velocity({translateX:[parseInt(this.followingWidth),0]},{duration:this.animationDuration*this.slideData.delta,easing:[25,8.5]}),this.contentFrame.velocity({translateX:[-parseInt(this.followingWidth),0]},{duration:this.animationDuration*this.slideData.delta,easing:[25,8.5]})}},isActive:function(){return this.enabled},getFixedElements:function(e){void 0===e&&(e=window.document);var t,i,o,n,a,r,s,l=['[style*="position:fixed"],[style*="position: fixed"]'],d=/\bposition:\s*fixed;/,c=e.styleSheets,h=[];for(i=0;i<c.length;i++){try{a=c[i].cssRules}catch(e){continue}if(null!==a)for(n=a.length,o=0;o<n;o++)r=a[o],d.test(r.cssText)&&null!=r.selectorText&&l.push(r.selectorText)}for(l=l.join(","),n=(l=e.querySelectorAll(l)).length,i=0;i<n;i++)s=l[i],"fixed"===(t=window.getComputedStyle(s,null)).getPropertyValue("position")&&h.push({el:s,offset:{left:isNaN(parseInt(t.getPropertyValue("left")))?0:parseInt(t.getPropertyValue("left")),top:isNaN(parseInt(t.getPropertyValue("top")))?0:parseInt(t.getPropertyValue("top"))},webkitTransformMatrix:"none"===t.getPropertyValue("-webkit-transform")?"":t.getPropertyValue("-webkit-transform"),transformMatrix:"none"===t.getPropertyValue("transform")?"":t.getPropertyValue("transform"),styleAttribute:s.getAttribute("style")});return h},fixFixedElements:function(e){var t=this;this.unfixFixedElements();var i={top:$(window).scrollTop(),left:$(window).scrollLeft()};lastScrollPos=i.top,void 0===e&&(e=this.getFixedElements()),Cargo.Helper.isEdge()&&(i.top=0),this.scrollOffset=i,e.forEach(function(e){e.el.style.setProperty("transform","translateY("+i.top+"px) "+e.transformMatrix,"important"),e.el.style.setProperty("-webkit-transform","translateY("+i.top+"px) "+e.webkitTransformMatrix,"important"),e.el.style.setProperty("transition","none","important"),e.el.style.setProperty("-webkit-transition","none","important"),t.fauxFixedElements.push(e)})},unfixFixedElements:function(){this.fauxFixedElements.forEach(function(e){e.el.style.removeProperty("transform"),e.el.style.removeProperty("-webkit-transform"),setTimeout(function(){null===e.styleAttribute||""===e.styleAttribute?e.el.removeAttribute("style"):e.el.setAttribute("style",e.styleAttribute)},1)}),this.scrollOffset=void 0,this.fauxFixedElements=[]}}),Cargo.o.view.FollowingButton=Backbone.View.extend({initialize:function(){var t=this;if(!0!==Cargo.Helper.IsAdminPath())return Cargo.API.Config.preview||Cargo.Helper.IsAdminEdit()?($.get("/dispatch/auth/getFollowingToolset",function(e){e.html&&$("body").prepend(e.html)},"json"),!1):void $.getJSON(Cargo.Helper.GetAuthDomain()+"/dispatch/auth/followingAuth/"+Cargo.Helper.GetUrl()+"?callback=?",function(e){!0!==Cargo.InspectorLoading&&($.post("/dispatch/auth/followingAuthLocal",{token:e.jdata.token,url:e.jdata.url,muid:e.jdata.muid,cv:e.jdata.cv},function(e){t.InitFollowingClick(),t.Init(e.jdata)},"json"),e.html&&($("body").prepend(e.html),t.InitFollowingClick(),t.Init(e.jdata)))})},InitFollowingClick:function(){Cargo.Helper.IsAdminBackdrop()?$("#toolset a",this.el).attr("href",Cargo.Model.Site.get("home_url")).attr("target","_top"):parent===window?$("#toolset_follow a").off().on("click",function(e){if(e.preventDefault(),$(this).closest("#toolset_follow").hasClass("noclick"))return!1;Cargo.View.Following.Toggle()}):$("#toolset_follow",this.el).addClass("noclick")},Init:function(e){Cargo.API.Config.cookie_url=e.cookie_url,Cargo.API.Config.cookie_link=e.cookie_link,Cargo.API.Config.cookie_site_count=e.cookie_site_count,"object"==typeof Cargo.View.Following&&"object"==typeof Cargo.View.Following.el&&Cargo.View.Following.updateCookieData()}}),Cargo.o.view.Thumbnail=Backbone.View.extend({name:"Thumbnail",isEditing:!1,Subview:!1,MobileSubview:!1,PageModel:!1,ContentModel:!1,templates:{},template:$('[type="text/x-handlebars-template"]#thumbnail').html(),initialize:function(){return this.model||(this.model=Cargo.Model.ThumbnailSettings),Cargo.Event.on("mobile_size",_.bind(this.checkSizeAndActivateView,this)),Cargo.Event.on("content_load_complete",_.bind(function(e){this.checkAndLoadThumbnails(e)},this)),Cargo.Event.on("homepage_loaded",this.checkAndLoadThumbnails,this),Cargo.Event.on("thumbnails:load_tag",function(e,t){var i;t?(isNaN(Number(t))||(i=Cargo.Collection.Scaffolding.getSetOrPageModel({id:Number(t)})),i||(i=Cargo.Collection.Scaffolding.getModelByPurl(t)),i&&(t=i.get("id")),this.ContentModel=i,this.loadThumbnailsFor(void 0,{set_id:t,tags:e})):this.checkAndLoadThumbnails(void 0,{tags:e})},this),this.show_thumbs=null,this},events:{dragstart:"dragstart"},dragstart:function(e){if(Cargo.API.Config.cookie_url&&e.target.nodeType===Node.ELEMENT_NODE&&"IMG"===e.target.nodeName&&e.target.hasAttribute("data-mid")){var t=parseInt($(e.target).closest("[data-id]").attr("data-id"));if(!isNaN(t)){var i=this.collection.findWhere({id:t});if(i.get("thumb_meta")&&i.get("thumb_meta").thumbnail_crop){var o=new Cargo.o.model.image(i.get("thumb_meta").thumbnail_crop.imageModel);if(o&&0==/(.*?)\.(svg)$/g.test(o.getOriginalImage().url)){var n={drag_image_src:e.target.getAttribute("src"),image_url:o.getOriginalImage().url,source_url:window.location.origin+i.get("url"),source_title:i.get("title")+" - "+Cargo.Model.Site.GetWebsiteTitle(),tags:""===i.get("tags")?[]:i.get("tags").split(", "),excerpt:i.get("excerpt")};e.dataTransfer.setData("cargo/imageselection",JSON.stringify(n))}}}}},requestTemplate:function(e,t){this.listenTo(Cargo.Event,"template_loaded",this.checkTemplate),this.listenTo(Cargo.Event,"content_load_complete",this.setActiveThumb);var i=e||this.model.get("name"),o=t||this.model.getTemplatePath();if(this.templates[i]=Cargo.Template.Get(i,o),this.templates.Thumbnail=Cargo.Template.Get("Thumbnail"),_.contains(this.templates,void 0))return this;this.stopListening(Cargo.Event,"template_loaded");var n=this.model.get("data").mobile_data;return n&&n.separate_mobile_view&&this.model.get("data").responsive&&Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth)?this.setupMobile():this.setup(),this},checkTemplate:function(e){if(!(e in this.templates))return this;if(this.templates[e]=Cargo.Template.Get(e),_.contains(this.templates,void 0))return this;this.stopListening(Cargo.Event,"template_loaded");var t=this.model.get("data").mobile_data;return t&&t.separate_mobile_view&&this.model.get("data").responsive&&Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth)?this.setupMobile():this.setup(),this},setup:function(){this.addEventListeners();var e=Cargo.Collection.ThumbnailModes.findWhere({mode_id:this.model.get("mode_id")});return e&&require(["/_jsapps/thumbnails/"+e.get("path")+"/main.js"],_.bind(this.setupSubView,this)),this},setupMobile:function(){if(this.addEventListeners(),this.MobileSubview)this.render(this.MobileSubview);else{if(require.defined("!text")||Backdrop.Data.require_loaded){var e=this.model.get("data").mobile_data;return require(["text!/_jsapps/thumbnails/"+e.mobile_design_path+"/defaults.json","/_jsapps/thumbnails/"+e.mobile_design_path+"/main.js"],_.bind(this.setupMobileSubView,this)),this}_.delay(_.bind(this.setupMobile,this),100)}},activateMobile:function(){this.model.set("mobile_active",!0,{changing:"mobile_active"});var e=this.model.get("data").mobile_data;if(e&&e.separate_mobile_view&&e.mobile_design_path&&this.model.get("data").responsive){var t=e.mobile_design_path,i=this.model.getTemplatePath(t);this.templates&&this.templates[t.toCamel(!0)]?this.setupMobile():this.requestTemplate(t.toCamel(!0),i)}else e&&(this.templates&&this.templates[this.model.get("name")]||this.requestTemplate());return this},activateNormal:function(){if(this.model.set("mobile_active",!1,{changing:"mobile_active"}),!this.MobileSubview||!this.templates[this.model.get("name")])return this.templates&&this.templates[this.model.get("name")]||this.requestTemplate(),this;this.setup()},addEventListeners:function(){return this.stopListening(Cargo.Event,"inline-editor-destroy-complete"),this.stopListening(this.model,"change"),!1!==this.PageModel&&this.stopListening(this.PageModel,"change"),this.stopListening(this.collection,"sync"),this.listenTo(this.collection,"sync",this.checkCollectionLengthAndSize),this.listenTo(Cargo.Event,"inline-editor-destroy-complete",function(){this.checkAndLoadThumbnails(Cargo.Helper.GetCurrentProjectId())},this),this.listenTo(this.model,"change",this.handleUpdates),!1!==this.PageModel&&this.listenTo(this.PageModel,"change",this.handleUpdates),this},setResponsive:function(){this.model.get("mobile_active")&&this.model.get("data").responsive?this.el.setAttribute("responsive-layout",""):this.el.removeAttribute("responsive-layout")},checkCollectionLengthAndSize:function(e,t,i){var o=!1;i&&i.params&&void 0!==i.params.page_id&&i.params.page_id!==this.currentPageID&&(o=!0),i=i||{},0<this.collection.length?(i&&i.from_thumbnail_reseed&&!1===this.show_thumbs||o||this.showThumbs(),this.checkSizeAndActivateView(Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth)),this.checkPagination(),_.defer(function(){Cargo.Plugins.elementResizer.refresh()})):o||this.hideThumbs()},checkSizeAndActivateView:function(e,t){e&&this.model.get("data").responsive?this.model.get("mobile_active")&&this.MobileSubview.inited||this.activateMobile():!this.model.get("mobile_active")&&this.Subview.inited||this.activateNormal()},hideThumbs:function(){return this.Subview&&"function"==typeof this.Subview.hideThumbs&&this.Subview.hideThumbs(),this.show_thumbs=!1,this.el.style.display="none",Cargo.Event.trigger("thumbnails_hide"),this},showThumbs:function(){return this.Subview&&"function"==typeof this.Subview.showThumbs&&this.Subview.showThumbs(),this.show_thumbs=!0,this.el.style.display="",Cargo.Event.trigger("thumbnails_show"),this},setActiveThumb:function(e){var t=this.el.querySelector(".thumbnail.active"),i=this.el.querySelector('[data-id="'+e+'"].thumbnail');t&&t.getAttribute("data-id")!=e&&$(t).removeClass("active"),$(i).addClass("active")},handleUpdates:function(e,t){var i;if("page"===e.type){if(this.PageModel&&this.PageModel!==e)return;i=_.clone(e.getPageOption("thumbnail_options")),this.PageModel=e,this.ContentModel=e}else i=_.clone(this.model.get("data"));if(i){switch("filter_type"==t.changing&&"page"===e.type&&("tag"==t.value?setTimeout($.proxy(function(){e.setThumbnailOption("filter_tags",i.filter_tags)},this),100):"set"==t.value&&setTimeout($.proxy(function(){e.setThumbnailOption("filter_set",i.filter_set)},this),100)),t.changing){case"thumb_meta":this.setup();break;case"show_thumbs":case"show_local_thumbs":!0===t.value?this.checkAndLoadThumbnails(void 0,i):this.hideThumbs();break;case"thumbnail_mode":this.requestTemplate();break;case"mobile_active":case"responsive":this.setResponsive(),this.checkSizeAndActivateView(Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth));break;case"filter_set":case"filter_tags":case"filter_type":case"random_limit":this.checkAndLoadThumbnails(void 0,i);break;default:this.ContentModel&&this.PageModel&&this.checkAndLoadThumbnails(this.PageModel.get("id"),this.PageModel.getPageOption("thumbnail_options"))}if(this.MobileSubview&&this.model.get("mobile_active")&&t&&this.model.get("data").responsive&&(t.mobile?i.mobile_data[t.mobile]=t.value:t.changing&&(i[t.changing]=t.value),i.show_thumbs||i.show_local_thumbs&&!i.show_thumbs)){var o=this.MobileSubview.model.get("data"),n=_.extend(o,i);this.MobileSubview.model.set("data",n,{silent:!0,changing:t.changing,value:t.value}),this.MobileSubview.handleUpdates(null,{changing:t.changing,value:t.value})}return this}},setupSubView:function(e){return this.Subview&&this.Subview.remove(),this.Subview=new e({model:this.model,collection:this.collection,parentView:this}),this.render(this.Subview),this.Subview.inited=!0,this},setupMobileSubView:function(e,t){this.MobileSubview&&this.MobileSubview.remove();var i=JSON.parse(e);_.extend(i,this.model.get("data"));var o=Cargo.Collection.ThumbnailModes.findWhere({path:i.mobile_data.mobile_design_path}),n=new Cargo.o.model.thumbnailsettings;return n.set({page_id:this.model.get("page_id"),site_id:this.model.get("site_id"),mobile_active:this.model.get("mobile_active"),mode_id:o.get("mode_id"),name:o.get("name"),path:o.get("path"),data:i}),this.MobileSubview=new t({model:n,collection:this.collection,parentView:this}),this.render(this.MobileSubview),this.MobileSubview.inited=!0,this},render:function(e){if(!this.canRender())return this;e||(e=this.Subview),this.setResponsive(),Handlebars.registerPartial("thumbnail_subview","");var t=Cargo.Template.Get("Thumbnail"),i=Cargo.Core.Handlebars.Render(t,{});this.$el.html(i);var o=this.$el.find(".thumbnails");return o.empty(),o.replaceWith(e.$el),e.render(),this.el._thumb_pagination_watcher||(Cargo.Event.on("thumbnail_pagination_complete",function(e,t,i){scrollMonitor.update(),this.checkPagination()},this),this.el._thumb_pagination_watcher=scrollMonitor.create(this.el,{bottom:2*-screen.height}),this.el._thumb_pagination_watcher.partiallyExitViewport(_.bind(function(){setTimeout(_.bind(this.checkPagination,this))},this)),this.checkPagination()),this},checkPagination:function(){!0===this.show_thumbs&&this.el._thumb_pagination_watcher&&!this.el._thumb_pagination_watcher.isBelowViewport&&this.collection.paginate()},canRender:function(){return!(_.contains(this.templates,void 0)||!Cargo.Collection.ThumbnailModes.length)},checkAndLoadThumbnails:function(e,t){var i,o,n=Cargo.Helper.GetPageViewById(e),a=this.ContentModel;if(this.ContentModel=Cargo.Collection.Scaffolding.getModel({id:e}),this.PageModel=!!n&&n.model,this.currentPageID=e,!Cargo.API.Config.direct_link_pid||!this.ContentModel||this.ContentModel!==a){if(!this.ContentModel)if($("script[data-set='FirstloadThumbOptions']").html()&&(o=$.parseJSON($("script[data-set='FirstloadThumbOptions']").html())),o)0===o.length&&(o=void 0);else{var r=Cargo.Collection.Tags.findTagByUrl(e);if(r)o={tags:r.get("url")};else if(_.isUndefined(t)&&!this.model.get("data").show_thumbs)return}if($("script[data-set='FirstloadThumbOptions']").remove(),!this.ContentModel&&_.isUndefined(t)&&(!o||_.size(o)<=1)&&!this.model.get("data").show_thumbs)return this.hideThumbs(),void this.addEventListeners();this.ContentModel&&("set"==this.ContentModel.type?(i=this.ContentModel.get("thumbnail_options"),o=void 0):void 0!==this.ContentModel.type&&!0!==this.ContentModel.get("pin")&&!(i=this.ContentModel.getPageOption("thumbnail_options"))&&o&&(o.use_global_thumb_settings=!0));var s=_.clone(o||(t||i));this.loadThumbnailsFor(e,s),this.addEventListeners()}},loadThumbnailsFor:function(e,t){var i;if(t)i=t.use_global_thumb_settings?_.clone(this.model.get("data")):t;else if((i=_.clone(this.model.get("data"))).show_thumbs){var o,n=Cargo.Collection.Scaffolding.getModel({id:e});if(n&&0!==n.get("id"))(o=Cargo.Collection.Tags.findTagByUrl(n.get("project_url")))?(console.log("thumb index: tag/set url collision"),n&&n.get("is_set")?i.set_id=n.get("id"):"bdif"!==Cargo.API.Config.cargo_url&&(i.show_thumbs=!1)):n&&n.get("is_set")&&!n.get("stack")&&(i.set_id=n.get("id"));else(o=Cargo.Collection.Tags.findTagByUrl(e))&&(i.tags=o.get("url"))}if(void 0!==i.show_local_thumbs&&(i.show_thumbs=i.show_local_thumbs),!1===i.show_thumbs)this.hideThumbs();else{var a=this.collection.fetch({params:this.getCollectionSettingsForOptions(e,i),reset:!0,success:_.bind(function(e,t){this.checkCollectionLengthAndSize.apply(this,arguments)},this)});a&&a.readyState!==XMLHttpRequest.DONE&&(this.el.style.visibility="hidden",Cargo.View.PinnedBottom.el.style.visibility="hidden",a.always(_.bind(function(){this.el.style.visibility="",Cargo.View.PinnedBottom.el.style.visibility=""},this)))}},getCollectionSettingsForOptions:function(e,t){var i={tags:void 0,page_id:void 0,set_id:void 0,random_limit:void 0,force_all:void 0};return t&&(t.tags||t.set_id?(i.tags=t.tags,i.set_id=t.set_id):"set"==t.filter_type?i.set_id=t.filter_set:"tag"==t.filter_type?i.tags=t.filter_tags:"random"==t.filter_type?(i.page_id=e,i.random_limit=parseInt(t.random_limit),isNaN(i.random_limit)&&(i.random_limit=10)):"all"==t.filter_type?(i.page_id=e,i.force_all=!0):i.page_id=e),i},updateIsEditing:function(e){this.isEditing=e==this.model.get("name"),this.trigger("is_editing",this.isEditing)},getIsEditing:function(){return this.isEditing},getActiveSubView:function(){return this.model.get("mobile_active")&&this.MobileSubview&&this.model.get("data").responsive?this.MobileSubview:this.Subview},updateThumbnailCrop:function(e,t,i){var o=this.collection.findWhere({id:e});if(o){if(o.set("thumb_meta",{thumbnail_crop:t},{silent:!0}),i)return void this.handleUpdates(o,{changing:"thumb_meta"});if(i)return;var n=this.el.querySelector('[data-id="'+e+'"].thumbnail img');n&&("function"==typeof t.imageModel.get?(n.setAttribute("width",t.imageModel.get("width")),n.setAttribute("height",t.imageModel.get("height"))):(n.setAttribute("width",t.imageModel.width),n.setAttribute("height",t.imageModel.height)),i?Cargo.Plugins.elementResizer.refresh():(n.style.width=t.percentWidth+"%",n.style.marginLeft=t.marginLeft+"%",n.style.marginTop=t.marginTop+"%",Cargo.Plugins.elementResizer.update()))}}}),Cargo.o.view.TemplateButton=Backbone.View.extend({data:{creating:!1},el:"body",events:{"click .new_site_button":"confirmCreate","mouseover .new_site_button":"showFull","mouseout .new_site_button":"hideFull"},enabled:null,is_inframe:!1,initialize:function(e){Cargo.API.Config.is_template&&(parent==window?this.render():($("body").addClass("template_site_inframe"),this.is_inframe=!0)),window.addEventListener("message",this.onPostMessage,!1)},render:function(e){var t=this,i=Cargo.Core.Handlebars.Render('<div class="new_site_button_wrapper"><div class="new_site_button"><div class="text">Make a site with this Template</div><div class="plus"><svg id="plus_makesite" x="0px" y="0px" viewBox="0 0 44 44" style="enable-background:new 0 0 44 44;"><defs><mask id="specialMask"><rect x="0" y="0" width="100%" height="100%" fill="#fff"></rect><g id="specialOrderText" fill="#000000"><line class="cls-3" x1="10" x2="34" y1="22" y2="22"/><line class="cls-3" y1="10" y2="34" x1="22" x2="22"/></g></mask></defs><g class="masked" style="mask: url(\'#specialMask\');"><g id="transform-rect"><rect id="rect" x="0" y="0" width="44" height="44" style="fill: #0fce83;"></rect></g></g></svg></div></div></div>');return $("body").append(i).addClass("template_site"),this.data.currentID=Cargo.Model.Site.get("id"),this.delegateEvents(),$.get("/_jsapps/modal/modal.html",function(e){t.createsitemodal=new modal,t.createsitemodal.template=_.template(e)}),this},onPostMessage:function(e){e.data&&e.data.redirect_url&&(window.onbeforeunload=null,document.location.href=e.data.redirect_url),e.data&&e.data.tab_index&&this.is_inframe&&("off"===e.data.tab_index?setTimeout(function(){$("*").not('[tabindex="-1"]').addClass("tabindex-off").attr("tabindex","-1")},100):"clear"===e.data.tab_index&&$(".tabindex-off").attr("tabindex","").removeAttr("tabindex").removeClass("tabindex-off"))},remove:function(){window.removeEventListener("message",this.onPostMessage)},confirmCreate:function(e){var t=this;t.createsitemodal.Confirm({message:"Make a site with this Template?",confirm:function(){t.start(e)}}),t.$el.addClass("createsitemodal")},start:function(e){e.preventDefault(),require(["/_jsapps/admin/_models/adminsite.js"],_.bind(function(e){this.data.AdminSite=new e,this.data.AdminSite.set("template_id",this.data.currentID),this.data.AdminSite.save({},{success:_.bind(function(e,t,i){if(0!=t.length){Cargo.Modal.Block({message:""});var o="https://auth.cargo.site/newsitesignup/"+e.get("sites_uid")+"/"+e.get("master_muid")+"/"+e.get("progress_id")+"?template_id="+this.data.currentID;Cargo.Modal.$el.addClass("signup"),Cargo.Modal.$el.find(".confirm-box").html('<iframe src="'+o+'"></iframe>'),Cargo.Modal.$el.find("iframe").css({width:"100%",height:"calc(100% + 1px)",border:"none"}),document.body.style.overflow="hidden"}},this),error:_.bind(function(e,t,i){var o=$.parseJSON(t.responseText);0!=o.length&&alert(o.message)},this)})},this))},requestStartProgress:function(){this.requests++,$.ajax({method:"POST",dataType:"json",url:"/dispatch/siteservices/checkSiteCopyStatus",data:{new_site_uid:this.data.AdminSite.get("sites_uid"),template_site_uid:this.data.AdminSite.get("template_id"),progress_id:this.data.AdminSite.get("progress_id")},success:_.bind(function(e){if(!(e.error&&0<e.error.length)){var t=100<this.requests?1500:500*Math.random()+250;clearTimeout(this.data.requestTimeout),this.data.requestTimeout=setTimeout(_.bind(this.requestStartProgress,this),t),e&&e.jdata&&console.log(e.jdata)}},this),error:_.bind(function(){var e=100<this.requests?1500:500*Math.random()+250;clearTimeout(this.data.requestTimeout),this.data.requestTimeout=setTimeout(_.bind(this.requestStartProgress,this),e)},this)})},displayCompletionStatus:function(e){var t=e.percent;t<10&&(t=Math.min(.1*this.requests,10)),this.createsitemodal.UpdateProgress(Math.round(t)),100<=t&&(clearTimeout(this.data.requestTimeout),setTimeout(_.bind(function(){window.onbeforeunload=null,document.location.href=this.data.redirect_url},this),1e3))}}),Cargo.o.view.ProductWidget=Backbone.View.extend({defaults:{price:!0,button_text:"Add to Cart"},initialize:function(e){this.activeSKU=void 0,requirejs(["text!/_jsapps/ecommerce/_templates/productWidget.html"],_.bind(function(e){this.template=_.template(e),this.requestedRender&&(delete this.requestedRender,this.render())},this))},events:{"change [name='skus']":"changeSKU","click [data-add-cart]":"addToCart"},getOptions:function(){var e={};if(this.el.hasAttribute("data-options"))try{e=JSON.parse(this.el.getAttribute("data-options"))}catch(e){}return _.defaults(e,this.defaults)},updateOptions:function(e){if(e){var t=this.getOptions();t=_.extend(t,e);try{this.el.setAttribute("data-options",JSON.stringify(t))}catch(e){console.warn("unable to store widget settings",e)}return this.render(),t}},formatPriceForCurrency:function(e,t,i){var o;if(void 0!==i&&(e*=i),"string"!=typeof t)o=e/100+"";else{var n={AED:"Ø¯.Ø¥",AFN:"Ø‹",ALL:"L",AMD:"Ö",ANG:"Æ’",AOA:"Kz",ARS:"$",AUD:"$",AWG:"Æ’",AZN:"â‚¼",BAM:"KM",BBD:"$",BDT:"à§³",BGN:"Ð»Ð²",BHD:".Ø¯.Ø¨",BIF:"FBu",BMD:"$",BND:"$",BOB:"$b",BRL:"R$",BSD:"$",BTC:"à¸¿",BTN:"Nu.",BWP:"P",BYR:"p.",BZD:"BZ$",CAD:"$",CDF:"FC",CHF:"CHF",CLP:"$",CNY:"Â¥",COP:"$",CRC:"â‚¡",CUC:"$",CUP:"â‚±",CVE:"$",CZK:"KÄ",DJF:"Fdj",DKK:"kr",DOP:"RD$",DZD:"Ø¯Ø¬",EEK:"kr",EGP:"Â£",ERN:"Nfk",ETB:"Br",ETH:"Îž",EUR:"â‚¬",FJD:"$",FKP:"Â£",GBP:"Â£",GEL:"â‚¾",GGP:"Â£",GHC:"â‚µ",GHS:"GHâ‚µ",GIP:"Â£",GMD:"D",GNF:"FG",GTQ:"Q",GYD:"$",HKD:"$",HNL:"L",HRK:"kn",HTG:"G",HUF:"Ft",IDR:"Rp",ILS:"â‚ª",IMP:"Â£",INR:"â‚¹",IQD:"Ø¹.Ø¯",IRR:"ï·¼",ISK:"kr",JEP:"Â£",JMD:"J$",JOD:"JD",JPY:"Â¥",KES:"KSh",KGS:"Ð»Ð²",KHR:"áŸ›",KMF:"CF",KPW:"â‚©",KRW:"â‚©",KWD:"KD",KYD:"$",KZT:"Ð»Ð²",LAK:"â‚­",LBP:"Â£",LKR:"â‚¨",LRD:"$",LSL:"M",LTC:"Å",LTL:"Lt",LVL:"Ls",LYD:"LD",MAD:"MAD",MDL:"lei",MGA:"Ar",MKD:"Ð´ÐµÐ½",MMK:"K",MNT:"â‚®",MOP:"MOP$",MRO:"UM",MUR:"â‚¨",MVR:"Rf",MWK:"MK",MXN:"$",MYR:"RM",MZN:"MT",NAD:"$",NGN:"â‚¦",NIO:"C$",NOK:"kr",NPR:"â‚¨",NZD:"$",OMR:"ï·¼",PAB:"B/.",PEN:"S/.",PGK:"K",PHP:"â‚±",PKR:"â‚¨",PLN:"zÅ‚",PYG:"Gs",QAR:"ï·¼",RMB:"ï¿¥",RON:"lei",RSD:"Ð”Ð¸Ð½.",RUB:"â‚½",RWF:"Râ‚£",SAR:"ï·¼",SBD:"$",SCR:"â‚¨",SDG:"Ø¬.Ø³.",SEK:"kr",SGD:"$",SHP:"Â£",SLL:"Le",SOS:"S",SRD:"$",SSP:"Â£",STD:"Db",SVC:"$",SYP:"Â£",SZL:"E",THB:"à¸¿",TJS:"SM",TMT:"T",TND:"Ø¯.Øª",TOP:"T$",TRL:"â‚¤",TRY:"â‚º",TTD:"TT$",TVD:"$",TWD:"NT$",TZS:"TSh",UAH:"â‚´",UGX:"USh",USD:"$",UYU:"$U",UZS:"Ð»Ð²",VEF:"Bs",VND:"â‚«",VUV:"VT",WST:"WS$",XAF:"FCFA",XBT:"Éƒ",XCD:"$",XOF:"CFA",XPF:"â‚£",YER:"ï·¼",ZAR:"R",ZWD:"Z$"};t=t.toUpperCase(),-1===["BIF","CLP","DJF","GNF","JPY","KMF","KRW","MGA","PYG","RWF","VND","VUV","XAF","XOF","XPF"].indexOf(t)&&(e/=100),o="undefined"!=typeof Intl?new Intl.NumberFormat(Cargo.__ecommerce_locale__||"en-US",{style:"currency",currency:t,currencyDisplay:"symbol",useGrouping:!0,minimumFractionDigits:0}).format(e):(n.hasOwnProperty(t)?n[t]:t+" ")+""+e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}if("string"==typeof o&&-1!==o.indexOf(".")){var a=o.split(".");2===a.length&&1===a[1].length&&(a[1]=a[1]+"0",o=a.join("."))}return o},render:function(){if(this.template){var e;void 0!==this.model&&((e=this.model.toJSON()).skus.data.sort(function(e,t){var i=_.reduce(e.attributes,function(e,t){return e+t},""),o=_.reduce(t.attributes,function(e,t){return e+t},"");return i<o?-1:o<i?1:0}),!this.activeSKU&&0<e.skus.data.length&&(this.activeSKU=e.skus.data[0]));var t=this.template({formatPriceForCurrency:this.formatPriceForCurrency,options:this.getOptions(),product:e,activeSKU:this.activeSKU,has_inventory:this.checkIfInventoryAvailable()});return this.el.innerHTML=t,this.el.setAttribute("contenteditable",!1),this}this.requestedRender=!0},changeSKU:function(e){var t=e.target[e.target.selectedIndex].value,i=_.findWhere(this.model.get("skus").data,{id:t});i&&(this.activeSKU=i,this.render())},checkIfInventoryAvailable:function(){if(this.activeSKU){if("finite"===this.activeSKU.inventory.type&&0<this.activeSKU.inventory.quantity)return!0;if("infinite"===this.activeSKU.inventory.type)return!0;if("bucket"===this.activeSKU.inventory.type&&("in_stock"===this.activeSKU.inventory.value||"limited"===this.activeSKU.inventory.value))return!0}return!1},addToCart:function(e){this.model&&!Cargo.Helper.IsAdminEdit()&&(e.preventDefault(),Cargo.View.Following.triggerEventInFrame("add-sku-to-cart",{sku:this.activeSKU.id,product:this.model.get("id")}))}}),window.Vimeo={},_.defer(function(){define("jquery",[],function(){return jQuery})}),$(function(){requirejs.onError=function(e){console.error(e)},requirejs.config({paths:{text:"//static.cargo.site/libs/require/text.min",css:"//static.cargo.site/libs/require/css.min"}}),document.body.style.visibility="";var e=Backbone.View.prototype.remove;Backbone.View.prototype.remove=function(){this.trigger("remove"),e.apply(this,arguments)},Cargo.API=new Cargo.o.api,Cargo.Helper=new Cargo.o.helpers,Cargo.Template=new Cargo.o.templates,Cargo.Router=new Cargo.o.router,Cargo.Model.DisplayOptions=new Cargo.o.model.display_options,Cargo.Model.Site=new Cargo.o.model.site,Cargo.Model.Image=new Cargo.o.model.image,Cargo.Model.Css=new Cargo.o.model.css,Cargo.Model.Tag=new Cargo.o.model.tag,Cargo.Model.ThumbnailSettings=new Cargo.o.model.thumbnailsettings,Cargo.Collection.Images=new Cargo.o.collection.images,Cargo.Collection.Scaffolding=new Cargo.o.collection.scaffolding,Cargo.Collection.SiteMenu=new Cargo.o.collection.sitemenu,Cargo.Collection.StripeProducts=new Cargo.o.collection.StripeProductCollection,Cargo.Collection.ThumbnailSettings=new Cargo.o.collection.thumbnailsettings,Cargo.Collection.ThumbnailModes=new Cargo.o.collection.thumbnailmodes,Cargo.Collection.GlobalThumbnails=new Cargo.o.collection.thumbnails,Cargo.Collection.Tags=new Cargo.o.collection.tags,Cargo.Model.DisplayOptions.once("change",function(){Cargo.Event.trigger("display_options_available",Cargo.Model.DisplayOptions)}),Cargo.Model.DisplayOptions.fetch({reset:!0}),Cargo.Analytics=new Cargo.o.analytics,Cargo.Model.Site.fetch(),Cargo.Model.ThumbnailSettings.fetch(),Cargo.Collection.Scaffolding.fetch(),Cargo.Collection.ThumbnailSettings.fetch(),Cargo.Collection.ThumbnailModes.fetch(),!0===Cargo.Model.Site.get("has_ecommerce")?Cargo.Collection.StripeProducts.fetch({success:function(e){Cargo.Collection.StripeProducts.productSyncOccurred=!0},error:function(){Cargo.Collection.StripeProducts.productSyncOccurred=!0}}):Cargo.Collection.StripeProducts.productSyncOccurred=!0,Cargo.Helper.TestUrlCaseAndRedirect(),Cargo.Helper.IsAdminPath()||(Cargo.Backdrop=Cargo.View.Backdrop=Backdrop.View.Backdrop=new Cargo.o.view.Backdrop),Cargo.Helper.IsAdminPath()&&(Cargo.Collection.ImageLibrary=new Cargo.o.collection.images,Cargo.Collection.ImageLibrary.fetch()),Cargo.View.Following=new Cargo.o.view.Following,Cargo.View.FollowingButton=new Cargo.o.view.FollowingButton,Cargo.View.TemplateButton=new Cargo.o.view.TemplateButton,void 0===Cargo.View.Main&&(Cargo.View.Main=new Cargo.o.view.Main({el:"body",collection:Cargo.Model.Site})),Cargo.Template.FindAndAddViewStubs(),Cargo.Template.LoadFoundViews(),Cargo.Helper.isOldIE()||Cargo.Helper.IsAdminPath()||(Cargo.Router.is_first_route=!0,Backbone.history.start({pushState:!0,hashChange:!1,root:Cargo.Helper.GetHomeUrl(!0)})),Cargo.Core.KeyboardShortcut.InitDefaults(),Cargo.Template.LoadAll(),Cargo.Template.LoadFoundViews(),Cargo.Core.ImageGallery.initialize(),Cargo.Core.Ecommerce.initialize(),Cargo.Core.InitKeycodeListener(),Cargo.Core.InitMessageListener(),"undefined"!=typeof scrollMonitor&&(Cargo.Helper.throttledScrollMonitorUpdate=_.throttle(scrollMonitor.update,50)),Cargo.Event.trigger("init_complete")}),function(e){"use strict";var d,r,n;d=jQuery,r=window.Slick||{},(n=0,r=function(e,t){var i,o=this;o.defaults={accessibility:!0,adaptiveHeight:!1,appendArrows:d(e),appendDots:d(e),arrows:!0,asNavFor:null,prevArrow:'<button type="button" data-role="none" class="slick-prev" aria-label="Previous" tabindex="0" role="button">Previous</button>',nextArrow:'<button type="button" data-role="none" class="slick-next" aria-label="Next" tabindex="0" role="button">Next</button>',autoplay:!1,autoplaySpeed:3e3,centerMode:!1,centerPadding:"50px",cssEase:"ease",customPaging:function(e,t){return d('<button type="button" data-role="none" role="button" tabindex="0" />').text(t+1)},dots:!1,dotsClass:"slick-dots",draggable:!0,easing:"linear",edgeFriction:.35,fade:!1,focusOnSelect:!1,infinite:!0,initialSlide:0,lazyLoad:"ondemand",mobileFirst:!1,pauseOnHover:!0,pauseOnFocus:!0,pauseOnDotsHover:!1,preventDefaults:!0,respondTo:"window",responsive:null,rows:1,rtl:!1,slide:"",slidesPerRow:1,slidesToShow:1,slidesToScroll:1,speed:500,swipe:!0,swipeToSlide:!1,touchMove:!0,touchThreshold:5,useCSS:!0,useTransform:!0,variableWidth:!1,vertical:!1,verticalSwiping:!1,waitForAnimate:!0,zIndex:1e3},o.initials={animating:!1,dragging:!1,autoPlayTimer:null,hideUITimer:null,currentDirection:0,currentLeft:null,currentSlide:0,direction:1,$dots:null,listWidth:null,listHeight:null,loadIndex:0,$nextArrow:null,$prevArrow:null,slideCount:null,slideWidth:null,$slideTrack:null,$slides:null,sliding:!1,slideOffset:0,swipeLeft:null,$list:null,touchObject:{},transformsEnabled:!1,unslicked:!1},d.extend(o,o.initials),o.activeBreakpoint=null,o.animType=null,o.animProp=null,o.breakpoints=[],o.breakpointSettings=[],o.cssTransitions=!1,o.focussed=!1,o.interrupted=!1,o.hidden="hidden",o.paused=!0,o.positionProp=null,o.respondTo=null,o.rowCount=1,o.shouldClick=!0,o.$slider=d(e),o.$slidesCache=null,o.transformType=null,o.transitionType=null,o.visibilityChange="visibilitychange",o.windowWidth=0,o.windowTimer=null,i=d(e).data("slick")||{},o.options=d.extend({},o.defaults,t,i),o.currentSlide=o.options.initialSlide,o.originalSettings=o.options,void 0!==document.mozHidden?(o.hidden="mozHidden",o.visibilityChange="mozvisibilitychange"):void 0!==document.webkitHidden&&(o.hidden="webkitHidden",o.visibilityChange="webkitvisibilitychange"),o.autoPlay=d.proxy(o.autoPlay,o),o.autoPlayClear=d.proxy(o.autoPlayClear,o),o.autoPlayIterator=d.proxy(o.autoPlayIterator,o),o.changeSlide=d.proxy(o.changeSlide,o),o.clickHandler=d.proxy(o.clickHandler,o),o.selectHandler=d.proxy(o.selectHandler,o),o.setPosition=d.proxy(o.setPosition,o),o.swipeHandler=d.proxy(o.swipeHandler,o),o.dragHandler=d.proxy(o.dragHandler,o),o.keyHandler=d.proxy(o.keyHandler,o),o.hideUI=d.proxy(o.hideUI,o),o.showUI=d.proxy(o.showUI,o),o.preventDefault=d.proxy(o.preventDefault,o),o.instanceUid=n++,o.htmlExpr=/^(?:\s*(<[\w\W]+>)[^>]*)$/,o.registerBreakpoints(),o.init(!0)}).prototype.activateADA=function(){this.$slideTrack.find(".slick-active").attr({"aria-hidden":"false"}).find("a, input, button, select").attr({tabindex:"0"})},r.prototype.addSlide=r.prototype.slickAdd=function(e,t,i){var o=this;if("boolean"==typeof t)i=t,t=null;else if(t<0||t>=o.slideCount)return!1;o.unload(),"number"==typeof t?0===t&&0===o.$slides.length?d(e).appendTo(o.$slideTrack):i?d(e).insertBefore(o.$slides.eq(t)):d(e).insertAfter(o.$slides.eq(t)):!0===i?d(e).prependTo(o.$slideTrack):d(e).appendTo(o.$slideTrack),o.$slides=o.$slideTrack.children(this.options.slide),o.$slideTrack.children(this.options.slide).detach(),o.$slideTrack.append(o.$slides),o.$slides.each(function(e,t){d(t).attr("data-slick-index",e)}),o.$slidesCache=o.$slides,o.reinit()},r.prototype.animateHeight=function(){var e=this;if(1===e.options.slidesToShow&&!0===e.options.adaptiveHeight&&!1===e.options.vertical){var t=e.$slides.eq(e.currentSlide).outerHeight(!0);if(e.$list.animate({height:t},e.options.speed),!0===e.options.arrows){var i=e.$slides.eq(e.currentSlide),o=i.is(".has_caption")?t-i.find(".gallery_image_caption").outerHeight(!0):t;e.$prevArrow.animate({height:o},{duration:e.options.speed}).css("overflow","visible"),e.$nextArrow.animate({height:o},{duration:e.options.speed}).css("overflow","visible")}}},r.prototype.animateSlide=function(e,t){var i={},o=this;o.animateHeight(),!0===o.options.rtl&&!1===o.options.vertical&&(e=-e),!1===o.transformsEnabled?!1===o.options.vertical?o.$slideTrack.animate({left:e},o.options.speed,o.options.easing,t):o.$slideTrack.animate({top:e},o.options.speed,o.options.easing,t):!1===o.cssTransitions?(!0===o.options.rtl&&(o.currentLeft=-o.currentLeft),d({animStart:o.currentLeft}).animate({animStart:e},{duration:o.options.speed,easing:o.options.easing,step:function(e){e=Math.ceil(e),!1===o.options.vertical?i[o.animType]="translate("+e+"px, 0px)":i[o.animType]="translate(0px,"+e+"px)",o.$slideTrack.css(i)},complete:function(){t&&t.call()}})):(o.applyTransition(),e=Math.ceil(e),!1===o.options.vertical?i[o.animType]="translate3d("+e+"px, 0px, 0px)":i[o.animType]="translate3d(0px,"+e+"px, 0px)",o.$slideTrack.css(i),t&&setTimeout(function(){o.disableTransition(),t.call()},o.options.speed))},r.prototype.getNavTarget=function(){var e=this.options.asNavFor;return e&&null!==e&&(e=d(e).not(this.$slider)),e},r.prototype.asNavFor=function(t){var e=this.getNavTarget();null!==e&&"object"==typeof e&&e.each(function(){var e=d(this).slick("getSlick");e.unslicked||e.slideHandler(t,!0)})},r.prototype.applyTransition=function(e){var t=this,i={};!1===t.options.fade?i[t.transitionType]=t.transformType+" "+t.options.speed+"ms "+t.options.cssEase:i[t.transitionType]="opacity "+t.options.speed+"ms "+t.options.cssEase,!1===t.options.fade?t.$slideTrack.css(i):t.$slides.eq(e).css(i)},r.prototype.autoPlay=function(){var e=this;e.autoPlayClear(),e.slideCount>e.options.slidesToShow&&(e.autoPlayTimer=setInterval(e.autoPlayIterator,e.options.autoplaySpeed))},r.prototype.autoPlayClear=function(){this.autoPlayTimer&&clearInterval(this.autoPlayTimer)},r.prototype.autoPlayIterator=function(){var e=this,t=e.currentSlide+e.options.slidesToScroll;e.paused||e.interrupted||e.focussed||(!1===e.options.infinite&&(1===e.direction&&e.currentSlide+1===e.slideCount-1?e.direction=0:0===e.direction&&(t=e.currentSlide-e.options.slidesToScroll,e.currentSlide-1==0&&(e.direction=1))),e.slideHandler(t))},r.prototype.buildArrows=function(){var e=this;!0===e.options.arrows&&(e.$prevArrow=d(e.options.prevArrow).addClass("slick-arrow"),e.$nextArrow=d(e.options.nextArrow).addClass("slick-arrow"),e.slideCount>e.options.slidesToShow?(e.$prevArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),e.$nextArrow.removeClass("slick-hidden").removeAttr("aria-hidden tabindex"),e.htmlExpr.test(e.options.prevArrow)&&e.$prevArrow.prependTo(e.options.appendArrows),e.htmlExpr.test(e.options.nextArrow)&&e.$nextArrow.appendTo(e.options.appendArrows),!0!==e.options.infinite&&e.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true")):e.$prevArrow.add(e.$nextArrow).addClass("slick-hidden").attr({"aria-disabled":"true",tabindex:"-1"}))},r.prototype.buildDots=function(){var e,t,i=this;if(!0===i.options.dots&&i.slideCount>i.options.slidesToShow){for(i.$slider.addClass("slick-dotted"),t=d("<ul />").addClass(i.options.dotsClass),e=0;e<=i.getDotCount();e+=1)t.append(d("<li />").append(i.options.customPaging.call(this,i,e)));i.$dots=t.appendTo(i.options.appendDots),i.$dots.find("li").first().addClass("slick-active").attr("aria-hidden","false")}},r.prototype.buildOut=function(){var e=this;e.$slides=e.$slider.children(e.options.slide+":not(.slick-cloned)").addClass("slick-slide"),e.slideCount=e.$slides.length,e.$slides.each(function(e,t){d(t).attr("data-slick-index",e).data("originalStyling",d(t).attr("style")||"")}),e.$slider.addClass("slick-slider"),e.$slideTrack=0===e.slideCount?d('<div class="slick-track"/>').appendTo(e.$slider):e.$slides.wrapAll('<div class="slick-track"/>').parent(),e.$list=e.$slideTrack.wrap('<div aria-live="polite" class="slick-list"/>').parent(),e.$slideTrack.css("opacity",0),!0!==e.options.centerMode&&!0!==e.options.swipeToSlide||(e.options.slidesToScroll=1),d("img[data-lazy]",e.$slider).not("[src]").addClass("slick-loading"),e.setupInfinite(),e.buildArrows(),e.buildDots(),e.updateDots(),e.setSlideClasses("number"==typeof e.currentSlide?e.currentSlide:0),!0===e.options.draggable&&e.$list.addClass("draggable")},r.prototype.buildRows=function(){var e,t,i,o,n,a,r,s=this;if(o=document.createDocumentFragment(),a=s.$slider.children(),1<s.options.rows){for(r=s.options.slidesPerRow*s.options.rows,n=Math.ceil(a.length/r),e=0;e<n;e++){var l=document.createElement("div");for(t=0;t<s.options.rows;t++){var d=document.createElement("div");for(i=0;i<s.options.slidesPerRow;i++){var c=e*r+(t*s.options.slidesPerRow+i);a.get(c)&&d.appendChild(a.get(c))}l.appendChild(d)}o.appendChild(l)}s.$slider.empty().append(o),s.$slider.children().children().children().css({width:100/s.options.slidesPerRow+"%",display:"inline-block"})}},r.prototype.checkResponsive=function(e,t){var i,o,n,a=this,r=!1,s=a.$slider.width(),l=window.innerWidth||d(window).width();if("window"===a.respondTo?n=l:"slider"===a.respondTo?n=s:"min"===a.respondTo&&(n=Math.min(l,s)),a.options.responsive&&a.options.responsive.length&&null!==a.options.responsive){for(i in o=null,a.breakpoints)a.breakpoints.hasOwnProperty(i)&&(!1===a.originalSettings.mobileFirst?n<a.breakpoints[i]&&(o=a.breakpoints[i]):n>a.breakpoints[i]&&(o=a.breakpoints[i]));null!==o?null!==a.activeBreakpoint?(o!==a.activeBreakpoint||t)&&(a.activeBreakpoint=o,"unslick"===a.breakpointSettings[o]?a.unslick(o):(a.options=d.extend({},a.originalSettings,a.breakpointSettings[o]),!0===e&&(a.currentSlide=a.options.initialSlide),a.refresh(e)),r=o):(a.activeBreakpoint=o,"unslick"===a.breakpointSettings[o]?a.unslick(o):(a.options=d.extend({},a.originalSettings,a.breakpointSettings[o]),!0===e&&(a.currentSlide=a.options.initialSlide),a.refresh(e)),r=o):null!==a.activeBreakpoint&&(a.activeBreakpoint=null,a.options=a.originalSettings,!0===e&&(a.currentSlide=a.options.initialSlide),a.refresh(e),r=o),e||!1===r||a.$slider.trigger("breakpoint",[a,r])}},r.prototype.changeSlide=function(e,t){var i,o,n,a=this,r=d(e.currentTarget);switch(r.is("a")&&e.preventDefault(),r.is("li")||(r=r.closest("li")),n=a.slideCount%a.options.slidesToScroll!=0,i=n?0:(a.slideCount-a.currentSlide)%a.options.slidesToScroll,e.data.message){case"previous":o=0===i?a.options.slidesToScroll:a.options.slidesToShow-i,a.slideCount>a.options.slidesToShow&&a.slideHandler(a.currentSlide-o,!1,t);break;case"next":o=0===i?a.options.slidesToScroll:i,a.slideCount>a.options.slidesToShow&&a.slideHandler(a.currentSlide+o,!1,t);break;case"index":var s=0===e.data.index?0:e.data.index||r.index()*a.options.slidesToScroll;a.slideHandler(a.checkNavigable(s),!1,t),r.children().trigger("focus");break;default:return}},r.prototype.checkNavigable=function(e){var t,i;if(t=this.getNavigableIndexes(),i=0,e>t[t.length-1])e=t[t.length-1];else for(var o in t){if(e<t[o]){e=i;break}i=t[o]}return e},r.prototype.cleanUpEvents=function(){var e=this;e.options.dots&&null!==e.$dots&&d("li",e.$dots).off("click.slick",e.changeSlide).off("mouseenter.slick",d.proxy(e.interrupt,e,!0)).off("mouseleave.slick",d.proxy(e.interrupt,e,!1)),e.$slider.off("focus.slick blur.slick"),!0===e.options.arrows&&e.slideCount>e.options.slidesToShow&&(e.$prevArrow&&e.$prevArrow.off("click.slick",e.changeSlide),e.$nextArrow&&e.$nextArrow.off("click.slick",e.changeSlide)),e.$slider.off("touchstart.slick mousedown.slick",e.swipeHandler),e.$slider.off("touchmove.slick mousemove.slick",e.swipeHandler),e.$slider.off("touchend.slick mouseup.slick",e.swipeHandler),e.$slider.off("touchcancel.slick mouseleave.slick",e.swipeHandler),e.$list.off("click.slick",e.clickHandler),d(document).off(e.visibilityChange,e.visibility),e.cleanUpSlideEvents(),!0===e.options.accessibility&&e.$list.off("keydown.slick",e.keyHandler),!0===e.options.focusOnSelect&&d(e.$slideTrack).children().off("click.slick",e.selectHandler),d(window).off("orientationchange.slick.slick-"+e.instanceUid,e.orientationChange),d(window).off("resize.slick.slick-"+e.instanceUid,e.resize),d("[draggable!=true]",e.$slideTrack).off("dragstart",e.preventDefault),d(window).off("load.slick.slick-"+e.instanceUid,e.setPosition),d(document).off("ready.slick.slick-"+e.instanceUid,e.setPosition),Cargo.Event.off("slideshow-lazyload",e.lazyLoad),Cargo.Event.off("slideshow-lazyload",e.progressiveLazyLoad)},r.prototype.cleanUpSlideEvents=function(){var e=this;e.$list.off("mouseenter.slick",d.proxy(e.interrupt,e,!0)),e.$list.off("mouseleave.slick",d.proxy(e.interrupt,e,!1))},r.prototype.cleanUpRows=function(){var e;1<this.options.rows&&((e=this.$slides.children().children()).removeAttr("style"),this.$slider.empty().append(e))},r.prototype.clickHandler=function(e){!1===this.shouldClick&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())},r.prototype.destroy=function(e){var t=this;t.autoPlayClear(),t.touchObject={},t.cleanUpEvents(),d(".slick-cloned",t.$slider).detach(),t.$dots&&t.$dots.remove(),t.$prevArrow&&t.$prevArrow.length&&(t.$prevArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),t.htmlExpr.test(t.options.prevArrow)&&t.$prevArrow.remove()),t.$nextArrow&&t.$nextArrow.length&&(t.$nextArrow.removeClass("slick-disabled slick-arrow slick-hidden").removeAttr("aria-hidden aria-disabled tabindex").css("display",""),t.htmlExpr.test(t.options.nextArrow)&&t.$nextArrow.remove()),t.$slides&&(t.$slides.removeClass("slick-slide slick-active slick-center slick-visible slick-current").removeAttr("aria-hidden").removeAttr("data-slick-index").each(function(){d(this).attr("style",d(this).data("originalStyling"))}),t.$slideTrack.children(this.options.slide).detach(),t.$slideTrack.detach(),t.$list.detach(),t.$slider.append(t.$slides)),t.cleanUpRows(),t.$slider.removeClass("slick-slider"),t.$slider.removeClass("slick-initialized"),t.$slider.removeClass("slick-dotted"),t.unslicked=!0,e||t.$slider.trigger("destroy",[t])},r.prototype.disableTransition=function(e){var t={};t[this.transitionType]="",!1===this.options.fade?this.$slideTrack.css(t):this.$slides.eq(e).css(t)},r.prototype.fadeSlide=function(e,t){var i=this;!1===i.cssTransitions?(i.$slides.eq(e).css({zIndex:i.options.zIndex}),i.$slides.eq(e).animate({opacity:1},i.options.speed,i.options.easing,t)):(i.applyTransition(e),i.$slides.eq(e).css({opacity:1,zIndex:i.options.zIndex}),t&&setTimeout(function(){i.disableTransition(e),t.call()},i.options.speed))},r.prototype.fadeSlideOut=function(e){var t=this;!1===t.cssTransitions?t.$slides.eq(e).animate({opacity:0,zIndex:t.options.zIndex-2},t.options.speed,t.options.easing):(t.applyTransition(e),t.$slides.eq(e).css({opacity:0,zIndex:t.options.zIndex-2}))},r.prototype.filterSlides=r.prototype.slickFilter=function(e){var t=this;null!==e&&(t.$slidesCache=t.$slides,t.unload(),t.$slideTrack.children(this.options.slide).detach(),t.$slidesCache.filter(e).appendTo(t.$slideTrack),t.reinit())},r.prototype.focusHandler=function(){var i=this;i.$slider.off("focus.slick blur.slick").on("focus.slick blur.slick","*:not(.slick-arrow)",function(e){e.stopImmediatePropagation();var t=d(this);setTimeout(function(){i.options.pauseOnFocus&&(i.focussed=t.is(":focus"),i.autoPlay())},0)})},r.prototype.getCurrent=r.prototype.slickCurrentSlide=function(){return this.currentSlide},r.prototype.getDotCount=function(){var e=this,t=0,i=0,o=0;if(!0===e.options.infinite)for(;t<e.slideCount;)++o,t=i+e.options.slidesToScroll,i+=e.options.slidesToScroll<=e.options.slidesToShow?e.options.slidesToScroll:e.options.slidesToShow;else if(!0===e.options.centerMode)o=e.slideCount;else if(e.options.asNavFor)for(;t<e.slideCount;)++o,t=i+e.options.slidesToScroll,i+=e.options.slidesToScroll<=e.options.slidesToShow?e.options.slidesToScroll:e.options.slidesToShow;else o=1+Math.ceil((e.slideCount-e.options.slidesToShow)/e.options.slidesToScroll);return o-1},r.prototype.getLeft=function(e){var t,i,o,n=this,a=0;return n.slideOffset=0,i=n.$slides.first().outerHeight(!0),!0===n.options.infinite?(n.slideCount>n.options.slidesToShow&&(n.slideOffset=n.slideWidth*n.options.slidesToShow*-1,a=i*n.options.slidesToShow*-1),n.slideCount%n.options.slidesToScroll!=0&&e+n.options.slidesToScroll>n.slideCount&&n.slideCount>n.options.slidesToShow&&(a=e>n.slideCount?(n.slideOffset=(n.options.slidesToShow-(e-n.slideCount))*n.slideWidth*-1,(n.options.slidesToShow-(e-n.slideCount))*i*-1):(n.slideOffset=n.slideCount%n.options.slidesToScroll*n.slideWidth*-1,n.slideCount%n.options.slidesToScroll*i*-1))):e+n.options.slidesToShow>n.slideCount&&(n.slideOffset=(e+n.options.slidesToShow-n.slideCount)*n.slideWidth,a=(e+n.options.slidesToShow-n.slideCount)*i),n.slideCount<=n.options.slidesToShow&&(n.slideOffset=0,a=0),!0===n.options.centerMode&&!0===n.options.infinite?n.slideOffset+=n.slideWidth*Math.floor(n.options.slidesToShow/2)-n.slideWidth:!0===n.options.centerMode&&(n.slideOffset=0,n.slideOffset+=n.slideWidth*Math.floor(n.options.slidesToShow/2)),t=!1===n.options.vertical?e*n.slideWidth*-1+n.slideOffset:e*i*-1+a,!0===n.options.variableWidth&&(o=n.slideCount<=n.options.slidesToShow||!1===n.options.infinite?n.$slideTrack.children(".slick-slide").eq(e):n.$slideTrack.children(".slick-slide").eq(e+n.options.slidesToShow),t=!0===n.options.rtl?o[0]?-1*(n.$slideTrack.width()-o[0].offsetLeft-o.width()):0:o[0]?-1*o[0].offsetLeft:0,!0===n.options.centerMode&&(o=n.slideCount<=n.options.slidesToShow||!1===n.options.infinite?n.$slideTrack.children(".slick-slide").eq(e):n.$slideTrack.children(".slick-slide").eq(e+n.options.slidesToShow+1),t=!0===n.options.rtl?o[0]?-1*(n.$slideTrack.width()-o[0].offsetLeft-o.width()):0:o[0]?-1*o[0].offsetLeft:0,t+=(n.$list.width()-o.outerWidth())/2)),t},r.prototype.getOption=r.prototype.slickGetOption=function(e){return this.options[e]},r.prototype.getNavigableIndexes=function(){var e,t=this,i=0,o=0,n=[];for(e=!1===t.options.infinite?t.slideCount:(i=-1*t.options.slidesToScroll,o=-1*t.options.slidesToScroll,2*t.slideCount);i<e;)n.push(i),i=o+t.options.slidesToScroll,o+=t.options.slidesToScroll<=t.options.slidesToShow?t.options.slidesToScroll:t.options.slidesToShow;return n},r.prototype.getSlick=function(){return this},r.prototype.getSlideCount=function(){var i,o,n=this;return o=!0===n.options.centerMode?n.slideWidth*Math.floor(n.options.slidesToShow/2):0,!0===n.options.swipeToSlide?(n.$slideTrack.find(".slick-slide").each(function(e,t){if(t.offsetLeft-o+d(t).outerWidth()/2>-1*n.swipeLeft)return i=t,!1}),Math.abs(d(i).attr("data-slick-index")-n.currentSlide)||1):n.options.slidesToScroll},r.prototype.goTo=r.prototype.slickGoTo=function(e,t){this.changeSlide({data:{message:"index",index:parseInt(e)}},t)},r.prototype.init=function(e){var t=this;d(t.$slider).hasClass("slick-initialized")||(d(t.$slider).addClass("slick-initialized"),t.buildRows(),t.buildOut(),t.setProps(),t.startLoad(),t.loadSlider(),t.initializeEvents(),t.updateArrows(),t.updateDots(),t.checkResponsive(!0),t.focusHandler()),e&&t.$slider.trigger("init",[t]),!0===t.options.accessibility&&t.initADA(),t.options.autoplay&&(t.paused=!1,t.autoPlay()),t.showUI(),this.hideUITimer=setTimeout(this.hideUI,1500)},r.prototype.initADA=function(){var t=this;t.$slides.add(t.$slideTrack.find(".slick-cloned")).attr({"aria-hidden":"true",tabindex:"-1"}).find("a, input, button, select").attr({tabindex:"-1"}),t.$slideTrack.attr("role","listbox"),t.$slides.not(t.$slideTrack.find(".slick-cloned")).each(function(e){d(this).attr({role:"option","aria-describedby":"slick-slide"+t.instanceUid+e})}),null!==t.$dots&&t.$dots.attr("role","tablist").find("li").each(function(e){d(this).attr({role:"presentation","aria-selected":"false","aria-controls":"navigation"+t.instanceUid+e,id:"slick-slide"+t.instanceUid+e})}).first().attr("aria-selected","true").end().find("button").attr("role","button").end().closest("div").attr("role","toolbar"),t.activateADA()},r.prototype.initArrowEvents=function(){var e=this;!0===e.options.arrows&&e.slideCount>e.options.slidesToShow&&(e.$prevArrow.off("click.slick").on("click.slick",{message:"previous"},e.changeSlide),e.$nextArrow.off("click.slick").on("click.slick",{message:"next"},e.changeSlide))},r.prototype.initDotEvents=function(){var e=this;!0===e.options.dots&&e.slideCount>e.options.slidesToShow&&d("li",e.$dots).on("click.slick",{message:"index"},e.changeSlide),!0===e.options.dots&&!0===e.options.pauseOnDotsHover&&d("li",e.$dots).on("mouseenter.slick",d.proxy(e.interrupt,e,!0)).on("mouseleave.slick",d.proxy(e.interrupt,e,!1))},r.prototype.initSlideEvents=function(){var e=this;e.options.pauseOnHover&&(e.$prevArrow&&(e.$prevArrow.on("mouseenter.slick",d.proxy(e.interrupt,e,!0)),e.$prevArrow.on("mouseleave.slick",d.proxy(e.interrupt,e,!1))),e.$nextArrow&&(e.$nextArrow.on("mouseenter.slick",d.proxy(e.interrupt,e,!0)),e.$nextArrow.on("mouseleave.slick",d.proxy(e.interrupt,e,!1))),e.$list.on("mouseenter.slick",d.proxy(e.interrupt,e,!0)),e.$list.on("mouseleave.slick",d.proxy(e.interrupt,e,!1)))},r.prototype.initializeEvents=function(){var e=this;e.initArrowEvents(),e.initDotEvents(),e.initSlideEvents(),e.$slider.on("touchstart.slick mousedown.slick",{action:"start"},e.swipeHandler),e.$slider.on("touchmove.slick mousemove.slick",{action:"move"},e.swipeHandler),e.$slider.on("touchend.slick mouseup.slick",{action:"end"},e.swipeHandler),e.$slider.on("touchcancel.slick mouseleave.slick",{action:"end"},e.swipeHandler),e.$list.on("click.slick",e.clickHandler),d(document).on(e.visibilityChange,d.proxy(e.visibility,e)),!0===e.options.accessibility&&e.$list.on("keydown.slick",e.keyHandler),!0===e.options.focusOnSelect&&d(e.$slideTrack).children().on("click.slick",e.selectHandler),d(window).on("orientationchange.slick.slick-"+e.instanceUid,d.proxy(e.orientationChange,e)),d(window).on("resize.slick.slick-"+e.instanceUid,d.proxy(e.resize,e)),d("[draggable!=true]",e.$slideTrack).on("dragstart",e.preventDefault),d(window).on("load.slick.slick-"+e.instanceUid,e.setPosition),d(document).on("ready.slick.slick-"+e.instanceUid,e.setPosition)},r.prototype.initUI=function(){var e=this;!0===e.options.arrows&&e.slideCount>e.options.slidesToShow&&(e.$prevArrow.show(),e.$nextArrow.show()),!0===e.options.dots&&e.slideCount>e.options.slidesToShow&&e.$dots.show()},r.prototype.keyHandler=function(e){var t=this;e.target.tagName.match("TEXTAREA|INPUT|SELECT")||(37===e.keyCode&&!0===t.options.accessibility?t.changeSlide({data:{message:!0===t.options.rtl?"next":"previous"}}):39===e.keyCode&&!0===t.options.accessibility&&t.changeSlide({data:{message:!0===t.options.rtl?"previous":"next"}}))},r.prototype.lazyLoad=function(){var e,t,o=this;function i(e){d("img[data-lazy], img[data-lazy-src]",e).each(function(){var e=d(this),t=e.attr("data-lazy")||e.attr("data-lazy-src"),i=document.createElement("img");e.removeAttr("data-lazy"),e.removeAttr("data-lazy-src"),i.onload=function(){e.attr("src",t).removeClass("slick-loading"),o.$slider.trigger("lazyLoaded",[o,e,t])},i.onerror=function(){e.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),o.$slider.trigger("lazyLoadError",[o,e,t])},i.src=t})}!0===o.options.centerMode?t=!0===o.options.infinite?(e=o.currentSlide+(o.options.slidesToShow/2+1))+o.options.slidesToShow+2:(e=Math.max(0,o.currentSlide-(o.options.slidesToShow/2+1)),o.options.slidesToShow/2+1+2+o.currentSlide):(e=o.options.infinite?o.options.slidesToShow+o.currentSlide:o.currentSlide,t=Math.ceil(e+o.options.slidesToShow),!0===o.options.fade&&(0<e&&e--,t<=o.slideCount&&t++)),t+=3,(e-=1)<0&&(e=0),i(o.$slider.find(".slick-slide").slice(e,t)),o.slideCount<=o.options.slidesToShow?i(o.$slider.find(".slick-slide")):o.currentSlide>=o.slideCount-o.options.slidesToShow?i(o.$slider.find(".slick-cloned").slice(0,o.options.slidesToShow)):0===o.currentSlide&&i(o.$slider.find(".slick-cloned").slice(-1*o.options.slidesToShow))},r.prototype.loadSlider=function(){var e=this;e.setPosition(),e.$slideTrack.css({opacity:1}),e.$slider.removeClass("slick-loading"),e.initUI(),"progressive"===e.options.lazyLoad&&e.progressiveLazyLoad()},r.prototype.next=r.prototype.slickNext=function(){this.changeSlide({data:{message:"next"}})},r.prototype.orientationChange=function(){this.checkResponsive(),this.setPosition()},r.prototype.pause=r.prototype.slickPause=function(){this.autoPlayClear(),this.paused=!0},r.prototype.play=r.prototype.slickPlay=function(){var e=this;e.autoPlay(),e.options.autoplay=!0,e.paused=!1,e.focussed=!1,e.interrupted=!1},r.prototype.postSlide=function(e){var t=this;t.unslicked||(t.$slider.trigger("afterChange",[t,e]),t.animating=!1,t.setPosition(),t.swipeLeft=null,t.options.autoplay&&t.autoPlay(),!0===t.options.accessibility&&t.initADA())},r.prototype.prev=r.prototype.slickPrev=function(){this.changeSlide({data:{message:"previous"}})},r.prototype.preventDefault=function(e){this.options.preventDefaults&&e.preventDefault()},r.prototype.progressiveLazyLoad=function(e){e=e||1;var t,i,o,n=this,a=d("img[data-lazy]",n.$slider);a.length?(t=a.first(),i=t.attr("data-lazy"),(o=document.createElement("img")).onload=function(){t.attr("src",i).removeAttr("data-lazy").removeClass("slick-loading"),!0===n.options.adaptiveHeight&&n.setPosition(),n.$slider.trigger("lazyLoaded",[n,t,i]),n.progressiveLazyLoad()},o.onerror=function(){e<3?setTimeout(function(){n.progressiveLazyLoad(e+1)},500):(t.removeAttr("data-lazy").removeClass("slick-loading").addClass("slick-lazyload-error"),n.$slider.trigger("lazyLoadError",[n,t,i]),n.progressiveLazyLoad())},o.src=i):n.$slider.trigger("allImagesLoaded",[n])},r.prototype.refresh=function(e){var t,i,o=this;i=o.slideCount-o.options.slidesToShow,!o.options.infinite&&o.currentSlide>i&&(o.currentSlide=i),o.slideCount<=o.options.slidesToShow&&(o.currentSlide=0),t=o.currentSlide,o.destroy(!0),d.extend(o,o.initials,{currentSlide:t}),o.init(),e||o.changeSlide({data:{message:"index",index:t}},!1)},r.prototype.registerBreakpoints=function(){var e,t,i,o=this,n=o.options.responsive||null;if("array"===d.type(n)&&n.length){for(e in o.respondTo=o.options.respondTo||"window",n)if(i=o.breakpoints.length-1,t=n[e].breakpoint,n.hasOwnProperty(e)){for(;0<=i;)o.breakpoints[i]&&o.breakpoints[i]===t&&o.breakpoints.splice(i,1),i--;o.breakpoints.push(t),o.breakpointSettings[t]=n[e].settings}o.breakpoints.sort(function(e,t){return o.options.mobileFirst?e-t:t-e})}},r.prototype.reinit=function(){var e=this;e.$slides=e.$slideTrack.children(e.options.slide).addClass("slick-slide"),e.slideCount=e.$slides.length,e.currentSlide>=e.slideCount&&0!==e.currentSlide&&(e.currentSlide=e.currentSlide-e.options.slidesToScroll),e.slideCount<=e.options.slidesToShow&&(e.currentSlide=0),e.registerBreakpoints(),e.setProps(),e.setupInfinite(),e.buildArrows(),e.updateArrows(),e.initArrowEvents(),e.buildDots(),e.updateDots(),e.initDotEvents(),e.cleanUpSlideEvents(),e.initSlideEvents(),e.checkResponsive(!1,!0),!0===e.options.focusOnSelect&&d(e.$slideTrack).children().on("click.slick",e.selectHandler),e.setSlideClasses("number"==typeof e.currentSlide?e.currentSlide:0),e.setPosition(),e.focusHandler(),e.paused=!e.options.autoplay,e.autoPlay(),e.options.arrows&&(e.showUI(),e.hideUITimer=setTimeout(e.hideUI,1500)),e.$slider.trigger("reInit",[e])},r.prototype.resize=function(){var e=this;d(window).width()!==e.windowWidth&&(clearTimeout(e.windowDelay),e.windowDelay=window.setTimeout(function(){e.windowWidth=d(window).width(),e.checkResponsive(),e.unslicked||e.setPosition()},50))},r.prototype.removeSlide=r.prototype.slickRemove=function(e,t,i){var o=this;if(e="boolean"==typeof e?!0===(t=e)?0:o.slideCount-1:!0===t?--e:e,o.slideCount<1||e<0||e>o.slideCount-1)return!1;o.unload(),!0===i?o.$slideTrack.children().remove():o.$slideTrack.children(this.options.slide).eq(e).remove(),o.$slides=o.$slideTrack.children(this.options.slide),o.$slideTrack.children(this.options.slide).detach(),o.$slideTrack.append(o.$slides),o.$slidesCache=o.$slides,o.reinit()},r.prototype.setCSS=function(e){var t,i,o=this,n={};!0===o.options.rtl&&(e=-e),t="left"==o.positionProp?Math.ceil(e)+"px":"0px",i="top"==o.positionProp?Math.ceil(e)+"px":"0px",n[o.positionProp]=e,!1===o.transformsEnabled||(!(n={})===o.cssTransitions?n[o.animType]="translate("+t+", "+i+")":n[o.animType]="translate3d("+t+", "+i+", 0px)"),o.$slideTrack.css(n)},r.prototype.setDimensions=function(){var e=this;!1===e.options.vertical?!0===e.options.centerMode&&e.$list.css({padding:"0px "+e.options.centerPadding}):(e.$list.height(e.$slides.first().outerHeight(!0)*e.options.slidesToShow),!0===e.options.centerMode&&e.$list.css({padding:e.options.centerPadding+" 0px"})),e.listWidth=e.$list.width(),e.listHeight=e.$list.height(),!1===e.options.vertical&&!1===e.options.variableWidth?(e.slideWidth=Math.ceil(e.listWidth/e.options.slidesToShow),e.$slideTrack.width(Math.ceil(e.slideWidth*e.$slideTrack.children(".slick-slide").length))):!0===e.options.variableWidth?e.$slideTrack.width(5e3*e.slideCount):(e.slideWidth=Math.ceil(e.listWidth),e.$slideTrack.height(Math.ceil(e.$slides.first().outerHeight(!0)*e.$slideTrack.children(".slick-slide").length)));var t=e.$slides.first().outerWidth(!0)-e.$slides.first().width();!1===e.options.variableWidth&&e.$slideTrack.children(".slick-slide").width(e.slideWidth-t)},r.prototype.setFade=function(){var i,o=this;o.$slides.each(function(e,t){i=o.slideWidth*e*-1,!0===o.options.rtl?d(t).css({position:"relative",right:i,top:0,zIndex:o.options.zIndex-2,opacity:0}):d(t).css({position:"relative",left:i,top:0,zIndex:o.options.zIndex-2,opacity:0})}),o.$slides.eq(o.currentSlide).css({zIndex:o.options.zIndex-1,opacity:1})},r.prototype.setHeight=function(){var e=this;if(1===e.options.slidesToShow&&!0===e.options.adaptiveHeight&&!1===e.options.vertical){var t=e.$slides.eq(e.currentSlide).outerHeight(!0);if(e.$list.css("height",t),!0===e.options.arrows){var i=e.$slides.eq(e.currentSlide),o=i.is(".has_caption")?t-i.find(".gallery_image_caption").outerHeight(!0):t;e.$prevArrow.css("height",o),e.$nextArrow.css("height",o)}}},r.prototype.setOption=r.prototype.slickSetOption=function(){var e,t,i,o,n,a=this,r=!1;if("object"===d.type(arguments[0])?(i=arguments[0],r=arguments[1],n="multiple"):"string"===d.type(arguments[0])&&(i=arguments[0],o=arguments[1],r=arguments[2],"responsive"===arguments[0]&&"array"===d.type(arguments[1])?n="responsive":void 0!==arguments[1]&&(n="single")),"single"===n)a.options[i]=o;else if("multiple"===n)d.each(i,function(e,t){a.options[e]=t});else if("responsive"===n)for(t in o)if("array"!==d.type(a.options.responsive))a.options.responsive=[o[t]];else{for(e=a.options.responsive.length-1;0<=e;)a.options.responsive[e].breakpoint===o[t].breakpoint&&a.options.responsive.splice(e,1),e--;a.options.responsive.push(o[t])}r&&(a.unload(),a.reinit())},r.prototype.setPosition=function(){var e=this;e.setDimensions(),e.setHeight(),!1===e.options.fade?e.setCSS(e.getLeft(e.currentSlide)):e.setFade(),e.$slider.trigger("setPosition",[e])},r.prototype.setProps=function(){var e=this,t=document.body.style;e.positionProp=!0===e.options.vertical?"top":"left","top"===e.positionProp?e.$slider.addClass("slick-vertical"):e.$slider.removeClass("slick-vertical"),void 0===t.WebkitTransition&&void 0===t.MozTransition&&void 0===t.msTransition||!0===e.options.useCSS&&(e.cssTransitions=!0),e.options.fade&&("number"==typeof e.options.zIndex?e.options.zIndex<3&&(e.options.zIndex=3):e.options.zIndex=e.defaults.zIndex),void 0!==t.OTransform&&(e.animType="OTransform",e.transformType="-o-transform",e.transitionType="OTransition",void 0===t.perspectiveProperty&&void 0===t.webkitPerspective&&(e.animType=!1)),void 0!==t.MozTransform&&(e.animType="MozTransform",e.transformType="-moz-transform",e.transitionType="MozTransition",void 0===t.perspectiveProperty&&void 0===t.MozPerspective&&(e.animType=!1)),void 0!==t.webkitTransform&&(e.animType="webkitTransform",e.transformType="-webkit-transform",e.transitionType="webkitTransition",void 0===t.perspectiveProperty&&void 0===t.webkitPerspective&&(e.animType=!1)),void 0!==t.msTransform&&(e.animType="msTransform",e.transformType="-ms-transform",e.transitionType="msTransition",void 0===t.msTransform&&(e.animType=!1)),void 0!==t.transform&&!1!==e.animType&&(e.animType="transform",e.transformType="transform",e.transitionType="transition"),e.transformsEnabled=e.options.useTransform&&null!==e.animType&&!1!==e.animType},r.prototype.setSlideClasses=function(e){var t,i,o,n,a=this;i=a.$slider.find(".slick-slide").removeClass("slick-active slick-center slick-current").attr("aria-hidden","true"),a.$slides.eq(e).addClass("slick-current"),!0===a.options.centerMode?(t=Math.floor(a.options.slidesToShow/2),!0===a.options.infinite&&(t<=e&&e<=a.slideCount-1-t?a.$slides.slice(e-t,e+t+1).addClass("slick-active").attr("aria-hidden","false"):(o=a.options.slidesToShow+e,i.slice(o-t+1,o+t+2).addClass("slick-active").attr("aria-hidden","false")),0===e?i.eq(i.length-1-a.options.slidesToShow).addClass("slick-center"):e===a.slideCount-1&&i.eq(a.options.slidesToShow).addClass("slick-center")),a.$slides.eq(e).addClass("slick-center")):0<=e&&e<=a.slideCount-a.options.slidesToShow?a.$slides.slice(e,e+a.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false"):i.length<=a.options.slidesToShow?i.addClass("slick-active").attr("aria-hidden","false"):(n=a.slideCount%a.options.slidesToShow,o=!0===a.options.infinite?a.options.slidesToShow+e:e,a.options.slidesToShow==a.options.slidesToScroll&&a.slideCount-e<a.options.slidesToShow?i.slice(o-(a.options.slidesToShow-n),o+n).addClass("slick-active").attr("aria-hidden","false"):i.slice(o,o+a.options.slidesToShow).addClass("slick-active").attr("aria-hidden","false")),"ondemand"===a.options.lazyLoad?(Cargo.Event.on("slideshow-lazyload",a.lazyLoad,this),a.lazyLoad()):"progressive"===a.options.lazyLoad&&Cargo.Event.on("slideshow-lazyload",a.progressiveLazyLoad,this)},r.prototype.setupInfinite=function(){var e,t,i,o=this;if(!0===o.options.fade&&(o.options.centerMode=!1),!0===o.options.infinite&&!1===o.options.fade&&(t=null,o.slideCount>o.options.slidesToShow)){for(i=!0===o.options.centerMode?o.options.slidesToShow+1:o.options.slidesToShow,e=o.slideCount;e>o.slideCount-i;e-=1){t=e-1;var n=d(o.$slides[t]).clone(!0).attr({id:"","data-exclude-item":""});n.find("[data-gallery-item], [data-gallery-item] *").attr("data-exclude-item",""),n.attr("data-slick-index",t-o.slideCount).prependTo(o.$slideTrack).addClass("slick-cloned")}for(e=0;e<i;e+=1){t=e;var n=d(o.$slides[t]).clone(!0).attr({id:"","data-exclude-item":""});n.find("[data-gallery-item], [data-gallery-item] *").attr("data-exclude-item",""),n.attr("data-slick-index",t+o.slideCount).appendTo(o.$slideTrack).addClass("slick-cloned")}o.$slideTrack.find(".slick-cloned").find("[id]").each(function(){d(this).attr("id","")})}},r.prototype.interrupt=function(e){e||this.autoPlay(),this.interrupted=e},r.prototype.selectHandler=function(e){var t=this,i=d(e.target).is(".slick-slide")?d(e.target):d(e.target).parents(".slick-slide"),o=parseInt(i.attr("data-slick-index"));if(o||(o=0),t.slideCount<=t.options.slidesToShow)return t.setSlideClasses(o),void t.asNavFor(o);t.slideHandler(o)},r.prototype.slideHandler=function(e,t,i){var o,n,a,r,s,l=null,d=this;if(t=t||!1,(!0!==d.animating||!0!==d.options.waitForAnimate)&&!(!0===d.options.fade&&d.currentSlide===e||d.slideCount<=d.options.slidesToShow))if(!1===t&&d.asNavFor(e),o=e,l=d.getLeft(o),r=d.getLeft(d.currentSlide),d.currentLeft=null===d.swipeLeft?r:d.swipeLeft,!1===d.options.infinite&&!1===d.options.centerMode&&(e<0||e>d.getDotCount()*d.options.slidesToScroll))!1===d.options.fade&&(o=d.currentSlide,!0!==i?d.animateSlide(r,function(){d.postSlide(o)}):d.postSlide(o));else if(!1===d.options.infinite&&!0===d.options.centerMode&&(e<0||e>d.slideCount-d.options.slidesToScroll))!1===d.options.fade&&(o=d.currentSlide,!0!==i?d.animateSlide(r,function(){d.postSlide(o)}):d.postSlide(o));else{if(d.options.autoplay&&clearInterval(d.autoPlayTimer),n=o<0?d.slideCount%d.options.slidesToScroll!=0?d.slideCount-d.slideCount%d.options.slidesToScroll:d.slideCount+o:o>=d.slideCount?d.slideCount%d.options.slidesToScroll!=0?0:o-d.slideCount:o,d.animating=!0,d.$slider.trigger("beforeChange",[d,d.currentSlide,n]),a=d.currentSlide,d.currentSlide=n,d.setSlideClasses(d.currentSlide),d.options.asNavFor&&(s=(s=d.getNavTarget()).slick("getSlick")).slideCount<=s.options.slidesToShow&&s.setSlideClasses(d.currentSlide),d.updateDots(),d.updateArrows(),!0===d.options.fade)return!0!==i?(d.fadeSlideOut(a),d.fadeSlide(n,function(){d.postSlide(n)})):d.postSlide(n),void d.animateHeight();!0!==i?d.animateSlide(l,function(){d.postSlide(n)}):d.postSlide(n)}},r.prototype.startLoad=function(){var e=this;!0===e.options.arrows&&e.slideCount>e.options.slidesToShow&&(e.$prevArrow.hide(),e.$nextArrow.hide()),!0===e.options.dots&&e.slideCount>e.options.slidesToShow&&e.$dots.hide(),e.$slider.addClass("slick-loading")},r.prototype.swipeDirection=function(){var e,t,i,o,n=this;return e=n.touchObject.startX-n.touchObject.curX,t=n.touchObject.startY-n.touchObject.curY,i=Math.atan2(t,e),(o=Math.round(180*i/Math.PI))<0&&(o=360-Math.abs(o)),o<=45&&0<=o?!1===n.options.rtl?"left":"right":o<=360&&315<=o?!1===n.options.rtl?"left":"right":135<=o&&o<=225?!1===n.options.rtl?"right":"left":!0===n.options.verticalSwiping?35<=o&&o<=135?"down":"up":"vertical"},r.prototype.swipeEnd=function(e){var t,i,o=this;if(o.dragging=!1,o.interrupted=!1,o.shouldClick=!(10<o.touchObject.swipeLength),o.$slider.removeAttr("data-in-transition"),void 0===o.touchObject.curX)return!1;if(!0===o.touchObject.edgeHit&&o.$slider.trigger("edge",[o,o.swipeDirection()]),o.touchObject.swipeLength>=o.touchObject.minSwipe){switch(i=o.swipeDirection()){case"left":case"down":t=o.options.swipeToSlide?o.checkNavigable(o.currentSlide+o.getSlideCount()):o.currentSlide+o.getSlideCount(),o.currentDirection=0;break;case"right":case"up":t=o.options.swipeToSlide?o.checkNavigable(o.currentSlide-o.getSlideCount()):o.currentSlide-o.getSlideCount(),o.currentDirection=1}"vertical"!=i&&(o.slideHandler(t),o.touchObject={},o.$slider.trigger("swipe",[o,i]))}else o.touchObject.startX!==o.touchObject.curX&&(o.slideHandler(o.currentSlide),o.touchObject={})},r.prototype.swipeHandler=function(e){var t=this;if("move"===e.data.action&&t.showUI(),d(e.target).closest(".slick-arrow").length?clearTimeout(this.hideUITimer):"mouseleave"==e.type?this.hideUITimer=setTimeout(this.hideUI,250):this.hideUITimer=setTimeout(this.hideUI,1500),!(!1===t.options.swipe||"ontouchend"in document&&!1===t.options.swipe||!1===t.options.draggable&&-1!==e.type.indexOf("mouse")))switch(t.touchObject.fingerCount=e.originalEvent&&void 0!==e.originalEvent.touches?e.originalEvent.touches.length:1,t.touchObject.minSwipe=t.listWidth/t.options.touchThreshold,!0===t.options.verticalSwiping&&(t.touchObject.minSwipe=t.listHeight/t.options.touchThreshold),e.data.action){case"start":t.swipeStart(e);break;case"move":t.swipeMove(e);break;case"end":t.swipeEnd(e)}},r.prototype.showUI=function(){this.$slider.find(".slick-arrow").removeClass("hidden"),clearTimeout(this.hideUITimer)},r.prototype.hideUI=function(){this.hideUITimer=null,this.$slider.find(".slick-arrow").addClass("hidden")},r.prototype.swipeMove=function(e){var t,i,o,n,a,r=this;return a=void 0!==e.originalEvent?e.originalEvent.touches:null,!(!r.dragging||a&&1!==a.length)&&(t=r.getLeft(r.currentSlide),r.touchObject.curX=void 0!==a?a[0].pageX:e.clientX,r.touchObject.curY=void 0!==a?a[0].pageY:e.clientY,r.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(r.touchObject.curX-r.touchObject.startX,2))),!0===r.options.verticalSwiping&&(r.touchObject.swipeLength=Math.round(Math.sqrt(Math.pow(r.touchObject.curY-r.touchObject.startY,2)))),"vertical"!==(i=r.swipeDirection())?(void 0!==e.originalEvent&&4<r.touchObject.swipeLength&&e.preventDefault(),n=(!1===r.options.rtl?1:-1)*(r.touchObject.curX>r.touchObject.startX?1:-1),!0===r.options.verticalSwiping&&(n=r.touchObject.curY>r.touchObject.startY?1:-1),o=r.touchObject.swipeLength,(r.touchObject.edgeHit=!1)===r.options.infinite&&(0===r.currentSlide&&"right"===i||r.currentSlide>=r.getDotCount()&&"left"===i)&&(o=r.touchObject.swipeLength*r.options.edgeFriction,r.touchObject.edgeHit=!0),!1===r.options.vertical?r.swipeLeft=t+o*n:r.swipeLeft=t+o*(r.$list.height()/r.listWidth)*n,!0===r.options.verticalSwiping&&(r.swipeLeft=t+o*n),!0!==r.options.fade&&!1!==r.options.touchMove&&(!0===r.animating?(r.swipeLeft=null,!1):void r.setCSS(r.swipeLeft))):void 0)},r.prototype.swipeStart=function(e){var t,i=this;if(i.interrupted=!0,1!==i.touchObject.fingerCount||i.slideCount<=i.options.slidesToShow)return!(i.touchObject={});void 0!==e.originalEvent&&void 0!==e.originalEvent.touches&&(t=e.originalEvent.touches[0]),i.touchObject.startX=i.touchObject.curX=void 0!==t?t.pageX:e.clientX,i.touchObject.startY=i.touchObject.curY=void 0!==t?t.pageY:e.clientY,setTimeout(function(){i.interrupted&&i.$slider.attr("data-in-transition","")},10),i.dragging=!0},r.prototype.unfilterSlides=r.prototype.slickUnfilter=function(){var e=this;null!==e.$slidesCache&&(e.unload(),e.$slideTrack.children(this.options.slide).detach(),e.$slidesCache.appendTo(e.$slideTrack),e.reinit())},r.prototype.unload=function(){var e=this;d(".slick-cloned",e.$slider).remove(),e.$dots&&e.$dots.remove(),e.$prevArrow&&e.htmlExpr.test(e.options.prevArrow)&&e.$prevArrow.remove(),e.$nextArrow&&e.htmlExpr.test(e.options.nextArrow)&&e.$nextArrow.remove(),e.$slides.removeClass("slick-slide slick-active slick-visible slick-current").attr("aria-hidden","true").css("width","")},r.prototype.unslick=function(e){this.$slider.trigger("unslick",[this,e]),this.destroy()},r.prototype.updateArrows=function(){var e=this;Math.floor(e.options.slidesToShow/2),!0===e.options.arrows&&e.slideCount>e.options.slidesToShow&&!e.options.infinite&&(e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false"),e.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false"),0===e.currentSlide?(e.$prevArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$nextArrow.removeClass("slick-disabled").attr("aria-disabled","false")):e.currentSlide>=e.slideCount-e.options.slidesToShow&&!1===e.options.centerMode?(e.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")):e.currentSlide>=e.slideCount-1&&!0===e.options.centerMode&&(e.$nextArrow.addClass("slick-disabled").attr("aria-disabled","true"),e.$prevArrow.removeClass("slick-disabled").attr("aria-disabled","false")))},r.prototype.updateDots=function(){var e=this;null!==e.$dots&&(e.$dots.find("li").removeClass("slick-active").attr("aria-hidden","true"),e.$dots.find("li").eq(Math.floor(e.currentSlide/e.options.slidesToScroll)).addClass("slick-active").attr("aria-hidden","false"))},r.prototype.visibility=function(){this.options.autoplay&&(document[this.hidden]?this.interrupted=!0:this.interrupted=!1)},d.fn.slick=function(){var e,t,i=this,o=arguments[0],n=Array.prototype.slice.call(arguments,1),a=i.length;for(e=0;e<a;e++)if("object"==typeof o||void 0===o?i[e].slick=new r(i[e],o):t=i[e].slick[o].apply(i[e].slick,n),void 0!==t)return t;return i}}(),function(e,t){var i=function(e,t,i){if(!1!==e.prototype.hasOwnProperty(name))return!1;e.prototype[t]=i};i(Node,"saveable",!1),i(Node,"setSaveable",function(e){return this.saveable=e,this}),i(Node,"isSaveable",function(){return this.saveable}),Node.prototype.persistCloneNode=function(){var n=function(e,t,i){for(var o=0;o<e.childNodes.length;o++)i(e.childNodes[o],t.childNodes[o]),0<e.childNodes[o].childNodes.length&&n(e.childNodes[o],t.childNodes[o],i)},e=Node.prototype.cloneNode.apply(this,arguments);return!0===this.isSaveable()&&e.setSaveable(!0),0<this.childNodes.length&&n(this,e,function(e,t){!0===e.isSaveable()&&t.setSaveable(!0)}),e},this.core={markAsEditable:function(e){}}}(window.CargoEditor=window.CargoEditor||{}),function(){"use strict";function e(){return this.data={main_margin:0,mobile_formatting:!1,mobile_padding:0,mobile_zoom:20},this.cache={chrome:0,offset:0,size:0,window:{h:0,w:0}},_.extend(this,Backbone.Events),this.listenTo(Cargo.Event,"design:ready",this.initialize),$(document).on("ready.BaseUnit",_.bind(this.onDocumentReady,this)),this}e.prototype.addEventListeners=function(){this.listenTo(Cargo.Event,"content_load_complete",this.refresh),this.listenTo(Cargo.Event,"editor-image-added handleAdminUIChange",this.onEditorChange),this.listenTo(Cargo.Event,"handleAdminUIChange",this.handleAdminUIChange);var e=Cargo.Helper.isMobile(),t=(e?"orientationchange":"resize")+".BaseUnit",i=e&&!Cargo.Helper.isIOS()?_.debounce(_.bind(this.onWindowResize,this),150):e&&Cargo.Helper.isIOS()?_.debounce(_.bind(this.onWindowResize,this),150):_.bind(this.onWindowResize,this);return $(window).on(t,i),$(window).on("load.BaseUnit",_.bind(this.onWindowLoad,this)),this},e.prototype.removeEventListeners=function(){return this.stopListening(),$(document).off(".BaseUnit"),$(window).off(".BaseUnit"),this},e.prototype.handleAdminUIChange=function(e,t){switch(e){case"mobile_formatting":case"mobile_pages_full_width":this.data[e]=t;break;case"main_margin":case"mobile_padding":case"mobile_zoom":this.data[e]=parseFloat(t)}return this.setBaseUnit(),this.triggerEvent("refresh"),this},e.prototype.onDocumentReady=function(e){this.$html=$(document.documentElement),this.addEventListeners(),Cargo.Event.trigger("design:ready")},e.prototype.onWindowLoad=function(e){CargoEditor&&CargoEditor.events&&this.listenTo(CargoEditor.events,"editor-summary-created",this.onEditorChange),this.cacheWindowSize(),this.refresh()},e.prototype.isIphoneX=function(){var e=window.devicePixelRatio||1,t=window.screen.width*e,i=window.screen.height*e;return!(!/iPad|iPhone|iPod/.test(navigator.userAgent)||window.MSStream||1125!=t||2436!==i)},e.prototype.onWindowResize=function(e){this.cacheWindowSize(),this.setBaseUnit(),this.triggerEvent("refresh")},e.prototype.onEditorChange=_.debounce(function(){this.refresh(),Cargo.Plugins.elementResizer.refresh()},0),e.prototype.initialize=function(){var e=Cargo.Model.DisplayOptions.get("layout_options");return this.data=_.extend(this.data,e),this.data.mobile_zoom=parseFloat(this.data.mobile_zoom),this.data.mobile_padding=parseFloat(this.data.mobile_padding),this.data.main_margin=parseFloat(this.data.main_margin),this.cacheWindowSize(),this.refresh(),Cargo.Plugins.elementResizer.refresh(),this},e.prototype.refresh=function(){return this.setBaseUnit(),this.triggerEvent("refresh"),this},e.prototype.cacheWindowSize=function(){return Cargo.Helper.isMobile()?(document.documentElement.clientWidth>window.innerHeight?(this.cache.window.h=screen.width||window.innerHeight,this.cache.window.w=screen.height||document.documentElement.clientWidth,this.isIphoneX()&&(this.cache.window.w=document.documentElement.clientWidth)):(this.cache.window.h=screen.height||window.innerHeight,this.cache.window.w=screen.width||document.documentElement.clientWidth),this.cache.chrome=this.cache.window.h-window.innerHeight):(this.cache.window.h=window.innerHeight,this.cache.window.w=document.documentElement.clientWidth),this},e.prototype.setBaseUnit=function(){var e,t=0,i=this.data.mobile_padding,o=this.data.mobile_zoom-15;return this.cache.window.h>this.cache.window.w&&(t=this.cache.window.h/this.cache.window.w-1),1<(t/=.777777778)&&(t=1),i=Math.abs(i)/10,i=this.data.main_margin*i*t*-1,e=this.getBaseUnit({weight:9+o*t,min:20}),this.triggerEvent("set",{diff:t,offset:i,size:e}),this.cache.size===e||(this.$html.css("font-size",e+"%"),this.cache.size=e),this},e.prototype.getBaseUnit=function(e){e=e||{};var t=0;return t=(e=$.extend(!0,{height:this.cache.window.h,width:this.cache.window.w,min:11,max:!1,weight:5,round:!1,offset:1},e)).width<e.height?e.width:e.height,t*=e.offset,t/=100/e.weight,e.min&&t<e.min&&(t=e.min),e.max&&t>e.max&&(t=e.max),e.round&&(t=Math.floor(t)),t},e.prototype.triggerEvent=function(e,t){return e="BaseUnit:"+e,t=t||{},Cargo.Event.trigger(e,_.extend(t,{cache:this.cache,data:this.data})),this},window.BaseUnit=e}(),function(){"use strict";function e(){return this.cache={},this.data={},_.extend(this,Backbone.Events),$(document).on("ready.MobileAdjustments",_.bind(this.setup,this)),this.listenTo(Cargo.Event,"BaseUnit:refresh BaseUnit:set",this.cacheChanges),this.listenTo(Cargo.Event,"slideshow_update BaseUnit:refresh",this.stretchShortMobileContent),this.listenTo(Cargo.Event,"mobile_size",this.setMobileClass),this}e.prototype.setup=function(){this.$body=$(document.body),this.$main=$("main"),this.$containerPadding=$("[data-container-padding]"),this.$contentPadded=$(".l-content-padding"),this.$contentRuler=$("[data-content-ruler]"),this.listenTo(Cargo.Event,"BaseUnit:set content_load_complete set_render_complete thumbnails_render_complete inspector_style_changed",this.onOtherEvent)},e.prototype.stretchShortMobileContent=function(){if(!_.isEmpty(this.cache)){var e=this.cache.window.h-this.cache.chrome>=this.$contentPadded.outerHeight();return this.data.mobile_formatting||!e?this.$main.css({position:"",top:"",bottom:"",minHeight:""}):this.$main.css({position:"fixed",top:0,bottom:0,minHeight:0}),this}},e.prototype.forceMobileSizing=function(){return 85<this.$contentRuler.width()/this.data.window.w*100},e.prototype.setMobileClass=function(e){this.$body||(this.$body=$(document.body));var t=e?"addClass":"removeClass";this.is_mobile_size=e,this.$body[t]("mobile"),this.setPagesToFullWidth()},e.prototype.setMobilePaddingOffset=function(e){var s=this,t=this.$body.find(".content_padding");this.mobile_padding=parseFloat(e.mobile_padding),t.each(function(){if(s.is_mobile_size){var i,o,e=parseInt($(this).closest("[data-id]").attr("data-id")),t=Cargo.Collection.Scaffolding.getModel({id:e});if(Cargo.Helper.IsAdminEdit()&&void 0!==parent.Cargo&&void 0!==parent.Cargo.Editor&&void 0!==parent.Cargo.Editor.View&&void 0!==parent.Cargo.Editor.View.ContentView&&parent.Cargo.Editor.View.ContentView.$el.is("#editproject")&&parent.Cargo.Editor.View.ContentView.pid==e){if(i=!0,void 0===parent.Cargo.Editor.View.ContentView.layoutOptions)return;o=parent.Cargo.Editor.View.ContentView.layoutOptions.getCurrentValues()}else i=!1,o=void 0!==t?t.getPageOption("local_layout_options"):Cargo.Model.DisplayOptions.get("layout_options");var n,a,r=Cargo.Model.DisplayOptions.get("layout_options");_.each(["top","right","bottom","left"],function(e){if(n="main_margin_"+e,a=NaN,o&&void 0!==o[n]?a=i?parseFloat(o[n].value):parseFloat(o[n]):r&&void 0!==r[n]&&(a=parseFloat(r[n])),isNaN(a))this.style.removeProperty("padding-"+e);else{var t=s.calculateMobilePaddingOffset(a);this.style.setProperty("padding-"+e,t+"rem")}},this)}else this.removeAttribute("style")});var o,i=document.getElementById("site_menu_button"),n=document.getElementById("shop_button"),a=[];i&&a.push(i),n&&a.push(n),_.each(document.styleSheets,function(e){e&&e.ownerNode&&"member_stylesheet"==e.ownerNode.id&&(o=e),e&&e.publicData&&"member_stylesheet"==e.publicData.id&&(o=e)}),o&&void 0!==a[0]&&_.each(a,function(n,e){var t;try{t=o.cssRules}catch(e){console.warn(e)}if(t){var i={top:"",right:"",bottom:"",left:""};_.each(t,function(t){(function(e,t){var i=Element.prototype,o=i.matches||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||function(e){return-1!==[].indexOf.call(document.querySelectorAll(e),this)};try{return o.call(e,t)}catch(e){console.warn(e)}return!1})(n,t.selectorText)&&_.each(t.style,function(e){i.hasOwnProperty(e)&&(i[e]=t.style[e])})}),_.each(i,function(e,t){if(s.is_mobile_size){if(""!==e){var i=parseFloat(e),o=s.calculateMobilePaddingOffset(i);n.style[t]=o+"rem"}}else n.style[t]=""})}}),Cargo.Event.trigger("mobile_padding_set")},e.prototype.calculateMobilePaddingOffset=function(e){var t=e-Math.abs(this.mobile_padding)/10*e;return Number(t.toFixed(1))},e.prototype.setPagesToFullWidth=function(e){this.mobile_pages_full_width=void 0!==e?e.mobile_pages_full_width:this.data.mobile_pages_full_width;var t=this.mobile_pages_full_width&&this.is_mobile_size?"addClass":"removeClass";this.$body[t]("full_width")},e.prototype.onOtherEvent=function(){this.setMobilePaddingOffset(this.data),this.setPagesToFullWidth(this.data)},e.prototype.cacheChanges=function(e){this.cache=e.cache,this.data=e.data},e.prototype.eventPreventDefault=function(e){e.preventDefault()},window.MobileAdjustments=e}(),Cargo=window.Cargo||{},Cargo.Modal;var modal=Backbone.View.extend({id:"confirm_modal",defaults:{message:"Save changes?",modal_type:"save",selector:"body",textarea_value:""},template:null,existingLinkElement:void 0,events:{"click .modal-overlay":"ModalClose","click [data-confirm]":"ModalConfirm","click [data-deny]":"ModalDeny"},is_active:!1,blocked:!1,initialize:function(e){if(null==this.template){var t=this;$.get("/_jsapps/modal/modal.html",function(e){t.template=_.template(e)})}},render:function(){var e=this.template({modal:this.model.toJSON()});return this.$el.html(e),void 0!==Cargo.View&&void 0!==Cargo.View.Following&&!Cargo.View.Following.enabled&&null==Cargo.Homepage&&Cargo.Helper.IsAdminEdit()&&setTimeout(function(){$(this.el).attr("tabindex","-1"),$(this.el).focus(),0<$("#editor_masterview").length&&$("#editor_masterview").is(".translate")&&0<parseInt($("#panel_content").css("top"))&&$("#master_wrapper").scrollTop(parseInt($("#panel_content").css("top"))),setTimeout(function(){$(this.el).focus()}.bind(this),100)}.bind(this),100),Cargo.Event.once("enter_keycode_triggered",this.ModalConfirm,this),Cargo.Event.once("esc_keycode_triggered",this.ModalClose,this),"save"==this.model.get("modal_type")&&Cargo.Event.once("save_shortcut_triggered",this.ModalConfirm,this),void 0!==Cargo.View&&void 0!==Cargo.View.Following&&Cargo.View.Following.enabled&&Cargo.View.Following.scrollOffset&&(this.$el.find(".modal-overlay").css("top",Cargo.View.Following.scrollOffset.top+"px"),this.$el.find(".confirm-box").css("top","calc("+Cargo.View.Following.scrollOffset.top+"px + 40%)")),Cargo.Event.trigger("modal_render_complete"),this},Confirm:function(e){(e=e||{}).modal_type="confirm",this.show(e)},ConfirmWithProgress:function(e){(e=e||{}).modal_type="confirm_with_progress",this.show(e)},Alert:function(e){(e=e||{}).modal_type="alert",this.show(e)},Prompt:function(e){(e=e||{}).modal_type="prompt",this.show(e),$(document).on("keydown.confirm_modal",_.bind(function(e){!0===e.shiftKey&&13===e.keyCode&&(e.preventDefault(),this.ModalConfirm())},this)),setTimeout(_.bind(function(){var e=$("[data-modal-textarea]",this.el)[0];e.focus();var t=e.value;e.value="",e.value=t},this),300)},Dialog:function(e){(e=e||{}).modal_type="dialog",this.show(e),setTimeout(_.bind(function(){$("[data-modal-textarea]",this.el).select()},this),300)},Block:function(e){(e=e||{}).modal_type="block",this.blocked=!0,this.show(e)},Save:function(e){(e=e||{}).modal_type="save",this.show(e)},show:function(e){this.model=null,this.model=new Backbone.Model(this.defaults),_.extend(this.model.attributes,e),$(this.model.get("selector")).append(this.render().el),Cargo.Event.trigger("confirm_modal:open"),this.is_active=!0},isActive:function(){return this.is_active},ModalConfirm:function(){var e,t=this.model.get("modal_type");"function"==typeof this.model.get("confirm")&&("prompt"==t&&(e=$("[data-modal-textarea]",this.el).val()),this.model.get("confirm")(e)),this.model.set("modal_type",null),"confirm_with_progress"==t?this.ShowProgress():this.ModalClose()},ModalDeny:function(){"function"==typeof this.model.get("deny")&&this.model.get("deny")(),this.ModalClose()},ModalClose:function(){if(!0!==this.blocked){if("alert"==this.model.get("modal_type"))return this.model.set("modal_type",null),void this.ModalConfirm();this.is_active=!1,Cargo.Event.off("enter_keycode_triggered",this.ModalConfirm),Cargo.Event.off("enter_keycode_triggered",this.ModalClose),Cargo.Event.off("esc_keycode_triggered",this.ModalClose),Cargo.Event.off("save_shortcut_triggered",this.ModalConfirm),Cargo.Event.trigger("confirm_modal:close"),$(document).off("keydown.confirm_modal"),this.el.remove()}},ShowProgress:function(){this.blocked=!0,$("[data-modal-message] div").html(this.model.get("progress_message")),$("[data-deny], [data-confirm]",this.el).hide(),$("[data-progress]",this.el).show(),this.UpdateProgress(0)},UpdateProgress:function(e){var t=$("[data-progress]",this.el),i=t.find(".progress-indicator"),o=t.find(".progress-percentage");0!=e||this.processing?10<e&&(0<i.find(".loading_animation").length&&(i.removeClass("waiting"),i.find(".loading_animation").remove()),i.css("width",e+"%"),o.text(e+"%")):(i.addClass("waiting").html(Cargo.Core.Handlebars.Render("{{>loading_animation}}",{})),this.processing=!0),100==e&&(this.processing=!1,this.blocked=!1)}});Cargo.Modal=new modal;var Backdrop={Data:{require_loaded:!1},o:{}};Backdrop.o.model={},Backdrop.o.collection={},Backdrop.Model={},Backdrop.Collection={},Backdrop.View={},Backdrop.o.model.Settings=Backbone.Model.extend({constructor:function(){this.defaults={page_id:void 0,backdrop_id:1,backdrop_path:"none",data:{}},Backbone.Model.prototype.constructor.apply(this,arguments)},url:function(){var e=Cargo.API.Config;return e.api_path+"/"+e.Version+"/backdrop/"+Cargo.Model.Site.get("site_url")+"/"+this.get("page_id")+"/"+this.get("backdrop_id")}}),Backdrop.o.model.Global=Backbone.Model.extend({isNew:function(){return!0},fetch:function(e){0<$("[data-set='GlobalSettings']").length?this.set($.parseJSON($("[data-set='GlobalSettings']").html()),e):Backbone.Model.prototype.fetch.apply(this,arguments)},url:function(){var e=Cargo.API.Config;return e.api_path+"/"+e.Version+"/backdrop/"+e.cargo_url}});var Cargo=Cargo||{};Cargo.Plugins=Cargo.Plugins||{},function(){function e(){}e.prototype.initializeImage=function(e){},e.prototype.setSrcAccordingToSize=function(e){if(null!=e){var t=Math.floor(Math.min(250*Math.ceil(Math.max(childObj.actualWidth,parentWidth)/250),childObj.imageModel.get("width"))),i=childObj.imageModel.getImageWithOptions({w:t});i.retina&&.8<childObj.actualWidth/i.w&&(i=childObj.imageModel.getImageWithOptions({w:t,q:94})),(i.w>childObj.lastSize||i.q>childObj.lastQ)&&childObj.element.attr("src")!==i.url&&(childObj.element.attr("src",i.url),childObj.lastSize=i.w,childObj.lastQ=i.q,childObj.element[0].__cachedLastSize=i.w,childObj.element[0].__cachedLastQ=i.q)}},Cargo.Plugins.imageSrcLoader=new e}();var Cargo=Cargo||{},requirejs,require,define;Cargo.Plugins=Cargo.Plugins||{},Cargo.Plugins.elementResizer=function(C){var c=/googlebot|bingbot|crawler|spider|robot|crawling/i.test(navigator.userAgent);function S(e,t){var i=e&&(t(e)?e:S(e.parentNode,t));return i||null}var k={vars:{ticking:!1,initialized:!1,isInCargoFrame:function(){var e=/\/adminedit/.test(document.location.pathname)||/\/admin/.test(document.location.pathname);try{var t=parent!=window&&"object"==typeof parent.Cargo,i=null!=Cargo.Editor;return e||t||i}catch(e){return!1}}()},options:{cargo_refreshEvents:["homepage_loaded","show_index_complete","mobile_padding_set","inspector_preview","page_collection_reset","direct_link_loaded","image_gallery_init_complete"],generic_refreshEvents:[],updateEvents:["resize","orientationchange"],selectors:["img","object","iframe","video",".elementresizer","[data-elementresizer-child]",".audio_component"],targets:{},minimumHeight:1,minimumWidth:1,centerElements:!0,adjustElementsToWindowHeight:!0,forceMobileImagesFullWidth:!1,forceMargin:!1,scrollTransition:!1,scrollTransitionThreshold:-100,forceVerticalMargin:40,forceHorizontalMargin:0,allowInit:!0},init:function(){function i(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent&&e.attachEvent("on"+t,i)}if(this.isMobile=!!Cargo.Helper&&Cargo.Helper.isMobile(),Cargo.Event.trigger("element_resizer_init",x),!k.options.allowInit)return!1;var o,e=document.createElement("img");e.classList.add("scroll-transition-fade","below-viewport");var t=document.createElement("div");t.classList.add("content"),t.appendChild(e),document.body.appendChild(t);var n=window.getComputedStyle(e).getPropertyValue("transform"),a=-1<n.indexOf("matrix("),r=-1<n.indexOf("matrix3d("),s=0,l=0;if(a){n=n.replace(")","").replace("matrix(","").split(",");for(var d=0;d<n.length;d++)n[d]=parseFloat(n[d])||0;l=n[n.length-1],s=n[n.length-2]}else if(r){n=n.replace(")","").replace("matrix3d(","").split(",");for(d=0;d<n.length;d++)n[d]=parseFloat(n[d]);l=n[n.length-3],s=n[n.length-4]}document.body.removeChild(t),this.imageTransforms={x:s,y:l},C.each(k.options.updateEvents,function(e,t){i(window,t,function(){k.requestTick(),"orientationchange"===t&&(clearTimeout(o),o=setTimeout(function(){k.requestTick()},160))})}),C.each(k.options.generic_refreshEvents,function(e,t){i(window,t,function(){k.refresh()})}),Cargo.Event.on("pagination_complete",function(){k.matchImagesWithImageModels(),k.refresh(!0)}),C.each(k.options.cargo_refreshEvents,function(e,t){Cargo.hasOwnProperty("Event")&&Cargo.Event.on(t,function(){k.requestRefreshTick()})}),Cargo.hasOwnProperty("Event")&&Cargo.Event.on("inspector_open",function(){CargoInspector.eventManager.subscribe("style_changed",function(e){k.requestTick()})});try{var c=window.matchMedia("(-webkit-min-device-pixel-ratio: 1.5)");"function"==typeof c.addListener&&c.addListener(function(){k.setResponsiveImageSrcs(),scrollMonitor.update()})}catch(e){}Cargo.Event.on("content_load_complete",function(){k.matchImagesWithImageModels(),k.requestTick()}),Cargo.Event.on("thumbnails_hide",function(){_.defer(function(){k.update()})}),Cargo.Event.on("thumbnails_render_complete",function(){scrollMonitor.update()}),void 0!==Cargo.Collection&&void 0!==Cargo.Collection.Scaffolding&&Cargo.Collection.Scaffolding.on("add",_.debounce(function(){k.matchImagesWithImageModels(),k.update()},1)),Cargo.Event.on("pin_load_complete",function(){k.requestRefreshTick()}),k.vars.initialized=!0,k.refresh()},refresh:function(a){if(!0!==a&&(a=!1),!k.vars.initialized)return!1;var e=C("[data-elementresizer]");a||(k.options.targets={}),e.each(function(e,t){if(a&&_.find(k.options.targets,function(e){return e.container[0]===t}))return;var i=C(t).find(k.options.selectors.join(",")),o=C(S(t,function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.hasAttribute("data-resize-parent")}));0==o.length&&(o=C("body"));var v=[];i.each(function(e,t){var i=S((t=C(t))[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE&&"DIV"===e.nodeName)return e.classList.contains("image-gallery")});if((!i||i.classList.contains("initialized"))&&(null===S(t[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.hasAttribute("data-no-elementresizer")})&&!t[0].hasAttribute("data-no-elementresizer"))){var o=S(t[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.hasAttribute("grid-col")}),n=S(t[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE&&"DIV"===e.nodeName)return e.classList.contains("slick")}),a=S(t[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE&&"DIV"===e.nodeName)return e.hasAttribute("thumbnails")}),r=S(t[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE&&"DIV"===e.nodeName)return"wallpaper"==e.getAttribute("data-backdrop")}),s=S(t[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE&&"DIV"===e.nodeName)return e.classList.contains("page_container")&&e.classList.contains("overlay")&&e.classList.contains("accommodate")});fixedPinParent=S(t[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE&&"DIV"===e.nodeName)return e.classList.contains("page_container")&&e.classList.contains("fixed")}),marqueeParent=S(t[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE&&"DIV"===e.nodeName)return e.classList.contains("marquee")});var l=t.width(),d=t.height(),c=parseInt(t.attr("data-rotation"))||0,h=parseInt(t.attr("width")),u=parseInt(t.attr("height")),g="string"==typeof t.attr("height")&&-1!==t.attr("height").indexOf("%"),p="string"==typeof t.attr("width")&&-1!==t.attr("width").indexOf("%"),m=isNaN(h)?l:h,f=isNaN(u)?d:u;minimumHeight=k.constrain(k.options.minimumHeight,0,f),minimumWidth=k.constrain(k.options.minimumWidth,0,m),childObj={element:t,hasBeenHandled:!1,originalWidth:m,originalHeight:f,widthIsPercentage:p,heightIsPercentage:g,actualWidth:h,actualHeight:u,actualRotation:c,minimumHeight:minimumHeight>f?f:minimumHeight,minimumWidth:minimumWidth>m?m:minimumWidth,ratio:f/m,isDraggable:t[0].hasAttribute("data-draggable"),isInWallpaper:null!==r,isInSlideshow:null!==n,isInMarquee:null!==marqueeParent,isInColumns:null!==o,isInThumbnails:null!==a,isInGallery:null!==i,isinFixedPinnedPage:null!==fixedPinParent,isInAdjustingPinnedPage:null!==s,nodeName:t[0].nodeName.toLowerCase(),isAudioPlayer:t.hasClass("audio_component"),noResize:0<t.parent("[data-elementresizer-no-resize]").length||t[0].hasAttribute("data-elementresizer-no-resize"),noCentering:0<t.parent("[data-elementresizer-no-centering]").length||t[0].hasAttribute("data-elementresizer-no-centering"),noVerticalResize:0<t.parent("[data-elementresizer-no-vertical-resize]").length||t[0].hasAttribute("data-elementresizer-no-vertical-resize"),prevLeftMargin:0,lastSize:t[0]._cachedLastSize?t[0]._cachedLastSize:0,lastQ:t[0]._cachedLastQ?t[0]._cachedLastQ:0,isSoundCloudFrame:-1!==(t.attr("src")+"").indexOf("soundcloud")&&"IFRAME"===t[0].nodeName},v.push(childObj)}}),v=v.concat([]);var n=parseInt(C(o).css("paddingLeft"))+parseInt(C(o).css("paddingRight"));isNaN(n)&&(n=0),k.options.targets[_.uniqueId()]={container:C(t),resize_parent:o,children:v,padding:n}}),k.matchImagesWithImageModels(),k.update()},matchImagesWithImageModels:function(){_.each(k.options.targets,function(e){if(Cargo.View.ImagesView)_.each(e.children,function(e){if(e.element[0].nodeType===Node.ELEMENT_NODE&&"IMG"===e.element[0].nodeName){var t=parseInt(e.element[0].getAttribute("data-mid"));isNaN(t)||(e.imageModel=Cargo.View.ImagesView.collection.findWhere({id:t}))}});else if(e.container[0].hasAttribute("thumbnails"))_.each(e.children,function(e){if(!e.imageModel){var t=S(e.element[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE&&"DIV"===e.nodeName)return e.classList.contains("thumbnail")});if(t){var i=parseInt(t.getAttribute("data-id")),o=Cargo.View.Thumbnail.collection.get(i);if(o&&o.get("thumb_meta")&&o.get("thumb_meta").thumbnail_crop&&o.get("thumb_meta").thumbnail_crop.imageModel)e.imageModel=new Cargo.o.model.image(o.get("thumb_meta").thumbnail_crop.imageModel);else{var n=Cargo.Collection.Scaffolding.getModel({id:i});if(void 0!==n&&void 0!==n.get("images")){var a=parseInt(e.element[0].getAttribute("data-mid"));isNaN(a)||(e.imageModel=_.where(n.get("images"),{id:a})[0])}}}}});else{var t,i=S(e.container[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE&&"DIV"===e.nodeName)return e.hasAttribute("data-id")});if(i&&(t=parseInt(i.getAttribute("data-id"))),!isNaN(t)){var o=Cargo.Collection.Scaffolding.getModel({id:parseInt(t)});void 0!==o&&void 0!==o.get("images")&&_.each(e.children,function(e){var t=parseInt(e.element[0].getAttribute("data-mid"));isNaN(t)||(e.imageModel=_.where(o.get("images"),{id:t})[0])})}}})},requestRefreshTick:function(){k.vars.refresh_ticking||(requestAnimationFrame(function(){k.refresh()}),k.vars.refresh_ticking=!0)},requestTick:function(){k.vars.ticking||(requestAnimationFrame(function(){k.vars.refresh_ticking||k.update()}),k.vars.ticking=!0)},constrain:function(e,t,i){return i<e?i:e<t?t:e},update:function(){var e,t,i;for(e in k.options.targets){var o=(i=k.options.targets[e]).container.width(),n=(i.padding,i.resize_parent.width()-k.options.forceHorizontalMargin),a=k.options.adjustElementsToWindowHeight?document.documentElement.clientHeight-k.options.forceVerticalMargin:9e9,r=k.options.forceMobileImagesFullWidth&&Cargo.Helper.IsMobileWindowSize(document.documentElement.clientWidth),s=1;k.options.adjustElementsToWindowHeight&&void 0!==window.orientation&&0!=window.orientation&&(g=document.documentElement.clientWidth-(!1===k.options.forceMargin?40:k.options.forceMargin));var l=!!k.vars.isInCargoFrame&&null!==S(i.container[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.classList.contains("page_content")});for(t in i.children){var d,c=n,h=(d=i.children[t]).minimumHeight,u=d.minimumWidth,g=a,p=r&&!d.isInMarquee?1:parseInt(d.element.attr("data-scale"))/100||1;if(rotation=parseInt(d.element[0].getAttribute("data-rotation")),transformX=d.isDraggable?d.element[0].getAttribute("data-transform-x"):0,transformY=d.isDraggable?d.element[0].getAttribute("data-transform-y"):0,!d.noResize){if(d.isInColumns){var m=S(d.element[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.hasAttribute("grid-col")});m&&(o=c=C(m).width(),c-=k.options.forceHorizontalMargin)}if(d.noVerticalResize)g=9e9;else{var f=S(i.container[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.classList.contains("content_padding")}),v=0;f&&(v+=Math.ceil(parseFloat(C(f).css("padding-top"),10))),!d.isInAdjustingPinnedPage&&Cargo.View.PinnedTop.pinCollection.findWhere({content_accommodate_page:!0})&&(v+=Cargo.View.PinnedTop.pinCollection.findWhere({content_accommodate_page:!0}).get("page_height")),g=a+-2*(v=Math.min(v,.25*a))}var b=d.actualWidth,y=d.actualHeight;c=c*p,k.constrain(c-b,1,9e9),k.constrain(g-y,1,9e9),s=[c/d.actualWidth,g/d.actualHeight];if(s=Math.min(s[0],s[1]),y=k.constrain(y*s,-9e9,d.originalHeight),b=k.constrain(b*s,-9e9,d.originalWidth),d.widthIsPercentage?(b=o/100*d.originalWidth,y=d.heightIsPercentage?d.originalHeight/100*b:d.originalHeight):d.heightIsPercentage&&(y=b/100*d.originalHeight),(y<=h||b<=u)&&(s=[u/b,h/y],y*=s=Math.max(s[0],s[1]),b*=s),(!1===d.hasBeenHandled||.5<Math.abs(d.actualWidth-b)||.5<Math.abs(d.actualHeight-y)||d.actualRotation!==rotation)&&!isNaN(b)&&!isNaN(y)){d.actualWidth=b,d.actualHeight=y,d.actualRotation=rotation;var w=d.isInGallery||isNaN(rotation)?"":"rotate("+rotation+"deg)";(transformX||transformY)&&(w="translate("+transformX+"%, "+transformY+"%) "+w),d.element.add("object"===d.nodeName?d.element.find("embed"):"").css({width:d.actualWidth+"px",height:d.actualHeight+"px",transform:w}),d.hasBeenHandled=!0}}k.options.centerElements&&!d.noCentering&&k.setLeftMargin(d,o),function(o){var e=o.isInGallery||o.isInThumbnails?o.element.parent():o.element;if(o.isInSlideshow&&o.isInGallery&&(e=C(S(o.element[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.classList.contains("image-gallery")}))),o.isInMarquee&&(e=C(S(o.element[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.classList.contains("marquee")}))),!l&&"undefined"!=typeof scrollMonitor&&!o.isinFixedPinnedPage)if(void 0!==o.element[0]._scrollWatcher||o.isInSlideshow&&o.isInGallery||o.isInMarquee||(o.element[0]._scrollWatcher=scrollMonitor.create(o.element[0],this.isMobile?screen.height/4:screen.height),o.element[0]._scrollWatcher.enterViewport(function(){if(!S(this.watchItem,function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return"BODY"===e.nodeName}))return this.watchItem._scrollWatcher.destroy(),void 0!==this.watchItem._scrollWatchEnterThreshold&&this.watchItem._scrollWatchEnterThreshold.destroy(),void(void 0!==this.watchItem._referenceScrollWatch&&this.watchItem._referenceScrollWatch.destroy());this.watchItem._animationFrameCancelID=requestAnimationFrame(_.bind(function(){this.watchItem.hasAttribute("data-lazy-src")&&(this.watchItem.setAttribute("src",this.watchItem.getAttribute("data-lazy-src")),this.watchItem.removeAttribute("data-lazy-src")),k.options.scrollTransition&&!l&&e.css("will-change","opacity, transform"),delete this.watchItem._animationFrameCancelID},this))}),o.element[0]._scrollWatcher.exitViewport(function(){this.watchItem._animationFrameCancelID&&cancelAnimationFrame(this.watchItem._animationFrameCancelID),this.isBelowViewport&&k.options.scrollTransition&&!l&&e.css("will-change","")})),k.options.scrollTransition){l||e.addClass("scroll-transition-fade"),void 0!==o.element[0]._scrollWatchEnterThreshold||e[0]._is_watched||(o.element[0]._scrollWatchEnterThreshold=scrollMonitor.create(e[0],k.options.scrollTransitionThreshold),e[0]._is_watched=!0,o.element[0]._scrollWatchEnterThreshold.enterViewport(function(){this.watchItem._startScrollWatchLeave&&(cancelAnimationFrame(this.watchItem._startScrollWatchLeave),delete this.watchItem._startScrollWatchLeave),this.watchItem._endScrollWatchLeave&&(cancelAnimationFrame(this.watchItem._endScrollWatchLeave),delete this.watchItem._endScrollWatchLeave);var e=0,t=0,i=0;o.isDraggable&&(e=o.element[0].getAttribute("data-transform-x")||0,t=o.element[0].getAttribute("data-transform-y")||0,i=o.element[0].getAttribute("data-transform-z")||0),this.watchItem.style.transitionDuration="",o.isInMarquee?this.watchItem.style.transform="":o.isInGallery&&o.actualRotation?this.watchItem.style.transform="rotate("+-o.actualRotation+"deg) translate("+e+"%, "+t+"%) rotate("+o.actualRotation+"deg) translateZ("+i+"px)":o.actualRotation||o.isDraggable?this.watchItem.style.transform="translate("+e+"%, "+t+"%) rotate("+o.actualRotation+"deg) translateZ("+i+"px)":this.watchItem.style.transform="",this.watchItem.classList.remove("below-viewport")})),void 0===o.element[0]._referenceScrollWatch&&(o.element[0]._referenceScrollWatch=scrollMonitor.create(e[0]),o.element[0]._referenceScrollWatch.enterViewport(function(){if(scrollMonitor.documentHeight-this.bottom<=-1*k.options.scrollTransitionThreshold){var e=0,t=0,i=0;o.isDraggable&&(e=o.element[0].getAttribute("data-transform-x")||0,t=o.element[0].getAttribute("data-transform-y")||0,i=o.element[0].getAttribute("data-transform-z")||0),o.isInMarquee?this.watchItem.style.transform="":o.isInGallery&&o.actualRotation?this.watchItem.style.transform="rotate("+-o.actualRotation+"deg) translate("+e+"%, "+t+"%) rotate("+o.actualRotation+"deg) translateZ("+i+"px)":o.actualRotation||o.isDraggable?this.watchItem.style.transform="translate("+e+"%, "+t+"%) rotate("+o.actualRotation+"deg) translateZ("+i+"px)":this.watchItem.style.transform="",this.watchItem.classList.remove("below-viewport")}}),o.element[0]._referenceScrollWatch.exitViewport(function(){if(this.isBelowViewport&&!l)this.watchItem.style.transitionDuration="initial",this.watchItem._startScrollWatchLeave=requestAnimationFrame(_.bind(function(){this.watchItem.classList.add("below-viewport");var e=0,t=0,i=0;o.isDraggable&&(e=o.element[0].getAttribute("data-transform-x")||0,t=o.element[0].getAttribute("data-transform-y")||0,i=o.element[0].getAttribute("data-transform-z")||0),o.isInMarquee?this.watchItem.style.transform="":o.actualRotation&&o.isInGallery?this.watchItem.style.transform="rotate("+-o.actualRotation+"deg) translate("+k.imageTransforms.x+"px, "+k.imageTransforms.y+"px) rotate("+o.actualRotation+"deg) translateZ("+i+"px)":!o.actualRotation||e||t?o.isDraggable?this.watchItem.style.transform="translate("+e+"%, "+t+"%) translate("+k.imageTransforms.x+"px, "+k.imageTransforms.y+"px) rotate("+o.actualRotation+"deg) translateZ("+i+"px)":this.watchItem.style.transform="":this.watchItem.style.transform="translate("+k.imageTransforms.x+"px, "+k.imageTransforms.y+"px) rotate("+o.actualRotation+"deg) translateZ("+i+"px)",void 0!==o.element[0]._scrollWatchEnterThreshold&&o.element[0]._scrollWatchEnterThreshold.recalculateLocation(),void 0!==o.element[0]._referenceScrollWatch&&o.element[0]._referenceScrollWatch.recalculateLocation(),this.watchItem._endScrollWatchLeave=requestAnimationFrame(_.bind(function(){this.watchItem.style.transitionDuration=""},this))},this));else if(this.isAboveViewport){this.watchItem.classList.remove("below-viewport");var e=0,t=0,i=0;o.isDraggable&&(e=o.element[0].getAttribute("data-transform-x")||0,t=o.element[0].getAttribute("data-transform-y")||0,i=o.element[0].getAttribute("data-transform-z")||0),o.isInMarquee?this.watchItem.style.transform="":o.isInGallery&&o.actualRotation?this.watchItem.style.transform="rotate("+-o.actualRotation+"deg) translate("+e+"%, "+t+"%) rotate("+o.actualRotation+"deg) translateZ("+i+"px)":o.actualRotation||o.isDraggable?this.watchItem.style.transform="translate("+e+"%, "+t+"%) rotate("+o.actualRotation+"deg) translateZ("+i+"px)":this.watchItem.style.transform="",this.watchItem.style.willChange=""}})),void 0===e[0]._reCalculateScrolMonitorOnTransitionEnd&&(e[0]._reCalculateScrolMonitorOnTransitionEnd=function(e){var t=e.propertyName;"transform"!=t&&"top"!=t&&"margin-top"!=t&&"margin"!=t||(void 0!==o.element[0]._scrollWatchEnterThreshold&&(o.element[0]._scrollWatchEnterThreshold.recalculateLocation(),o.element[0]._scrollWatchEnterThreshold.update(),o.element[0]._scrollWatchEnterThreshold.triggerCallbacks()),void 0!==o.element[0]._referenceScrollWatch&&(o.element[0]._referenceScrollWatch.recalculateLocation(),o.element[0]._referenceScrollWatch.update(),o.element[0]._referenceScrollWatch.triggerCallbacks()))},e[0].addEventListener("transitionend",e[0]._reCalculateScrolMonitorOnTransitionEnd));var t=C(o.element[0]._referenceScrollWatch.watchItem);t[0].style.transitionDuration="",t[0].classList.remove("below-viewport");var i=0,n=0,a=0;o.isDraggable&&(i=o.element[0].getAttribute("data-transform-x")||0,n=o.element[0].getAttribute("data-transform-y")||0,a=o.element[0].getAttribute("data-transform-z")||0),o.isInMarquee?t[0].style.transform="":o.isInGallery&&o.actualRotation?t[0].style.transform="rotate("+-o.actualRotation+"deg) translate("+i+"%, "+n+"%) rotate("+o.actualRotation+"deg) translateZ("+a+"px)":o.actualRotation||o.isDraggable?t[0].style.transform="translate("+i+"%, "+n+"%) rotate("+o.actualRotation+"deg) translateZ("+a+"px)":t[0].style.transform="",o.element[0]._referenceScrollWatch.isInViewport||o.element[0]._referenceScrollWatch.isAboveViewport||(o.isInMarquee?t[0].style.transform="":o.actualRotation&&o.isInGallery?t[0].style.transform="rotate("+-o.actualRotation+"deg) translate("+k.imageTransforms.x+"px, "+k.imageTransforms.y+"px) rotate("+o.actualRotation+"deg) translateZ("+a+"px)":!o.actualRotation||i||n?o.isDraggable?t[0].style.transform="translate("+i+"%, "+n+"%) translate("+k.imageTransforms.x+"px, "+k.imageTransforms.y+"px) rotate("+o.actualRotation+"deg) translateZ("+a+"px)":t[0].style.transform="":t[0].style.transform="translate("+k.imageTransforms.x+"px, "+k.imageTransforms.y+"px) rotate("+o.actualRotation+"deg) translateZ("+a+"px)",t[0].classList.add("below-viewport"))}else void 0!==e[0]._scrollWatchEnterThreshold&&(e[0]._scrollWatchEnterThreshold.destroy(),delete e[0]._scrollWatchEnterThreshold,e.style.transform="",e.style.willChange="",e.removeClass("scroll-transition-fade below-viewport")),void 0!==e[0]._referenceScrollWatch&&(e[0]._referenceScrollWatch.destroy(),delete e[0]._referenceScrollWatch),void 0!==e[0]._reCalculateScrolMonitorOnTransitionEnd&&(e[0].removeEventListener("transitionend",e[0]._reCalculateScrolMonitorOnTransitionEnd),delete e[0]._reCalculateScrolMonitorOnTransitionEnd)}(d)}}k.setResponsiveImageSrcs(),k.vars.ticking=!1,k.vars.refresh_ticking=!1,"undefined"!=typeof scrollMonitor&&scrollMonitor.update(),Cargo.Event.trigger("elementresizer_update_complete",x)},setResponsiveImageSrcs:function(){var d=!1;_.each(this.options.targets,function(e){var t,i,o,n=e.container.width(),a=250;for(o=0;o<e.children.length;o++)if(i=e.children[o],isNaN(i.actualWidth)||void 0===i.imageModel||"function"!=typeof i.imageModel.get)c&&i.element[0].setAttribute("src",i.element[0].getAttribute("data-src"));else if(c)if(3500<i.imageModel.get("width")){var r=i.imageModel.getImageWithOptions({w:3500});i.element[0].getAttribute("src")!==r.url&&i.element[0].setAttribute("src",r.url)}else i.element[0].setAttribute("src",i.element[0].getAttribute("data-src"));else{var s=!1;if(i.isInThumbnails)n=i.element[0].parentElement.offsetWidth,n=Math.max(.01*parseFloat(i.element[0].style.width)*n,n)||n,t=Math.floor(Math.min(Math.ceil(n/a)*a,i.imageModel.get("width"))),s=!0;else if(i.isInGallery){var l=S(i.element[0],function(e){if(e&&e.nodeType===Node.ELEMENT_NODE)return e.classList.contains("gallery_card")});if(!l)continue;n=l.offsetWidth,t=Math.floor(Math.min(Math.ceil(n/a)*a,i.imageModel.get("width"))),s=!0}else i.isInWallpaper?(n=i.element[0].parentElement.offsetWidth,t=Math.floor(Math.min(Math.ceil(n/a)*a,i.imageModel.get("width"))),s=!0):t=i.isInColumns?(n=i.element[0].parentElement.offsetWidth,Math.floor(Math.min(Math.ceil(Math.max(i.actualWidth,n)/a)*a,i.imageModel.get("width")))):Math.floor(Math.min(Math.ceil(i.actualWidth/a)*a,i.imageModel.get("width")));if(0!=t)(r=i.imageModel.getImageWithOptions({w:t})).retina&&(s&&.51<n/r.w||.51<i.actualWidth/r.w)&&(r=i.imageModel.getImageWithOptions({w:t,q:94})),0<=r.w&&(r.w>i.lastSize||r.q>i.lastQ)&&(i.isInSlideshow&&!i.element[0].hasAttribute("src")?(i.element[0].hasAttribute("data-lazy")||(d=!0),i.element[0].hasAttribute("data-lazy")!==r.url&&i.element[0].setAttribute("data-lazy",r.url)):i.element[0]._scrollWatcher&&!i.isInWallpaper?i.element[0]._scrollWatcher.isInViewport?i.element[0].getAttribute("src")!==r.url&&i.element[0].setAttribute("src",r.url):i.element[0].getAttribute("src")!==r.url&&i.element[0].getAttribute("data-lazy-src")!==r.url&&i.element[0].setAttribute("data-lazy-src",r.url):i.element[0].getAttribute("src")!==r.url&&i.element[0].setAttribute("src",r.url),i.lastSize=r.w,i.lastQ=r.q,i.element[0]._cachedLastSize=r.w,i.element[0]._cachedLastQ=r.q)}},this),d&&Cargo.Event.trigger("slideshow-lazyload")},setLeftMargin:function(e,t,i){var o;o=e.isSoundCloudFrame?(t-e.element.width())/2:(t-e.actualWidth)/2,isNaN(o)||(e.prevLeftMargin!==o&&e.element.css("marginLeft",o),e.prevLeftMargin=o)}},x={options:k.options,init:k.init,refresh:k.refresh,update:k.update,requestTick:k.requestTick,requestRefreshTick:k.requestRefreshTick,setOptions:function(e){C.extend(k.options,e),!1!==k.options.forceMargin&&(k.options.forceHorizontalMargin=k.options.forceMargin,k.options.forceVerticalMargin=k.options.forceMargin),k.options.allowInit&&k.vars.initialized&&k.update()},targets:function(){return k.options.targets}};return C(function(){k.init()}),x}(jQuery),function(ii,oi){"use strict";this.PhotoSwipe=function(u,n,e,t){var m={features:null,bind:function(e,t,i,o){var n=(o?"remove":"add")+"EventListener";t=t.split(" ");for(var a=0;a<t.length;a++)t[a]&&e[n](t[a],i,!1)},isArray:function(e){return e instanceof Array},createEl:function(e,t){var i=document.createElement(t||"div");return e&&(i.className=e),i},getScrollY:function(){var e=ii.pageYOffset;return e!==oi?e:document.documentElement.scrollTop},unbind:function(e,t,i){m.bind(e,t,i,!0)},removeClass:function(e,t){var i=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className=e.className.replace(i," ").replace(/^\s\s*/,"").replace(/\s\s*$/,"")},addClass:function(e,t){m.hasClass(e,t)||(e.className+=(e.className?" ":"")+t)},hasClass:function(e,t){return e.className&&new RegExp("(^|\\s)"+t+"(\\s|$)").test(e.className)},getChildByClass:function(e,t){for(var i=e.firstChild;i;){if(m.hasClass(i,t))return i;i=i.nextSibling}},arraySearch:function(e,t,i){for(var o=e.length;o--;)if(e[o][i]===t)return o;return-1},extend:function(e,t,i){for(var o in t)if(t.hasOwnProperty(o)){if(i&&e.hasOwnProperty(o))continue;e[o]=t[o]}},easing:{sine:{out:function(e){return Math.sin(e*(Math.PI/2))},inOut:function(e){return-(Math.cos(Math.PI*e)-1)/2}},cubic:{out:function(e){return--e*e*e+1}}},detectFeatures:function(){if(m.features)return m.features;var e=m.createEl(),t=e.style,i="",o={};if(o.oldIE=document.all&&!document.addEventListener,o.touch="ontouchstart"in ii,ii.requestAnimationFrame&&(o.raf=ii.requestAnimationFrame,o.caf=ii.cancelAnimationFrame),o.pointerEvent=navigator.pointerEnabled||navigator.msPointerEnabled,!o.pointerEvent){var n=navigator.userAgent;if(/iP(hone|od)/.test(navigator.platform)){var a=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);a&&0<a.length&&1<=(a=parseInt(a[1],10))&&a<8&&(o.isOldIOSPhone=!0)}var r=n.match(/Android\s([0-9\.]*)/),s=r?r[1]:0;1<=(s=parseFloat(s))&&(s<4.4&&(o.isOldAndroid=!0),o.androidVersion=s),o.isMobileOpera=/opera mini|opera mobi/i.test(n)}for(var l,d,c=["transform","perspective","animationName"],h=["","webkit","Moz","ms","O"],u=0;u<4;u++){i=h[u];for(var g=0;g<3;g++)l=c[g],d=i+(i?l.charAt(0).toUpperCase()+l.slice(1):l),!o[l]&&d in t&&(o[l]=d);i&&!o.raf&&(i=i.toLowerCase(),o.raf=ii[i+"RequestAnimationFrame"],o.raf&&(o.caf=ii[i+"CancelAnimationFrame"]||ii[i+"CancelRequestAnimationFrame"]))}if(!o.raf){var p=0;o.raf=function(e){var t=(new Date).getTime(),i=Math.max(0,16-(t-p)),o=ii.setTimeout(function(){e(t+i)},i);return p=t+i,o},o.caf=function(e){clearTimeout(e)}}return o.svg=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,m.features=o}};m.detectFeatures(),m.features.oldIE&&(m.bind=function(e,t,i,o){t=t.split(" ");for(var n,a=(o?"detach":"attach")+"Event",r=function(){i.handleEvent.call(i)},s=0;s<t.length;s++)if(n=t[s])if("object"==typeof i&&i.handleEvent){if(o){if(!i["oldIE"+n])return!1}else i["oldIE"+n]=r;e[a]("on"+n,i["oldIE"+n])}else e[a]("on"+n,i)});var g=this,p={allowPanToNext:!0,spacing:.12,bgOpacity:1,mouseUsed:!1,loop:!0,pinchToClose:!0,closeOnScroll:!0,closeOnVerticalDrag:!0,verticalDragRange:.75,hideAnimationDuration:333,showAnimationDuration:333,showHideOpacity:!1,focus:!0,escKey:!0,arrowKeys:!0,mainScrollEndFriction:.35,panEndFriction:.35,isClickableElement:function(e){return"A"===e.tagName},getDoubleTapZoom:function(e,t){return e?1:t.initialZoomLevel<.7?1:1.33},maxSpreadZoom:1.33,modal:!0,scaleMode:"fit"};m.extend(p,t);var l,a,o,f,r,s,h,d,c,v,b,y,w,_,C,S,k,x,E,I,T,A,M,P,O,L,D,N,$,V,H,R,G,F,B,z,q,W,j,U,K,Z,i,X,Y,J,Q,ee,te,ie,oe,ne,ae,re,se,le,de={x:0,y:0},ce={x:0,y:0,rotation:0},he={x:0,y:0,rotation:0},ue={},ge=0,pe={},me={x:0,y:0},fe=0,ve=!0,be=[],ye={},we=!1,_e=function(e,t){m.extend(g,t.publicMethods),be.push(e)},Ce=function(e){var t=Ft();return t-1<e?e-t:e<0?t+e:e},Se={},ke=function(e,t){return Se[e]||(Se[e]=[]),Se[e].push(t)},xe=function(e){var t=Se[e];if(t){var i=Array.prototype.slice.call(arguments);i.shift();for(var o=0;o<t.length;o++)t[o].apply(g,i)}},Ee=function(){return(new Date).getTime()},Ie=function(e){re=e,g.bg.style.opacity=e*p.bgOpacity},Te=function(e,t,i,o,n,a){(!we||n&&n!==g.currItem)&&(o/=n?n.fitRatio:g.currItem.fitRatio),e[A]=y+t+"px, "+i+"px"+w+" scale("+o+") rotateZ("+a+"rad)"},Ae=function(e){te&&(e&&(v>g.currItem.fitRatio?we||(Xt(g.currItem,!1,!0),we=!0):we&&(Xt(g.currItem),we=!1)),Te(te,he.x,he.y,v,null,he.rotation))},Me=function(e){e.container&&Te(e.container.style,e.initialPosition.x,e.initialPosition.y,e.initialZoomLevel,e,0)},Pe=function(e,t){t[A]=y+e+"px, 0px"+w},Oe=function(e,t){if(!p.loop&&t){var i=f+(me.x*ge-e)/me.x,o=Math.round(e-ct.x);(i<0&&0<o||i>=Ft()-1&&o<0)&&(e=ct.x+o*p.mainScrollEndFriction)}ct.x=e,Pe(e,r)},Le=function(e,t){var i=ht[e]-pe[e];return ce[e]+de[e]+i-i*(t/b)},De=function(e,t){e.x=t.x,e.y=t.y,t.id&&(e.id=t.id)},Ne=function(e){e.x=Math.round(e.x),e.y=Math.round(e.y)},$e=null,Ve=function(){$e&&(m.unbind(document,"mousemove",Ve),m.addClass(u,"pswp--has_mouse"),p.mouseUsed=!0,xe("mouseUsed")),$e=setTimeout(function(){$e=null},100)},He=function(e,t){var i=jt(g.currItem,ue,e);return t&&(ee=i),i},Re=function(e){return e||(e=g.currItem),e.initialZoomLevel},Ge=function(e){return e||(e=g.currItem),0<e.w?p.maxSpreadZoom:1},Fe=function(e,t,i,o){return o===g.currItem.initialZoomLevel?(i[e]=g.currItem.initialPosition[e],!0):(i[e]=Le(e,o),i[e]>t.min[e]?(i[e]=t.min[e],!0):i[e]<t.max[e]&&(i[e]=t.max[e],!0))},Be=function(e){var t="";p.escKey&&27===e.keyCode?t="close":p.arrowKeys&&(37===e.keyCode?t="prev":39===e.keyCode&&(t="next")),t&&(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey||(e.preventDefault?e.preventDefault():e.returnValue=!1,g[t]()))},ze=function(e){e&&(Z||K||ie||q)&&(e.preventDefault(),e.stopPropagation())},qe=function(){g.setScrollOffset(0,m.getScrollY())},We={},je=0,Ue=function(e){We[e]&&(We[e].raf&&L(We[e].raf),je--,delete We[e])},Ke=function(e){We[e]&&Ue(e),We[e]||(je++,We[e]={})},Ze=function(){for(var e in We)We.hasOwnProperty(e)&&Ue(e)},Xe=function(e,t,i,o,n,a,r){var s,l=Ee();Ke(e);var d=function(){if(We[e]){if(s=Ee()-l,o<=s)return Ue(e),a(i),void(r&&r());a((i-t)*n(s/o)+t),We[e].raf=O(d)}};d()},Ye={shout:xe,listen:ke,viewportSize:ue,options:p,isMainScrollAnimating:function(){return ie},getZoomLevel:function(){return v},getCurrentIndex:function(){return f},isDragging:function(){return j},isZooming:function(){return J},setScrollOffset:function(e,t){pe.x=e,V=pe.y=t,xe("updateScrollOffset",pe)},applyZoomPan:function(e,t,i,o){he.x=t,he.y=i,v=e,Ae(o)},init:function(){if(!l&&!a){var e;ni("init",g),g.framework=m,g.template=u,g.bg=m.getChildByClass(u,"pswp__bg"),D=u.className,l=!0,H=m.detectFeatures(),O=H.raf,L=H.caf,A=H.transform,$=H.oldIE,g.scrollWrap=m.getChildByClass(u,"pswp__scroll-wrap"),g.container=m.getChildByClass(g.scrollWrap,"pswp__container"),r=g.container.style,g.itemHolders=S=[{el:g.container.children[0],wrap:0,index:-1},{el:g.container.children[1],wrap:0,index:-1},{el:g.container.children[2],wrap:0,index:-1}],S[0].el.style.display=S[2].el.style.display="none",function(){if(A){var e=H.perspective&&!P;return y="translate"+(e?"3d(":"("),w=H.perspective?", 0px)":")"}A="left",m.addClass(u,"pswp--ie"),Pe=function(e,t){t.left=e+"px"},Me=function(e){var t=1<e.fitRatio?1:e.fitRatio,i=e.container.style,o=t*e.w,n=t*e.h;i.width=o+"px",i.height=n+"px",i.left=e.initialPosition.x+"px",i.top=e.initialPosition.y+"px"},Ae=function(){if(te){var e=te,t=g.currItem,i=1<t.fitRatio?1:t.fitRatio,o=i*t.w,n=i*t.h;e.width=o+"px",e.height=n+"px",e.left=he.x+"px",e.top=he.y+"px"}}}(),c={resize:g.updateSize,orientationchange:function(){clearTimeout(R),R=setTimeout(function(){ue.x!==g.scrollWrap.clientWidth&&g.updateSize()},500)},scroll:qe,keydown:Be,click:ze};var t=H.isOldIOSPhone||H.isOldAndroid||H.isMobileOpera;for(H.animationName&&H.transform&&!t||(p.showAnimationDuration=p.hideAnimationDuration=0),e=0;e<be.length;e++)g["init"+be[e]]();if(n){var i=g.ui=new n(g,m);i.init()}xe("firstUpdate"),f=f||p.index||0,(isNaN(f)||f<0||f>=Ft())&&(f=0),g.currItem=Gt(f),(H.isOldIOSPhone||H.isOldAndroid)&&(ve=!1),u.setAttribute("aria-hidden","false"),p.modal&&(ve?u.style.position="fixed":(u.style.position="absolute",u.style.top=m.getScrollY()+"px")),V===oi&&(xe("initialLayout"),V=N=m.getScrollY());var o="pswp--open ";for(p.mainClass&&(o+=p.mainClass+" "),p.showHideOpacity&&(o+="pswp--animate_opacity "),o+=P?"pswp--touch":"pswp--notouch",o+=H.animationName?" pswp--css_animation":"",o+=H.svg?" pswp--svg":"",m.addClass(u,o),g.updateSize(),s=-1,fe=null,e=0;e<3;e++)Pe((e+s)*me.x,S[e].el.style);$||m.bind(g.scrollWrap,d,g),ke("initialZoomInEnd",function(){g.setContent(S[0],f-1),g.setContent(S[2],f+1),S[0].el.style.display=S[2].el.style.display="block",p.focus&&u.focus(),m.bind(document,"keydown",g),H.transform&&m.bind(g.scrollWrap,"click",g),p.mouseUsed||m.bind(document,"mousemove",Ve),m.bind(ii,"resize scroll orientationchange",g),xe("bindEvents")}),g.setContent(S[1],f),g.updateCurrItem(),xe("afterInit"),ni("after-init",g),ve||(_=setInterval(function(){je||j||J||v!==g.currItem.initialZoomLevel||g.updateSize()},1e3)),m.addClass(u,"pswp--visible")}},close:function(){l&&(a=!(l=!1),xe("close"),ni("closing",g),m.unbind(ii,"resize scroll orientationchange",g),m.unbind(ii,"scroll",c.scroll),m.unbind(document,"keydown",g),m.unbind(document,"mousemove",Ve),H.transform&&m.unbind(g.scrollWrap,"click",g),j&&m.unbind(ii,h,g),clearTimeout(R),xe("unbindEvents"),Bt(g.currItem,null,!0,g.destroy))},destroy:function(){xe("destroy"),ni("destroy",g),$t&&clearTimeout($t),u.setAttribute("aria-hidden","true"),u.className=D,_&&clearInterval(_),m.unbind(g.scrollWrap,d,g),m.unbind(ii,"scroll",g),pt(),Ze(),Se=null},panTo:function(e,t,i){i||(e>ee.min.x?e=ee.min.x:e<ee.max.x&&(e=ee.max.x),t>ee.min.y?t=ee.min.y:t<ee.max.y&&(t=ee.max.y)),he.x=e,he.y=t,Ae()},handleEvent:function(e){e=e||ii.event,c[e.type]&&c[e.type](e)},goTo:function(e){var t=(e=Ce(e))-f;fe=t,f=e,g.currItem=Gt(f),ge-=t,Oe(me.x*ge),Ze(),ie=!1,g.updateCurrItem()},next:function(){g.goTo(f+1)},prev:function(){g.goTo(f-1)},updateCurrZoomItem:function(e){if(e&&(xe("beforeChange",0),ni("before-slide-change",g,0)),S[1].el.children.length){var t=S[1].el.children[0];te=m.hasClass(t,"pswp__zoom-wrap")?t.style:null}else te=null;ee=g.currItem.bounds,b=v=g.currItem.initialZoomLevel,he.x=ee.center.x,he.y=ee.center.y,e&&(xe("afterChange"),ni("after-slide-change",g))},invalidateCurrItems:function(){C=!0;for(var e=0;e<3;e++)S[e].item&&(S[e].item.needsUpdate=!0)},updateCurrItem:function(e){if(0!==fe){var t,i=Math.abs(fe);if(!(e&&i<2)){g.currItem=Gt(f),we=!1,xe("beforeChange",fe);var o=fe;null===o&&(o=0),ni("slide-change",g,o),3<=i&&(s+=fe+(0<fe?-3:3),i=3);for(var n=0;n<i;n++)0<fe?(t=S.shift(),S[2]=t,Pe((++s+2)*me.x,t.el.style),g.setContent(t,f-i+n+1+1)):(t=S.pop(),S.unshift(t),Pe(--s*me.x,t.el.style),g.setContent(t,f+i-n-1-1));if(te&&1===Math.abs(fe)){var a=Gt(k);a.initialZoomLevel!==v&&(jt(a,ue),Xt(a),Me(a))}fe=0,g.updateCurrZoomItem(),k=f,xe("afterChange")}}},updateSize:function(e){if(!ve&&p.modal){var t=m.getScrollY();if(V!==t&&(u.style.top=t+"px",V=t),!e&&ye.x===ii.innerWidth&&ye.y===ii.innerHeight)return;ye.x=ii.innerWidth,ye.y=ii.innerHeight,u.style.height=ye.y+"px"}if(ue.x=g.scrollWrap.clientWidth,ue.y=g.scrollWrap.clientHeight,qe(),me.x=ue.x+Math.round(ue.x*p.spacing),me.y=ue.y,Oe(me.x*ge),xe("beforeResize"),s!==oi){for(var i,o,n,a=0;a<3;a++)i=S[a],Pe((a+s)*me.x,i.el.style),n=f+a-1,p.loop&&2<Ft()&&(n=Ce(n)),(o=Gt(n))&&(C||o.needsUpdate||!o.bounds)?(g.cleanSlide(o),g.setContent(i,n),1===a&&(g.currItem=o,g.updateCurrZoomItem(!0)),o.needsUpdate=!1):-1===i.index&&0<=n&&g.setContent(i,n),o&&o.container&&(jt(o,ue),Xt(o),Me(o));C=!1}b=v=g.currItem.initialZoomLevel,(ee=g.currItem.bounds)&&(he.x=ee.center.x,he.y=ee.center.y,Ae(!0)),xe("resize")},zoomTo:function(t,e,i,o,n){e&&(b=v,ht.x=Math.abs(e.x)-he.x,ht.y=Math.abs(e.y)-he.y,De(ce,he));var a=He(t,!1),r={};Fe("x",a,r,t),Fe("y",a,r,t);var s=v,l={x:he.x,y:he.y};Ne(r);var d=function(e){he.y=1===e?(v=t,he.x=r.x,r.y):(v=(t-s)*e+s,he.x=(r.x-l.x)*e+l.x,(r.y-l.y)*e+l.y),n&&n(e),Ae(1===e)};i?Xe("customZoomTo",0,1,i,o||m.easing.sine.inOut,d):d(1)}},Je={},Qe={},et={},tt={},it={},ot=[],nt={},at=[],rt={},st=0,lt={x:0,y:0},dt=0,ct={x:0,y:0},ht={x:0,y:0},ut={x:0,y:0},gt=function(e,t){return rt.x=Math.abs(e.x-t.x),rt.y=Math.abs(e.y-t.y),Math.sqrt(rt.x*rt.x+rt.y*rt.y)},pt=function(){i&&(L(i),i=null)},mt=function(){j&&(i=O(mt),At())},ft=function(e,t){return!(!e||e===document)&&!(e.getAttribute("class")&&-1<e.getAttribute("class").indexOf("pswp__scroll-wrap"))&&(t(e)?e:ft(e.parentNode,t))},vt={},bt=function(e,t){return vt.prevent=!ft(e.target,p.isClickableElement),xe("preventDragEvent",e,t,vt),vt.prevent},yt=function(e,t){return t.x=e.pageX,t.y=e.pageY,t.id=e.identifier,t},wt=function(e,t,i){i.x=.5*(e.x+t.x),i.y=.5*(e.y+t.y)},_t=function(){var e=he.y-g.currItem.initialPosition.y;return Math.min(1.2-Math.abs(e/(ue.y/2)),1)},Ct={},St={},kt=[],xt=function(e){for(;0<kt.length;)kt.pop();return M?(le=0,ot.forEach(function(e){0===le?kt[0]=e:1===le&&(kt[1]=e),le++})):-1<e.type.indexOf("touch")?e.touches&&0<e.touches.length&&(kt[0]=yt(e.touches[0],Ct),1<e.touches.length&&(kt[1]=yt(e.touches[1],St))):(Ct.x=e.pageX,Ct.y=e.pageY,Ct.id="",kt[0]=Ct),kt},Et=function(e,t){var i,o,n,a,r=he[e]+t[e],s=0<t[e],l=ct.x+t.x,d=ct.x-nt.x;if(i=r>ee.min[e]||r<ee.max[e]?p.panEndFriction:1,r=he[e]+t[e]*i,(p.allowPanToNext||v===g.currItem.initialZoomLevel)&&(te?"h"!==oe||"x"!==e||K||(s?(r>ee.min[e]&&(i=p.panEndFriction,ee.min[e],o=ee.min[e]-ce[e]),(o<=0||d<0)&&1<Ft()?(a=l,d<0&&l>nt.x&&(a=nt.x)):ee.min.x!==ee.max.x&&(n=r)):(r<ee.max[e]&&(i=p.panEndFriction,ee.max[e],o=ce[e]-ee.max[e]),(o<=0||0<d)&&1<Ft()?(a=l,0<d&&l<nt.x&&(a=nt.x)):ee.min.x!==ee.max.x&&(n=r))):a=l,"x"===e))return a!==oi&&(Oe(a,!0),X=a!==nt.x),ee.min.x!==ee.max.x&&(n!==oi?he.x=n:X||(he.x+=t.x*i)),a!==oi;ie||X||v>g.currItem.fitRatio&&(he[e]+=t[e]*i)},It=function(e){if(!("mousedown"===e.type&&0<e.button))if(Rt)e.preventDefault();else if(!W||"mousedown"!==e.type){if(bt(e,!0)&&e.preventDefault(),xe("pointerDown"),M){var t=m.arraySearch(ot,e.pointerId,"id");t<0&&(t=ot.length),ot[t]={x:e.pageX,y:e.pageY,id:e.pointerId}}var i=xt(e),o=i.length;Y=null,Ze(),j&&1!==o||(j=ne=!0,m.bind(ii,h,g),z=se=ae=q=X=Z=U=K=!1,oe=null,xe("firstTouchStart",i),De(ce,he),de.x=de.y=0,De(tt,i[0]),De(it,tt),nt.x=me.x*ge,at=[{x:tt.x,y:tt.y}],F=G=Ee(),He(v,!0),pt(),mt()),!J&&1<o&&!ie&&!X&&(b=v,J=U=!(K=!1),de.y=de.x=0,De(ce,he),De(Je,i[0]),De(Qe,i[1]),wt(Je,Qe,ut),ht.x=Math.abs(ut.x)-he.x,ht.y=Math.abs(ut.y)-he.y,Q=gt(Je,Qe))}},Tt=function(e){if(e.preventDefault(),M){var t=m.arraySearch(ot,e.pointerId,"id");if(-1<t){var i=ot[t];i.x=e.pageX,i.y=e.pageY}}if(j){var o=xt(e);if(oe||Z||J)Y=o;else if(ct.x!==me.x*ge)oe="h";else{var n=Math.abs(o[0].x-tt.x)-Math.abs(o[0].y-tt.y);10<=Math.abs(n)&&(oe=0<n?"h":"v",Y=o)}}},At=function(){if(Y){var e,t,i=Y.length;if(0!==i)if(De(Je,Y[0]),et.x=Je.x-tt.x,et.y=Je.y-tt.y,J&&1<i){if(tt.x=Je.x,tt.y=Je.y,!et.x&&!et.y&&(e=Y[1],t=Qe,e.x===t.x&&e.y===t.y))return;De(Qe,Y[1]),K||(K=!0,xe("zoomGestureStarted"));var o=gt(Je,Qe),n=Dt(o);n>g.currItem.initialZoomLevel+g.currItem.initialZoomLevel/15&&(se=!0);var a=1,r=Re(),s=Ge();if(n<r)if(p.pinchToClose&&!se&&b<=g.currItem.initialZoomLevel){var l=r-n,d=1-l/(r/1.2);Ie(d),xe("onPinchClose",d),ae=!0}else 1<(a=(r-n)/r)&&(a=1),n=r-a*(r/3);else s<n&&(1<(a=(n-s)/(6*r))&&(a=1),n=s+a*r);a<0&&(a=0),wt(Je,Qe,lt),de.x+=lt.x-ut.x,de.y+=lt.y-ut.y,De(ut,lt),he.x=Le("x",n),he.y=Le("y",n),z=v<n,v=n,Ae()}else{if(!oe)return;if(ne&&(ne=!1,10<=Math.abs(et.x)&&(et.x-=Y[0].x-it.x),10<=Math.abs(et.y)&&(et.y-=Y[0].y-it.y)),tt.x=Je.x,tt.y=Je.y,0===et.x&&0===et.y)return;if("v"===oe&&p.closeOnVerticalDrag&&"fit"===p.scaleMode&&v===g.currItem.initialZoomLevel){de.y+=et.y,he.y+=et.y;var c=_t();return q=!0,xe("onVerticalDrag",c),Ie(c),void Ae()}!function(e,t,i){if(50<e-F){var o=2<at.length?at.shift():{};o.x=t,o.y=i,at.push(o),F=e}}(Ee(),Je.x,Je.y),Z=!0,ee=g.currItem.bounds;var h=Et("x",et);h||(Et("y",et),Ne(he),Ae())}}},Mt=function(e){if(H.isOldAndroid){if(W&&"mouseup"===e.type)return;-1<e.type.indexOf("touch")&&(clearTimeout(W),W=setTimeout(function(){W=0},600))}var t;if(xe("pointerUp"),bt(e,!1)&&e.preventDefault(),M){var i=m.arraySearch(ot,e.pointerId,"id");-1<i&&(t=ot.splice(i,1)[0],navigator.pointerEnabled?t.type=e.pointerType||"mouse":(t.type={4:"mouse",2:"touch",3:"pen"}[e.pointerType],t.type||(t.type=e.pointerType||"mouse")))}var o,n=xt(e),a=n.length;if("mouseup"===e.type&&(a=0),2===a)return!(Y=null);1===a&&De(it,n[0]),0!==a||oe||ie||(t||("mouseup"===e.type?t={x:e.pageX,y:e.pageY,type:"mouse"}:e.changedTouches&&e.changedTouches[0]&&(t={x:e.changedTouches[0].pageX,y:e.changedTouches[0].pageY,type:"touch"})),xe("touchRelease",e,t));var r=-1;if(0===a&&(j=!1,m.unbind(ii,h,g),pt(),J?r=0:-1!==dt&&(r=Ee()-dt)),dt=1===a?Ee():-1,o=-1!==r&&r<150?"zoom":"swipe",J&&a<2&&(J=!1,1===a&&(o="zoomPointerUp"),xe("zoomGestureEnded")),Y=null,Z||K||ie||q)if(Ze(),B||(B=Pt()),B.calculateSwipeSpeed("x"),q){var s=_t();if(s<p.verticalDragRange)g.close();else{var l=he.y,d=re;Xe("verticalDrag",0,1,300,m.easing.cubic.out,function(e){he.y=(g.currItem.initialPosition.y-l)*e+l,Ie((1-d)*e+d),Ae()}),xe("onVerticalDrag",1)}}else{if((X||ie)&&0===a){var c=Lt(o,B);if(c)return;o="zoomPointerUp"}ie||("swipe"===o?!X&&v>g.currItem.fitRatio&&Ot(B):Nt())}},Pt=function(){var t,i,o={lastFlickOffset:{},lastFlickDist:{},lastFlickSpeed:{},slowDownRatio:{},slowDownRatioReverse:{},speedDecelerationRatio:{},speedDecelerationRatioAbs:{},distanceOffset:{},backAnimDestination:{},backAnimStarted:{},calculateSwipeSpeed:function(e){i=1<at.length?(t=Ee()-F+50,at[at.length-2][e]):(t=Ee()-G,it[e]),o.lastFlickOffset[e]=tt[e]-i,o.lastFlickDist[e]=Math.abs(o.lastFlickOffset[e]),20<o.lastFlickDist[e]?o.lastFlickSpeed[e]=o.lastFlickOffset[e]/t:o.lastFlickSpeed[e]=0,Math.abs(o.lastFlickSpeed[e])<.1&&(o.lastFlickSpeed[e]=0),o.slowDownRatio[e]=.95,o.slowDownRatioReverse[e]=1-o.slowDownRatio[e],o.speedDecelerationRatio[e]=1},calculateOverBoundsAnimOffset:function(t,e){o.backAnimStarted[t]||(he[t]>ee.min[t]?o.backAnimDestination[t]=ee.min[t]:he[t]<ee.max[t]&&(o.backAnimDestination[t]=ee.max[t]),o.backAnimDestination[t]!==oi&&(o.slowDownRatio[t]=.7,o.slowDownRatioReverse[t]=1-o.slowDownRatio[t],o.speedDecelerationRatioAbs[t]<.05&&(o.lastFlickSpeed[t]=0,o.backAnimStarted[t]=!0,Xe("bounceZoomPan"+t,he[t],o.backAnimDestination[t],e||300,m.easing.sine.out,function(e){he[t]=e,Ae()}))))},calculateAnimOffset:function(e){o.backAnimStarted[e]||(o.speedDecelerationRatio[e]=o.speedDecelerationRatio[e]*(o.slowDownRatio[e]+o.slowDownRatioReverse[e]-o.slowDownRatioReverse[e]*o.timeDiff/10),o.speedDecelerationRatioAbs[e]=Math.abs(o.lastFlickSpeed[e]*o.speedDecelerationRatio[e]),o.distanceOffset[e]=o.lastFlickSpeed[e]*o.speedDecelerationRatio[e]*o.timeDiff,he[e]+=o.distanceOffset[e])},panAnimLoop:function(){if(We.zoomPan&&(We.zoomPan.raf=O(o.panAnimLoop),o.now=Ee(),o.timeDiff=o.now-o.lastNow,o.lastNow=o.now,o.calculateAnimOffset("x"),o.calculateAnimOffset("y"),Ae(),o.calculateOverBoundsAnimOffset("x"),o.calculateOverBoundsAnimOffset("y"),o.speedDecelerationRatioAbs.x<.05&&o.speedDecelerationRatioAbs.y<.05))return he.x=Math.round(he.x),he.y=Math.round(he.y),Ae(),void Ue("zoomPan")}};return o},Ot=function(e){if(e.calculateSwipeSpeed("y"),ee=g.currItem.bounds,e.backAnimDestination={},e.backAnimStarted={},Math.abs(e.lastFlickSpeed.x)<=.05&&Math.abs(e.lastFlickSpeed.y)<=.05)return e.speedDecelerationRatioAbs.x=e.speedDecelerationRatioAbs.y=0,e.calculateOverBoundsAnimOffset("x"),e.calculateOverBoundsAnimOffset("y"),!0;Ke("zoomPan"),e.lastNow=Ee(),e.panAnimLoop()},Lt=function(e,t){var i,o,n;if(ie||(st=f),"swipe"===e){var a=tt.x-it.x,r=t.lastFlickDist.x<10;30<a&&(r||20<t.lastFlickOffset.x)?o=-1:a<-30&&(r||t.lastFlickOffset.x<-20)&&(o=1)}o&&((f+=o)<0?(f=p.loop?Ft()-1:0,n=!0):f>=Ft()&&(f=p.loop?0:Ft()-1,n=!0),n&&!p.loop||(fe+=o,ge-=o,i=!0));var s,l=me.x*ge,d=Math.abs(l-ct.x);return s=i||l>ct.x==0<t.lastFlickSpeed.x?(s=0<Math.abs(t.lastFlickSpeed.x)?d/Math.abs(t.lastFlickSpeed.x):333,s=Math.min(s,400),Math.max(s,250)):333,st===f&&(i=!1),ie=!0,xe("mainScrollAnimStart"),Xe("mainScroll",ct.x,l,s,m.easing.cubic.out,Oe,function(){Ze(),ie=!1,st=-1,(i||st!==f)&&g.updateCurrItem(),xe("mainScrollAnimComplete")}),i&&g.updateCurrItem(!0),i},Dt=function(e){return 1/Q*e*b},Nt=function(){var e=v,t=Re(),i=Ge();v<t?e=t:i<v&&(e=i);var o,n=re;return ae&&!z&&!se&&v<t?g.close():(ae&&(o=function(e){Ie((1-n)*e+n)}),g.zoomTo(e,0,200,m.easing.cubic.out,o)),!0};_e("Gestures",{publicMethods:{initGestures:function(){var e=function(e,t,i,o,n){x=e+t,E=e+i,I=e+o,T=n?e+n:""};(M=H.pointerEvent)&&H.touch&&(H.touch=!1),M?navigator.pointerEnabled?e("pointer","down","move","up","cancel"):e("MSPointer","Down","Move","Up","Cancel"):H.touch?(e("touch","start","move","end","cancel"),P=!0):e("mouse","down","move","up"),h=E+" "+I+" "+T,d=x,M&&!P&&(P=1<navigator.maxTouchPoints||1<navigator.msMaxTouchPoints),g.likelyTouchDevice=P,c[x]=It,c[E]=Tt,c[I]=Mt,T&&(c[T]=c[I]),H.touch&&(d+=" mousedown",h+=" mousemove mouseup",c.mousedown=c[x],c.mousemove=c[E],c.mouseup=c[I]),P||(p.allowPanToNext=!1)}}});var $t,Vt,Ht,Rt,Gt,Ft,Bt=function(a,e,r,t){var s;$t&&clearTimeout($t),Ht=Rt=!0,a.initialLayout?(s=a.initialLayout,a.initialLayout=null):s=p.getThumbBoundsFn&&p.getThumbBoundsFn(f);var l,d,c=r?p.hideAnimationDuration:p.showAnimationDuration,h=function(){Ue("initialZoom"),r?(g.template.removeAttribute("style"),g.bg.removeAttribute("style")):(Ie(1),e&&(e.style.display="block"),m.addClass(u,"pswp--animated-in"),xe("initialZoom"+(r?"OutEnd":"InEnd"))),t&&t(),Rt=!1};if(!c||!s||s.x===oi)return xe("initialZoom"+(r?"Out":"In")),v=a.initialZoomLevel,De(he,a.initialPosition),Ae(),u.style.opacity=r?0:1,Ie(1),void(c?setTimeout(function(){h()},c):h());l=o,d=!g.currItem.src||g.currItem.loadError||p.showHideOpacity,a.miniImg&&(a.miniImg.style.webkitBackfaceVisibility="hidden"),r||(v=s.w/a.w,he.rotation=s.transform.rotation,he.x=s.x,he.y=s.y-N,g[d?"template":"bg"].style.opacity=.001,Ae(),he.rotation=0),Ke("initialZoom"),r&&!l&&m.removeClass(u,"pswp--animated-in"),d&&(r?m[(l?"remove":"add")+"Class"](u,"pswp--animate_opacity"):setTimeout(function(){m.addClass(u,"pswp--animate_opacity")},30)),$t=setTimeout(function(){if(xe("initialZoom"+(r?"Out":"In")),r){var t=s.w/a.w,i={x:he.x,y:he.y,rotation:0},o=v,n=re,e=function(e){he.rotation=1===e?(v=t,he.x=s.x,he.y=s.y-V,s.transform.rotation):(v=(t-o)*e+o,he.x=(s.x-i.x)*e+i.x,he.y=(s.y-V-i.y)*e+i.y,(s.transform.rotation-i.rotation)*e+i.rotation),Ae(),d?u.style.opacity=1-e:Ie(n-e*n)};l?Xe("initialZoom",0,1,c,m.easing.cubic.out,e,h):(e(1),$t=setTimeout(h,c+20))}else v=a.initialZoomLevel,De(he,a.initialPosition),Ae(),Ie(1),d?u.style.opacity=1:Ie(1),$t=setTimeout(h,c+20)},r?25:90)},zt={},qt=[],Wt={index:0,errorMsg:'<div class="pswp__error-msg"><a href="%url%" target="_blank">The image</a> could not be loaded.</div>',forceProgressiveLoading:!1,preload:[1,1],getNumItemsFn:function(){return Vt.length}},jt=function(e,t,i){if(!e.src||e.loadError)return e.w=e.h=0,e.initialZoomLevel=e.fitRatio=1,e.bounds={center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}},e.initialPosition=e.bounds.center,e.bounds;var o,n,a,r,s=!i;if(s&&(e.vGap||(e.vGap={top:0,bottom:0}),e.hGap||(e.hGap={left:0,right:0}),xe("parseVerticalMargin",e)),zt.x=t.x-e.hGap.left-e.hGap.right,zt.y=t.y-e.vGap.top-e.vGap.bottom,s){var l=zt.x/e.w,d=zt.y/e.h;e.fitRatio=l<d?l:d;var c=p.scaleMode;"orig"===c?i=1:"fit"===c&&(i=e.fitRatio),1<i&&(i=1),e.initialZoomLevel=i,e.bounds||(e.bounds={center:{x:0,y:0},max:{x:0,y:0},min:{x:0,y:0}})}return i?(n=(o=e).w*i,a=e.h*i,(r=o.bounds).center.x=Math.round((zt.x-n)/2)+o.hGap.left,r.center.y=Math.round((zt.y-a)/2)+o.vGap.top,r.max.x=n>zt.x?Math.round(zt.x-n)+o.hGap.left:r.center.x,r.max.y=a>zt.y?Math.round(zt.y-a)+o.vGap.top:r.center.y,r.min.x=n>zt.x?o.hGap.left:r.center.x,r.min.y=a>zt.y?o.vGap.top:r.center.y,s&&i===e.initialZoomLevel&&(e.initialPosition=e.bounds.center),e.bounds):void 0},Ut=function(e,t,i,o,n,a){t.loadError||o&&(t.imageAppended=!0,Xt(t,o,t===g.currItem&&we),i.appendChild(o),a&&setTimeout(function(){t&&t.loaded&&t.placeholder&&(t.placeholder.style.display="none",t.placeholder=null)},500))},Kt=function(e){e.loading=!0,e.loaded=!1;var t=e.img=m.createEl("pswp__img","img"),i=function(){e.loading=!1,e.loaded=!0,e.loadComplete?e.loadComplete(e):e.img=null,t.onload=t.onerror=null,t=null};return t.onload=i,t.onerror=function(){e.loadError=!0,i()},t.src=e.src,t},Zt=function(e,t){if(e.src&&e.loadError&&e.container)return t&&(e.container.innerHTML=""),e.container.innerHTML=p.errorMsg.replace("%url%",e.src),!0},Xt=function(e,t,i){if(e.src){t||(t=e.container.lastChild);var o=i?e.w:Math.round(e.w*e.fitRatio),n=i?e.h:Math.round(e.h*e.fitRatio);e.placeholder&&!e.loaded&&(e.placeholder.style.width=o+"px",e.placeholder.style.height=n+"px"),t.style.width=o+"px",t.style.height=n+"px"}},Yt=function(){if(qt.length){for(var e,t=0;t<qt.length;t++)(e=qt[t]).holder.index===e.index&&Ut(e.index,e.item,e.baseDiv,e.img,0,e.clearPlaceholder);qt=[]}};_e("Controller",{publicMethods:{lazyLoadItem:function(e){e=Ce(e);var t=Gt(e);t&&(!t.loaded&&!t.loading||C)&&(xe("gettingData",e,t),t.src&&Kt(t))},initController:function(){m.extend(p,Wt,!0),g.items=Vt=e,Gt=g.getItemAt,Ft=p.getNumItemsFn,p.loop,Ft()<3&&(p.loop=!1),ke("beforeChange",function(e){var t,i=p.preload,o=null===e||0<=e,n=Math.min(i[0],Ft()),a=Math.min(i[1],Ft());for(t=1;t<=(o?a:n);t++)g.lazyLoadItem(f+t);for(t=1;t<=(o?n:a);t++)g.lazyLoadItem(f-t)}),ke("initialLayout",function(){g.currItem.initialLayout=p.getThumbBoundsFn&&p.getThumbBoundsFn(f)}),ke("mainScrollAnimComplete",Yt),ke("initialZoomInEnd",Yt),ke("destroy",function(){for(var e,t=0;t<Vt.length;t++)(e=Vt[t]).container&&(e.container=null),e.placeholder&&(e.placeholder=null),e.img&&(e.img=null),e.preloader&&(e.preloader=null),e.loadError&&(e.loaded=e.loadError=!1);qt=null})},getItemAt:function(e){return 0<=e&&Vt[e]!==oi&&Vt[e]},allowProgressiveImg:function(){return p.forceProgressiveLoading||!P||p.mouseUsed||1200<screen.width},setContent:function(t,i){p.loop&&(i=Ce(i));var e=g.getItemAt(t.index);e&&(e.container=null);var o,n=g.getItemAt(i);if(n){xe("gettingData",i,n),t.index=i;var a=(t.item=n).container=m.createEl("pswp__zoom-wrap");if(!n.src&&n.html&&(n.html.tagName?a.appendChild(n.html):a.innerHTML=n.html),Zt(n),jt(n,ue),!n.src||n.loadError||n.loaded)n.src&&!n.loadError&&((o=m.createEl("pswp__img","img")).style.opacity=1,o.src=n.src,Xt(n,o),Ut(0,n,a,o));else{if(n.loadComplete=function(e){if(l){if(t&&t.index===i){if(Zt(e,!0))return e.loadComplete=e.img=null,jt(e,ue),Me(e),void(t.index===f&&g.updateCurrZoomItem());e.imageAppended?!Rt&&e.placeholder&&(e.placeholder.style.display="none",e.placeholder=null):H.transform&&(ie||Rt)?qt.push({item:e,baseDiv:a,img:e.img,index:i,holder:t,clearPlaceholder:!0}):Ut(0,e,a,e.img,0,!0)}e.loadComplete=null,e.img=null,xe("imageLoadComplete",i,e)}},m.features.transform){var r="pswp__img pswp__img--placeholder";r+=n.msrc?"":" pswp__img--placeholder--blank";var s=m.createEl(r,n.msrc?"img":"");n.msrc&&(s.src=n.msrc),Xt(n,s),a.appendChild(s),n.placeholder=s}n.loading||Kt(n),g.allowProgressiveImg()&&(!Ht&&H.transform?qt.push({item:n,baseDiv:a,img:n.img,index:i,holder:t}):Ut(0,n,a,n.img,0,!0))}Ht||i!==f?Me(n):(te=a.style,Bt(n,o||n.img)),t.el.innerHTML="",t.el.appendChild(a)}else t.el.innerHTML=""},cleanSlide:function(e){e.img&&(e.img.onload=e.img.onerror=null),e.loaded=e.loading=e.img=e.imageAppended=!1}}});var Jt,Qt,ei={},ti=function(e,t,i){var o=document.createEvent("CustomEvent"),n={origEvent:e,target:e.target,releasePoint:t,pointerType:i||"touch"};o.initCustomEvent("pswpTap",!0,!0,n),e.target.dispatchEvent(o)};_e("Tap",{publicMethods:{initTap:function(){ke("firstTouchStart",g.onTapStart),ke("touchRelease",g.onTapRelease),ke("destroy",function(){ei={},Jt=null})},onTapStart:function(e){1<e.length&&(clearTimeout(Jt),Jt=null)},onTapRelease:function(e,t){var i,o;if(t&&!Z&&!U&&!je){var n=t;if(Jt&&(clearTimeout(Jt),Jt=null,i=n,o=ei,Math.abs(i.x-o.x)<25&&Math.abs(i.y-o.y)<25))return void xe("doubleTap",n);if("mouse"===t.type)return void ti(e,t,"mouse");var a=e.target.tagName.toUpperCase();if("BUTTON"===a||m.hasClass(e.target,"pswp__single-tap"))return void ti(e,t);De(ei,n),Jt=setTimeout(function(){ti(e,t),Jt=null},300)}}}}),_e("DesktopZoom",{publicMethods:{initDesktopZoom:function(){$||(P?ke("mouseUsed",function(){g.setupDesktopZoom()}):g.setupDesktopZoom(!0))},setupDesktopZoom:function(e){Qt={};var t="wheel mousewheel DOMMouseScroll";ke("bindEvents",function(){m.bind(u,t,g.handleMouseWheel)}),ke("unbindEvents",function(){Qt&&m.unbind(u,t,g.handleMouseWheel)}),g.mouseZoomedIn=!1;var i,o=function(){g.mouseZoomedIn&&(m.removeClass(u,"pswp--zoomed-in"),g.mouseZoomedIn=!1),v<1?m.addClass(u,"pswp--zoom-allowed"):m.removeClass(u,"pswp--zoom-allowed"),n()},n=function(){i&&(m.removeClass(u,"pswp--dragging"),i=!1)};ke("resize",o),ke("afterChange",o),ke("pointerDown",function(){g.mouseZoomedIn&&(i=!0,m.addClass(u,"pswp--dragging"))}),ke("pointerUp",n),e||o()},handleMouseWheel:function(e){if(v<=g.currItem.fitRatio)return p.modal&&(!p.closeOnScroll||je||j?e.preventDefault():A&&2<Math.abs(e.deltaY)&&(o=!0,g.close())),!0;if(e.stopPropagation(),Qt.x=0,"deltaX"in e)1===e.deltaMode?(Qt.x=18*e.deltaX,Qt.y=18*e.deltaY):(Qt.x=e.deltaX,Qt.y=e.deltaY);else if("wheelDelta"in e)e.wheelDeltaX&&(Qt.x=-.16*e.wheelDeltaX),e.wheelDeltaY?Qt.y=-.16*e.wheelDeltaY:Qt.y=-.16*e.wheelDelta;else{if(!("detail"in e))return;Qt.y=e.detail}He(v,!0);var t=he.x-Qt.x,i=he.y-Qt.y;(p.modal||t<=ee.min.x&&t>=ee.max.x&&i<=ee.min.y&&i>=ee.max.y)&&e.preventDefault(),g.panTo(t,i)},toggleDesktopZoom:function(e){e=e||{x:ue.x/2+pe.x,y:ue.y/2+pe.y};var t=p.getDoubleTapZoom(!0,g.currItem),i=v===t;g.mouseZoomedIn=!i,g.zoomTo(i?g.currItem.initialZoomLevel:t,e,333),m[(i?"remove":"add")+"Class"](u,"pswp--zoomed-in")}}}),m.extend(g,Ye)},this.template='<div class="pswp image-zoom-navigation" tabindex="-1" role="dialog" aria-hidden="true"> \t\x3c!-- Background of PhotoSwipe. \t\t It\'s a separate element as animating opacity is faster than rgba(). --\x3e \t<div class="pswp__bg image-zoom-background"></div> \t\x3c!-- Slides wrapper with overflow:hidden. --\x3e \t<div class="pswp__scroll-wrap"> \t\t\x3c!-- Container that holds slides. \t\t\tPhotoSwipe keeps only 3 of them in the DOM to save memory.\t\t\tDon\'t modify these 3 pswp__item elements, data is added later on. --\x3e \t\t<div class="pswp__container"> \t\t\t<div class="pswp__item"></div> \t\t\t<div class="pswp__item"></div> \t\t\t<div class="pswp__item"></div> \t\t</div> \t\t<div class="pswp__ui pswp__ui--hidden pswp__custom_nav"> \t\t\t<div class="pswp__group pswp__group-prev"> \t\t\t\t<div class="pswp__button pswp__button-prev"> \t\t\t\t\t<svg version="1.1" class="left-arrow" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t\t\t\t\t\t viewBox="0 0 36 36" style="enable-background:new 0 0 36 36;" xml:space="preserve">\t\t\t\t\t\t\t<path class="shape-outline outer-color" d="M8.0008001,17.2999992c-0.4000001,0.3999996-0.4000001,1,0,1.3999996l15.7991991,15.7992001\t\t\t\t\t\t\t\tc0.3999996,0.4000015,1,0.4000015,1.3999996,0l2.6992016-2.6991997c0.3999996-0.3999996,0.3999996-1,0-1.3999996\t\t\t\t\t\t\t\tL16.2992001,18.7000008c-0.4000006-0.3999996-0.4000006-1,0-1.3999996L27.8992004,5.6999998\t\t\t\t\t\t\t\tc0.3999996-0.4000001,0.3999996-1,0-1.4000001l-2.6992016-2.6992002c-0.3999996-0.4-1-0.4-1.3999996,0L8.0008001,17.2999992z"/>\t\t\t\t\t\t\t<path class="shape-shape inner-color" d="M9.6999998,17.6000004c-0.1999998,0.2000008-0.1999998,0.5,0,0.7000008l14.500001,14.5000019\t\t\t\t\t\t\t\tc0.2000008,0.2000008,0.5,0.2000008,0.7000008,0l1.3999996-1.3999996c0.2000008-0.2000008,0.2000008-0.5,0-0.7000008\t\t\t\t\t\t\t\tL13.8999996,18.3999996c-0.1999998-0.2000008-0.1999998-0.5,0-0.7000008L26.2999992,5.3000002\t\t\t\t\t\t\t\tc0.2000008-0.1999998,0.2000008-0.5,0-0.6999998l-1.3999996-1.4000001c-0.2000008-0.2-0.5-0.2-0.7000008,0L9.6999998,17.6000004z"/>\t\t\t\t\t</svg>\t\t\t\t</div> \t\t\t</div>\t\t\t<div class="pswp__group pswp__group-next"> \t\t\t\t<div class="pswp__button pswp__button-next"> \t\t\t\t\t<svg version="1.1" class="right-arrow" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t\t\t\t\t\t viewBox="0 0 36 36" style="enable-background:new 0 0 36 36;" xml:space="preserve">\t\t\t\t\t\t\t<path class="shape-outline outer-color" d="M8.0008001,17.2999992c-0.4000001,0.3999996-0.4000001,1,0,1.3999996l15.7991991,15.7992001\t\t\t\t\t\t\t\tc0.3999996,0.4000015,1,0.4000015,1.3999996,0l2.6992016-2.6991997c0.3999996-0.3999996,0.3999996-1,0-1.3999996\t\t\t\t\t\t\t\tL16.2992001,18.7000008c-0.4000006-0.3999996-0.4000006-1,0-1.3999996L27.8992004,5.6999998\t\t\t\t\t\t\t\tc0.3999996-0.4000001,0.3999996-1,0-1.4000001l-2.6992016-2.6992002c-0.3999996-0.4-1-0.4-1.3999996,0L8.0008001,17.2999992z"/>\t\t\t\t\t\t\t<path class="shape-shape inner-color" d="M9.6999998,17.6000004c-0.1999998,0.2000008-0.1999998,0.5,0,0.7000008l14.500001,14.5000019\t\t\t\t\t\t\t\tc0.2000008,0.2000008,0.5,0.2000008,0.7000008,0l1.3999996-1.3999996c0.2000008-0.2000008,0.2000008-0.5,0-0.7000008\t\t\t\t\t\t\t\tL13.8999996,18.3999996c-0.1999998-0.2000008-0.1999998-0.5,0-0.7000008L26.2999992,5.3000002\t\t\t\t\t\t\t\tc0.2000008-0.1999998,0.2000008-0.5,0-0.6999998l-1.3999996-1.4000001c-0.2000008-0.2-0.5-0.2-0.7000008,0L9.6999998,17.6000004z"/>\t\t\t\t\t</svg>\t\t\t\t</div> \t\t\t</div> \t\t\t<div class="pswp__group pswp__group-close"> \t\t\t\t<div class="pswp__button pswp__button-close"> \t\t\t\t\t<svg class="close-button" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"\t\t\t\t\t\t viewBox="0 0 36 36" style="enable-background:new 0 0 36 36;" xml:space="preserve">\t\t\t\t\t\t\t<path class="shape-outline outer-color" d="M30.4992,9.7l-8,8c-0.2,0.2-0.2,0.5,0,0.7l8.1,8c0.4,0.4,0.4,1,0,1.4L27.9,30.4992c-0.4,0.4-1,0.4-1.4,0l-8-8\t\t\t\t\t\t\t\tc-0.2-0.2-0.5-0.2-0.7,0l-8.2,8c-0.4,0.4-1,0.4-1.4,0L5.5008,27.8c-0.4-0.4-0.4-1,0-1.4l8.1-8.1c0.2-0.2,0.1-0.5,0-0.7l-8-8\t\t\t\t\t\t\t\tc-0.4-0.4-0.4-1,0-1.4L8.3,5.5008c0.4-0.4,1-0.4,1.4,0l0,0l8.1,8.1c0.2,0.2,0.5,0.1,0.7,0l8-8c0.4-0.4,1-0.4,1.4,0L30.5992,8.3\t\t\t\t\t\t\t\tC30.8992,8.6,30.8992,9.3,30.4992,9.7L30.4992,9.7z"/>\t\t\t\t\t\t\t<path class="shape-shape inner-color" d="M28.8,26.7L28.8,26.7L28.8,26.7l-8.3-8.3c-0.2-0.2-0.2-0.5,0-0.7l8.3-8.4c0.2-0.2,0.2-0.5,0-0.7l-1.4-1.4l0,0\t\t\t\t\t\t\t\tc-0.2-0.2-0.5-0.2-0.7,0l-8.3,8.3c-0.2,0.2-0.5,0.2-0.7,0L9.3,7.2l0,0l0,0C9.1,7,8.8,7,8.6,7.2L7.2,8.6C7,8.8,7,9.1,7.2,9.3\t\t\t\t\t\t\t\tl8.4,8.4c0.2,0.2,0.2,0.5,0,0.7l-8.4,8.3c-0.2,0.2-0.2,0.5,0,0.7l1.4,1.4l0,0c0.2,0.2,0.5,0.2,0.7,0l8.4-8.4c0.2-0.2,0.5-0.1,0.7,0\t\t\t\t\t\t\t\tl8.4,8.4c0.2,0.2,0.5,0.2,0.7,0l1.4-1.4C29,27.2,29,26.9,28.8,26.7z"/>\t\t\t\t\t</svg>\t\t\t\t</div> \t\t\t</div>\t\t</div> \t</div><div id="freshbox" style="display: none; width: 0; height: 0;">\x3c!-- legacy support --\x3e</div> </div>';var l=function(){var e=document.createElement("div");for(e.innerHTML=this.template;0<e.childNodes.length;)document.body.appendChild(e.childNodes[0]);e=null}.bind(this),ni=function(){};this.setEventProxy=function(e){"function"==typeof e&&(ni=e)},this.isActive=!1,this.activeGallery=oi,this.openImageArray=function(e,n,k){var x=function(e,t,i,o,n,a,r){var s=Math.acos,l=Math.atan,d=Math.sqrt,c=Math.PI,h={x:n,y:a},u=0,g={x:1,y:1},p={x:0,y:0},m=e*o-t*i;if(r)e?(p={x:l(i/e),y:l(t/e)},g={x:e,y:m/e}):p.x=t?(u=.5*c,g={x:t,y:m/t},l(o/t)):(g={x:i,y:o},.25*c);else if(e||t){var f=d(e*e+t*t);u=0<t?s(e/f):-s(e/f),g={x:f,y:m/f},p.x=l((e*i+t*o)/(f*f))}else if(i||o){var v=d(i*i+o*o);u=.5*c-(0<o?s(-i/v):-s(i/v)),g={x:m/v,y:v},p.y=l((e*i+t*o)/(v*v))}else g={x:0,y:0};return{scale:g,translate:h,rotation:u,skew:p}};if(e!==oi&&this.activeGallery===oi){var t=document.querySelectorAll(".pswp")[0];t===oi&&(l(),t=document.querySelectorAll(".pswp")[0]);var a=[],r=0;if(Array.prototype.forEach.call(e,function(e){if(e.hasAttribute("data-src")&&(e.hasAttribute("width_o")||e.hasAttribute("width"))&&(e.hasAttribute("height_o")||e.hasAttribute("height"))){e===n&&(r=a.length);var t=e.getAttribute("data-src"),i=e.hasAttribute("width_o")?e.getAttribute("width_o"):e.getAttribute("width"),o=e.hasAttribute("height_o")?e.getAttribute("height_o"):e.getAttribute("height");e._lightboxSrc!==oi&&(t=e._lightboxSrc),e._lightboxWidth!==oi&&(i=e._lightboxWidth),e._lightboxHeight!==oi&&(o=e._lightboxHeight),a.push({src:t,msrc:e.getAttribute("src"),w:i,h:o,el:e})}}),0==a.length)return!1;var E=this,i={index:r,maxSpreadZoom:1,getThumbBoundsFn:function(e){if(k&&k.preventAnimation)return!1;if(E.activeGallery==oi)return!1;var t=E.activeGallery.getItemAt(e);if(t==oi||t.el==oi||"function"!=typeof t.el.getBoundingClientRect)return!1;var i=t.el,o=!1;if(t.el.hasAttribute("data-gallery-uid")){var n=$(t.el).closest(".gallery_card");0<n.length&&(o=!0,i=n[0])}var a=ii.getComputedStyle(i).getPropertyValue("transform"),r=i.getBoundingClientRect();if(0===r.width)return!1;i.style.transformOrigin="left top";var s,l=i.getBoundingClientRect(),d=(t.el.getBoundingClientRect(),[]),c=-1<a.indexOf("matrix("),h=-1<a.indexOf("matrix3d("),u=c||h;if(c){d=a.replace(")","").replace("matrix(","").split(",");for(var g=0;g<d.length;g++)d[g]=parseFloat(d[g]);s=x(d[0],d[1],d[2],d[3],d[4],d[5],!1)}else if(h){d=a.replace(")","").replace("matrix3d(","").split(",");for(g=0;g<d.length;g++)d[g]=parseFloat(d[g]);s=x(d[0],d[1],d[4],d[5],d[12],d[13],!1)}else s={rotation:0,scale:{x:1,y:1},skew:{x:0,y:0},translate:{x:0,y:0}};var p,m=0,f=0,v=0,b=0;if(u){var y=i.style.transform;if(i.style.transformOrigin="",i.style.transform="",p=i.getBoundingClientRect(),v=l.left-p.left,b=l.top-p.top,o){var w=t.el.getBoundingClientRect();f=p.width-w.width,m=2*(w.top-p.top);var _=Math.sqrt(f*f+m*m),C=s.rotation+.25*Math.PI;v-=Math.cos(C)*_*.5,b-=Math.sin(C)*_*.5}i.style.transform=y}else o?r=p=t.el.getBoundingClientRect():p=r;var S=ii.pageYOffset||document.documentElement.scrollTop;return{x:r.left+-v+s.translate.x,y:r.top+-b+S+s.translate.y,w:p.width*s.scale.x-f,h:p.height*s.scale.y-m,transform:s}},closeEl:!0,arrowEl:1<a.length,tapToClose:!0,closeOnScroll:!1},o=!1;if(k!==oi&&"object"==typeof k){for(var s in k)k.hasOwnProperty(s)&&(i[s]=k[s]);!0===k.disableZoom&&(o=!0,i.zoomEl=!1,i.getDoubleTapZoom=function(e,t){return t.initialZoomLevel},i.pinchToClose=!1)}return this.activeGallery=new this.PhotoSwipe(t,this.PhotoSwipeUI_Default,a,i),o?t.classList.add("pswp--zoom-disabled"):t.classList.remove("pswp--zoom-disabled"),this.activeGallery.init(),this.isActive=!0,this.activeGallery.listen("destroy",function(){null!==t.parentNode&&t.parentNode.removeChild(t),E.isActive=!1,E.activeGallery=oi}),this.activeGallery}},this.PhotoSwipeUI_Default=function(o,l){var i,n,a,s,e,d,c,r,h,u=this,t=!1,g=!0,p={closeElClasses:["item","caption","zoom-wrap","ui","top-bar"],timeToIdle:1500,timeToIdleOutside:1500,closeEl:!0,fullscreenEl:!0,zoomEl:!0,counterEl:!0,arrowEl:!0,tapToClose:!1,tapToToggleControls:!0,clickToCloseNonZoomable:!0,fitControlsWidth:1200},m=function(e){if(c)return!0;e=e||ii.event,d.timeToIdle&&d.mouseUsed&&!s&&y();for(var t=e.target||e.srcElement;"svg"===t.nodeName||"path"===t.nodeName;)t=t.parentNode;for(var i,o,n=t.getAttribute("class")||"",a=0;a<_.length;a++)(i=_[a]).onTap&&-1<n.indexOf("pswp__"+i.name)&&(i.onTap(),o=!0);if(o){e.stopPropagation&&e.stopPropagation(),c=!0;var r=l.features.isOldAndroid?600:30;setTimeout(function(){c=!1},r)}},f=function(e,t,i){l[(i?"add":"remove")+"Class"](e,"pswp__"+t)},v=function(e){for(var t=0;t<d.closeElClasses.length;t++)if(l.hasClass(e,"pswp__"+d.closeElClasses[t]))return!0},b=0,y=function(){clearTimeout(h),b=0,s&&u.setIdle(!1)},w=function(e){var t=(e=e||ii.event).relatedTarget||e.toElement;t&&"HTML"!==t.nodeName||(clearTimeout(h),h=setTimeout(function(){u.setIdle(!0)},d.timeToIdleOutside))},_=[{name:"button--zoom",option:"zoomEl",onTap:o.toggleDesktopZoom},{name:"button-close",option:"closeEl",onTap:o.close},{name:"button-prev",option:"arrowEl",onTap:o.prev},{name:"button-next",option:"arrowEl",onTap:o.next},{name:"button--fs",option:"fullscreenEl",onTap:function(){i.isFullscreen()?i.exit():i.enter()}}];u.init=function(){var t;l.extend(o.options,p,!0),d=o.options,n=l.getChildByClass(o.scrollWrap,"pswp__ui"),(e=o.listen)("onVerticalDrag",function(e){g&&e<.95?u.hideControls():!g&&.95<=e&&u.showControls()}),e("onPinchClose",function(e){g&&e<.9?(u.hideControls(),t=!0):t&&!g&&.9<e&&u.showControls()}),e("zoomGestureEnded",function(){(t=!1)&&!g&&u.showControls()}),e("beforeChange",u.update),e("doubleTap",function(e){var t=o.currItem.initialZoomLevel;o.getZoomLevel()!==t?o.zoomTo(t,e,333):o.zoomTo(d.getDoubleTapZoom(!1,o.currItem),e,333)}),e("preventDragEvent",function(e,t,i){var o=e.target||e.srcElement;o&&o.getAttribute("class")&&-1<e.type.indexOf("mouse")&&(0<o.getAttribute("class").indexOf("__caption")||/(SMALL|STRONG|EM)/i.test(o.tagName))&&(i.prevent=!1)}),e("bindEvents",function(){l.bind(n,"pswpTap click",m),l.bind(o.scrollWrap,"pswpTap",u.onGlobalTap),o.likelyTouchDevice||l.bind(o.scrollWrap,"mouseover",u.onMouseOver)}),e("unbindEvents",function(){r&&clearInterval(r),l.unbind(document,"mouseout",w),l.unbind(document,"mousemove",y),l.unbind(n,"pswpTap click",m),l.unbind(o.scrollWrap,"pswpTap",u.onGlobalTap),l.unbind(o.scrollWrap,"mouseover",u.onMouseOver),i&&(l.unbind(document,i.eventK,u.updateFullscreen),i.isFullscreen()&&(d.hideAnimationDuration=0,i.exit()),i=null)}),e("destroy",function(){d.captionEl&&(_fakeCaptionContainer&&n.removeChild(_fakeCaptionContainer),l.removeClass(_captionContainer,"pswp__caption--empty")),l.removeClass(n,"pswp__ui--over-close"),l.addClass(n,"pswp__ui--hidden"),u.setIdle(!1)}),d.showAnimationDuration||l.removeClass(n,"pswp__ui--hidden"),e("initialZoomInEnd",function(){d.showAnimationDuration&&l.removeClass(n,"pswp__ui--hidden")}),e("initialZoomOut",function(){l.addClass(n,"pswp__ui--hidden")}),function(){var a,r,s,e=function(e){if(e){for(var t=e.length,i=[],o=0;o<t;o++){a=e[o],r=a.className;for(var n=0;n<_.length;n++)s=_[n],-1<r.indexOf("pswp__"+s.name)&&(d[s.option]?(l.removeClass(a,"pswp__element--disabled"),i.push(a),s.onInit&&s.onInit(a)):l.addClass(a,"pswp__element--disabled"))}i.length}};e(n.children);for(var t=n.querySelectorAll(".pswp__group"),i=0;i<t.length;i++)e(t[i].children)}(),d.timeToIdle&&e("mouseUsed",function(){l.bind(document,"mousemove",y),l.bind(document,"mouseout",w),r=setInterval(function(){2==++b&&u.setIdle(!0)},d.timeToIdle/2)}),clearTimeout(h),h=setTimeout(function(){u.setIdle(!0)},d.timeToIdleOutside),d.fullscreenEl&&!l.features.isOldAndroid&&(i||(i=u.getFullscreenAPI()),i?(l.bind(document,i.eventK,u.updateFullscreen),u.updateFullscreen(),l.addClass(o.template,"pswp--supports-fs")):l.removeClass(o.template,"pswp--supports-fs"))},u.setIdle=function(e){f(n,"ui--idle",s=e)},u.update=function(){t=!(!g||!o.currItem)},u.updateFullscreen=function(e){e&&setTimeout(function(){o.setScrollOffset(0,l.getScrollY())},50),l[(i.isFullscreen()?"add":"remove")+"Class"](o.template,"pswp--fs")},u.onGlobalTap=function(e){var t=(e=e||ii.event).target||e.srcElement;if(!c)if(e.detail&&"mouse"===e.detail.pointerType){if(v(t))return void o.close();if(l.hasClass(t,"pswp__img")){if(d.disableZoom)return void o.close();if(1===o.getZoomLevel()&&o.getZoomLevel()<=o.currItem.fitRatio){if(d.clickToCloseNonZoomable)return void o.close()}else o.toggleDesktopZoom(e.detail.releasePoint)}}else if(d.tapToToggleControls&&(g?u.hideControls():u.showControls()),d.tapToClose&&(l.hasClass(t,"pswp__img")||v(t)))return void o.close()},u.onMouseOver=function(e){var t=(e=e||ii.event).target||e.srcElement;f(n,"ui--over-close",v(t))},u.hideControls=function(){l.addClass(n,"pswp__ui--hidden"),g=!1},u.showControls=function(){g=!0,t||u.update(),l.removeClass(n,"pswp__ui--hidden")},u.toggleFullscreen=function(){i.isFullscreen()?i.exit():i.enter()},u.supportsFullscreen=function(){var e=document;return!!(e.exitFullscreen||e.mozCancelFullScreen||e.webkitExitFullscreen||e.msExitFullscreen)},u.getFullscreenAPI=function(){var e,t=document.documentElement,i="fullscreenchange";return t.requestFullscreen?e={enterK:"requestFullscreen",exitK:"exitFullscreen",elementK:"fullscreenElement",eventK:i}:t.mozRequestFullScreen?e={enterK:"mozRequestFullScreen",exitK:"mozCancelFullScreen",elementK:"mozFullScreenElement",eventK:"moz"+i}:t.webkitRequestFullscreen?e={enterK:"webkitRequestFullscreen",exitK:"webkitExitFullscreen",elementK:"webkitFullscreenElement",eventK:"webkit"+i}:t.msRequestFullscreen&&(e={enterK:"msRequestFullscreen",exitK:"msExitFullscreen",elementK:"msFullscreenElement",eventK:"MSFullscreenChange"}),e&&(e.enter=function(){if(a=d.closeOnScroll,d.closeOnScroll=!1,"webkitRequestFullscreen"!==this.enterK)return o.template[this.enterK]();o.template[this.enterK](Element.ALLOW_KEYBOARD_INPUT)},e.exit=function(){return d.closeOnScroll=a,document[this.exitK]()},e.isFullscreen=function(){return document[this.elementK]}),e}}}.call(window.lightbox={},window),function(){"use strict";new MobileAdjustments,window.baseUnit=new BaseUnit,Cargo.Event.on("element_resizer_init",function(e){e.setOptions({cargo_refreshEvents:["inline-editor-load-complete","inspector_preview","page_collection_reset","direct_link_loaded","mobile_padding_set"],generic_refreshEvents:[],updateEvents:["resize","orientationchange"],forceVerticalMargin:0,forceMobileImagesFullWidth:Cargo.Model.DisplayOptions.get("layout_options").mobile_images_full_width,adjustElementsToWindowHeight:Cargo.Model.DisplayOptions.get("layout_options").limit_vertical_images,scrollTransitionThreshold:-100,scrollTransition:Cargo.Model.DisplayOptions.get("layout_options").scroll_transition,centerElements:!1,allowInit:!0})})}(),function(global,setTimeout){function commentReplace(e,t){return t||""}function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){var i;if(e)for(i=0;i<e.length&&(!e[i]||!t(e[i],i,e));i+=1);}function eachReverse(e,t){var i;if(e)for(i=e.length-1;-1<i&&(!e[i]||!t(e[i],i,e));i-=1);}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var i;for(i in e)if(hasProp(e,i)&&t(e[i],i))break}function mixin(i,e,o,n){return e&&eachProp(e,function(e,t){!o&&hasProp(i,t)||(!n||"object"!=typeof e||!e||isArray(e)||isFunction(e)||e instanceof RegExp?i[t]=e:(i[t]||(i[t]={}),mixin(i[t],e,o,n)))}),i}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,i,o){var n=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return n.requireType=e,n.requireModules=o,i&&(n.originalError=i),n}function newContext(l){function g(e,t,i){var o,n,a,r,s,l,d,c,h,u,g=t&&t.split("/"),p=x.map,m=p&&p["*"];if(e&&(l=(e=e.split("/")).length-1,x.nodeIdCompat&&jsSuffixRegExp.test(e[l])&&(e[l]=e[l].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&g&&(e=g.slice(0,g.length-1).concat(e)),function(e){var t,i;for(t=0;t<e.length;t++)if("."===(i=e[t]))e.splice(t,1),t-=1;else if(".."===i){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;0<t&&(e.splice(t-1,2),t-=2)}}(e),e=e.join("/")),i&&p&&(g||m)){e:for(a=(n=e.split("/")).length;0<a;a-=1){if(s=n.slice(0,a).join("/"),g)for(r=g.length;0<r;r-=1)if((o=getOwn(p,g.slice(0,r).join("/")))&&(o=getOwn(o,s))){d=o,c=a;break e}!h&&m&&getOwn(m,s)&&(h=getOwn(m,s),u=a)}!d&&h&&(d=h,c=u),d&&(n.splice(0,c,d),e=n.join("/"))}return getOwn(x.pkgs,e)||e}function d(t){isBrowser&&each(scripts(),function(e){if(e.getAttribute("data-requiremodule")===t&&e.getAttribute("data-requirecontext")===C.contextName)return e.parentNode.removeChild(e),!0})}function c(e){var t=getOwn(x.paths,e);if(t&&isArray(t)&&1<t.length)return t.shift(),C.require.undef(e),C.makeRequire(null,{skipMap:!0})([e]),!0}function p(e){var t,i=e?e.indexOf("!"):-1;return-1<i&&(t=e.substring(0,i),e=e.substring(i+1,e.length)),[t,e]}function h(e,t,i,o){var n,a,r,s,l=null,d=t?t.name:null,c=e,h=!0,u="";return e||(h=!1,e="_@r"+(O+=1)),l=(s=p(e))[0],e=s[1],l&&(l=g(l,d,o),a=getOwn(A,l)),e&&(l?u=a&&a.normalize?a.normalize(e,function(e){return g(e,d,o)}):-1===e.indexOf("!")?g(e,d,o):e:(l=(s=p(u=g(e,d,o)))[0],u=s[1],i=!0,n=C.nameToUrl(u))),{prefix:l,name:u,parentMap:t,unnormalized:!!(r=!l||a||i?"":"_unnormalized"+(L+=1)),url:n,originalName:c,isDefine:h,id:(l?l+"!"+u:u)+r}}function u(e){var t=e.id,i=getOwn(E,t);return i||(i=E[t]=new C.Module(e)),i}function m(e,t,i){var o=e.id,n=getOwn(E,o);!hasProp(A,o)||n&&!n.defineEmitComplete?(n=u(e)).error&&"error"===t?i(n.error):n.on(t,i):"defined"===t&&i(A[o])}function f(i,e){var t=i.requireModules,o=!1;e?e(i):(each(t,function(e){var t=getOwn(E,e);t&&(t.error=i,t.events.error&&(o=!0,t.emit("error",i)))}),o||req.onError(i))}function v(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(C.defQueueMap[t]=!0),T.push(e)}),globalDefQueue=[])}function b(e){delete E[e],delete I[e]}function y(){var e,o,t=1e3*x.waitSeconds,n=t&&C.startTime+t<(new Date).getTime(),a=[],r=[],s=!1,l=!0;if(!_){if(_=!0,eachProp(I,function(e){var t=e.map,i=t.id;if(e.enabled&&(t.isDefine||r.push(e),!e.error))if(!e.inited&&n)c(i)?s=o=!0:(a.push(i),d(i));else if(!e.inited&&e.fetched&&t.isDefine&&(s=!0,!t.prefix))return l=!1}),n&&a.length)return(e=makeError("timeout","Load timeout for modules: "+a,null,a)).contextName=C.contextName,f(e);l&&each(r,function(e){!function n(a,r,s){var e=a.map.id;a.error?a.emit("error",a.error):(r[e]=!0,each(a.depMaps,function(e,t){var i=e.id,o=getOwn(E,i);!o||a.depMatched[t]||s[i]||(getOwn(r,i)?(a.defineDep(t,A[i]),a.check()):n(o,r,s))}),s[e]=!0)}(e,{},{})}),n&&!o||!s||!isBrowser&&!isWebWorker||k||(k=setTimeout(function(){k=0,y()},50)),_=!1}}function r(e){hasProp(A,e[0])||u(h(e[0],null,!0)).init(e[1],e[2])}function i(e,t,i,o){e.detachEvent&&!isOpera?o&&e.detachEvent(o,t):e.removeEventListener(i,t,!1)}function n(e){var t=e.currentTarget||e.srcElement;return i(t,C.onScriptLoad,"load","onreadystatechange"),i(t,C.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function w(){var e;for(v();T.length;){if(null===(e=T.shift())[0])return f(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));r(e)}C.defQueueMap={}}var _,e,C,S,k,x={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},E={},I={},o={},T=[],A={},M={},P={},O=1,L=1;return S={require:function(e){return e.require?e.require:e.require=C.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?A[e.map.id]=e.exports:e.exports=A[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(x.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},(e=function(e){this.events=getOwn(o,e.id)||{},this.map=e,this.shim=getOwn(x.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0}).prototype={init:function(e,t,i,o){o=o||{},this.inited||(this.factory=t,i?this.on("error",i):this.events.error&&(i=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=i,this.inited=!0,this.ignore=o.ignore,o.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,C.startTime=(new Date).getTime();var e=this.map;return this.shim?void C.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()})):e.prefix?this.callPlugin():this.load()}},load:function(){var e=this.map.url;M[e]||(M[e]=!0,C.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,i=this.map.id,o=this.depExports,n=this.exports,a=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(a)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{n=C.execCb(i,a,o,n)}catch(t){e=t}else n=C.execCb(i,a,o,n);if(this.map.isDefine&&void 0===n&&((t=this.module)?n=t.exports:this.usingExports&&(n=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",f(this.error=e)}else n=a;if(this.exports=n,this.map.isDefine&&!this.ignore&&(A[i]=n,req.onResourceLoad)){var r=[];each(this.depMaps,function(e){r.push(e.normalizedMap||e)}),req.onResourceLoad(C,this.map,r)}b(i),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(C.defQueueMap,i)||this.fetch()}},callPlugin:function(){var l=this.map,d=l.id,e=h(l.prefix);this.depMaps.push(e),m(e,"defined",bind(this,function(e){var a,t,i,o=getOwn(P,this.map.id),n=this.map.name,r=this.map.parentMap?this.map.parentMap.name:null,s=C.makeRequire(l.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(e.normalize&&(n=e.normalize(n,function(e){return g(e,r,!0)})||""),m(t=h(l.prefix+"!"+n,this.map.parentMap),"defined",bind(this,function(e){this.map.normalizedMap=t,this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),void((i=getOwn(E,t.id))&&(this.depMaps.push(t),this.events.error&&i.on("error",bind(this,function(e){this.emit("error",e)})),i.enable()))):o?(this.map.url=C.nameToUrl(o),void this.load()):((a=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})})).error=bind(this,function(e){this.inited=!0,(this.error=e).requireModules=[d],eachProp(E,function(e){0===e.map.id.indexOf(d+"_unnormalized")&&b(e.map.id)}),f(e)}),a.fromText=bind(this,function(e,t){var i=l.name,o=h(i),n=useInteractive;t&&(e=t),n&&(useInteractive=!1),u(o),hasProp(x.config,d)&&(x.config[i]=x.config[d]);try{req.exec(e)}catch(e){return f(makeError("fromtexteval","fromText eval for "+d+" failed: "+e,e,[d]))}n&&(useInteractive=!0),this.depMaps.push(o),C.completeLoad(i),s([i],a)}),void e.load(l.name,s,a,x))})),C.enable(e,this),this.pluginMaps[e.id]=e},enable:function(){(I[this.map.id]=this).enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var i,o,n;if("string"==typeof e){if(e=h(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,n=getOwn(S,e.id))return void(this.depExports[t]=n(this));this.depCount+=1,m(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?m(e,"error",bind(this,this.errback)):this.events.error&&m(e,"error",bind(this,function(e){this.emit("error",e)}))}i=e.id,o=E[i],hasProp(S,i)||!o||o.enabled||C.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(E,e.id);t&&!t.enabled&&C.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var i=this.events[e];i||(i=this.events[e]=[]),i.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},(C={config:x,contextName:l,registry:E,defined:A,urlFetched:M,defQueue:T,defQueueMap:{},Module:e,makeModuleMap:h,nextTick:req.nextTick,onError:f,configure:function(e){if(e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs){var i=e.urlArgs;e.urlArgs=function(e,t){return(-1===t.indexOf("?")?"?":"&")+i}}var o=x.shim,n={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){n[t]?(x[t]||(x[t]={}),mixin(x[t],e,!0,!0)):x[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(P[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,t){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=C.makeShimExports(e)),o[t]=e}),x.shim=o),e.packages&&each(e.packages,function(e){var t;t=(e="string"==typeof e?{name:e}:e).name,e.location&&(x.paths[t]=e.location),x.pkgs[t]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(E,function(e,t){e.inited||e.map.unnormalized||(e.map=h(t,null,!0))}),(e.deps||e.callback)&&C.require(e.deps||[],e.callback)},makeShimExports:function(t){return function(){var e;return t.init&&(e=t.init.apply(global,arguments)),e||t.exports&&getGlobal(t.exports)}},makeRequire:function(a,r){function s(e,t,i){var o,n;return r.enableBuildCallback&&t&&isFunction(t)&&(t.__requireJsBuild=!0),"string"==typeof e?isFunction(t)?f(makeError("requireargs","Invalid require call"),i):a&&hasProp(S,e)?S[e](E[a.id]):req.get?req.get(C,e,a,s):(o=h(e,a,!1,!0).id,hasProp(A,o)?A[o]:f(makeError("notloaded",'Module name "'+o+'" has not been loaded yet for context: '+l+(a?"":". Use require([])")))):(w(),C.nextTick(function(){w(),(n=u(h(null,a))).skipMap=r.skipMap,n.init(e,t,i,{enabled:!0}),y()}),s)}return r=r||{},mixin(s,{isBrowser:isBrowser,toUrl:function(e){var t,i=e.lastIndexOf("."),o=e.split("/")[0];return-1!==i&&(!("."===o||".."===o)||1<i)&&(t=e.substring(i,e.length),e=e.substring(0,i)),C.nameToUrl(g(e,a&&a.id,!0),t,!0)},defined:function(e){return hasProp(A,h(e,a,!1,!0).id)},specified:function(e){return e=h(e,a,!1,!0).id,hasProp(A,e)||hasProp(E,e)}}),a||(s.undef=function(i){v();var e=h(i,a,!0),t=getOwn(E,i);t.undefed=!0,d(i),delete A[i],delete M[e.url],delete o[i],eachReverse(T,function(e,t){e[0]===i&&T.splice(t,1)}),delete C.defQueueMap[i],t&&(t.events.defined&&(o[i]=t.events),b(i))}),s},enable:function(e){getOwn(E,e.id)&&u(e).enable()},completeLoad:function(e){var t,i,o,n=getOwn(x.shim,e)||{},a=n.exports;for(v();T.length;){if(null===(i=T.shift())[0]){if(i[0]=e,t)break;t=!0}else i[0]===e&&(t=!0);r(i)}if(C.defQueueMap={},o=getOwn(E,e),!t&&!hasProp(A,e)&&o&&!o.inited){if(!(!x.enforceDefine||a&&getGlobal(a)))return c(e)?void 0:f(makeError("nodefine","No define call for "+e,null,[e]));r([e,n.deps||[],n.exportsFn])}y()},nameToUrl:function(e,t,i){var o,n,a,r,s,l,d=getOwn(x.pkgs,e);if(d&&(e=d),l=getOwn(P,e))return C.nameToUrl(l,t,i);if(req.jsExtRegExp.test(e))r=e+(t||"");else{for(o=x.paths,a=(n=e.split("/")).length;0<a;a-=1)if(s=getOwn(o,n.slice(0,a).join("/"))){isArray(s)&&(s=s[0]),n.splice(0,a,s);break}r=n.join("/"),r=("/"===(r+=t||(/^data\:|^blob\:|\?/.test(r)||i?"":".js")).charAt(0)||r.match(/^[\w\+\.\-]+:/)?"":x.baseUrl)+r}return x.urlArgs&&!/^blob\:/.test(r)?r+x.urlArgs(e,r):r},load:function(e,t){req.load(C,e,t)},execCb:function(e,t,i,o){return t.apply(o,i)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=n(e);C.completeLoad(t.id)}},onScriptError:function(e){var i=n(e);if(!c(i.id)){var o=[];return eachProp(E,function(e,t){0!==t.indexOf("_@r")&&each(e.depMaps,function(e){if(e.id===i.id)return o.push(t),!0})}),f(makeError("scripterror",'Script error for "'+i.id+(o.length?'", needed by: '+o.join(", "):'"'),e,[i.id]))}}}).require=C.makeRequire(),C}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState||eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript}var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.3.2",commentRegExp=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,i,o){var n,a,r=defContextName;return isArray(e)||"string"==typeof e||(a=e,isArray(t)?(e=t,t=i,i=o):e=[]),a&&a.context&&(r=a.context),(n=getOwn(contexts,r))||(n=contexts[r]=req.s.newContext(r)),a&&n.configure(a),n.require(e,t,i)},req.config=function(e){return req(e)},req.nextTick=void 0!==setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(t){req[t]=function(){var e=contexts[defContextName];return e.require[t].apply(e,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,i){var o=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return o.type=e.scriptType||"text/javascript",o.charset="utf-8",o.async=!0,o},req.load=function(e,t,i){var o,n=e&&e.config||{};if(isBrowser)return(o=req.createNode(n,t,i)).setAttribute("data-requirecontext",e.contextName),o.setAttribute("data-requiremodule",t),!o.attachEvent||o.attachEvent.toString&&o.attachEvent.toString().indexOf("[native code")<0||isOpera?(o.addEventListener("load",e.onScriptLoad,!1),o.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,o.attachEvent("onreadystatechange",e.onScriptLoad)),o.src=i,n.onNodeCreated&&n.onNodeCreated(o,n,t,i),currentlyAddingScript=o,baseElement?head.insertBefore(o,baseElement):head.appendChild(o),currentlyAddingScript=null,o;if(isWebWorker)try{setTimeout(function(){},0),importScripts(i),e.completeLoad(t)}catch(o){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+i,o,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||-1!==mainScript.indexOf("!")||(mainScript=(src=mainScript.split("/")).pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,i,t){var o,n;"string"!=typeof e&&(t=i,i=e,e=null),isArray(i)||(t=i,i=null),!i&&isFunction(t)&&(i=[],t.length&&(t.toString().replace(commentRegExp,commentReplace).replace(cjsRequireRegExp,function(e,t){i.push(t)}),i=(1===t.length?["require"]:["require","exports","module"]).concat(i))),useInteractive&&((o=currentlyAddingScript||getInteractiveScript())&&(e||(e=o.getAttribute("data-requiremodule")),n=contexts[o.getAttribute("data-requirecontext")])),n?(n.defQueue.push([e,i,t]),n.defQueueMap[e]=!0):globalDefQueue.push([e,i,t])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}}(this,"undefined"==typeof setTimeout?void 0:setTimeout);